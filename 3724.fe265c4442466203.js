"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[3724],{23724:(I,c,r)=>{r.r(c),r.d(c,{default:()=>E});var l=r(15861),n=r(50484),p=r(57964),y=r(1258),d=r(77675),o=r(80543),m=(r(14007),r(4703),r(65311),r(10141)),v=r(93792),g=r(58304),C=r(9395),S=r(74321);const P=t=>{let s=class extends t{resume(){this._isUserPaused=!1,this.suspended||this._doResume()}pause(){this._isUserPaused=!0,this.suspended||this._doPause()}disconnect(){this._doDisconnect()}connect(){this._doConnect()}clear(){this._doClear()}constructor(...e){super(...e),this._isUserPaused=!1,this.filter=null}get connectionStatus(){return(this._isUserPaused||this.suspended)&&"connected"===this._streamConnectionStatus?"paused":this._streamConnectionStatus}_onSuspendedChange(e){e?this._doPause():this._isUserPaused||this._doResume()}};return(0,n._)([(0,o.Cb)()],s.prototype,"_isUserPaused",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],s.prototype,"connectionStatus",null),(0,n._)([(0,o.Cb)({type:S.Z})],s.prototype,"filter",void 0),s=(0,n._)([(0,m.j)("esri.views.layers.StreamLayerView")],s),s};let a=class extends(P(g.default)){constructor(){super(...arguments),this.pipelineConnectionStatus="disconnected",this.pipelineErrorString=null}initialize(){var t=this;this.addHandles([(0,d.YP)(()=>this.layer.customParameters,function(){var s=(0,l.Z)(function*(e){(yield t.getWorker()).streamMessenger.updateCustomParameters(e)});return function(e){return s.apply(this,arguments)}}()),this.layer.on("send-message-to-socket",function(){var s=(0,l.Z)(function*(e){(yield t.getWorker()).streamMessenger.sendMessageToSocket(e)});return function(e){return s.apply(this,arguments)}}()),this.layer.on("send-message-to-client",function(){var s=(0,l.Z)(function*(e){(yield t.getWorker()).streamMessenger.sendMessageToClient(e),t._isUserPaused&&"type"in e&&"clear"===e.type&&t.incrementSourceRefreshVersion()});return function(e){return s.apply(this,arguments)}}()),(0,d.YP)(()=>this.layer.purgeOptions,()=>this._update()),(0,d.YP)(()=>this.suspended,this._onSuspendedChange.bind(this))],"constructor"),this._doResume()}destroy(){this._doPause()}get connectionError(){return this.pipelineErrorString?new p.Z("stream-controller",this.pipelineErrorString):null}on(t,s){if(Array.isArray(t))return(0,y.AL)(t.map(i=>this.on(i,s)));const e=["data-received","message-received"].includes(t);e&&this.getWorker().then(i=>i.streamMessenger.enableEvent(t,!0));const h=super.on(t,s),u=this;return(0,y.kB)(()=>{h.remove(),e&&(u._workerProxy.closed||u.hasEventListener(t)||u.getWorker().then(i=>i.streamMessenger.enableEvent(t,!1)))})}queryLatestObservations(t,s){var e=this;return(0,l.Z)(function*(){if(!(e.layer.timeInfo?.endField||e.layer.timeInfo?.startField||e.layer.timeInfo?.trackIdField))throw new p.Z("streamlayer-no-timeField","queryLatestObservation can only be used with services that define a TrackIdField");const h=yield e.getWorker();return(0,C.Y)(h.features.executeQueryForLatestObservations(e._cleanUpQuery(t),s).then(u=>{const i=v.Z.fromJSON(u);return i.features.forEach(f=>{f.layer=e.layer,f.sourceLayer=e.layer}),i}),new v.Z({features:[]}))})()}detach(){super.detach(),this.pipelineConnectionStatus="disconnected"}get _streamConnectionStatus(){return this.pipelineConnectionStatus}_doPause(){null!=this._refreshInterval&&(clearInterval(this._refreshInterval),this._refreshInterval=null)}_doResume(){this._refreshInterval=setInterval(()=>this.incrementSourceRefreshVersion(),this.layer.updateInterval)}_doDisconnect(){this.getWorker().then(t=>t.streamMessenger.disconnect()),this._doPause()}_doConnect(){this.getWorker().then(t=>t.streamMessenger.connect()),this.resume()}_doClear(){this.getWorker().then(t=>t.streamMessenger.clear()),null==this._refreshInterval&&this.incrementSourceRefreshVersion()}_createClientOptions(){const t=super._createClientOptions(),s=this;return{...t,get container(){return s.featureContainer},setProperty:e=>{this.set(e.propertyName,e.value)}}}};(0,n._)([(0,o.Cb)()],a.prototype,"pipelineConnectionStatus",void 0),(0,n._)([(0,o.Cb)()],a.prototype,"pipelineErrorString",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],a.prototype,"connectionError",null),(0,n._)([(0,o.Cb)({readOnly:!0})],a.prototype,"_streamConnectionStatus",null),a=(0,n._)([(0,m.j)("esri.views.2d.layers.StreamLayerView2D")],a);const E=a}}]);