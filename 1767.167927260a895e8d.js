"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[1767],{6118:(Z,f,e)=>{e.d(f,{JZ:()=>T,RL:()=>B,eY:()=>b});var y=e(15861),l=e(79412),r=e(92899),g=e(44406),n=e(93266),I=e(64456),c=e(98634),C=e(39237),F=e(17091),D=e(22784);function T(h){return h&&"render"in h}function B(h){const t=document.createElement("canvas");return t.width=h.width,t.height=h.height,h.render(t.getContext("2d")),t}class b extends I.s{constructor(t=null,s=!1){super(),this.blendFunction="standard",this._sourceWidth=0,this._sourceHeight=0,this._textureInvalidated=!1,this._texture=null,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.immutable=s,this.source=t,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null),null!=this._uploadStatus&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(t){this._height=t}get source(){return this._source}set source(t){null==t&&null==this._source||(this._source=t,this.invalidateTexture(),this.requestRender())}get width(){return void 0!==this._width?this._width:this._sourceWidth}set width(t){this._width=t}beforeRender(t){super.beforeRender(t),this.updateTexture(t)}setSourceAsync(t,s){var i=this;return(0,y.Z)(function*(){null!=i._uploadStatus&&i._uploadStatus.controller.abort();const p=new AbortController,d=(0,l.hh)();return(0,l.$F)(s,()=>p.abort()),(0,l.$F)(p,u=>d.reject(u)),i._uploadStatus={controller:p,resolver:d},i.source=t,d.promise})()}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):this._source&&(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width))}updateTransitionProperties(t,s){t>=64&&(this.fadeTransitionEnabled=!1,this.inFadeTransition=!1),super.updateTransitionProperties(t,s)}setTransform(t){const s=(0,r.yR)(this.transforms.displayViewScreenMat3),[i,p]=t.toScreenNoRotation([0,0],[this.x,this.y]),d=this.resolution/this.pixelRatio/t.resolution,u=d*this.width,v=d*this.height,o=Math.PI*this.rotation/180;(0,r.Iu)(s,s,(0,n.al)(i,p)),(0,r.Iu)(s,s,(0,n.al)(u/2,v/2)),(0,r.U1)(s,s,-o),(0,r.Iu)(s,s,(0,n.al)(-u/2,-v/2)),(0,r.ex)(s,s,(0,n.al)(u,v)),(0,r.Jp)(this.transforms.displayViewScreenMat3,t.displayViewMat3,s)}setSamplingProfile(t){this._texture&&(t.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(t.samplingMode))}bind(t,s){this._texture&&t.bindTexture(this._texture,s)}updateTexture({context:t,painter:s}){var i=this;return(0,y.Z)(function*(){if(!i._textureInvalidated)return;if(i._textureInvalidated=!1,i._texture||(i._texture=i._createTexture(t)),!i.source)return void i._texture.setData(null);i._texture.resize(i._sourceWidth,i._sourceHeight);const p=function U(h){return T(h)?h instanceof c.Z?h.getRenderedRasterPixels()?.renderedRasterPixels:B(h):h}(i.source);try{if(null!=i._uploadStatus){const{controller:d,resolver:u}=i._uploadStatus,v={signal:d.signal},{width:o,height:a}=i,x=i._texture;yield s.textureUploadManager.enqueueTextureUpdate({data:p,texture:x,width:o,height:a},v),u.resolve(),i._uploadStatus=null}else i._texture.setData(p);i.ready()}catch(d){(0,l.H9)(d)}})()}onDetach(){this.destroy()}_createTransforms(){return{displayViewScreenMat3:(0,g.Ue)()}}_createTexture(t){const s=this.immutable,i=new D.X;return i.internalFormat=s?C.lP.RGBA8:C.VI.RGBA,i.wrapMode=C.e8.CLAMP_TO_EDGE,i.isImmutable=s,i.width=this._sourceWidth,i.height=this._sourceHeight,new F.x(t,i)}}},98634:(Z,f,e)=>{e.d(f,{Z:()=>y});class y{constructor(r,g,n){this.pixelBlock=r,this.extent=g,this.originalPixelBlock=n}get width(){return null!=this.pixelBlock?this.pixelBlock.width:0}get height(){return null!=this.pixelBlock?this.pixelBlock.height:0}render(r){const g=this.pixelBlock;if(null==g)return;const n=this.filter({extent:this.extent,pixelBlock:this.originalPixelBlock??g});if(null==n.pixelBlock)return;n.pixelBlock.maskIsAlpha&&(n.pixelBlock.premultiplyAlpha=!0);const I=n.pixelBlock.getAsRGBA(),c=r.createImageData(n.pixelBlock.width,n.pixelBlock.height);c.data.set(I),r.putImageData(c,0,0)}getRenderedRasterPixels(){const r=this.filter({extent:this.extent,pixelBlock:this.pixelBlock});return null==r.pixelBlock?null:(r.pixelBlock.maskIsAlpha&&(r.pixelBlock.premultiplyAlpha=!0),{width:r.pixelBlock.width,height:r.pixelBlock.height,renderedRasterPixels:new Uint8Array(r.pixelBlock.getAsRGBA().buffer)})}}},21774:(Z,f,e)=>{e.r(f),e.d(f,{default:()=>v});var y=e(15861),l=e(50484),r=e(4703),g=e(51172),n=e(79412),I=e(77675),c=e(80543),D=(e(14007),e(65311),e(10141)),T=e(26894),B=e(81065),U=e(83124),b=e(87653),h=e(50145),t=e(32126),s=e(57964),i=e(6523),p=e(18276);const d=o=>{let a=class extends o{initialize(){this.exportImageParameters=new i.j({layer:this.layer})}destroy(){this.exportImageParameters=(0,g.SC)(this.exportImageParameters)}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}get timeExtent(){return(0,p.h)(this.layer,this.view?.timeExtent,this._get("timeExtent"))}fetchPopupFeaturesAtLocation(x,_){var E=this;return(0,y.Z)(function*(){const{layer:R}=E;if(!x)throw new s.Z("wmslayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:R});const{popupEnabled:m}=R;if(!m)throw new s.Z("wmslayerview:fetchPopupFeatures","popupEnabled should be true",{popupEnabled:m});const P=E.createFetchPopupFeaturesQuery(x);if(!P)return[];const{extent:w,width:M,height:S,x:O,y:W}=P;if(!(w&&M&&S))throw new s.Z("wmslayerview:fetchPopupFeatures","WMSLayer does not support fetching features.",{extent:w,width:M,height:S});const A=yield R.fetchFeatureInfo(w,M,S,O,W);return(0,n.k_)(_),A})()}};return(0,l._)([(0,c.Cb)()],a.prototype,"exportImageParameters",void 0),(0,l._)([(0,c.Cb)({readOnly:!0})],a.prototype,"exportImageVersion",null),(0,l._)([(0,c.Cb)()],a.prototype,"layer",void 0),(0,l._)([(0,c.Cb)({readOnly:!0})],a.prototype,"timeExtent",null),a=(0,l._)([(0,D.j)("esri.views.layers.WMSLayerView")],a),a};let u=class extends(d((0,t.Z)((0,U.y)(h.Z)))){constructor(){super(...arguments),this.bitmapContainer=new B.c}supportsSpatialReference(o){return this.layer.serviceSupportsSpatialReference(o)}update(o){this.strategy.update(o).catch(a=>{(0,n.D_)(a)||r.Z.getLogger(this).error(a)})}attach(){const{layer:o}=this,{imageMaxHeight:a,imageMaxWidth:x}=o;this.bitmapContainer=new B.c,this.container.addChild(this.bitmapContainer),this.strategy=new b.Z({container:this.bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:a,imageMaxWidth:x,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.addAttachHandles((0,I.YP)(()=>this.exportImageVersion,()=>this.requestUpdate()))}detach(){this.strategy=(0,g.SC)(this.strategy),this.container.removeAllChildren()}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQuery(o){const{view:a,bitmapContainer:x}=this,{x:_,y:E}=o,{spatialReference:R}=a;let m,P=0,w=0;if(x.children.some(W=>{const{width:A,height:V,resolution:H,x:L,y:j}=W,K=L+H*A,G=j-H*V;return _>=L&&_<=K&&E<=j&&E>=G&&(m=new T.Z({xmin:L,ymin:G,xmax:K,ymax:j,spatialReference:R}),P=A,w=V,!0)}),!m)return null;const M=m.width/P,S=Math.round((_-m.xmin)/M),O=Math.round((m.ymax-E)/M);return{extent:m,width:P,height:w,x:S,y:O}}doRefresh(){var o=this;return(0,y.Z)(function*(){o.requestUpdate()})()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(o,a,x,_){return this.layer.fetchImageBitmap(o,a,x,{timeExtent:this.timeExtent,..._})}};(0,l._)([(0,c.Cb)()],u.prototype,"strategy",void 0),(0,l._)([(0,c.Cb)()],u.prototype,"updating",void 0),u=(0,l._)([(0,D.j)("esri.views.2d.layers.WMSLayerView2D")],u);const v=u}}]);