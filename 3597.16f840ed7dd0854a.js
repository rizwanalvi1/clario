"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[3597],{38737:(W,w,a)=>{var u,p;a.d(w,{Y:()=>u}),(p=u||(u={}))[p.KILOBYTES=1024]="KILOBYTES",p[p.MEGABYTES=1048576]="MEGABYTES",p[p.GIGABYTES=1073741824]="GIGABYTES"},52540:(W,w,a)=>{a.d(w,{z:()=>p});var u=a(39921);class p{constructor(f,T){this._storage=new u.WJ,this.id="",this.name="",this.size=0,this._storage.maxSize=f,this._storage.register(this),T&&this._storage.registerRemoveFunc("",T)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(f,T,c=1){this._storage.put(this,f,T,c,1)}pop(f){return this._storage.pop(this,f)}get(f){return this._storage.get(this,f)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(f){this._storage.maxSize=f}resetHitRate(){}}},39921:(W,w,a)=>{a.d(w,{WJ:()=>c,Xq:()=>T});var f,_,u=a(43029);(_=f||(f={}))[_.ALL=0]="ALL",_[_.SOME=1]="SOME";class T{constructor(t,e,s){this.name=t,this._storage=e,this.id=O+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),s&&(this._storage.registerRemoveFunc(this.id,s),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(t){return this._storage.getSize(this,t)}resetHitRate(){this._hit=this._miss=0}put(t,e,s,l=0){this._storage.put(this,t,e,s,l)}pop(t){const e=this._storage.pop(this,t);return void 0===e?++this._miss:++this._hit,e}get(t){const e=this._storage.get(this,t);return void 0===e?++this._miss:++this._hit,e}peek(t){return this._storage.peek(this,t)}updateSize(t,e,s){this._storage.updateSize(this,t,e,s)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class c{get size(){return this._size}constructor(t=10485760){this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new u.Z,this._users=new u.Z}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(t){this._users.push(t)}deregister(t){this._users.removeUnordered(t)}registerRemoveFunc(t,e){this._removeFuncs.push([t,e])}deregisterRemoveFunc(t){this._removeFuncs.filterInPlace(e=>e[0]!==t)}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,-1),this._checkSize()}getSize(t,e){return this._db.get(t.id+e)?.size??0}put(t,e,s,l,v){const r=this._db.get(e=t.id+e);if(r&&(this._size-=r.size,t.size-=r.size,this._db.delete(e),r.entry!==s&&this._notifyRemove(e,r.entry,r.size,f.ALL)),l>this._maxSize)return void this._notifyRemove(e,s,l,f.ALL);if(void 0===s)return void console.warn("Refusing to cache undefined entry ");if(!l||l<0)return console.warn(`Refusing to cache entry with size ${l} for key ${e}`),void this._notifyRemove(e,s,0,f.ALL);const y=1+Math.max(v,-4)- -3;this._db.set(e,new D(s,l,y)),this._size+=l,t.size+=l,this._checkSize()}updateSize(t,e,s,l){const v=this._db.get(e=t.id+e);if(v&&v.entry===s){for(this._size-=v.size,t.size-=v.size;l>this._maxSize;){const r=this._notifyRemove(e,s,l,f.SOME);if(!(null!=r&&r>0))return void this._db.delete(e);l=r}v.size=l,this._size+=l,t.size+=l,this._checkSize()}}pop(t,e){const s=this._db.get(e=t.id+e);if(s)return this._size-=s.size,t.size-=s.size,this._db.delete(e),++this._hit,s.entry;++this._miss}get(t,e){const s=this._db.get(e=t.id+e);if(void 0!==s)return this._db.delete(e),s.lives=s.lifetime,this._db.set(e,s),++this._hit,s.entry;++this._miss}peek(t,e){const s=this._db.get(t.id+e);return s?++this._hit:++this._miss,s?.entry}get performanceInfo(){const t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},e={},s=new Array;this._db.forEach((r,y)=>{const z=r.lifetime;s[z]=(s[z]||0)+r.size,this._users.forAll(Z=>{const{id:$,name:I}=Z;y.startsWith($)&&(e[I]=(e[I]||0)+r.size)})});const l={};this._users.forAll(r=>{const y=r.name;"hitRate"in r&&"number"==typeof r.hitRate&&!isNaN(r.hitRate)&&r.hitRate>0?(e[y]=e[y]||0,l[y]=Math.round(100*r.hitRate)+"%"):l[y]="0%"});const v=Object.keys(e);v.sort((r,y)=>e[y]-e[r]),v.forEach(r=>t[r]=Math.round(e[r]/2**20)+"MB / "+l[r]);for(let r=s.length-1;r>=0;--r){const y=s[r];y&&(t["Priority "+(r+-3-1)]=Math.round(y/this._size*100)+"%")}return t}resetStats(){this._hit=this._miss=0,this._users.forAll(t=>t.resetHitRate())}clear(t){const e=t.id;this._db.forEach((s,l)=>{l.startsWith(e)&&(this._size-=s.size,this._db.delete(l),this._notifyRemove(l,s.entry,s.size,f.ALL))}),t.size=0}clearAll(){this._db.forEach((t,e)=>this._notifyRemove(e,t.entry,t.size,f.ALL)),this._users.forAll(t=>t.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,e,s,l){let v;return this._removeFuncs.some(r=>{if(t.startsWith(r[0])){const y=r[1](e,l,s);return"number"==typeof y&&(v=y),!0}return!1}),v}_checkSize(){this._users.forAll(t=>this._checkSizeLimits(t)),this._checkSizeLimits()}_checkSizeLimits(t){const e=t??this;if(e.maxSize<0||e.size<=e.maxSize)return;const s=t?.id;let l=!0;for(;l;){l=!1;for(const[v,r]of this._db)if(0===r.lifetime&&(!s||v.startsWith(s))){if(this._purgeItem(v,r,t),e.size<=.9*e.maxSize)return;l||=this._db.has(v)}}for(const[v,r]of this._db)if((!s||v.startsWith(s))&&(this._purgeItem(v,r,t),e.size<=.9*e.maxSize))return}_purgeItem(t,e,s=this._users.find(l=>t.startsWith(l.id))){if(this._db.delete(t),e.lives<=1){this._size-=e.size,s&&(s.size-=e.size);const l=this._notifyRemove(t,e.entry,e.size,f.SOME);null!=l&&l>0&&(this._size+=l,s&&(s.size+=l),e.lives=e.lifetime,e.size=l,this._db.set(t,e))}else--e.lives,this._db.set(t,e)}}let O=0;class D{constructor(t,e,s){this.entry=t,this.size=e,this.lifetime=s,this.lives=s}}},13597:(W,w,a)=>{a.d(w,{Z:()=>l});var u=a(50484),S=(a(2189),a(80543)),O=(a(14007),a(4703),a(65311),a(62185)),D=a(10141),_=a(30220),t=a(58296),e=a(27627),s=a(43814);const l=v=>{let r=class extends v{constructor(){super(...arguments),this.copyright=null,this.minScale=0,this.maxScale=0,this.spatialReference=null,this.tileInfo=null,this.tilemapCache=null}destroy(){this.tilemapCache?.destroy?.()}readMinScale(y,z){return null!=z.minLOD&&null!=z.maxLOD?y:0}readMaxScale(y,z){return null!=z.minLOD&&null!=z.maxLOD?y:0}get supportsBlankTile(){return this.version>=10.2}readTilemapCache(y,z,Z){const $=z.capabilities?.includes("Tilemap");let{minLOD:I,maxLOD:C,minScale:j,maxScale:K}=z;if(null==I&&null==C&&0!==j&&0!==K){const E=x=>Math.round(1e4*x)/1e4;j=E(j||z.tileInfo.lods[0].scale),K=E(K||z.tileInfo.lods[z.tileInfo.lods.length-1].scale);for(const x of z.tileInfo.lods){const F=E(x.scale);I=F>=j?x.level:I,C=F>=K?x.level:C}}if($)return new e.y({layer:this,minLOD:I,maxLOD:C});if(z.tileInfo){const E=new _.Z;return E.read(z.tileInfo,Z),new t.Z(E,I,C)}return null}};return(0,u._)([(0,S.Cb)({json:{read:{source:"copyrightText"}}})],r.prototype,"copyright",void 0),(0,u._)([(0,S.Cb)()],r.prototype,"minScale",void 0),(0,u._)([(0,O.r)("service","minScale")],r.prototype,"readMinScale",null),(0,u._)([(0,S.Cb)()],r.prototype,"maxScale",void 0),(0,u._)([(0,O.r)("service","maxScale")],r.prototype,"readMaxScale",null),(0,u._)([(0,S.Cb)({type:s.Z})],r.prototype,"spatialReference",void 0),(0,u._)([(0,S.Cb)({readOnly:!0})],r.prototype,"supportsBlankTile",null),(0,u._)([(0,S.Cb)({type:_.Z})],r.prototype,"tileInfo",void 0),(0,u._)([(0,S.Cb)()],r.prototype,"tilemapCache",void 0),(0,u._)([(0,O.r)("service","tilemapCache",["capabilities","tileInfo"])],r.prototype,"readTilemapCache",null),(0,u._)([(0,S.Cb)()],r.prototype,"version",void 0),r=(0,u._)([(0,D.j)("esri.layers.mixins.ArcGISCachedService")],r),r}},58296:(W,w,a)=>{a.d(w,{Z:()=>f});var u=a(15861),p=a(57964),S=a(79412);class f{constructor(c,O=0,D=c.lods[c.lods.length-1].level){this.tileInfo=c,this.minLOD=O,this.maxLOD=D,c.lodAt(O)||(this.minLOD=c.lods[0].level),c.lodAt(D)||(this.maxLOD=c.lods[c.lods.length-1].level)}get effectiveMinLOD(){return this.minLOD??this.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.tileInfo.lods[this.tileInfo.lods.length-1].level}getAvailability(c,O,D){const _=this.tileInfo?.lodAt(c);return!_||c<this.minLOD||c>this.maxLOD?"unavailable":_.cols&&_.rows?D>=_.cols[0]&&D<=_.cols[1]&&O>=_.rows[0]&&O<=_.rows[1]?"unknown":"unavailable":"unknown"}fetchAvailability(c,O,D,_){var t=this;return(0,u.Z)(function*(){yield(0,S.Yn)(_);const e=t.getAvailability(c,O,D);if("unavailable"===e)throw new p.Z("tile-map:tile-unavailable","Tile is not available",{level:c,row:O,col:D});return e})()}fetchAvailabilityUpsample(c,O,D,_,t){var e=this;return(0,u.Z)(function*(){yield(0,S.Yn)(t),_.level=c,_.row=O,_.col=D;const s=e.tileInfo;return s.updateTileInfo(_),e.fetchAvailability(c,O,D,t).catch(l=>{if((0,S.D_)(l))throw l;if(s.upsampleTile(_))return e.fetchAvailabilityUpsample(_.level,_.row,_.col,_,t);throw l})})()}}},27627:(W,w,a)=>{a.d(w,{y:()=>R});var B,u=a(15861),p=a(50484),S=a(66476),f=a(73514),T=a(38737),c=a(57964),O=a(1258),_=(a(14007),a(52540)),t=a(43029),e=a(79412),s=a(77675),l=a(66679),v=a(6785),r=a(80543),Z=(a(4703),a(65311),a(10141)),$=a(74901),I=a(34222),C=a(40271);class E{constructor(n){!function H(i){if(!i?.location)throw new c.Z("tilemap:missing-location","Location missing from tilemap response");if(!1===i.valid)throw new c.Z("tilemap:invalid","Tilemap response was marked as invalid");if(!i.data)throw new c.Z("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(i.data))throw new c.Z("tilemap:data-mismatch","Data must be an array of numbers");if(i.data.length!==i.location.width*i.location.height)throw new c.Z("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}(n);const{location:h,data:o}=n;this.location=Object.freeze((0,I.d9)(h));let g=!0,A=!0;const m=function j(i,n=!1){return i<=C.c8?n?new Array(i).fill(0):new Array(i):new Uint32Array(i)}(Math.ceil(this.location.width*this.location.height/32));let P=0;for(let M=0;M<o.length;M++){const U=M%32;o[M]?(A=!1,m[P]|=1<<U):g=!1,31===U&&++P}A?(this._availability="unavailable",this.byteSize=40):g?(this._availability="available",this.byteSize=40):(this._availability=m,this.byteSize=40+(0,C.Xw)(m))}getAvailability(n,h){if("unavailable"===this._availability||"available"===this._availability)return this._availability;const o=(n-this.location.top)*this.location.width+(h-this.location.left),b=o>>5,g=this._availability;return b<0||b>g.length?"unknown":g[b]&1<<o%32?"available":"unavailable"}static fromDefinition(n,h){const o=n.service.request||S.Z,{row:d,col:b,width:g,height:A}=n,L={query:{f:"json"}};return h=h?{...L,...h}:L,o(function F(i){let n;if(i.service.tileServers?.length){const o=i.service.tileServers;n=`${o&&o.length?o[i.row%o.length]:i.service.url}/tilemap/${i.level}/${i.row}/${i.col}/${i.width}/${i.height}`}else n=`${i.service.url}/tilemap/${i.level}/${i.row}/${i.col}/${i.width}/${i.height}`;const h=i.service.query;return h&&(n=`${n}?${h}`),n}(n),h).then(m=>m.data).catch(m=>{if(422===m?.details?.httpStatus)return{location:{top:d,left:b,width:g,height:A},valid:!0,data:new Array(g*A).fill(0)};throw m}).then(m=>{if(m.location&&(m.location.top!==d||m.location.left!==b||m.location.width!==g||m.location.height!==A))throw new c.Z("tilemap:location-mismatch","Tilemap response for different location than requested",{response:m,definition:{top:d,left:b,width:g,height:A}});return E.fromJSON(m)})}static fromJSON(n){return Object.freeze(new E(n))}}function x(i){return`${i.level}/${i.row}/${i.col}/${i.width}/${i.height}`}let R=B=class extends f.Z{constructor(i){super(i),this._pendingTilemapRequests={},this.request=S.Z,this.size=32,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new _.z(2*T.Y.MEGABYTES),this.addHandles((0,s.YP)(()=>{const{layer:i}=this;return[i?.parsedUrl,i?.tileServers,i?.apiKey,i?.customParameters]},()=>this._initializeTilemapDefinition(),s.nn))}get effectiveMinLOD(){return this.minLOD??this.layer.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.layer.tileInfo.lods[this.layer.tileInfo.lods.length-1].level}getAvailability(i,n,h){if(!this.layer.tileInfo.lodAt(i)||i<this.effectiveMinLOD||i>this.effectiveMaxLOD)return"unavailable";const o=this._tilemapFromCache(i,n,h,this._tmpTilemapDefinition);return o?o.getAvailability(n,h):"unknown"}fetchAvailability(i,n,h,o){return!this.layer.tileInfo.lodAt(i)||i<this.effectiveMinLOD||i>this.effectiveMaxLOD?Promise.reject(new c.Z("tile-map:tile-unavailable","Tile is not available",{level:i,row:n,col:h})):this._fetchTilemap(i,n,h,o).catch(d=>d).then(d=>{if(d instanceof E){const b=d.getAvailability(n,h);if("unavailable"===b)throw new c.Z("tile-map:tile-unavailable","Tile is not available",{level:i,row:n,col:h});return b}if((0,e.D_)(d))throw d;return"unknown"})}fetchAvailabilityUpsample(i,n,h,o,d){o.level=i,o.row=n,o.col=h;const b=this.layer.tileInfo;b.updateTileInfo(o);const g=this.fetchAvailability(i,n,h,d).catch(A=>{if((0,e.D_)(A))throw A;if(b.upsampleTile(o))return this.fetchAvailabilityUpsample(o.level,o.row,o.col,o,d);throw A});return this._fetchAvailabilityUpsamplePrefetch(o.id,i,n,h,d,g),g}_fetchAvailabilityUpsamplePrefetch(i,n,h,o,d,b){var g=this;return(0,u.Z)(function*(){if(!g._prefetchingEnabled||null==i)return;const A=`prefetch-${i}`;if(g.hasHandles(A))return;const L=new AbortController;b.then(()=>L.abort(),()=>L.abort());let m=!1;const P=(0,O.kB)(()=>{m||(m=!0,L.abort())});if(g.addHandles(P,A),yield(0,l.MU)(10,L.signal).catch(()=>{}),m||(m=!0,g.removeHandles(A)),(0,e.Hc)(L))return;const M=new $.f(i,n,h,o),U={...d,signal:L.signal},N=g.layer.tileInfo;for(let J=0;B._prefetches.length<B._maxPrefetch&&N.upsampleTile(M);++J){const G=g.fetchAvailability(M.level,M.row,M.col,U);B._prefetches.push(G);const Y=()=>{B._prefetches.removeUnordered(G)};G.then(Y,Y)}})()}_fetchTilemap(i,n,h,o){if(!this.layer.tileInfo.lodAt(i)||i<this.effectiveMinLOD||i>this.effectiveMaxLOD)return Promise.reject(new c.Z("tilemap-cache:level-unavailable",`Level ${i} is unavailable in the service`));const d=this._tmpTilemapDefinition,b=this._tilemapFromCache(i,n,h,d);if(b)return Promise.resolve(b);const g=o?.signal;return o={...o,signal:null},new Promise((A,L)=>{(0,e.fu)(g,()=>L((0,e.zE)()));const m=x(d);let P=this._pendingTilemapRequests[m];if(!P){P=E.fromDefinition(d,o).then(U=>(this._tilemapCache.put(m,U,U.byteSize),U));const M=()=>{delete this._pendingTilemapRequests[m]};this._pendingTilemapRequests[m]=P,P.then(M,M)}P.then(A,L)})}_initializeTilemapDefinition(){if(!this.layer.parsedUrl)return;const{parsedUrl:i,apiKey:n,customParameters:h}=this.layer;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:i.path,query:(0,v.B7)({...i.query,...h,token:n??i.query?.token}),tileServers:this.layer.tileServers,request:this.request},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(i,n,h,o){o.level=i,o.row=n-n%this.size,o.col=h-h%this.size;const d=x(o);return this._tilemapCache.get(d)}get test(){}};R._maxPrefetch=4,R._prefetches=new t.Z({initialSize:B._maxPrefetch}),(0,p._)([(0,r.Cb)({constructOnly:!0})],R.prototype,"layer",void 0),(0,p._)([(0,r.Cb)({constructOnly:!0})],R.prototype,"minLOD",void 0),(0,p._)([(0,r.Cb)({constructOnly:!0})],R.prototype,"maxLOD",void 0),(0,p._)([(0,r.Cb)({constructOnly:!0})],R.prototype,"request",void 0),(0,p._)([(0,r.Cb)({constructOnly:!0})],R.prototype,"size",void 0),R=B=(0,p._)([(0,Z.j)("esri.layers.support.TilemapCache")],R)}}]);