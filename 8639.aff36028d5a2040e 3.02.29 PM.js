"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[8639,318],{28639:(N,C,s)=>{s.r(C),s.d(C,{default:()=>E});var g=s(15861),p=s(50484),j=s(66476),K=s(57964),W=s(4703),I=s(55117),T=s(3233),A=s(79412),h=s(80543),x=(s(14007),s(65311),s(10141)),a=s(43548),O=s(73145),S=s(82921),f=s(26894),m=s(43814),M=s(83639),L=s(95060),Z=s(29674),b=s(4257),G=s(27426),V=s(80099),$=s(70509),F=s(29717),R=s(56956),d=s(43688);let _=class extends((0,b.Y)((0,V.q)((0,$.I)((0,F.M)((0,T.R)((0,G.N)((0,Z.V)(L.Z)))))))){constructor(t){super(t),this.operationalLayerType="IntegratedMesh3DTilesLayer",this.spatialReference=new m.Z({wkid:4326,vcsWkid:115700}),this.fullExtent=new f.Z(-180,-90,180,90,this.spatialReference),this.url=null,this.type="integrated-mesh-3dtiles",this.path=null,this.minScale=0,this.maxScale=0}set elevationInfo(t){this._set("elevationInfo",t),this._validateElevationInfo()}_verifyArray(t,r){if(!Array.isArray(t)||t.length<r)return!1;for(const o of t)if("number"!=typeof o)return!1;return!0}_initFullExtent(t){const r=t.root?.boundingVolume;if(!r)return;if(r.box){const i=r?.box;if(i[3]>7972671&&i[7]>7972671&&i[11]>7945940)return}const o=t.root?.transform,u=(0,O.Ue)();if(r.region&&this._verifyArray(r.region,6)){const i=r.region,P=(0,I.BV)(i[0]),v=(0,I.BV)(i[1]),c=i[4],D=(0,I.BV)(i[2]),l=(0,I.BV)(i[3]);this.fullExtent=new f.Z({xmin:P,ymin:v,zmin:c,xmax:D,ymax:l,zmax:i[5],spatialReference:this.spatialReference})}else if(r.sphere&&this._verifyArray(r.sphere,4)){const i=r.sphere,P=(0,O.al)(i[0],i[1],i[2]),v=i[3]/Math.sqrt(3),c=(0,O.Ue)();(0,a.f)(c,P,(0,O.al)(v,v,v));const D=(0,O.Ue)();if((0,a.g)(D,P,(0,O.al)(v,v,v)),o&&this._verifyArray(o,16)){const H=o;(0,a.h)(u,c,H),(0,a.c)(c,u),(0,a.h)(u,D,H),(0,a.c)(D,u)}(0,M.projectBuffer)(c,S.pn,0,c,m.Z.WGS84,0,1),(0,M.projectBuffer)(D,S.pn,0,D,m.Z.WGS84,0,1);const l=(0,O.Ue)(),B=(0,O.Ue)();(0,a.y)(l,c,D),(0,a.C)(B,c,D),this.fullExtent=new f.Z({xmin:l[0],ymin:l[1],zmin:l[2],xmax:B[0],ymax:B[1],zmax:B[2],spatialReference:this.spatialReference})}else if(r.box&&this._verifyArray(r.box,12)){const i=r.box,P=(0,O.al)(i[0],i[1],i[2]),v=(0,O.al)(i[3],i[4],i[5]),c=(0,O.al)(i[6],i[7],i[8]),D=(0,O.al)(i[9],i[10],i[11]),l=[];for(let z=0;z<8;++z)l.push((0,O.Ue)());if((0,a.g)(l[0],P,v),(0,a.g)(l[0],l[0],c),(0,a.g)(l[0],l[0],D),(0,a.z)(l[1],P,v),(0,a.g)(l[1],l[1],c),(0,a.g)(l[1],l[1],D),(0,a.g)(l[2],P,v),(0,a.z)(l[2],l[2],c),(0,a.g)(l[2],l[2],D),(0,a.z)(l[3],P,v),(0,a.z)(l[3],l[3],c),(0,a.g)(l[3],l[3],D),(0,a.g)(l[4],P,v),(0,a.g)(l[4],l[4],c),(0,a.z)(l[4],l[4],D),(0,a.z)(l[5],P,v),(0,a.g)(l[5],l[5],c),(0,a.z)(l[5],l[5],D),(0,a.g)(l[6],P,v),(0,a.z)(l[6],l[6],c),(0,a.z)(l[6],l[6],D),(0,a.z)(l[7],P,v),(0,a.z)(l[7],l[7],c),(0,a.z)(l[7],l[7],D),o&&this._verifyArray(o,16)){const z=o;for(let X=0;X<8;++X)(0,a.h)(l[X],l[X],z)}const B=(0,O.al)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),H=(0,O.al)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let z=0;z<8;++z)(0,M.projectBuffer)(l[z],S.pn,0,l[z],m.Z.WGS84,0,1),(0,a.y)(H,H,l[z]),(0,a.C)(B,B,l[z]);this.fullExtent=new f.Z({xmin:H[0],ymin:H[1],zmin:H[2],xmax:B[0],ymax:B[1],zmax:B[2],spatialReference:this.spatialReference})}}load(t){var r=this;return(0,g.Z)(function*(){return r.addResolvingPromise(r._doLoad(t)),r})()}_doLoad(t){var r=this;return(0,g.Z)(function*(){const o=null!=t?t.signal:null;try{yield r.loadFromPortal({supportedTypes:["3DTiles Service"],validateItem:u=>{if(u.typeKeywords?.includes("IntegratedMesh"))return!0;throw new K.Z("portal:invalid-layer-item-type","Invalid layer item, expected '${expectedType}' ",{expectedType:"3DTiles Service containing IntegratedMesh"})}},t)}catch(u){(0,A.r9)(u)}r.url&&(yield(0,j.Z)(r.url,{query:{f:"json",...r.customParameters,token:r.apiKey},responseType:"json",signal:o}).then(i=>{r._initFullExtent(i.data)},i=>{(0,A.r9)(i)}))})()}fetchAttributionData(){var t=this;return(0,g.Z)(function*(){return t.load().then(()=>({}))})()}_validateElevationInfo(){const t=this.elevationInfo,r="Integrated mesh 3d tiles layers";(0,d.LR)(W.Z.getLogger(this),(0,d.Uy)(r,"absolute-height",t)),(0,d.LR)(W.Z.getLogger(this),(0,d.kf)(r,t))}};(0,p._)([(0,h.Cb)({type:["IntegratedMesh3DTilesLayer"]})],_.prototype,"operationalLayerType",void 0),(0,p._)([(0,h.Cb)({type:m.Z})],_.prototype,"spatialReference",void 0),(0,p._)([(0,h.Cb)({type:f.Z})],_.prototype,"fullExtent",void 0),(0,p._)([(0,h.Cb)(R.PV)],_.prototype,"elevationInfo",null),(0,p._)([(0,h.Cb)({type:["show","hide"]})],_.prototype,"listMode",void 0),(0,p._)([(0,h.Cb)(R.HQ)],_.prototype,"url",void 0),(0,p._)([(0,h.Cb)({readOnly:!0})],_.prototype,"type",void 0),(0,p._)([(0,h.Cb)({type:String,json:{origins:{"web-scene":{read:!0,write:!0},"portal-item":{read:!0,write:!0}},read:!1}})],_.prototype,"path",void 0),(0,p._)([(0,h.Cb)({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:!1,write:!1}}}})],_.prototype,"minScale",void 0),(0,p._)([(0,h.Cb)({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:!1,write:!1}}}})],_.prototype,"maxScale",void 0),_=(0,p._)([(0,x.j)("esri.layers.IntegratedMesh3DTilesLayer")],_);const E=_},29674:(N,C,s)=>{s.d(C,{V:()=>A});var g=s(50484),p=s(80543),I=(s(14007),s(4703),s(65311),s(10141));const A=h=>{let y=class extends h{get apiKey(){return this._isOverridden("apiKey")?this._get("apiKey"):function T(h){return"portalItem"in h}(this)?this.portalItem?.apiKey:null}set apiKey(U){null!=U?this._override("apiKey",U):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return(0,g._)([(0,p.Cb)({type:String})],y.prototype,"apiKey",null),y=(0,g._)([(0,I.j)("esri.layers.mixins.APIKeyMixin")],y),y}},4257:(N,C,s)=>{s.d(C,{Y:()=>A});var g=s(50484),p=s(4703),j=s(80543),I=(s(14007),s(65311),s(10141)),T=s(89713);const A=h=>{let y=class extends h{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const U=(0,T.Qc)(this.url);if(null!=U&&U.title)return U.title}return this._get("title")||""}set title(U){this._set("title",U)}set url(U){this._set("url",(0,T.Nm)(U,p.Z.getLogger(this)))}};return(0,g._)([(0,j.Cb)()],y.prototype,"title",null),(0,g._)([(0,j.Cb)({type:String})],y.prototype,"url",null),y=(0,g._)([(0,I.j)("esri.layers.mixins.ArcGISService")],y),y}},27426:(N,C,s)=>{s.d(C,{N:()=>T});var g=s(50484),p=s(80543),I=(s(14007),s(4703),s(65311),s(10141));const T=A=>{let h=class extends A{constructor(){super(...arguments),this.customParameters=null}};return(0,g._)([(0,p.Cb)({type:Object,json:{write:{overridePolicy:y=>({enabled:!!(y&&Object.keys(y).length>0)})}}})],h.prototype,"customParameters",void 0),h=(0,g._)([(0,I.j)("esri.layers.mixins.CustomParametersMixin")],h),h}},70509:(N,C,s)=>{s.d(C,{I:()=>V});var g=s(15861),p=s(50484),j=s(11931),K=s(26152),W=s(66476),I=s(37636),T=s(57964),A=s(4703),h=s(51172),y=s(79412),U=s(6785),x=s(80543),S=(s(14007),s(65311),s(62185)),f=s(10141),m=s(7547),M=s(85971),L=s(61018),Z=s(27835),b=s(57437),G=s(50318);const V=F=>{let R=class extends F{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,h.SC)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(d){d!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",d))}readPortalItem(d,_,E){if(_.itemId)return new Z.default({id:_.itemId,portal:E?.portal})}writePortalItem(d,_){d?.id&&(_.itemId=d.id)}loadFromPortal(d,_){var E=this;return(0,g.Z)(function*(){if(E.portalItem?.id)try{const{load:t}=yield Promise.all([s.e(2772),s.e(8592),s.e(6964)]).then(s.bind(s,36964));return(0,y.k_)(_),yield t({instance:E,supportedTypes:d.supportedTypes,validateItem:d.validateItem,supportsData:d.supportsData,layerModuleTypeMap:d.layerModuleTypeMap},_)}catch(t){throw(0,y.D_)(t)||A.Z.getLogger(E).warn(`Failed to load layer (${E.title}, ${E.id}) portal item (${E.portalItem.id})\n  ${t}`),t}})()}finishLoadEditablePortalLayer(d){var _=this;return(0,g.Z)(function*(){_._set("userHasEditingPrivileges",yield _._fetchUserHasEditingPrivileges(d).catch(E=>((0,y.r9)(E),!0)))})()}setUserPrivileges(d,_){var E=this;return(0,g.Z)(function*(){if(!j.default.userPrivilegesApplied)return E.finishLoadEditablePortalLayer(_);if(E.url)try{const{features:{edit:t,fullEdit:r},content:{updateItem:o}}=yield E._fetchUserPrivileges(d,_);E._set("userHasEditingPrivileges",t),E._set("userHasFullEditingPrivileges",r),E._set("userHasUpdateItemPrivileges",o)}catch(t){(0,y.r9)(t)}})()}_fetchUserPrivileges(d,_){var E=this;return(0,g.Z)(function*(){let t=E.portalItem;if(!d||!t||!t.loaded||t.sourceUrl)return E._fetchFallbackUserPrivileges(_);const r=d===t.id;if(r&&t.portal.user)return(0,G.Ss)(t);let o,u;if(r)o=t.portal.url;else try{o=yield(0,M.oP)(E.url,_)}catch(c){(0,y.r9)(c)}if(!o||!(0,U.Zo)(o,t.portal.url))return E._fetchFallbackUserPrivileges(_);try{const c=null!=_?_.signal:null;u=yield K.id?.getCredential(`${o}/sharing`,{prompt:!1,signal:c})}catch(c){(0,y.r9)(c)}if(!u)return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}};try{if(r?yield t.reload():(t=new Z.default({id:d,portal:{url:o}}),yield t.load(_)),t.portal.user)return(0,G.Ss)(t)}catch(c){(0,y.r9)(c)}return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}}})()}_fetchFallbackUserPrivileges(d){var _=this;return(0,g.Z)(function*(){let E=!0;try{E=yield _._fetchUserHasEditingPrivileges(d)}catch(t){(0,y.r9)(t)}return{features:{edit:E,fullEdit:!1},content:{updateItem:!1}}})()}_fetchUserHasEditingPrivileges(d){var _=this;return(0,g.Z)(function*(){const E=_.url?K.id?.findCredential(_.url):null;if(!E)return!0;const t=$.credential===E?$.user:yield _._fetchEditingUser(d);return $.credential=E,$.user=t,null==t?.privileges||t.privileges.includes("features:user:edit")})()}_fetchEditingUser(d){var _=this;return(0,g.Z)(function*(){const E=_.portalItem?.portal?.user;if(E)return E;const t=K.id?.findServerInfo(_.url??"");if(!t?.owningSystemUrl)return null;const r=`${t.owningSystemUrl}/sharing/rest`,o=L.Z.getDefault();if(o&&o.loaded&&(0,U.Fv)(o.restUrl)===(0,U.Fv)(r))return o.user;const u=`${r}/community/self`,i=null!=d?d.signal:null,P=yield(0,I.q6)((0,W.Z)(u,{authMode:"no-prompt",query:{f:"json"},signal:i}));return P.ok?b.Z.fromJSON(P.value.data):null})()}read(d,_){_&&(_.layer=this),super.read(d,_)}write(d,_){const E=_?.portal,t=this.portalItem?.id&&(this.portalItem.portal||L.Z.getDefault());return E&&t&&!(0,U.tm)(t.restUrl,E.restUrl)?(_.messages&&_.messages.push(new T.Z("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(d,{..._,layer:this})}};return(0,p._)([(0,x.Cb)({type:Z.default})],R.prototype,"portalItem",null),(0,p._)([(0,S.r)("web-document","portalItem",["itemId"])],R.prototype,"readPortalItem",null),(0,p._)([(0,m.c)("web-document","portalItem",{itemId:{type:String}})],R.prototype,"writePortalItem",null),(0,p._)([(0,x.Cb)({clonable:!1})],R.prototype,"resourceReferences",void 0),(0,p._)([(0,x.Cb)({type:Boolean,readOnly:!0})],R.prototype,"userHasEditingPrivileges",void 0),(0,p._)([(0,x.Cb)({type:Boolean,readOnly:!0})],R.prototype,"userHasFullEditingPrivileges",void 0),(0,p._)([(0,x.Cb)({type:Boolean,readOnly:!0})],R.prototype,"userHasUpdateItemPrivileges",void 0),R=(0,p._)([(0,f.j)("esri.layers.mixins.PortalLayer")],R),R},$={credential:null,user:null}},50318:(N,C,s)=>{s.d(C,{$o:()=>x,Fj:()=>h,IW:()=>U,Ss:()=>S,_$:()=>A,ck:()=>y,hz:()=>O,qj:()=>T});var g=s(15861),p=s(83821),j=s(43814),K=s(48230);function I(){return(I=(0,g.Z)(function*(f){const m=f.spatialReference;if(m.isWGS84)return f.clone();if(m.isWebMercator)return(0,K.Sx)(f);const M=j.Z.WGS84;return yield(0,p.initializeProjection)(m,M),(0,p.project)(f,M)})).apply(this,arguments)}function T(f,m){if(!A(f,m)){const M=f.typeKeywords;M?M.push(m):f.typeKeywords=[m]}}function A(f,m){return!!f.typeKeywords?.includes(m)}function h(f){return A(f,O.HOSTED_SERVICE)}function y(f,m){const M=f.typeKeywords;if(M){const L=M.indexOf(m);L>-1&&M.splice(L,1)}}function U(f,m,M){M?T(f,m):y(f,m)}function x(f){return a.apply(this,arguments)}function a(){return a=(0,g.Z)(function*(f){const m=f.clone().normalize();let M;if(m.length>1)for(const L of m)M?L.width>M.width&&(M=L):M=L;else M=m[0];return function W(f){return I.apply(this,arguments)}(M)}),a.apply(this,arguments)}const O={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function S(f){const{portal:m,isOrgItem:M,itemControl:L}=f,Z=m.user?.privileges;let b=!Z||Z.includes("features:user:edit"),G=!!M&&!!Z?.includes("features:user:fullEdit");const V="update"===L||"admin"===L;return V?G=b=!0:G&&(b=!0),{features:{edit:b,fullEdit:G},content:{updateItem:V}}}},43688:(N,C,s)=>{s.d(C,{LR:()=>R,Uy:()=>V,VW:()=>I,Wb:()=>$,fm:()=>d,kf:()=>F}),s(49602);var p=s(1678);function I(t,r){return function K(t,r){return r?.mode?r.mode:function j(t){return t?_:E}(t).mode}(null!=t&&t.hasZ,r)}function V(t,r,o){return o&&o.mode!==r?`${t} only support ${r} elevation mode`:null}function $(t,r,o){return o?.mode===r?`${t} do not support ${r} elevation mode`:null}function F(t,r){return null!=r?.featureExpressionInfo&&"0"!==r.featureExpressionInfo.expression?`${t} do not support featureExpressionInfo`:null}function R(t,r){r&&t.warn(".elevationInfo=",r)}function d(t){return(t?.offset??0)*(0,p.Z7)(t?.unit)}const _={mode:"absolute-height",offset:0},E={mode:"on-the-ground",offset:null}}}]);