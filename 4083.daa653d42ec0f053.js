"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[4083],{3233:(De,se,y)=>{y.d(se,{R:()=>C,w:()=>oe});var M=y(50484),x=y(73514),Te=y(44469),ye=y(34222),N=y(60301);class H{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(N.v8),this._values=new Map,this.multipleOriginsSupported=!0}clone(d){const l=new H,c=this._originStores[N.s3.DEFAULTS];c&&c.forEach((p,r)=>{l.set(r,(0,ye.d9)(p),N.s3.DEFAULTS)});for(let p=N.s3.SERVICE;p<N.v8;p++){const r=this._originStores[p];r&&r.forEach((G,_)=>{d&&d.has(_)||l.set(_,(0,ye.d9)(G),p)})}return l}get(d,l){const c=void 0===l?this._values:this._originStores[l];return c?c.get(d):void 0}keys(d){const l=null==d?this._values:this._originStores[d];return l?[...l.keys()]:[]}set(d,l,c=N.s3.USER){let p=this._originStores[c];if(p||(p=new Map,this._originStores[c]=p),p.set(d,l),!this._values.has(d)||this._propertyOriginMap.get(d)<=c){const r=this._values.get(d);return this._values.set(d,l),this._propertyOriginMap.set(d,c),r!==l}return!1}delete(d,l=N.s3.USER){const c=this._originStores[l];if(!c)return;const p=c.get(d);if(c.delete(d),this._values.has(d)&&this._propertyOriginMap.get(d)===l){this._values.delete(d);for(let r=l-1;r>=0;r--){const G=this._originStores[r];if(G&&G.has(d)){this._values.set(d,G.get(d)),this._propertyOriginMap.set(d,r);break}}}return p}has(d,l){const c=void 0===l?this._values:this._originStores[l];return!!c&&c.has(d)}revert(d,l){for(;l>0&&!this.has(d,l);)--l;const c=this._originStores[l],p=c?.get(d),r=this._values.get(d);return this._values.set(d,p),this._propertyOriginMap.set(d,l),r!==p}originOf(d){return this._propertyOriginMap.get(d)||N.s3.DEFAULTS}forEach(d){this._values.forEach(d)}}var Ce=y(68090),re=y(49301),S=y(10141);const Le=J=>{let d=class extends J{constructor(...l){super(...l);const c=(0,re.vw)(this),p=c.store,r=new H;c.store=r,(0,Te.M)(c,p,r)}read(l,c){(0,Ce.i)(this,l,c)}getAtOrigin(l,c){const p=pe(this),r=(0,N.M9)(c);if("string"==typeof l)return p.get(l,r);const G={};return l.forEach(_=>{G[_]=p.get(_,r)}),G}originOf(l){return(0,N.x3)(this.originIdOf(l))}originIdOf(l){return pe(this).originOf(l)}revert(l,c){const p=pe(this),r=(0,N.M9)(c),G=(0,re.vw)(this);let _;_="string"==typeof l?"*"===l?p.keys(r):[l]:l,_.forEach(Me=>{G.invalidate(Me),p.revert(Me,r),G.commit(Me)})}};return d=(0,M._)([(0,S.j)("esri.core.ReadOnlyMultiOriginJSONSupport")],d),d};function pe(J){return(0,re.vw)(J).store}let ge=class extends(Le(x.Z)){};ge=(0,M._)([(0,S.j)("esri.core.ReadOnlyMultiOriginJSONSupport")],ge);var Ee=y(37718),$=y(82206);const le=J=>{let d=class extends J{constructor(...l){super(...l)}clear(l,c="user"){return ee(this).delete(l,(0,N.M9)(c))}write(l,c){return(0,$.c)(this,l=l||{},c),l}setAtOrigin(l,c,p){(0,re.vw)(this).setAtOrigin(l,c,(0,N.M9)(p))}removeOrigin(l){const c=ee(this),p=(0,N.M9)(l),r=c.keys(p);for(const G of r)c.originOf(G)===p&&c.set(G,c.get(G,p),N.s3.USER)}updateOrigin(l,c){const p=ee(this),r=(0,N.M9)(c),G=(0,Ee.U2)(this,l);for(let _=r+1;_<N.v8;++_)p.delete(l,_);p.set(l,G,r)}toJSON(l){return this.write({},l)}};return d=(0,M._)([(0,S.j)("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],d),d.prototype.toJSON.isDefaultToJSON=!0,d};function ee(J){return(0,re.vw)(J).store}const C=J=>{let d=class extends(le(Le(J))){constructor(...l){super(...l)}};return d=(0,M._)([(0,S.j)("esri.core.MultiOriginJSONSupport")],d),d};let oe=class extends(C(x.Z)){};oe=(0,M._)([(0,S.j)("esri.core.MultiOriginJSONSupport")],oe)},76215:(De,se,y)=>{y.d(se,{C:()=>M});const M=["operational-layers","basemap","ground"]},88305:(De,se,y)=>{y.r(se),y.d(se,{default:()=>Ve});var ee,e,M=y(15861),x=y(50484),ye=(y(2189),y(83944)),N=y(57964),H=y(4703),Ce=y(8611),re=y(79412),S=y(80543),ge=(y(14007),y(65311),y(10141)),Ee=y(95060),$=y(10842),le=y(62209);(e=ee||(ee={})).MULTIPLIER="multiplier",e.ABSOLUTE="absoluteValue";var C=y(10579),oe=y(2295),J=y(3660),d=y(19855),l=y(29717),c=y(98930);let p,r=null;var te,ke,Ne,Re,Ae,xe,Ie,Se,ze,_e,We;function ce(e,t,n,a,i,o){const s=n.length,m=i.length,v=Float64Array.BYTES_PER_ELEMENT,T=Uint32Array.BYTES_PER_ELEMENT,k=Uint8Array.BYTES_PER_ELEMENT,Z=r._malloc(16+s*(k+2*v)+m*(2*T));try{const w=Z+16-Z%16,g=w+s*v,I=g+s*v,D=I+m*T,O=D+m*T,P=()=>[r.HEAPF64.subarray(w>>3,(w>>3)+s),r.HEAPF64.subarray(g>>3,(g>>3)+s),r.HEAPU32.subarray(I>>2,(I>>2)+m),r.HEAPU32.subarray(D>>2,(D>>2)+m),r.HEAPU8.subarray(O,O+s)],[E,U,K,W,Q]=P();E.set(n),U.set(a),K.set(i),W.set(o),Q.set(t);let j=e(s,O,w,g,m,I,D),Y=null,A=null;if(j){const f=r.getLayoutLinksTypes(),h=r.getLayoutLinksVerticesEndIndices(),F=r.getLayoutLinksVertices(),q=r.countLayoutLinksVertices();!m||f&&h?q&&!F?j=!1:(Y={types:new Uint8Array(r.HEAPU8.subarray(f,f+m)),vertexEndIndex:new Uint32Array(r.HEAPU32.subarray(h>>2,(h>>2)+m)),vertices:new Float64Array(r.HEAPF64.subarray(F>>3,(F>>3)+2*q))},A=r.getAuxiliaryGraphicElements()):j=!1}const[X,ae,ne,ue,u]=P();return n.set(X),a.set(ae),i.set(ne),o.set(ue),t.set(u),{success:j,links:Y,graphics:A}}finally{r._free(Z),r.cleanupLayout()}}(function(e){e[e.None=0]="None",e[e.IsMovable=1]="IsMovable",e[e.IsGeographic=2]="IsGeographic",e[e.IsRoot=4]="IsRoot"})(te||(te={})),function(e){e[e.Regular=0]="Regular",e[e.Orthogonal=1]="Orthogonal",e[e.Curved=2]="Curved",e[e.Recursive=3]="Recursive"}(ke||(ke={})),function(e){e.getMinIdealEdgeLength=function t(){return r.getMinIdealEdgeLength()},e.apply=function n(a,i,o,s,m,v=2,T=1,k=-1){return ce((L,b,Z,w,g,I,D)=>r.applyForceDirectedLayout(L,b,Z,w,g,I,D,v,T,k),a,i,o,s,m)}}(Ne||(Ne={})),function(e){e.apply=function t(n,a,i,o,s,m=2,v=1,T=-1){return ce((k,L,b,Z,w,g,I)=>r.applyCommunityLayout(k,L,b,Z,w,g,I,m,v,T),n,a,i,o,s)}}(Re||(Re={})),function(e){e.apply=function t(n,a,i,o,s){return ce(r.applySimpleLayout,n,a,i,o,s)}}(Ae||(Ae={})),function(e){e.apply=function t(n,a,i,o,s){return ce(r.applyHierarchicalLayout,n,a,i,o,s)}}(xe||(xe={})),function(e){e.apply=function t(n,a,i,o,s){return ce(r.applyRadialTreeLayout,n,a,i,o,s)}}(Ie||(Ie={})),function(e){e.apply=function t(n,a,i,o,s){return ce(r.applySmartTreeLayout,n,a,i,o,s)}}(Se||(Se={})),function(e){e.apply=function t(n,a,i,o,s,m,v,T,k){return ce((L,b,Z,w,g,I,D)=>{if(o.length!==L||s.length!==L||T.length!==g||k.length!==g)return!1;const O=Float64Array.BYTES_PER_ELEMENT,P=16,E=r._malloc(P+L*O),U=r._malloc(P+L*O),K=r._malloc(P+g*O),W=r._malloc(P+g*O),Q=E+P-E%P,j=U+P-U%P,Y=K+P-K%P,A=W+P-W%P;try{return r.HEAPF64.subarray(Q>>3,(Q>>3)+L).set(o),r.HEAPF64.subarray(j>>3,(j>>3)+L).set(s),r.HEAPF64.subarray(Y>>3,(Y>>3)+g).set(T),r.HEAPF64.subarray(A>>3,(A>>3)+g).set(k),r.applyChronologicalLayout(L,b,Z,w,Q,j,g,I,D,Y,A)}finally{r._free(E),r._free(U),r._free(K),r._free(W)}},n,a,i,m,v)}}(ze||(ze={})),function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(_e||(_e={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(We||(We={}));var Ye=y(56380),Je=y(26894),Ke=y(44107),Qe=y(64222);let B=class extends((0,d.h7)((0,l.M)(Ee.Z))){constructor(e){if(super(e),this.dataPreloadedInLocalCache=!1,this.defaultLinkChartConfig=null,this._currentLinkChartConfig={layoutMode:"RADIAL_TREE"},this._graphTypeLookup=new Map,this.dataManager=null,this.knowledgeGraph=null,this.layers=new ye.Z,this.entityLinkChartDiagramLookup=new Map,this.relationshipLinkChartDiagramLookup=new Map,this.linkChartExtent=new Je.Z({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),this.memberEntityTypes=null,this.memberRelationshipTypes=null,this.sublayerIdsCache=new Map,this.tables=new ye.Z,this.type="link-chart",this._originalInclusionList=e.inclusionModeDefinition,e.dataPreloadedInLocalCache&&!e.inclusionModeDefinition)throw new N.Z("knowledge-graph:linkchart-layer-constructor","If creating a link chart composite layer and configured that data is already loaded in the cache, you must specify an inclusion list so the Composite Layer knows what records belong to it")}normalizeCtorArgs(e){return{url:e.url,title:e.title,dataPreloadedInLocalCache:e.dataPreloadedInLocalCache,defaultLinkChartConfig:e.defaultLinkChartConfig}}_initializeLayerProperties(e){if(!this.title&&this.url){const o=this.url.split("/");this.title=o[o.length-2]}const t=new Set;let n=[],a=[];if(e.inclusionModeDefinition&&(!e.inclusionModeDefinition.namedTypeDefinitions||e.inclusionModeDefinition.namedTypeDefinitions.size<1))throw new N.Z("knowledge-graph:composite-layer-constructor","If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined");e.knowledgeGraph.dataModel.entityTypes?.forEach(o=>{o.name&&this._graphTypeLookup.set(o.name,o)}),e.knowledgeGraph.dataModel.relationshipTypes?.forEach(o=>{o.name&&this._graphTypeLookup.set(o.name,o)}),e.inclusionModeDefinition?.generateAllSublayers?(n=e.knowledgeGraph.dataModel.entityTypes??[],a=e.knowledgeGraph.dataModel.relationshipTypes??[]):e.inclusionModeDefinition?.namedTypeDefinitions&&e.inclusionModeDefinition?.namedTypeDefinitions.size>0?e.inclusionModeDefinition?.namedTypeDefinitions.forEach((o,s)=>{const m=this._graphTypeLookup.get(s);if(!m)return H.Z.getLogger(this).warn(`A named type, ${s}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(s);"relationship"===m.type?t.has(s)||(t.add(s),a.push(m)):"entity"===m.type?t.has(s)||(t.add(s),n.push(m)):(H.Z.getLogger(this).warn(`A named type, ${s}, was in the inclusion list that wasn't properly modeled and will be removed`),e.inclusionModeDefinition?.namedTypeDefinitions.delete(s))}):(n=e.knowledgeGraph.dataModel.entityTypes??[],a=e.knowledgeGraph.dataModel.relationshipTypes??[]);const i=new C.Qc({knowledgeGraph:e.knowledgeGraph,inclusionModeDefinition:e.inclusionModeDefinition});this.knowledgeGraph=e.knowledgeGraph,this.memberEntityTypes=n,this.memberRelationshipTypes=a,this.dataManager=i}load(e){var t=this;return this.addResolvingPromise(new Promise(n=>{(0,Ye.fetchKnowledgeGraph)(this.url).then(a=>{this._initializeLayerProperties({knowledgeGraph:a,inclusionModeDefinition:this._originalInclusionList}),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.size||(this.dataManager.inclusionModeDefinition={generateAllSublayers:!1,namedTypeDefinitions:new Map},this.dataManager.knowledgeGraph.dataModel.entityTypes?.forEach(i=>{i.name&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.set(i.name,{useAllData:!0})}),this.dataManager.knowledgeGraph.dataModel.relationshipTypes?.forEach(i=>{i.name&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.set(i.name,{useAllData:!0})})),this.dataPreloadedInLocalCache?(this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach(i=>{i.useAllData=!1,i.members?.forEach(o=>{let s;s=o.linkChartLocation instanceof le.Z?o.linkChartLocation:o.linkChartLocation?(0,$.GH)(o.linkChartLocation):null,s&&2===s.coords.length&&0===s.lengths.length?this.entityLinkChartDiagramLookup.set(o.id,s):this.relationshipLinkChartDiagramLookup.set(o.id,s)}),this.addResolvingPromise(this._initializeDiagram().then((0,M.Z)(function*(){t.layers.forEach(function(){var o=(0,M.Z)(function*(s){yield s.refreshCachedQueryEngine()});return function(s){return o.apply(this,arguments)}}()),t.tables.forEach(function(){var o=(0,M.Z)(function*(s){yield s.refreshCachedQueryEngine()});return function(s){return o.apply(this,arguments)}}())})))})):this.addResolvingPromise(this.dataManager.refreshCacheContent(void 0,!1,"GEOGRAPHIC"===this.defaultLinkChartConfig?.layoutMode,!0).then((0,M.Z)(function*(){(0,re.k_)(e);const o=[],s=[];t.loadLayerAssumingLocalCache(),t.dataManager.inclusionModeDefinition&&(t.dataManager.inclusionModeDefinition.generateAllSublayers=!1,t.dataManager.inclusionModeDefinition.namedTypeDefinitions.forEach(m=>{m.useAllData=!1})),yield t._initializeDiagram(),t.layers.forEach(m=>{s.push(m.refreshCachedQueryEngine()),o.push(new Promise(v=>{m.on("layerview-create",()=>{v(null)})}))}),t.tables.forEach(m=>{s.push(m.refreshCachedQueryEngine())}),yield Promise.all(s)}))),n(null)})})),Promise.resolve(this)}addRecords(e,t){var n=this;return(0,M.Z)(function*(){let a=[];t?.cascadeAddRelationshipEndNodes&&n.dataManager.knowledgeGraph.dataModel&&(a=yield(0,J.bv)(e,n.dataManager.knowledgeGraph));const i=e.concat(a).filter(o=>!n.sublayerIdsCache.get(o.typeName)?.has(o.id));yield n._handleNewRecords(i)})()}removeRecords(e,{cascadeRemoveRelationships:t=!0,recalculateLayout:n=!1}={cascadeRemoveRelationships:!0,recalculateLayout:!1}){var a=this;return(0,M.Z)(function*(){let i=[];for(const s of e)!1===a.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(s.typeName)?.useAllData&&a.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(s.typeName)?.members?.has(s.id)&&i.push(s);if(t){const s=new Set,m=[];for(const v of i)if(a.dataManager.nodeConnectionsLookup.has(v.id))for(const T of a.dataManager.nodeConnectionsLookup.get(v.id))s.add(T);for(const v of s)if(a.dataManager.memberIdTypeLookup.has(v))for(const T of a.dataManager.memberIdTypeLookup.get(v))a.dataManager.relationshipTypeNames.has(T)&&m.push({id:v,typeName:T});i=i.concat(m)}a.dataManager.removeFromLayer(i);for(const s of i)a.sublayerIdsCache.get(s.typeName)?.delete(s.id),a.dataManager.relationshipTypeNames.has(s.typeName)?a.relationshipLinkChartDiagramLookup.delete(s.id):a.entityLinkChartDiagramLookup.delete(s.id);n&&(yield a.calculateLinkChartLayout(a._currentLinkChartConfig.layoutMode,a._currentLinkChartConfig.layoutOptions));const o=[];return a.layers.forEach(s=>{o.push(s.refreshCachedQueryEngine())}),yield Promise.all(o),a._refreshNamedTypes(),i})()}expand(e,t){var n=this;return(0,M.Z)(function*(){const a=yield n.dataManager.getConnectedRecordIds(e,t),i=a.filter(o=>!n.sublayerIdsCache.get(o.typeName)?.has(o.id));return yield n._handleNewRecords(a),{records:i}})()}loadLayerAssumingLocalCache(){this.memberRelationshipTypes.forEach(e=>{const t=new oe.Z({objectType:e,parentCompositeLayer:this,graphType:"relationship",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)}),this.memberEntityTypes.forEach(e=>{const t=new oe.Z({objectType:e,parentCompositeLayer:this,graphType:"entity",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)}),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach((e,t)=>{const n=(0,Ce.s1)(this.sublayerIdsCache,t,()=>new Set);e.members?.forEach(a=>{if(n.add(a.id),a.linkChartLocation)if(a.linkChartLocation instanceof le.Z)this.dataManager.relationshipTypeNames.has(t)?this.relationshipLinkChartDiagramLookup.set(a.id,a.linkChartLocation):this.entityLinkChartDiagramLookup.set(a.id,a.linkChartLocation);else{const i=(0,$.GH)(a.linkChartLocation);this.dataManager.relationshipTypeNames.has(t)?this.relationshipLinkChartDiagramLookup.set(a.id,a.linkChartLocation?i:null):this.entityLinkChartDiagramLookup.set(a.id,a.linkChartLocation?i:null)}})})}calculateLinkChartLayout(e="RADIAL_TREE",t){var n=this;return(0,M.Z)(function*(){const a=[],i=[],o=[];n.dataManager.sublayerCaches.forEach((u,f)=>{n.dataManager.entityTypeNames.has(f)?u.forEach(h=>{a.push({typeName:f,feature:h})}):n.dataManager.relationshipTypeNames.has(f)&&u.forEach(h=>{i.push({typeName:f,feature:h})})}),n.entityLinkChartDiagramLookup=new Map,n.relationshipLinkChartDiagramLookup=new Map;const s=new Map,m=new Map,v=new Map,T=new Map,k=new Uint8Array(a.length),L=new Float64Array(a.length),b=new Float64Array(a.length),Z=new Uint32Array(i.length),w=new Uint32Array(i.length),g=[],D=new Je.Z({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7});let O,P="FORCE_DIRECTED",E=0,U=0;switch(P="GEOGRAPHIC"===e?"FORCE_DIRECTED":e,P){case"FORCE_DIRECTED":O=Ne.apply;break;case"COMMUNITY":O=Re.apply;break;case"HIERARCHICAL":O=xe.apply;break;case"RADIAL_TREE":O=Ie.apply;break;case"SMART_TREE":O=Se.apply;break;default:O=Ae.apply}a.forEach(({typeName:u,feature:f})=>{if(t?.lockedNodeLocations?.has(f.attributes[C.zS])){k[E]="GEOGRAPHIC"===e&&n.dataManager.geographicLookup.has(u)?te.IsGeographic:te.None;const h=t.lockedNodeLocations.get(f.attributes[C.zS]);L[E]=h.x,b[E]=h.y}else if("GEOGRAPHIC"===e&&n.dataManager.geographicLookup.has(u)){k[E]=te.IsGeographic;let h=null;const F=f.attributes[n.dataManager.geographicLookup.get(u).name];switch(n.dataManager.geographicLookup.get(u)?.geometryType){case"esriGeometryPoint":L[E]=F?.x,b[E]=F?.y;break;case"esriGeometryPolygon":h=F?.centroid,null!=h?.x&&null!=h?.y?(L[E]=h.x,b[E]=h.y):k[E]=te.IsMovable;break;case"esriGeometryPolyline":case"esriGeometryMultipoint":h=F?.extent?.center,null!=h?.x&&null!=h?.y?(L[E]=h.x,b[E]=h.y):k[E]=te.IsMovable;break;default:k[E]=te.IsMovable}(null==L[E]||null==b[E]||Number.isNaN(L[E])||Number.isNaN(b[E]))&&(k[E]=te.IsMovable,L[E]=0,b[E]=0)}else k[E]=te.IsMovable,L[E]=0,b[E]=0;T.set(f.attributes[C.zS],E),g[E]={feature:f,typeName:u},E++});let K=!1;const W=new Map;i.forEach(u=>{const f=u.feature.attributes[C.WZ],h=u.feature.attributes[C.TD],F=T.get(f),q=T.get(h);if(void 0!==F&&void 0!==q){const z=f+"-"+h,V=W.get(z);V?.has(u.typeName)||(Z[U]=F,w[U]=q,void 0===V?W.set(z,new Map([[u.typeName,U]])):V.set(u.typeName,U),U++),o.push(u)}else K=!0,n.relationshipLinkChartDiagramLookup.set(f,null)}),K&&H.Z.getLogger(n).warn("A relationship is a member of this layer that has either origin or destination entity nodes that are not members. The diagram geometry will be set to null");const Q=n._validateLayoutSettings(e,t),j=n._convertLayoutSettingsToCalculationSettings(Q);yield function _(){return p||(p=y.e(183).then(y.bind(y,30183)).then(e=>e.l).then(({default:e})=>e({locateFile:t=>(0,c.V)(`esri/libs/linkchartlayout/${t}`)})).then(e=>{!function Me(e){r=e}(e)}),p)}();const{success:Y,links:A}=O(k,L,b,Z.subarray(0,U),w.subarray(0,U),j.computationBudgetTime,j.idealEdgeLengthMultiplier,j.repulsionRadiusMultiplier);if(!Y)throw new N.Z("knowledge-graph:layout-failed","Attempting to arrange the records in the specified layout failed");for(let u=0;u<g.length;u++){if(b[u]>84.9999?b[u]=84.9999:b[u]<-84.9999&&(b[u]=-84.9999),L[u]>179.9999?L[u]=179.9999:L[u]<-179.9999&&(L[u]=-179.9999),g[u].feature.attributes[C.Cn]=new Ke.Z(L[u],b[u]),s.has(g[u].typeName))s.get(g[u].typeName)?.set(g[u].feature.attributes[C.zS],g[u].feature);else{const h=new Map;h.set(g[u].feature.attributes[C.zS],g[u].feature),s.set(g[u].typeName,h)}v.set(g[u].feature.attributes[C.zS],g[u].feature);const f=(0,$.GH)(g[u].feature.attributes[C.Cn]);n.entityLinkChartDiagramLookup.set(g[u].feature.attributes[C.zS],g[u].feature.attributes[C.Cn]?f:null),g[u].feature.attributes[C.Cn].x<D.xmin&&(D.xmin=g[u].feature.attributes[C.Cn].x),g[u].feature.attributes[C.Cn].x>D.xmax&&(D.xmax=g[u].feature.attributes[C.Cn].x),g[u].feature.attributes[C.Cn].y<D.ymin&&(D.ymin=g[u].feature.attributes[C.Cn].y),g[u].feature.attributes[C.Cn].y>D.ymax&&(D.ymax=g[u].feature.attributes[C.Cn].y)}if(n.linkChartExtent.xmin=D.xmin,n.linkChartExtent.xmax=D.xmax,n.linkChartExtent.ymin=D.ymin,n.linkChartExtent.ymax=D.ymax,!A)throw new N.Z("knowledge-graph:layout-failed","Attempting to retrieve link geometry from diagram engine failed");const X=new Map,ae=new Map,ne=new Map,ue=new Set;for(let u=0;u<o.length;u++){const f=[],h=o[u],F=h.feature.attributes[C.WZ],q=h.feature.attributes[C.TD],z=F+"-"+q,V=W.get(z).get(h.typeName),de=0===V?0:A?.vertexEndIndex[V-1];if(!ue.has(V)){if(ue.add(V),A.types[V]===ke.Recursive){const R=[A.vertices[2*de],A.vertices[2*de+1]],we=[A.vertices[2*(de+1)],A.vertices[2*(de+1)+1]],he=[.5*(R[0]+we[0]),.5*(R[1]+we[1])],me=[he[0]-R[0],he[1]-R[1]],Ue=[he[0]+me[1],he[1]-me[0]],He=[he[0]-me[1],he[1]+me[0]];f.push(R),f.push(Ue),f.push(we),f.push(He),f.push(R)}else{if(A.types[V]!==ke.Regular){H.Z.getLogger(n).warn("A relationship generated an unsupported link geometry type.  It will not be rendered");continue}for(let R=de;R<A.vertexEndIndex[V];R++)f.push([A.vertices[2*R],A.vertices[2*R+1]])}const ie=g[T.get(F)]?.feature.attributes[C.Cn],fe=g[T.get(q)]?.feature.attributes[C.Cn];f[0][0]===ie.x&&f[0][1]===ie.y||(f[0]=[ie.x,ie.y]),f[f.length-1][0]===fe.x&&f[f.length-1][1]===fe.y||(f[f.length-1]=[fe.x,fe.y]);for(let R=1;R<f.length-1;R++)f[R][1]>85.5?f[R][1]=85.5:f[R][1]<-85.5&&(f[R][1]=-85.5),f[R][0]>179.9999?f[R][0]=179.9999:f[R][0]<-179.9999&&(f[R][0]=-179.9999);X.has(z)?X.get(z).push(f):X.set(z,[f])}const Oe=X.get(z);ae.has(z)||(ae.set(z,new Map),ne.set(z,new Map));const ve=ae.get(z),be=ne.get(z);ve.has(h.typeName)||(ve.set(h.typeName,Oe.shift()),be.set(h.typeName,0));const Pe=ve.get(h.typeName);be.set(h.typeName,be.get(h.typeName)+1);const Ge=new Qe.Z({paths:Pe});if(h.feature.attributes[C.Cn]=Ge,m.has(h.typeName))m.get(h.typeName)?.set(h.feature.attributes[C.zS],h.feature);else{const ie=new Map;ie.set(h.feature.attributes[C.zS],h.feature),m.set(h.typeName,ie)}v.set(h.feature.attributes[C.zS],h.feature);const Ze=(0,$.GH)(h.feature.attributes[C.Cn]);n.relationshipLinkChartDiagramLookup.set(h.feature.attributes[C.zS],h.feature.attributes[C.Cn]?Ze:null)}for(const u of o)u.feature.attributes[C.Fd]=ne.get(u.feature.attributes[C.WZ]+"-"+u.feature.attributes[C.TD])?.get(u.typeName)??null;return n._currentLinkChartConfig={layoutMode:e,layoutOptions:Q},{nodes:s,links:m,idMap:v}})()}applyNewLinkChartLayout(e="RADIAL_TREE",t){var n=this;return(0,M.Z)(function*(){const a=[];yield n.calculateLinkChartLayout(e,t),n.layers.forEach(i=>{a.push(i.refreshCachedQueryEngine())}),yield Promise.all(a),n._refreshNamedTypes()})()}getCurrentNodeLocations(){const e=new Map;return this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach(t=>{t?.members?.forEach(n=>{const a=n.linkChartLocation;let i;a&&(i="x"in a?{x:a.x,y:a.y}:{x:a.coords[0],y:a.coords[1]},e.set(n.id,new Ke.Z({x:i.x,y:i.y})))})}),e}synchronizeInclusionListWithCache(){var e=this;return(0,M.Z)(function*(){return new Promise(t=>{e.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach((n,a)=>{if(n.useAllData=!1,n.members&&n.members.size>0){if(!e.dataManager.sublayerCaches.get(a))return;const i=new Set(Array.from(e.dataManager.sublayerCaches.get(a).keys()));Array.from(n.members.keys()).filter(o=>!i.has(o)).forEach(o=>{n.members?.delete(o)})}}),t()})})()}refreshLinkChartCache(e){var t=this;return(0,M.Z)(function*(){yield t.dataManager.refreshCacheContent(e);const n=[];t.layers.forEach(a=>{n.push(a.refreshCachedQueryEngine())}),yield Promise.all(n),t._refreshNamedTypes()})()}connectEntities(e){var t=this;return(0,M.Z)(function*(){let n=[];for(const i of t.dataManager.relationshipTypeNames){const o=t.sublayerIdsCache.get(i);o&&(n=n.concat(Array.from(o.keys())))}const a=yield t.dataManager.getAttachedRelationships(e,n);return yield t._handleNewRecords(a),{records:a}})()}_handleNewRecords(e){var t=this;return(0,M.Z)(function*(){const n=[];t.dataManager.addToLayer(e);for(const i of e)t.sublayerIdsCache.has(i.typeName)||(t.sublayerIdsCache.set(i.typeName,new Set),n.push(i.typeName)),t.sublayerIdsCache.get(i.typeName).add(i.id);for(const i of n){const o=t._graphTypeLookup.get(i);if(o){const s=new oe.Z({objectType:o,parentCompositeLayer:t,graphType:o.type,title:i});"entity"===o.type?t.dataManager.entityTypeNames.add(i):t.dataManager.relationshipTypeNames.add(i),s.geometryType?t.layers.push(s):t.tables.push(s),t.dataManager.sublayerCaches.set(i,new Map)}}yield t.dataManager.refreshCacheContent(e.map(i=>i.id));const a=Object.assign({},t._currentLinkChartConfig.layoutOptions);a.lockedNodeLocations=t.getCurrentNodeLocations(),yield t.applyNewLinkChartLayout(t._currentLinkChartConfig.layoutMode,a)})()}_initializeDiagram(){var e=this;return(0,M.Z)(function*(){e.defaultLinkChartConfig?e.defaultLinkChartConfig.doNotRecalculateLayout?(e.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach((t,n)=>{t?.members?.forEach(a=>{const i=a.linkChartLocation;let o;const s=a.id;if(!i)return;o="x"in i?{x:i.x,y:i.y}:{x:i.coords[0],y:i.coords[1]};const m=(0,$.GH)(o);e.dataManager.relationshipTypeNames.has(n)?e.relationshipLinkChartDiagramLookup.set(s,m):e.entityLinkChartDiagramLookup.set(s,m),e.linkChartExtent.xmin>o.x&&(e.linkChartExtent.xmin=o.x),e.linkChartExtent.xmax<o.x&&(e.linkChartExtent.xmax=o.x),e.linkChartExtent.ymin>o.y&&(e.linkChartExtent.ymin=o.y),e.linkChartExtent.ymax<o.y&&(e.linkChartExtent.ymax=o.y)})}),e.memberRelationshipTypes.forEach(t=>{t.name&&e.dataManager.sublayerCaches.get(t.name)?.forEach(n=>{const a=e.relationshipLinkChartDiagramLookup.get(n.attributes[C.WZ]),i=e.relationshipLinkChartDiagramLookup.get(n.attributes[C.TD]);if(a&&i){const o=(0,$.GH)(new Qe.Z({paths:[[a.coords[0],a.coords[1]],[i.coords[0],i.coords[1]]]}));e.relationshipLinkChartDiagramLookup.set(n.attributes[C.zS],o)}else e.relationshipLinkChartDiagramLookup.set(n.attributes[C.zS],null)})})):yield e.calculateLinkChartLayout(e.defaultLinkChartConfig.layoutMode,{lockedNodeLocations:e.getCurrentNodeLocations(),...e.defaultLinkChartConfig.layoutOptions||{}}):yield e.calculateLinkChartLayout("RADIAL_TREE",{lockedNodeLocations:e.getCurrentNodeLocations()})})()}_refreshNamedTypes(){for(const e of this.layers)e.emit("refresh",{dataChanged:!0});for(const e of this.tables)e.emit("refresh",{dataChanged:!0})}_validateLayoutSettings(e,t){const n=w=>"number"==typeof w&&!isNaN(w),m=new Set(["FORCE_DIRECTED","COMMUNITY","GEOGRAPHIC"]),v={};if(!m.has(e)||!t)return!m.has(e)&&t&&H.Z.getLogger(this).warn("Layout mode options were given for a layout mode that does not utilize them, settings will be ignored"),v;const{computationBudgetTime:T,repulsionRadiusMultiplier:k,idealEdgeLength:L,idealEdgeLengthType:b}=t;var w;n(w=T)&&w>=1?v.computationBudgetTime=T:void 0!==T&&H.Z.getLogger(this).warn("Invalid layout computationBudgetTime setting, will revert to default setting"),(w=>n(w)&&w>=1)(k)?v.repulsionRadiusMultiplier=k:void 0!==k&&H.Z.getLogger(this).warn("Invalid layout repulsionRadiusMultiplier setting, will revert to default setting");const Z=void 0!==L||void 0!==b;return"GEOGRAPHIC"!==e&&Z?H.Z.getLogger(this).warn("Ideal edge length settings were specified for an incompatible layout mode, and will be ignored"):"GEOGRAPHIC"===e&&Z&&((w=>Object.values(ee).includes(w))(b)?v.idealEdgeLengthType=b:void 0!==b&&H.Z.getLogger(this).warn('Invalid layout idealEdgeLengthType setting, will revert to "multiplier" setting'),(w=>n(w)&&w>=0)(L)?v.idealEdgeLength=L:void 0!==L&&H.Z.getLogger(this).warn("Invalid layout idealEdgeLength setting, will revert to default setting")),v}_convertLayoutSettingsToCalculationSettings(e){let t=e.idealEdgeLength;return e.idealEdgeLengthType===ee.ABSOLUTE&&(void 0===t?t=-1:t*=-1),{computationBudgetTime:e.computationBudgetTime,repulsionRadiusMultiplier:e.repulsionRadiusMultiplier,idealEdgeLengthMultiplier:t}}};(0,x._)([(0,S.Cb)()],B.prototype,"dataPreloadedInLocalCache",void 0),(0,x._)([(0,S.Cb)()],B.prototype,"defaultLinkChartConfig",void 0),(0,x._)([(0,S.Cb)()],B.prototype,"dataManager",void 0),(0,x._)([(0,S.Cb)()],B.prototype,"knowledgeGraph",void 0),(0,x._)([(0,S.Cb)()],B.prototype,"layers",void 0),(0,x._)([(0,S.Cb)()],B.prototype,"entityLinkChartDiagramLookup",void 0),(0,x._)([(0,S.Cb)()],B.prototype,"relationshipLinkChartDiagramLookup",void 0),(0,x._)([(0,S.Cb)()],B.prototype,"linkChartExtent",void 0),(0,x._)([(0,S.Cb)()],B.prototype,"memberEntityTypes",void 0),(0,x._)([(0,S.Cb)()],B.prototype,"memberRelationshipTypes",void 0),(0,x._)([(0,S.Cb)()],B.prototype,"sublayerIdsCache",void 0),(0,x._)([(0,S.Cb)()],B.prototype,"tables",void 0),(0,x._)([(0,S.Cb)({json:{read:!1}})],B.prototype,"type",void 0),B=(0,x._)([(0,ge.j)("esri.layers.LinkChartLayer")],B);const Ve=B},56956:(De,se,y)=>{y.d(se,{C_:()=>re,HQ:()=>Le,Lx:()=>Ee,Oh:()=>le,PV:()=>ge,YI:()=>Ce,bT:()=>ee,iR:()=>S,id:()=>oe,rO:()=>J,rT:()=>l,rn:()=>pe,u1:()=>d,vg:()=>C});var M=y(76215),x=y(26894),Te=y(43814),ye=y(19677),N=y(86516),H=y(39437);const Ce={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:M.C}}},re={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(c,p)=>!p.disablePopup},write:{enabled:!0,writer(c,p,r){p[r]=!c}}}},S={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:M.C}}},Le={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:ye.w}}},pe={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:M.C}}},ge={value:null,type:N.Z,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:M.C}}};function Ee(c){return{type:c,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const $={write:{enabled:!0,layerContainerTypes:M.C},read:!0},le={type:Number,json:{origins:{"web-document":$,"portal-item":{write:!0}}}},ee={...le,json:{...le.json,origins:{"web-document":{...$,write:{enabled:!0,layerContainerTypes:M.C,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(c,p,r)=>r&&"service"!==r.origin||!p.drawingInfo||void 0===p.drawingInfo.transparency?p.layerDefinition?.drawingInfo&&void 0!==p.layerDefinition.drawingInfo.transparency?(0,H.b)(p.layerDefinition.drawingInfo.transparency):void 0:(0,H.b)(p.drawingInfo.transparency)}}},C={type:x.Z,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(c,p)=>{const r=x.Z.fromJSON(c);return null!=p.spatialReference&&"object"==typeof p.spatialReference&&(r.spatialReference=Te.Z.fromJSON(p.spatialReference)),r}}}},read:!1}},oe={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},J={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.minScale",write:{enabled:!0,layerContainerTypes:M.C}}},name:"layerDefinition.minScale",write:!0}},d={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.maxScale",write:{enabled:!0,layerContainerTypes:M.C}}},name:"layerDefinition.maxScale",write:!0}},l={json:{write:{ignoreOrigin:!0,layerContainerTypes:M.C},origins:{"web-map":{read:!1,write:!1}}}}}}]);