"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[707],{90295:(ut,J,r)=>{r.d(J,{Z:()=>U});class U{constructor(G){this.size=0,this._start=0,this.maxSize=G,this._buffer=new Array(G)}get entries(){return this._buffer}enqueue(G){if(this.size===this.maxSize){const D=this._buffer[this._start];return this._buffer[this._start]=G,this._start=(this._start+1)%this.maxSize,D}return this._buffer[(this._start+this.size++)%this.maxSize]=G,null}dequeue(){if(0===this.size)return null;const G=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,G}peek(){return 0===this.size?null:this._buffer[this._start]}peekLast(){return 0===this.size?null:this._buffer[(this._start+(this.size-1))%this.maxSize]}find(G){if(0===this.size)return null;for(const D of this._buffer)if(null!=D&&G(D))return D;return null}clear(G){let D=this.dequeue();for(;null!=D;)G&&G(D),D=this.dequeue()}}},97244:(ut,J,r)=>{r.d(J,{b:()=>T,j:()=>C});var U=r(15861),F=r(98930),G=r(14007);const D=128e3;let N=null,v=null;function C(){return O.apply(this,arguments)}function O(){return O=(0,U.Z)(function*(){return N||(N=function M(){return f.apply(this,arguments)}()),N}),O.apply(this,arguments)}function f(){return(f=(0,U.Z)(function*(){v=yield((0,G.Z)("esri-csp-restrictions")?yield r.e(5246).then(r.bind(r,15246)).then(z=>z.l):yield r.e(8392).then(r.bind(r,28392)).then(z=>z.l)).default({locateFile:z=>(0,F.V)(`esri/core/libs/libtess/${z}`)})})).apply(this,arguments)}function T(B,z){const g=Math.max(B.length,D);return v.triangulate(B,z,g)}},37778:(ut,J,r)=>{r.d(J,{j:()=>C});var U=r(7587),F=r(93297),G=r(40460),D=r(7070),N=r(84176);class C{static executeEffects(M,f,T,B){const g=(0,N.Tg)(M);let u=new G.z(f);for(const c of M){const l=(0,D.h)(c);l&&(u=l.execute(u,c,1.3333333333333333,T,B,g))}return u}static applyEffects(M,f,T){if(!M)return f;const B=(0,N.Tg)(M);let z,g=new G.z(U.z.fromJSONCIM(f));for(const l of M){const m=(0,D.h)(l);m&&(g=m.execute(g,l,1,null,T,B))}const u=[];let c=null;for(;z=g.next();)u.push(...(0,F.M)(z)),c=z.geometryType;return 0===u.length||null===c?null:"esriGeometryPolygon"===c?{rings:u}:{paths:u}}}},76721:(ut,J,r)=>{r.d(J,{i:()=>F});var U=r(7070);class F{static getPlacement(D,N,v,C,O,M){const f=(0,U.W)(v);return f?(-1===N&&D.invertY(),f.execute(D,v,C,O,M)):null}}},28179:(ut,J,r)=>{r.d(J,{z:()=>z});var U=r(11196),F=r(99657);function G(g,u){return g.x===u.x&&g.y===u.y}function N(g,u){return g.x=u.y,g.y=-u.x,g}function v(g,u){return g.x=-u.y,g.y=u.x,g}function C(g,u){return g.x=u.x,g.y=u.y,g}function O(g,u){return g.x=-u.x,g.y=-u.y,g}function M(g){return Math.sqrt(g.x*g.x+g.y*g.y)}function f(g,u){return g.x*u.y-g.y*u.x}function T(g,u){return g.x*u.x+g.y*u.y}function B(g,u,c,l){return g.x=u.x*c+u.y*l,g.y=u.x*l-u.y*c,g}class z{constructor(u,c,l){this._writeVertex=u,this._writeTriangle=c,this._canUseThinTessellation=l,this._prevNormal={x:void 0,y:void 0},this._nextNormal={x:void 0,y:void 0},this._textureNormalLeft={x:0,y:1},this._textureNormalRight={x:0,y:-1},this._textureNormal={x:void 0,y:void 0},this._joinNormal={x:void 0,y:void 0},this._inner={x:void 0,y:void 0},this._outer={x:void 0,y:void 0},this._roundStart={x:void 0,y:void 0},this._roundEnd={x:void 0,y:void 0},this._startBreak={x:void 0,y:void 0},this._endBreak={x:void 0,y:void 0},this._innerPrev={x:void 0,y:void 0},this._innerNext={x:void 0,y:void 0},this._bevelStart={x:void 0,y:void 0},this._bevelEnd={x:void 0,y:void 0},this._bevelMiddle={x:void 0,y:void 0}}tessellate(u,c,l=this._canUseThinTessellation){(function D(g){if(!g)return;const u=g.length;if(u<=1)return;let c=0;for(let l=1;l<u;l++)G(g[l],g[c])||++c===l||(g[c]=g[l]);g.length=c+1})(u),l&&c.halfWidth<F.do&&!c.offset?this._tessellateThin(u,c):this._tessellate(u,c)}_tessellateThin(u,c){if(u.length<2)return;const l=c.wrapDistance||65535;let m=c.initialDistance||0,x=!1,I=u[0].x,b=u[0].y;const Q=u.length;for(let ot=1;ot<Q;++ot){x&&(x=!1,m=0);let j=u[ot].x,E=u[ot].y,p=j-I,L=E-b,V=Math.sqrt(p*p+L*L);if(p/=V,L/=V,m+V>l){x=!0;const a=(l-m)/V;V=l-m,j=(1-a)*I+a*j,E=(1-a)*b+a*E,--ot}const W=this._writeVertex(I,b,0,0,p,L,L,-p,0,-1,m),H=this._writeVertex(I,b,0,0,p,L,-L,p,0,1,m);m+=V;const R=this._writeVertex(j,E,0,0,p,L,L,-p,0,-1,m),n=this._writeVertex(j,E,0,0,p,L,-L,p,0,1,m);this._writeTriangle(W,H,R),this._writeTriangle(H,R,n),I=j,b=E}}_tessellate(u,c){const m=u[u.length-1],x=G(u[0],m);if(u.length<(x?3:2))return;const b=c.pixelCoordRatio,Q=null!=c.capType?c.capType:U.RL.BUTT,ot=null!=c.joinType?c.joinType:U.AH.MITER,j=null!=c.miterLimit?Math.min(c.miterLimit,4):2,E=null!=c.roundLimit?Math.min(c.roundLimit,1.05):1.05,p=null!=c.halfWidth?c.halfWidth:2,L=!!c.textured;let V,W,H,R=null;const n=this._prevNormal,a=this._nextNormal;let A=-1,w=-1;const S=this._joinNormal;let k,X;const tt=this._textureNormalLeft,rt=this._textureNormalRight,Z=this._textureNormal;let st=-1,q=-1;const dt=c.wrapDistance||65535;let nt=c.initialDistance||0;const mt=this._writeVertex,ft=this._writeTriangle,lt=(o,i,h,s,_,d)=>{const P=mt(W,H,k,X,h,s,o,i,_,d,nt);return st>=0&&q>=0&&P>=0&&ft(st,q,P),st=q,q=P,P};x&&(V=u[u.length-2],a.x=m.x-V.x,a.y=m.y-V.y,w=M(a),a.x/=w,a.y/=w);let e=!1;for(let o=0;o<u.length;++o){if(e&&(e=!1,nt=0),V&&(n.x=-a.x,n.y=-a.y,A=w,nt+A>dt&&(e=!0)),e){const y=(dt-nt)/A;A=dt-nt,V={x:(1-y)*V.x+y*u[o].x,y:(1-y)*V.y+y*u[o].y},--o}else V=u[o];W=V.x,H=V.y;const i=o<=0&&!e,h=o===u.length-1;if(i||(nt+=A),R=h?x?u[1]:null:u[o+1],R?(a.x=R.x-W,a.y=R.y-H,w=M(a),a.x/=w,a.y/=w):(a.x=void 0,a.y=void 0),!x){if(i){v(S,a),k=S.x,X=S.y,Q===U.RL.SQUARE&&(lt(-a.y-a.x,a.x-a.y,a.x,a.y,0,-1),lt(a.y-a.x,-a.x-a.y,a.x,a.y,0,1)),Q===U.RL.ROUND&&(lt(-a.y-a.x,a.x-a.y,a.x,a.y,-1,-1),lt(a.y-a.x,-a.x-a.y,a.x,a.y,-1,1)),Q!==U.RL.ROUND&&Q!==U.RL.BUTT||(lt(-a.y,a.x,a.x,a.y,0,-1),lt(a.y,-a.x,a.x,a.y,0,1));continue}if(h){N(S,n),k=S.x,X=S.y,Q!==U.RL.ROUND&&Q!==U.RL.BUTT||(lt(n.y,-n.x,-n.x,-n.y,0,-1),lt(-n.y,n.x,-n.x,-n.y,0,1)),Q===U.RL.SQUARE&&(lt(n.y-n.x,-n.x-n.y,-n.x,-n.y,0,-1),lt(-n.y-n.x,n.x-n.y,-n.x,-n.y,0,1)),Q===U.RL.ROUND&&(lt(n.y-n.x,-n.x-n.y,-n.x,-n.y,1,-1),lt(-n.y-n.x,n.x-n.y,-n.x,-n.y,1,1));continue}}let s,_,d=-f(n,a);if(Math.abs(d)<.01)T(n,a)>0?(S.x=n.x,S.y=n.y,d=1,s=Number.MAX_VALUE,_=!0):(v(S,a),d=1,s=1,_=!1);else{S.x=(n.x+a.x)/d,S.y=(n.y+a.y)/d,s=M(S);const y=(s-1)*p*b;_=s>4||y>A&&y>w}k=S.x,X=S.y;let P=ot;switch(ot){case U.AH.BEVEL:s<1.05&&(P=U.AH.MITER);break;case U.AH.ROUND:s<E&&(P=U.AH.MITER);break;case U.AH.MITER:s>j&&(P=U.AH.BEVEL)}switch(P){case U.AH.MITER:if(lt(S.x,S.y,-n.x,-n.y,0,-1),lt(-S.x,-S.y,-n.x,-n.y,0,1),h)break;if(L){const y=e?0:nt;st=this._writeVertex(W,H,k,X,a.x,a.y,S.x,S.y,0,-1,y),q=this._writeVertex(W,H,k,X,a.x,a.y,-S.x,-S.y,0,1,y)}break;case U.AH.BEVEL:{const y=d<0;let Y,K,at,it;if(y){const ct=st;st=q,q=ct,Y=tt,K=rt}else Y=rt,K=tt;if(_)at=y?v(this._innerPrev,n):N(this._innerPrev,n),it=y?N(this._innerNext,a):v(this._innerNext,a);else{const ct=y?O(this._inner,S):C(this._inner,S);at=ct,it=ct}const $=y?N(this._bevelStart,n):v(this._bevelStart,n);lt(at.x,at.y,-n.x,-n.y,Y.x,Y.y);const et=lt($.x,$.y,-n.x,-n.y,K.x,K.y);if(h)break;const ht=y?v(this._bevelEnd,a):N(this._bevelEnd,a);if(_){const ct=this._writeVertex(W,H,k,X,-n.x,-n.y,0,0,0,0,nt);st=this._writeVertex(W,H,k,X,a.x,a.y,it.x,it.y,Y.x,Y.y,nt),q=this._writeVertex(W,H,k,X,a.x,a.y,ht.x,ht.y,K.x,K.y,nt),this._writeTriangle(et,ct,q)}else{if(L){const ct=this._bevelMiddle;ct.x=($.x+ht.x)/2,ct.y=($.y+ht.y)/2,B(Z,ct,-n.x,-n.y),lt(ct.x,ct.y,-n.x,-n.y,Z.x,Z.y),B(Z,ct,a.x,a.y),st=this._writeVertex(W,H,k,X,a.x,a.y,ct.x,ct.y,Z.x,Z.y,nt),q=this._writeVertex(W,H,k,X,a.x,a.y,it.x,it.y,Y.x,Y.y,nt)}else{const ct=st;st=q,q=ct}lt(ht.x,ht.y,a.x,a.y,K.x,K.y)}if(y){const ct=st;st=q,q=ct}break}case U.AH.ROUND:{const y=d<0;let Y,K;if(y){const _t=st;st=q,q=_t,Y=tt,K=rt}else Y=rt,K=tt;const at=y?O(this._inner,S):C(this._inner,S);let it,$;_?(it=y?v(this._innerPrev,n):N(this._innerPrev,n),$=y?N(this._innerNext,a):v(this._innerNext,a)):(it=at,$=at);const et=y?N(this._roundStart,n):v(this._roundStart,n),ht=y?v(this._roundEnd,a):N(this._roundEnd,a),ct=lt(it.x,it.y,-n.x,-n.y,Y.x,Y.y),pt=lt(et.x,et.y,-n.x,-n.y,K.x,K.y);if(h)break;const xt=this._writeVertex(W,H,k,X,-n.x,-n.y,0,0,0,0,nt);_||this._writeTriangle(st,q,xt);const yt=O(this._outer,at),gt=this._writeVertex(W,H,k,X,a.x,a.y,ht.x,ht.y,K.x,K.y,nt);let Et,Pt;const Tt=s>2;if(Tt){let _t;s!==Number.MAX_VALUE?(yt.x/=s,yt.y/=s,_t=T(n,yt),_t=(s*(_t*_t-1)+1)/_t):_t=-1,Et=y?N(this._startBreak,n):v(this._startBreak,n),Et.x+=n.x*_t,Et.y+=n.y*_t,Pt=y?v(this._endBreak,a):N(this._endBreak,a),Pt.x+=a.x*_t,Pt.y+=a.y*_t}B(Z,yt,-n.x,-n.y);const Dt=this._writeVertex(W,H,k,X,-n.x,-n.y,yt.x,yt.y,Z.x,Z.y,nt);B(Z,yt,a.x,a.y);const At=L?this._writeVertex(W,H,k,X,a.x,a.y,yt.x,yt.y,Z.x,Z.y,nt):Dt,St=xt,Ot=L?this._writeVertex(W,H,k,X,a.x,a.y,0,0,0,0,nt):xt;let vt=-1,Mt=-1;if(Tt&&(B(Z,Et,-n.x,-n.y),vt=this._writeVertex(W,H,k,X,-n.x,-n.y,Et.x,Et.y,Z.x,Z.y,nt),B(Z,Pt,a.x,a.y),Mt=this._writeVertex(W,H,k,X,a.x,a.y,Pt.x,Pt.y,Z.x,Z.y,nt)),L?Tt?(this._writeTriangle(St,pt,vt),this._writeTriangle(St,vt,Dt),this._writeTriangle(Ot,At,Mt),this._writeTriangle(Ot,Mt,gt)):(this._writeTriangle(St,pt,Dt),this._writeTriangle(Ot,At,gt)):Tt?(this._writeTriangle(xt,pt,vt),this._writeTriangle(xt,vt,Mt),this._writeTriangle(xt,Mt,gt)):(this._writeTriangle(xt,pt,Dt),this._writeTriangle(xt,At,gt)),_?(st=this._writeVertex(W,H,k,X,a.x,a.y,$.x,$.y,Y.x,Y.y,nt),q=gt):(st=L?this._writeVertex(W,H,k,X,a.x,a.y,$.x,$.y,Y.x,Y.y,nt):ct,this._writeTriangle(st,Ot,gt),q=gt),y){const _t=st;st=q,q=_t}break}}}}}},78686:(ut,J,r)=>{r.d(J,{dx:()=>lt,tZ:()=>ft,bT:()=>q,so:()=>nt}),r(4460);var F=r(97244),G=r(80247),D=r(62209),N=r(99657);function v(e,o,i,h,s,_,d){k=0;const P=(h-i)*_,y=s&&s.length,Y=y?(s[0]-i)*_:P;let K,at,it,$,et,ht=C(o,i,0,0,Y,_,!0);if(ht&&ht.next!==ht.prev){if(y&&(ht=function u(e,o,i,h,s,_){const d=new Array;for(let P=0,y=h.length;P<y;P++){const Y=C(e,o,0,h[P]*_,P<y-1?h[P+1]*_:i*_,_,!1);Y===Y.next&&(Y.steiner=!0),d.push(g(Y))}d.sort(V);for(const P of d)s=c(P,s);return s}(o,i,h,s,ht,_)),P>80*_){K=it=o[0+i*_],at=$=o[1+i*_];for(let ct=_;ct<Y;ct+=_){const pt=o[ct+i*_],xt=o[ct+1+i*_];K=Math.min(K,pt),at=Math.min(at,xt),it=Math.max(it,pt),$=Math.max($,xt)}et=Math.max(it-K,$-at),et=0!==et?1/et:0}M(ht,e,_,K,at,et,d,0)}}function C(e,o,i,h,s,_,d){let P;if(d===function ot(e,o,i,h,s,_){let d=0;for(let P=h,y=s-_;P<s;P+=_)d+=(e[y+o*_]-e[P+o*_])*(e[P+1+o*_]+e[y+1+o*_]),y=P;return d}(e,o,0,h,s,_)>0)for(let y=h;y<s;y+=_)P=B(y+o*_,e[y+o*_],e[y+1+o*_],P);else for(let y=s-_;y>=h;y-=_)P=B(y+o*_,e[y+o*_],e[y+1+o*_],P);return P&&L(P,P.next)&&(z(P),P=P.next),P}function O(e,o=e){if(!e)return e;let i,h=e;do{if(i=!1,h.steiner||!L(h,h.next)&&0!==I(h.prev,h,h.next))h=h.next;else{if(z(h),h=o=h.prev,h===h.next)break;i=!0}}while(i||h!==o);return o}function M(e,o,i,h,s,_,d,P){if(!e)return;!P&&_&&(e=m(e,h,s,_));let y=e;for(;e.prev!==e.next;){const Y=e.prev,K=e.next;if(_?T(e,h,s,_):f(e))o.push(Y.index/i+d),o.push(e.index/i+d),o.push(K.index/i+d),z(e),e=K.next,y=K.next;else if((e=K)===y){P?1===P?M(e=W(e,o,i,d),o,i,h,s,_,d,2):2===P&&H(e,o,i,h,s,_,d):M(O(e),o,i,h,s,_,d,1);break}}}function f(e){const o=e.prev,i=e,h=e.next;if(I(o,i,h)>=0)return!1;let s=e.next.next;const _=s;let d=0;for(;s!==e.prev&&(0===d||s!==_);){if(d++,j(o.x,o.y,i.x,i.y,h.x,h.y,s.x,s.y)&&I(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function T(e,o,i,h){const s=e.prev,_=e,d=e.next;if(I(s,_,d)>=0)return!1;const Y=s.x>_.x?s.x>d.x?s.x:d.x:_.x>d.x?_.x:d.x,K=s.y>_.y?s.y>d.y?s.y:d.y:_.y>d.y?_.y:d.y,at=p(s.x<_.x?s.x<d.x?s.x:d.x:_.x<d.x?_.x:d.x,s.y<_.y?s.y<d.y?s.y:d.y:_.y<d.y?_.y:d.y,o,i,h),it=p(Y,K,o,i,h);let $=e.prevZ,et=e.nextZ;for(;$&&$.z>=at&&et&&et.z<=it;){if($!==e.prev&&$!==e.next&&j(s.x,s.y,_.x,_.y,d.x,d.y,$.x,$.y)&&I($.prev,$,$.next)>=0||($=$.prevZ,et!==e.prev&&et!==e.next&&j(s.x,s.y,_.x,_.y,d.x,d.y,et.x,et.y)&&I(et.prev,et,et.next)>=0))return!1;et=et.nextZ}for(;$&&$.z>=at;){if($!==e.prev&&$!==e.next&&j(s.x,s.y,_.x,_.y,d.x,d.y,$.x,$.y)&&I($.prev,$,$.next)>=0)return!1;$=$.prevZ}for(;et&&et.z<=it;){if(et!==e.prev&&et!==e.next&&j(s.x,s.y,_.x,_.y,d.x,d.y,et.x,et.y)&&I(et.prev,et,et.next)>=0)return!1;et=et.nextZ}return!0}function B(e,o,i,h){const s=A.create(e,o,i);return h?(s.next=h.next,s.prev=h,h.next.prev=s,h.next=s):(s.prev=s,s.next=s),s}function z(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function g(e){let o=e,i=e;do{(o.x<i.x||o.x===i.x&&o.y<i.y)&&(i=o),o=o.next}while(o!==e);return i}function c(e,o){const i=function l(e,o){let i=o;const h=e.x,s=e.y;let _,d=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){const it=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(it<=h&&it>d){if(d=it,it===h){if(s===i.y)return i;if(s===i.next.y)return i.next}_=i.x<i.next.x?i:i.next}}i=i.next}while(i!==o);if(!_)return null;if(h===d)return _.prev;const P=_,y=_.x,Y=_.y;let K,at=1/0;for(i=_.next;i!==P;)h>=i.x&&i.x>=y&&h!==i.x&&j(s<Y?h:d,s,y,Y,s<Y?d:h,s,i.x,i.y)&&(K=Math.abs(s-i.y)/(h-i.x),(K<at||K===at&&i.x>_.x)&&E(i,e)&&(_=i,at=K)),i=i.next;return _}(e,o);if(!i)return o;const h=a(i,e);return O(h,h.next),O(i,i.next)}function m(e,o,i,h){let s;for(;s!==e;s=s.next){if(s=s||e,null===s.z&&(s.z=p(s.x,s.y,o,i,h)),s.prev.next!==s||s.next.prev!==s)return s.prev.next=s,s.next.prev=s,m(e,o,i,h);s.prevZ=s.prev,s.nextZ=s.next}return e.prevZ.nextZ=null,e.prevZ=null,function x(e){let o,i=1;for(;;){let h,s=e;e=null,o=null;let _=0;for(;s;){_++,h=s;let d=0;for(;d<i&&h;d++)h=h.nextZ;let P=i;for(;d>0||P>0&&h;){let y;0===d?(y=h,h=h.nextZ,P--):0!==P&&h?s.z<=h.z?(y=s,s=s.nextZ,d--):(y=h,h=h.nextZ,P--):(y=s,s=s.nextZ,d--),o?o.nextZ=y:e=y,y.prevZ=o,o=y}s=h}if(o.nextZ=null,i*=2,_<2)return e}}(e)}function I(e,o,i){return(o.y-e.y)*(i.x-o.x)-(o.x-e.x)*(i.y-o.y)}function b(e,o,i,h){return!!(L(e,o)&&L(i,h)||L(e,h)&&L(i,o))||I(e,o,i)>0!=I(e,o,h)>0&&I(i,h,e)>0!=I(i,h,o)>0}function j(e,o,i,h,s,_,d,P){return(s-d)*(o-P)-(e-d)*(_-P)>=0&&(e-d)*(h-P)-(i-d)*(o-P)>=0&&(i-d)*(_-P)-(s-d)*(h-P)>=0}function E(e,o){return I(e.prev,e,e.next)<0?I(e,o,e.next)>=0&&I(e,e.prev,o)>=0:I(e,o,e.prev)<0||I(e,e.next,o)<0}function p(e,o,i,h,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*s)|e<<8))|e<<4))|e<<2))|e<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-h)*s)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function L(e,o){return e.x===o.x&&e.y===o.y}function V(e,o){return e.x-o.x}function W(e,o,i,h){let s=e;do{const _=s.prev,d=s.next.next;!L(_,d)&&b(_,s,s.next,d)&&E(_,d)&&E(d,_)&&(o.push(_.index/i+h),o.push(s.index/i+h),o.push(d.index/i+h),z(s),z(s.next),s=e=d),s=s.next}while(s!==e);return s}function H(e,o,i,h,s,_,d){let P=e;do{let y=P.next.next;for(;y!==P.prev;){if(P.index!==y.index&&R(P,y)){let Y=a(P,y);return P=O(P,P.next),Y=O(Y,Y.next),M(P,o,i,h,s,_,d,0),void M(Y,o,i,h,s,_,d,0)}y=y.next}P=P.next}while(P!==e)}function R(e,o){return e.next.index!==o.index&&e.prev.index!==o.index&&!function Q(e,o){let i=e;do{if(i.index!==e.index&&i.next.index!==e.index&&i.index!==o.index&&i.next.index!==o.index&&b(i,i.next,e,o))return!0;i=i.next}while(i!==e);return!1}(e,o)&&E(e,o)&&E(o,e)&&function n(e,o){let i=e,h=!1;const s=(e.x+o.x)/2,_=(e.y+o.y)/2;do{i.y>_!=i.next.y>_&&i.next.y!==i.y&&s<(i.next.x-i.x)*(_-i.y)/(i.next.y-i.y)+i.x&&(h=!h),i=i.next}while(i!==e);return h}(e,o)}function a(e,o){const i=A.create(e.index,e.x,e.y),h=A.create(o.index,o.x,o.y),s=e.next,_=o.prev;return e.next=o,o.prev=e,i.next=s,s.prev=i,h.next=i,i.prev=h,_.next=h,h.prev=_,h}class A{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(o,i,h){const s=k<w.length?w[k++]:new A;return s.index=o,s.x=i,s.y=h,s.prev=null,s.next=null,s.z=null,s.prevZ=null,s.nextZ=null,s.steiner=!1,s}}const w=[];let k=0;for(let e=0;e<8096;e++)w.push(new A);const X=1e-5,tt=new G.bN(0,0,0,1,0),rt=new G.bN(0,0,0,1,0);function Z(e,o,i){let h=0;for(let s=1;s<i;s++)h+=(e[2*(o+s)]-e[2*(o+s-1)])*(e[2*(o+s)+1]+e[2*(o+s-1)+1]);return h}function st(e,o,i,h,s){let _=0;for(let P=i;P<h;P+=3){const y=2*(e[P]-s),Y=2*(e[P+1]-s),K=2*(e[P+2]-s);_+=Math.abs((o[y]-o[K])*(o[Y+1]-o[y+1])-(o[y]-o[Y])*(o[K+1]-o[y+1]))}return _}function q(e,o){const{coords:i,lengths:h,hasIndeterminateRingOrder:s}=o,d=e;if(s)return!1;let P=0;for(let y=0;y<h.length;){let Y=y,K=h[y],at=Z(i,P,K);const it=[];for(;++Y<h.length;){const ct=h[Y],pt=Z(i,P+K,ct);if(!(pt>0))break;at+=pt,it.push(P+K),K+=ct}const $=d.length;v(d,i,P,P+K,it,2,0);const et=st(d,i,$,d.length,0),ht=Math.abs(at);if(Math.abs((et-ht)/Math.max(1e-7,ht))>X)return d.length=0,!1;y=Y,P+=K}return!0}function nt(e){const{coords:o,lengths:i}=e,{buffer:h}=(0,F.b)(o,i);return h}function ft(e,o){if(null==e)return null;if(!function mt(e,o,i){let h=0;for(let s=0;s<e.lengths.length;s++){const _=e.lengths[s];for(let d=0;d<_;d++){const P=e.coords[2*(d+h)],y=e.coords[2*(d+h)+1];if(P<o||P>i||y<o||y>i)return!0}h+=_}return!1}(e,-128,N.i9+128))return e;tt.setPixelMargin(o),tt.reset(G.Vl.Polygon);let i=0;for(let d=0;d<e.lengths.length;d++){const P=e.lengths[d];let y=e.coords[2*(0+i)],Y=e.coords[2*(0+i)+1];tt.moveTo(y,Y);for(let K=1;K<P;K++)y=e.coords[2*(K+i)],Y=e.coords[2*(K+i)+1],tt.lineTo(y,Y);tt.close(),i+=P}const h=tt.result(!1);if(!h)return null;const s=[],_=[];for(const d of h){let P=0;for(const y of d)_.push(y.x),_.push(y.y),P++;s.push(P)}return new D.Z(s,_)}function lt(e,o){rt.setPixelMargin(o);const i=rt,h=-o,s=N.i9+o;let _=[],d=!1;if(!e.nextPath())return null;let P=!0;for(;P;){e.seekPathStart();const y=[];if(!e.pathSize)return null;i.reset(G.Vl.LineString),e.nextPoint();let Y=e.x,K=e.y;if(d)i.moveTo(Y,K);else{if(Y<h||Y>s||K<h||K>s){d=!0;continue}y.push({x:Y,y:K})}let at=!1;for(;e.nextPoint();)if(Y=e.x,K=e.y,d)i.lineTo(Y,K);else{if(Y<h||Y>s||K<h||K>s){at=!0;break}y.push({x:Y,y:K})}if(at)d=!0;else{if(d){const it=i.resultWithStarts();if(it)for(const $ of it)_.push($)}else _.push({line:y,start:0});P=e.nextPath(),d=!1}}return _=_.filter(y=>y.line.length>1),0===_.length?null:_}tt.setExtent(N.i9),rt.setExtent(N.i9)},11223:(ut,J,r)=>{r.d(J,{Z:()=>D});var U=r(92436),F=r(39237);const G={createComputedParams:N=>N,optionalAttributes:{},attributes:{id:{type:F.g.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:F.g.UNSIGNED_BYTE,count:1},pos:{type:F.g.SHORT,count:2,pack:"position",packPrecisionFactor:10},inverseArea:{type:F.g.FLOAT,count:1,packTessellation:({inverseArea:N})=>N}}};class D extends U.r{constructor(){super(...arguments),this.vertexSpec=G}createTesselationParams(v){return{inverseArea:1/v.readGeometryArea()}}}},92436:(ut,J,r)=>{r.d(J,{r:()=>O});var U=r(15861),F=r(14007),G=r(97244),D=r(78686),N=r(88269);const C=(0,F.Z)("featurelayer-fast-triangulation-enabled");class O extends N.c{loadDependencies(){var f=()=>super.loadDependencies,T=this;return(0,U.Z)(function*(){yield Promise.all([f().call(T),(0,G.j)()])})()}_write(f,T,B){const z=B?.asOptimized()??T.readGeometryForDisplay(),g=this._clip(z);g&&(f.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(f,T,g),f.recordEnd())}_clip(f){return f?(0,D.tZ)(f,this.hasEffects?256:8):null}_writeGeometry(f,T,B){const z=B.maxLength>100,g=[],u=this.createTesselationParams(T);if(!z&&C&&(0,D.bT)(g,B))return void(g.length&&this._writeVertices(f,T,B.coords,u,g));const c=(0,D.so)(B);this._writeVertices(f,T,c,u)}_writeVertices(f,T,B,z,g){const u=T.getDisplayId(),c=f.vertexCount(),l=this.hasEffects;let m=0;if(g)for(const x of g){const I=B[2*x],b=B[2*x+1];l&&f.recordBounds(I,b,0,0),this._writeVertex(f,u,I,b,z),m++}else for(let x=0;x<B.length;x+=2){const I=Math.round(B[x]),b=Math.round(B[x+1]);l&&f.recordBounds(I,b,0,0),this._writeVertex(f,u,I,b,z),m++}f.indexEnsureSize(m);for(let x=0;x<m;x++)f.indexWrite(x+c)}}},62693:(ut,J,r)=>{r.d(J,{MG:()=>O,MW:()=>C,Mb:()=>M,h5:()=>f});var U=r(55768),F=r(26128),G=r(35089),D=r(10659),N=r(90450),v=r(39237);function C(T){const{sprite:B,aspectRatio:z,scaleProportionally:g}=T,u=(0,U.F2)(T.height);let l=u*z;return l<=0?l=B.width:g&&(l*=B.width/B.height),{width:l,height:u>0?u:B.height}}function O(T){const{applyRandomOffset:B,sampleAlphaOnly:z}=T;return(0,G.u)([[N.Ux,B],[N.GS,z]])}const M={createComputedParams:T=>T,optionalAttributes:D.w.optionalAttributes,attributes:{...D.w.attributes,bitset:{count:1,type:v.g.UNSIGNED_BYTE,pack:O},width:{count:1,type:v.g.HALF_FLOAT,pack:T=>C(T).width},height:{count:1,type:v.g.HALF_FLOAT,pack:T=>C(T).height},offset:{count:2,type:v.g.HALF_FLOAT,pack:({offsetX:T,offsetY:B})=>[(0,U.F2)(T),-(0,U.F2)(B)]},scale:{count:2,type:v.g.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:T,scaleY:B})=>[T,B]},angle:{count:1,type:v.g.UNSIGNED_BYTE,pack:({angle:T})=>(0,F.s5)(T)}}};class f extends D.H{constructor(){super(...arguments),this.vertexSpec=M}}},78426:(ut,J,r)=>{r.d(J,{f:()=>u});var U=r(15861),F=r(55768),G=r(7587),D=r(62693),N=r(35089),v=r(69794),C=r(91197),O=r(90450),M=r(39237);const f=D.Mb,B={createComputedParams:c=>c,optionalAttributes:f.optionalAttributes,attributes:{...f.attributes,bitset:{type:M.g.UNSIGNED_BYTE,count:1,pack:c=>(0,D.MG)(c)},aux1:{count:1,type:M.g.HALF_FLOAT,pack:c=>(0,D.MW)(c).width},aux2:{count:1,type:M.g.HALF_FLOAT,pack:c=>(0,D.MW)(c).height},aux3:{count:2,type:M.g.HALF_FLOAT,pack:({offsetX:c,offsetY:l})=>[(0,F.F2)(c),(0,F.F2)(l)]},aux4:{count:2,type:M.g.UNSIGNED_BYTE,pack:({scaleX:c,scaleY:l})=>[c*C.$1,l*C.$1]}}},z={createComputedParams:c=>c,optionalAttributes:f.optionalAttributes,attributes:{...f.attributes,color:v.OQ.attributes.color,bitset:{type:M.g.UNSIGNED_BYTE,count:1,pack:c=>(0,N.u)([[O.WD,!0]])},aux1:{count:1,type:M.g.HALF_FLOAT,pack:c=>(0,F.F2)(.5*c.width)},aux2:{count:1,type:M.g.HALF_FLOAT,pack:c=>(0,F.F2)(.5*c.referenceWidth)},aux3:{count:2,type:M.g.HALF_FLOAT,packTessellation:({extrusionOffsetX:c,extrusionOffsetY:l})=>[c,l]},aux4:{count:2,type:M.g.UNSIGNED_BYTE,packTessellation:({normalX:c,normalY:l})=>[c*C.$1+C.NS,l*C.$1+C.NS]}}};class g extends v.B2{constructor(){super(...arguments),this.vertexSpec=z}}class u extends v.nT{constructor(){super(...arguments),this.vertexSpec=B}_createOutlineWriter(l,m,x,I){return new g(l,m,x,I)}_write(l,m,x){const I=x?.asOptimized()??m.readGeometryForDisplay(),b=this._clip(I);if(!b)return;const Q=this.evaluatedMeshParams.sprite?.textureBinding;l.recordStart(this.instanceId,this.attributeLayout,Q),this._writeGeometry(l,m,b),this._lineMeshWriter.writeLineVertices(l,G.z.fromOptimizedCIM(b,"esriGeometryPolyline"),m),l.recordEnd()}ensurePacked(l,m,x){super.ensurePacked(l,m,x),this._lineMeshWriter.ensurePacked(l,m,x)}enqueueRequest(l,m,x){super.enqueueRequest(l,m,x),this._lineMeshWriter.enqueueRequest(l,m,x)}loadDependencies(){var l=()=>super.loadDependencies,m=this;return(0,U.Z)(function*(){yield Promise.all([l().call(m),m._lineMeshWriter.loadDependencies()])})()}}},20325:(ut,J,r)=>{r.d(J,{Q:()=>v,a:()=>N});var U=r(99657),F=r(92436),G=r(35089),D=r(39237);const N={createComputedParams:C=>C,optionalAttributes:{zoomRange:{type:D.g.SHORT,count:2,packPrecisionFactor:U.JS,pack:({scaleInfo:C},{tileInfo:O})=>(0,G._f)(C,O)}},attributes:{id:{type:D.g.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:D.g.UNSIGNED_BYTE,count:1},pos:{type:D.g.SHORT,count:2,pack:"position",packPrecisionFactor:10},color:{type:D.g.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:C})=>(0,G.G7)(C)}}};class v extends F.r{constructor(){super(...arguments),this.vertexSpec=N}createTesselationParams(O){return null}}},69794:(ut,J,r)=>{r.d(J,{B2:()=>B,OQ:()=>T,nT:()=>z,s9:()=>f});var U=r(15861),F=r(7587),G=r(78686),D=r(20325),N=r(35089),v=r(98201),C=r(51059),O=r(90450),M=r(39237);const f={createComputedParams:g=>g,optionalAttributes:v.bT.optionalAttributes,attributes:{...v.bT.attributes,bitset:{type:M.g.UNSIGNED_BYTE,count:1,pack:g=>0},color:{type:M.g.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:g})=>(0,N.G7)(g)}}},T={createComputedParams:g=>g,optionalAttributes:v.bT.optionalAttributes,attributes:{...v.bT.attributes,bitset:{type:M.g.UNSIGNED_BYTE,count:1,pack:g=>(0,N.u)([[O.WD,!0]])},color:{type:M.g.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:g})=>(0,N.G7)(g)}}};class B extends v.ti{constructor(){super(...arguments),this.vertexSpec=T}}class z extends D.Q{constructor(u,c,l,m){super(u,c,l,m),this.vertexSpec=f,this._lineMeshWriter=this._createOutlineWriter(u,c,l,m)}_createOutlineWriter(u,c,l,m){return new B(u,c,l,m)}_write(u,c,l){const m=l?.asOptimized()??c.readGeometryForDisplay(),x=this._clip(m);x&&(u.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(u,c,x),this._lineMeshWriter.writeLineVertices(u,F.z.fromOptimizedCIM(x,"esriGeometryPolyline"),c),u.recordEnd())}_clip(u){return u?(0,G.tZ)(u,(0,C.b8)(this.evaluatedMeshParams)):null}ensurePacked(u,c,l){super.ensurePacked(u,c,l),this._lineMeshWriter.ensurePacked(u,c,l)}enqueueRequest(u,c,l){super.enqueueRequest(u,c,l),this._lineMeshWriter.enqueueRequest(u,c,l)}loadDependencies(){var u=()=>super.loadDependencies,c=this;return(0,U.Z)(function*(){yield Promise.all([u().call(c),c._lineMeshWriter.loadDependencies()])})()}}},10659:(ut,J,r)=>{r.d(J,{H:()=>N,w:()=>D});var U=r(99657),F=r(20325),G=r(39237);const D={createComputedParams:v=>v,optionalAttributes:F.a.optionalAttributes,attributes:{...F.a.attributes,tlbr:{count:4,type:G.g.UNSIGNED_SHORT,pack:({sprite:v})=>{const{rect:C,width:O,height:M}=v,f=C.x+U.s4,T=C.y+U.s4;return[f,T,f+O,T+M]}},inverseRasterizationScale:{count:1,type:G.g.BYTE,packPrecisionFactor:16,pack:({sprite:v})=>1/v.rasterizationScale}}};class N extends F.Q{constructor(){super(...arguments),this.vertexSpec=D}_write(C,O,M){const f=M?.asOptimized()??O.readGeometryForDisplay(),T=this._clip(f);if(!T)return;const B=this.evaluatedMeshParams.sprite?.textureBinding;C.recordStart(this.instanceId,this.attributeLayout,B),this._writeGeometry(C,O,T),C.recordEnd()}}},34501:(ut,J,r)=>{r.d(J,{i:()=>O});var U=r(15861),F=r(7587),G=r(69794),D=r(10659);const N={optionalAttributes:D.w.optionalAttributes,createComputedParams:M=>M,attributes:{...D.w.attributes,...G.s9.attributes}},v={optionalAttributes:D.w.optionalAttributes,createComputedParams:M=>M,attributes:{...D.w.attributes,...G.OQ.attributes}};class C extends G.B2{constructor(){super(...arguments),this.vertexSpec=v}}class O extends G.nT{constructor(){super(...arguments),this.vertexSpec=N}_createOutlineWriter(f,T,B,z){return new C(f,T,B,z)}_write(f,T,B){const z=B?.asOptimized()??T.readGeometryForDisplay(),g=this._clip(z);if(!g)return;const u=this.evaluatedMeshParams.sprite?.textureBinding;f.recordStart(this.instanceId,this.attributeLayout,u),this._writeGeometry(f,T,g),this._lineMeshWriter.writeLineVertices(f,F.z.fromOptimizedCIM(g,"esriGeometryPolyline"),T),f.recordEnd()}ensurePacked(f,T,B){super.ensurePacked(f,T,B),this._lineMeshWriter.ensurePacked(f,T,B)}enqueueRequest(f,T,B){super.enqueueRequest(f,T,B),this._lineMeshWriter.enqueueRequest(f,T,B)}loadDependencies(){var f=()=>super.loadDependencies,T=this;return(0,U.Z)(function*(){yield Promise.all([f().call(T),T._lineMeshWriter.loadDependencies()])})()}}},35089:(ut,J,r)=>{r.d(J,{G7:()=>T,L:()=>B,Lq:()=>z,NF:()=>M,QS:()=>g,_f:()=>O,kU:()=>u,u:()=>f});var U=r(66599),F=r(57964),G=r(4703),D=r(11196);const N=()=>G.Z.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils"),v=0,C=100;function O(c,l){return[!!c?.minScale&&l.scaleToZoom(c.minScale)||v,!!c?.maxScale&&l.scaleToZoom(c.maxScale)||C]}function M(c){return 1<<c}function f(c){let l=0;for(const[m,x]of c)x&&(l|=1<<m);return l}function T(c){let l;if(!c)return[0,0,0,0];if("string"==typeof c){const Q=U.Z.fromString(c);if(!Q)return N().errorOnce(new F.Z("mapview:mesh-processing","Unable to parse string into color",{color:c})),[0,0,0,0];l=Q.toArray()}else l=c;const[m,x,I,b]=l;return[m*(b/255),x*(b/255),I*(b/255),b]}function B(c){switch(c){case"butt":case D.kP.Butt:return D.RL.BUTT;case"round":case D.kP.Round:return D.RL.ROUND;case"square":case D.kP.Square:return D.RL.SQUARE}}function z(c){switch(c){case"bevel":case D.r4.Bevel:return D.AH.BEVEL;case"miter":case D.r4.Miter:return D.AH.MITER;case"round":case D.r4.Round:return D.AH.ROUND}}function g(c,l){return Math.round(Math.min(Math.sqrt(c*l),255))}function u(c,l){return Math.round(c*l)/l}},23990:(ut,J,r)=>{r.d(J,{E:()=>D});var U=r(88269),F=r(39237);const G={createComputedParams:N=>N,optionalAttributes:{},attributes:{pos:{type:F.g.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:F.g.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:F.g.UNSIGNED_BYTE,count:1},offset:{type:F.g.BYTE,count:2,packAlternating:{count:4,pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}};class D extends U.c{constructor(){super(...arguments),this.vertexSpec=G}_write(v,C){v.recordStart(this.instanceId,this.attributeLayout);const O=C.getDisplayId();if("esriGeometryPoint"===C.geometryType){const M=C.readXForDisplay(),f=C.readYForDisplay();this._writeQuad(v,O,M,f)}else"esriGeometryMultipoint"===C.geometryType&&C.readGeometryForDisplay()?.forEachVertex((f,T)=>{f>=0&&f<=512&&T>=0&&T<=512&&this._writeQuad(v,O,f,T)});v.recordEnd()}_writeQuad(v,C,O,M){const f=v.vertexCount();this._writeVertex(v,C,O,M),v.indexWrite(f+0),v.indexWrite(f+1),v.indexWrite(f+2),v.indexWrite(f+1),v.indexWrite(f+3),v.indexWrite(f+2)}}},98201:(ut,J,r)=>{r.d(J,{bT:()=>T,ti:()=>g});var U=r(55768),F=r(7587),G=r(99657),D=r(28179),N=r(78686),v=r(35089),C=r(88269),O=r(51059),M=r(39237);class f{constructor(){this.extrusionOffsetX=0,this.extrusionOffsetY=0,this.normalX=0,this.normalY=0,this.directionX=0,this.directionY=0,this.distance=0}}const T={createComputedParams:u=>u,optionalAttributes:{zoomRange:{type:M.g.SHORT,count:2,packPrecisionFactor:G.JS,pack:({scaleInfo:u},{tileInfo:c})=>(0,v._f)(u,c)}},attributes:{id:{type:M.g.UNSIGNED_BYTE,count:3,pack:"id"},pos:{type:M.g.SHORT,count:2,pack:"position",packPrecisionFactor:10},bitset:{type:M.g.UNSIGNED_BYTE,count:1},color:{type:M.g.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:u})=>(0,v.G7)(u)},offset:{type:M.g.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:u,extrusionOffsetY:c})=>[(0,v.kU)(u,16),(0,v.kU)(c,16)]},normal:{type:M.g.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:u,normalY:c})=>[(0,v.kU)(u,16),(0,v.kU)(c,16)]},halfWidth:{type:M.g.HALF_FLOAT,count:1,pack:({width:u})=>(0,U.F2)(.5*u)},referenceHalfWidth:{type:M.g.HALF_FLOAT,count:1,pack:({referenceWidth:u})=>(0,U.F2)(.5*u)}}};class B{constructor(){this.id=0,this.bitset=0,this.indexCount=0,this.vertexCount=0,this.vertexFrom=0,this.vertexBounds=0}}class g extends C.c{constructor(c,l,m,x){super(c,l,m,x),this.vertexSpec=T,this._currentWrite=new B,this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:65535,textured:!1},this._tessParams=new f,this._initializeTessellator()}writeLineVertices(c,l,m){const x=this._getLines(l);null!=x&&this._writeVertices(c,m,x)}_initializeTessellator(){this._lineTessellator=new D.z(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0)}_write(c,l,m){const x=m??F.z.fromFeatureSetReaderCIM(l);x&&this._writeGeometry(c,l,x)}_writeGeometry(c,l,m,x){c.recordStart(this.instanceId,this.attributeLayout,x),this.writeLineVertices(c,m,l),c.recordEnd()}_getLines(c){return(0,N.dx)(c,(0,O.b8)(this.evaluatedMeshParams))}_writeVertices(c,l,m){const{_currentWrite:x,_tessellationOptions:I,evaluatedMeshParams:b}=this,{width:Q,capType:ot,joinType:j,miterLimit:E,hasSizeVV:p}=b,L=(0,U.F2)(.5*Q);I.halfWidth=L,I.capType=(0,v.L)(ot),I.joinType=(0,v.Lq)(j),I.miterLimit=E;const V=!p;x.out=c,x.id=l.getDisplayId(),x.vertexCount=0,x.indexCount=0,x.vertexFrom=c.vertexCount(),x.vertexBounds=V&&L<G.do?0:1;for(const{line:W,start:H}of m)I.initialDistance=H%65535,this._lineTessellator.tessellate(W,I,V)}_writeTesselatedVertex(c,l,m,x,I,b,Q,ot,j,E,p){const{out:L,id:V,vertexBounds:W}=this._currentWrite;return this.hasEffects&&L.recordBounds(c,l,W,W),this._tessParams.extrusionOffsetX=Q,this._tessParams.extrusionOffsetY=ot,this._tessParams.normalX=j,this._tessParams.normalY=E,this._tessParams.directionX=I,this._tessParams.directionY=b,this._tessParams.distance=p,this._writeVertex(L,V,c,l,this._tessParams),this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(c,l,m){const{out:x}=this._currentWrite;x.indexEnsureSize(3),x.indexWrite(c),x.indexWrite(l),x.indexWrite(m),this._currentWrite.indexCount+=3}}},36397:(ut,J,r)=>{r.d(J,{I:()=>O});var U=r(7587),F=r(99657),G=r(35089),D=r(98201),N=r(90450),v=r(39237);const C={createComputedParams:M=>M,optionalAttributes:D.bT.optionalAttributes,attributes:{...D.bT.attributes,bitset:{type:v.g.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:M,shouldScaleDash:f,isSDF:T})=>(0,G.u)([[N.GS,M],[N.Wq,f],[N.B7,T]])},tlbr:{type:v.g.UNSIGNED_SHORT,count:4,pack:({sprite:M})=>{const{rect:f,width:T,height:B}=M,z=f.x+F.s4,g=f.y+F.s4;return[z,g,z+T,g+B]}},accumulatedDistance:{type:v.g.UNSIGNED_SHORT,count:1,packTessellation:({distance:M})=>M},segmentDirection:{type:v.g.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:M,directionY:f})=>[M,f]}}};class O extends D.ti{constructor(f,T,B,z){super(f,T,B,z),this.vertexSpec=C,this._tessellationOptions.textured=!0}_write(f,T,B){const z=B??U.z.fromFeatureSetReaderCIM(T);if(!z)return;const{sprite:g}=this.evaluatedMeshParams;this._writeGeometry(f,T,z,g?.textureBinding)}}},82758:(ut,J,r)=>{r.d(J,{A:()=>ot});var U=r(55768),F=r(60902),G=r(78332),D=r(29726),N=r(7587),v=r(33820),C=r(11196),O=r(76721),M=r(99657),f=r(35089),T=r(25896);class B{static from(E){return"width"in E?this.fromSimpleMeshParams(E):this.fromComplexMeshParams(E)}static fromSimpleMeshParams(E){const p=new B(E.sprite,E.color,E.outlineColor,E.minPixelBuffer,E.placement,E.scaleInfo,E.effects),{type:L,width:V,height:W,angle:H,alignment:R,outlineSize:n,referenceSize:a,sprite:A,overrideOutlineColor:w}=E;return p.rawWidth=(0,U.F2)(V),p.rawHeight=(0,U.F2)(W),p.angle=H,p.alignment=R,p.outlineSize=(0,U.F2)(n),p.referenceSize=(0,U.F2)(a),p.overrideOutlineColor=w,p.offsetX=(0,U.F2)(E.offsetX),p.offsetY=(0,U.F2)(E.offsetY),"simple"!==L||A.sdf||(p.rawWidth=A.width,p.rawHeight=A.height),p.sizeRatio=A.sdf?2:1,p._computeSize(E,!1),p}static fromComplexMeshParams(E){const p=new B(E.sprite,E.color,E.outlineColor,E.minPixelBuffer,E.placement,E.scaleInfo,E.effects);let{alignment:L,transforms:V,size:W,scaleX:H,anchorX:R,anchorY:n,angle:a,colorLocked:A,frameHeight:w,widthRatio:S,offsetX:k,offsetY:X,outlineSize:tt,referenceSize:rt,scaleFactor:Z,sizeRatio:st,isAbsoluteAnchorPoint:q,rotateClockwise:dt,scaleSymbolsProportionally:nt,sprite:mt}=E;if(V&&V.infos.length>0){const e=(0,T.yl)(W,a,dt,k,X,V);W=e.size,a=e.rotation,k=e.offsetX,X=e.offsetY,dt=!1}Z&&(W*=Z,k*=Z,X*=Z);const ft=H*(mt.width/mt.height);p.alignment=L,p.rawHeight=(0,U.F2)(W),p.rawWidth=p.rawHeight*ft,p.referenceSize=(0,U.F2)(rt),p.sizeRatio=st,p.angle=a,p.rotateClockwise=dt,p.anchorX=R,p.anchorY=n,p.offsetX=(0,U.F2)(k),p.offsetY=(0,U.F2)(X),q&&W&&(p.anchorX=mt.sdf?R/(W*S):R/(W*ft),p.anchorY=n/W);const lt=nt&&w?W/w:1;return p.outlineSize=0===tt||isNaN(tt)?0:(0,U.F2)(tt)*lt,p.scaleSymbolsProportionally=nt,p.colorLocked=A,p._computeSize(E,!0),p}constructor(E,p,L,V,W,H,R){this.sprite=E,this.color=p,this.outlineColor=L,this.minPixelBuffer=V,this.placement=W,this.scaleInfo=H,this.effects=R,this.rawWidth=0,this.rawHeight=0,this.angle=0,this.outlineSize=0,this.referenceSize=0,this.sizeRatio=1,this.alignment=C.v2.SCREEN,this.scaleSymbolsProportionally=!1,this.overrideOutlineColor=!1,this.colorLocked=!1,this.anchorX=0,this.anchorY=0,this.computedWidth=0,this.computedHeight=0,this.texXmin=0,this.texYmin=0,this.texXmax=0,this.texYmax=0,this.offsetX=0,this.offsetY=0,this.rotateClockwise=!0}get boundsInfo(){return{size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(E,p){const{sprite:L,hasSizeVV:V}=E,W=!!L.sdf,{rawWidth:H,rawHeight:R,sizeRatio:n,outlineSize:a}=this,A=H*n,w=R*n;if(W&&!V){const dt=R,nt=a+2;this.computedWidth=Math.min((p&&H>R?A:H)+nt,A),this.computedHeight=Math.min(dt+nt,w)}else this.computedWidth=A,this.computedHeight=w;const S=W?Math.max(L.width,L.height)/Math.max(A,w):1,k=.5*(A-this.computedWidth)*S,X=.5*(w-this.computedHeight)*S,tt=L.rect.x+M.s4+k,rt=L.rect.y+M.s4+X,Z=tt+L.width-2*k,st=rt+L.height-2*X;this.texXmin=Math.floor(tt),this.texYmin=Math.floor(rt),this.texXmax=Math.ceil(Z),this.texYmax=Math.ceil(st),this.computedWidth*=(this.texXmax-this.texXmin)/(Z-tt),this.computedHeight*=(this.texYmax-this.texYmin)/(st-rt),this.anchorX*=A/this.computedWidth,this.anchorY*=w/this.computedHeight}}var z=r(76455),g=r(76895),u=r(88269),c=r(39237);const m=128/Math.PI;const Q={createComputedParams:j=>B.from(j),optionalAttributes:{zoomRange:{type:c.g.SHORT,count:2,packPrecisionFactor:M.JS,pack:({scaleInfo:j},{tileInfo:E})=>(0,f._f)(j,E)}},attributes:{pos:{type:c.g.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:c.g.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:c.g.UNSIGNED_BYTE,count:1,pack:({sprite:j,alignment:E,scaleSymbolsProportionally:p,overrideOutlineColor:L,colorLocked:V})=>{let W=0;return j.sdf&&(W|=(0,f.NF)(z.m.bitset.isSDF)),E===C.v2.MAP&&(W|=(0,f.NF)(z.m.bitset.isMapAligned)),p&&(W|=(0,f.NF)(z.m.bitset.scaleSymbolsProportionally)),L&&(W|=(0,f.NF)(z.m.bitset.overrideOutlineColor)),V&&(W|=(0,f.NF)(z.m.bitset.colorLocked)),W}},offset:{type:c.g.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({angle:j,computedWidth:E,computedHeight:p,anchorX:L,anchorY:V,offsetX:W,offsetY:H,rotateClockwise:R})=>{const n=function b(j,E,p,L,V=!1){const W=(0,G.Ue)(),H=V?1:-1;return(0,F.yR)(W),(E||p)&&(0,F.Iu)(W,W,[E,-p]),L&&(0,F.U1)(W,W,.017453292519944444*H*-L),W}(0,W,H,-j,R),a=-(.5+L)*E,A=-(.5-V)*p,w=[a,A],S=[a+E,A],k=[a,A+p],X=[a+E,A+p];return(0,D.iu)(w,w,n),(0,D.iu)(S,S,n),(0,D.iu)(k,k,n),(0,D.iu)(X,X,n),[w,S,k,X]}}},textureUV:{type:c.g.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({texXmax:j,texXmin:E,texYmax:p,texYmin:L})=>[[E,L],[j,L],[E,p],[j,p]]}},color:{type:c.g.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:j})=>(0,f.G7)(j)},outlineColor:{type:c.g.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:j})=>(0,f.G7)(j)},sizing:{type:c.g.UNSIGNED_BYTE,count:4,pack:({rawWidth:j,rawHeight:E,outlineSize:p,referenceSize:L})=>{const V=Math.max(j,E);return[(0,f.QS)(V,128),(0,f.QS)(p,128),(0,f.QS)(L,128),0]}},placementAngle:{type:c.g.UNSIGNED_BYTE,count:1,packTessellation:({placementAngle:j})=>function I(j){return function x(j,E){return j%=E,Math.abs(j>=0?j:j+E)}(j*m,256)}(j)},sizeRatio:{type:c.g.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sizeRatio:j})=>j}}};class ot extends u.c{constructor(){super(...arguments),this.vertexSpec=Q}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(E,p,L){const V=this.evaluatedMeshParams.sprite?.textureBinding,W=p.getDisplayId();E.recordStart(this.instanceId,this.attributeLayout,V);const H=this.evaluatedMeshParams.minPixelBuffer,R=Math.max(this.evaluatedMeshParams.computedWidth,H),n=Math.max(this.evaluatedMeshParams.computedHeight,H),a=this.evaluatedMeshParams.offsetX,A=-this.evaluatedMeshParams.offsetY;if(null!=this.evaluatedMeshParams.placement)this._writePlacedMarkers(E,p,L,R,n);else if(L?.nextPath()){L.nextPoint();const w=L.x,S=L.y;E.recordBounds(w+a,S+A,R,n),this._writeQuad(E,W,w,S)}else if("esriGeometryPolygon"===p.geometryType){const w=p.readCentroidForDisplay();if(!w)return;const[S,k]=w.coords;E.recordBounds(S+a,k+A,R,n),this._writeQuad(E,W,S,k)}else if("esriGeometryPoint"===p.geometryType){const w=p.readXForDisplay(),S=p.readYForDisplay();E.recordBounds(w+a,S+A,R,n),this._writeQuad(E,W,w,S)}else p.readGeometryForDisplay()?.forEachVertex((S,k)=>{E.recordBounds(S+a,k+A,R,n),Math.abs(S)>v.L||Math.abs(k)>v.L||this._writeQuad(E,W,S,k)});E.recordEnd()}_writePlacedMarkers(E,p,L,V,W){const H=L??N.z.fromFeatureSetReaderCIM(p)?.clone();if(!H)return;const n=O.i.getPlacement(H,-1,this.evaluatedMeshParams.placement,(0,U.F2)(1),E.id,(0,g.n)());if(!n)return;const a=p.getDisplayId();let A=n.next();const w=this.evaluatedMeshParams.offsetX,S=-this.evaluatedMeshParams.offsetY;for(;null!=A;){const k=A.tx,X=-A.ty;if(Math.abs(k)>v.L||Math.abs(X)>v.L){A=n.next();continue}const tt=-A.getAngle();E.recordBounds(k+w,X+S,V,W),this._writeQuad(E,a,k,X,tt),A=n.next()}}_writeQuad(E,p,L,V,W){const H=E.vertexCount();this._writeVertex(E,p,L,V,null==W?null:{placementAngle:W}),E.indexWrite(H+0),E.indexWrite(H+1),E.indexWrite(H+2),E.indexWrite(H+1),E.indexWrite(H+3),E.indexWrite(H+2)}}},88269:(ut,J,r)=>{r.d(J,{c:()=>u});var U=r(15861),F=r(7587),G=r(37778),D=r(76895),N=r(10264),C=(r(14007),r(51059)),O=r(39237);function M(c){switch(c){case O.g.BYTE:case O.g.UNSIGNED_BYTE:return 1;case O.g.SHORT:case O.g.UNSIGNED_SHORT:case O.g.HALF_FLOAT:return 2;case O.g.FLOAT:case O.g.INT:case O.g.UNSIGNED_INT:return 4}}class T{static fromVertexSpec(l,m){const{attributes:x,optionalAttributes:I}=l;let b,Q,ot;const j=[];for(const R in x){const n=x[R];"position"===n.pack?b={...n,name:R,offset:0}:"id"===n.pack?Q={...n,name:R,offset:4}:"bitset"===R?ot={...n,name:R,offset:7}:j.push({...n,name:R})}for(const R in I)!0===m[R]&&j.push({...I[R],name:R});const E=function f(c){const l=[],m=[],x=[];for(const I of c){const b=M(I.type)*I.count;switch(b%2||b%4||4){case 4:l.push(I);continue;case 2:m.push(I);continue;case 1:x.push(I);continue;default:throw new Error("Found unexpected dataType byte count")}}return l.push(...m),l.push(...x),l}(j),p=[];let L=8,V=1;for(const R of E)p.push({...R,offset:L}),L+=M(R.type)*R.count,R.packAlternating&&(V=Math.max(R.packAlternating.count,V));const W=Uint32Array.BYTES_PER_ELEMENT,H=L%W;return new T(b,Q,ot,p,L+(H?W-H:0),V)}constructor(l,m,x,I,b,Q){this.position=l,this.id=m,this.bitset=x,this.standardAttributes=I,this.stride=b,this.packVertexCount=Q,I.push(x),this._attributes=[l,m,x,...I]}get attributeLayout(){if(!this._attributeLayout){const l=(0,C.ig)(this._attributes),m=this._attributes.map(x=>({name:x.name,count:x.count,offset:x.offset,type:x.type,packPrecisionFactor:x.packPrecisionFactor,normalized:x.normalized??!1}));this._attributeLayout={attributes:m,hash:l,stride:this.stride}}return this._attributeLayout}}var B=r(93919);class z{static fromVertexSpec(l,m){const x=T.fromVertexSpec(l,m);return new z(x)}constructor(l){this._spec=l,this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount),this._packedU32View=new Uint32Array(this._packed.buffer),this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(l,m,x,I,b,Q){for(let ot=0;ot<this._spec.packVertexCount;ot++){const j=ot*this._spec.stride;this._packPosition(x,I,j),this._packId(m,j);const E=this._spec.bitset;if(Q){if(E.packTessellation){const p=E.packTessellation(Q,b);this._pack(p,E,j)}for(const p of this._spec.standardAttributes)if(null!=p.packTessellation){const L=p.packTessellation(Q,b);this._pack(L,p,j)}else if(p.packAlternating?.packTessellation){const L=p.packAlternating.packTessellation(Q,b);for(let V=0;V<this._spec.packVertexCount;V++)this._pack(L[V],p,V*this._spec.stride)}}}l.vertexWriteRegion(this._packedU32View)}pack(l,m){for(const x of this._spec.standardAttributes)if(x.pack&&"string"!=typeof x.pack){const I=x.pack(l,m);for(let b=0;b<this._spec.packVertexCount;b++)this._pack(I,x,b*this._spec.stride)}else if(x.packAlternating?.pack){const I=x.packAlternating.pack(l,m);for(let b=0;b<this._spec.packVertexCount;b++)this._pack(I[b],x,b*this._spec.stride)}}_packPosition(l,m,x){const{offset:I}=this._spec.position,b=this._spec.position.packPrecisionFactor??1,Q=(0,N.UJ)(l*b,m*b);this._dataView.setUint32(x+I,Q,!0)}_packId(l,m){const x=l*(this._spec.id.packPrecisionFactor??1),I=4278190080&this._dataView.getUint32(m+this._spec.id.offset,!0);this._dataView.setUint32(m+this._spec.id.offset,x|I,!0)}_pack(l,m,x){(0,B.G)(this._dataView,l,m,x)}}class u{constructor(l,m,x,I){this._instanceId=l,this._evaluator=m,this._enabledOptionalAttributes=x,this._viewParams=I,this._evaluator.evaluator=b=>this.vertexSpec.createComputedParams(b)}get _vertexPack(){if(!this._cachedVertexPack){const l=z.fromVertexSpec(this.vertexSpec,this._enabledOptionalAttributes);this._evaluator.hasDynamicProperties||l.pack(this._evaluator.evaluatedMeshParams,this._viewParams),this._cachedVertexPack=l}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return!!this.evaluatedMeshParams.effects}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}setReferences(l){this._references=l}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}loadDependencies(){var l=this;return(0,U.Z)(function*(){(function g(c){if(!c)return!1;for(const l of c)switch(l.effect.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1})(l._evaluator.inputMeshParams.effects?.effectInfos)&&(yield(0,D.A)())})()}enqueueRequest(l,m,x){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(l,m,x)}write(l,m,x,I,b){this.ensurePacked(m,x,I);const Q=this.evaluatedMeshParams.effects;if(!Q||0===Q.length)return void this._write(l,x,void 0,b);const ot=x.readGeometryForDisplay()?.clone();if(!ot)return;const j=F.z.fromOptimizedCIM(ot,x.geometryType),E=(0,D.n)();j.invertY();const L=G.j.executeEffects(Q,j,l.id||"",E);let V;for(;V=L.next();)V.invertY(),this._write(l,x,V,b)}ensurePacked(l,m,x){if(!this._evaluator.hasDynamicProperties)return;const I=this._evaluator.evaluateMeshParams(l,m,x);this._vertexPack.pack(I,this._viewParams)}_writeVertex(l,m,x,I,b){this._vertexPack.writeVertex(l,m,x,I,this.evaluatedMeshParams,b)}}},76895:(ut,J,r)=>{r.d(J,{A:()=>D,n:()=>G});var U=r(15861);let F=null;function G(){return F}function D(){return N.apply(this,arguments)}function N(){return(N=(0,U.Z)(function*(){F=yield Promise.all([r.e(9465),r.e(8592)]).then(r.bind(r,49574))})).apply(this,arguments)}},79484:(ut,J,r)=>{r.d(J,{q:()=>v});var U=r(55768),F=r(35089),G=r(88269),D=r(39237);const N={createComputedParams:C=>C,optionalAttributes:{},attributes:{pos:{type:D.g.SHORT,count:2,packPrecisionFactor:10,pack:"position"},id:{type:D.g.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:D.g.UNSIGNED_BYTE,count:1,pack:C=>0},offset:{type:D.g.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:C})=>{const O=(0,U.F2)(C),M=-O/2,f=-O/2;return[[M,f],[M+O,f],[M,f+O],[M+O,f+O]]}}},texCoords:{type:D.g.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},size:{type:D.g.UNSIGNED_BYTE,count:2,pack:({size:C})=>[C,C]},referenceSize:{type:D.g.UNSIGNED_BYTE,count:1,pack:({size:C})=>(0,U.F2)(C)},zoomRange:{type:D.g.UNSIGNED_BYTE,count:2,pack:({scaleInfo:C},{tileInfo:O})=>(0,F._f)(C,O)}}};class v extends G.c{constructor(){super(...arguments),this.vertexSpec=N}_write(O,M){const f=M.getDisplayId(),T=this.evaluatedMeshParams.minPixelBuffer,B=Math.max((0,U.F2)(this.evaluatedMeshParams.size),T);let z,g;if("esriGeometryPoint"===M.geometryType)z=M.readXForDisplay(),g=M.readYForDisplay();else{const c=M.readCentroidForDisplay();if(!c)return;z=c?.coords[0],g=c?.coords[1]}O.recordStart(this.instanceId,this.attributeLayout),O.recordBounds(z,g,B,B);const u=O.vertexCount();this._writeVertex(O,f,z,g),O.indexWrite(u+0),O.indexWrite(u+1),O.indexWrite(u+2),O.indexWrite(u+1),O.indexWrite(u+3),O.indexWrite(u+2),O.recordEnd()}}},26372:(ut,J,r)=>{r.d(J,{lW:()=>W,PW:()=>c});var U=r(55117),F=r(55768),G=r(7587),D=r(76721),N=r(13948),v=r(99657),C=r(60559),O=r(35089),M=r(76895),f=r(88269),T=r(90450),B=r(25896);class g{constructor(n){const{offsetX:a,offsetY:A,postAngle:w,fontSize:S,scaleFactor:k,transforms:X}=n;if(this.offsetX=a,this.offsetY=A,this.postAngle=w,this.fontSize=Math.min(S,96),this.transforms=X,X&&X.infos.length>1){const tt=(0,B.yl)(S,w,!1,a,A,X);this.fontSize=Math.min(tt.size,96),this.postAngle=tt.rotation,this.offsetX=tt.offsetX,this.offsetY=tt.offsetY}k&&(this.fontSize*=k,this.offsetX*=k,this.offsetY*=k)}}var u=r(39237);const c=28,l=[4,4],m=[16,4],x={topLeft:m,topRight:m,bottomLeft:m,bottomRight:m},I=[4,2],b=[4,6],Q={topLeft:I,topRight:I,bottomLeft:b,bottomRight:b},ot={topLeft:I,topRight:b,bottomLeft:I,bottomRight:b},j={topLeft:b,topRight:b,bottomLeft:l,bottomRight:l},E={topLeft:l,topRight:l,bottomLeft:b,bottomRight:b},p={topLeft:b,topRight:l,bottomLeft:b,bottomRight:l},L={topLeft:l,topRight:b,bottomLeft:l,bottomRight:b},V={createComputedParams:R=>R,optionalAttributes:{zoomRange:{type:u.g.UNSIGNED_SHORT,count:2,packPrecisionFactor:v.JS,packTessellation:({minZoom:R,maxZoom:n})=>[R||0,n||c]},clipAngle:{type:u.g.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:R})=>H(R||0)},referenceSymbol:{type:u.g.BYTE,count:4,packPrecisionFactor:1,packTessellation:(R,n)=>{if(!R.referenceBounds)return[0,0,0,0];const a=(0,N.g)(n.horizontalAlignment),A=(0,N.tf)(n.verticalAlignment),{offsetX:w,offsetY:S,size:k}=R.referenceBounds;return[(0,F.F2)(w),-(0,F.F2)(S),(0,F.F2)(k),a+1<<2|A+1]}}},attributes:{pos:{type:u.g.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:u.g.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:u.g.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:R,mapAligned:n})=>(0,O.u)([[T.mL,R],[T.$r,!!n]])},offset:{type:u.g.SHORT,count:2,packPrecisionFactor:8,packAlternating:{count:4,packTessellation:({offsets:R})=>{const{bottomLeft:n,bottomRight:a,topLeft:A,topRight:w}=R;return[A,w,n,a]}}},textureUV:{type:u.g.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:R})=>{const{bottomLeft:n,bottomRight:a,topLeft:A,topRight:w}=R;return[A,w,n,a]}}},color:{type:u.g.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:R})=>R},fontSize:{type:u.g.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,packTessellation:({fontSize:R})=>(0,F.F2)(R)},referenceSize:{type:u.g.UNSIGNED_BYTE,count:1,packPrecisionFactor:4,packTessellation:({fontSize:R},{referenceSize:n})=>(0,F.F2)(n??R)},haloColor:{type:u.g.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:R})=>(0,O.G7)(R)},haloFontSize:{type:u.g.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,pack:({haloFontSize:R})=>(0,F.F2)(R)}}};class W extends f.c{constructor(){super(...arguments),this.vertexSpec=V,this._textMeshParamsPropsInitialized=!1}ensurePacked(n,a,A){super.ensurePacked(n,a,A),this._textMeshParamsPropsInitialized&&!this._evaluator.hasDynamicProperties||(this._textMeshTransformProps=new g(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0)}_write(n,a,A){const w=this._getShaping();if(!w)return;const S=a.getDisplayId();if(null!=this.evaluatedMeshParams.placement)return this._writePlacedTextMarkers(n,a,w,A);if(A?.nextPath())return A.nextPoint(),this._writeGlyphs(n,S,A.x,A.y,w,0);if("esriGeometryPolygon"===a.geometryType){const tt=a.readCentroidForDisplay();if(!tt)return;const[rt,Z]=tt.coords;return this._writeGlyphs(n,S,rt,Z,w,0)}if("esriGeometryMultipoint"===a.geometryType)return void a.readGeometryForDisplay()?.forEachVertex((rt,Z)=>this._writeGlyphs(n,S,rt,Z,w,0));const k=a.readXForDisplay(),X=a.readYForDisplay();return this._writeGlyphs(n,S,k,X,w,0)}_writePlacedTextMarkers(n,a,A,w){const S=w??G.z.fromFeatureSetReaderCIM(a);if(!S)return;const X=D.i.getPlacement(S,-1,this.evaluatedMeshParams.placement,(0,F.F2)(1),n.id,(0,M.n)());if(!X)return;const tt=a.getDisplayId();let rt=X.next();for(;null!=rt;){const Z=rt.tx,st=-rt.ty,q=-rt.getAngle();this._writeGlyphs(n,tt,Z,st,A,q),rt=X.next()}}_getShaping(n){const a=this._textMeshTransformProps,A=this.evaluatedMeshParams;if(!A.glyphs?.glyphs.length)return null;const w=Math.round((0,F.F2)(a.fontSize)),S=(0,F.F2)(a.offsetX),k=(0,F.F2)(a.offsetY),X=(0,U.uZ)((0,F.F2)(A.lineWidth),v.A5,v.NT),tt=v.uk*(0,U.uZ)(A.lineHeightRatio,.25,4);return(0,C.Nr)(A.glyphs,{scale:w/v.iD,angle:a.postAngle,xOffset:S,yOffset:k,horizontalAlignment:A.horizontalAlignment,verticalAlignment:n||A.verticalAlignment,maxLineWidth:X,lineHeight:tt,decoration:A.decoration,borderLineSizePx:(0,F.F2)(A.boxBorderLineSize),hasBackground:!!A.boxBackgroundColor,useCIMAngleBehavior:A.useCIMAngleBehavior})}_writeGlyphs(n,a,A,w,S,k,X,tt){const rt=this.evaluatedMeshParams,Z=this._textMeshTransformProps,st=Z.fontSize,q=(0,F.F2)(Z.offsetX),dt=(0,F.F2)(Z.offsetY),[nt,mt]=(0,O._f)(rt.scaleInfo,this.getTileInfo());0!==k&&S.setRotation(k);const ft=S.bounds,lt=A+ft.x+q,e=w+ft.y-dt,o=2*(rt.minPixelBuffer?rt.minPixelBuffer/st:1),i=Math.max(ft.width,ft.height)*o;S.textBox&&(n.recordStart(this.instanceId,this.attributeLayout,S.glyphs[0].textureBinding),n.recordBounds(lt,e,i,i),this._writeTextBox(n,a,A,w,S.textBox,X,tt),n.recordEnd());for(const h of S.glyphs){n.recordStart(this.instanceId,this.attributeLayout,h.textureBinding),n.recordBounds(lt,e,i,i);const{texcoords:s,offsets:_}=h;this._writeQuad(n,a,A,w,{texcoords:s,offsets:_,fontSize:st,color:(0,O.G7)(rt.color),isBackground:!1,referenceBounds:X,minZoom:nt,maxZoom:mt,...tt}),n.recordEnd()}0!==k&&S.setRotation(-k)}_writeTextBox(n,a,A,w,S,k,X){const tt=this.evaluatedMeshParams,{fontSize:rt}=this._textMeshTransformProps,{boxBackgroundColor:Z,boxBorderLineColor:st}=tt,q={isBackground:!0,fontSize:rt,referenceBounds:k,...X};Z&&(this._writeQuad(n,a,A,w,{texcoords:x,offsets:S.main,color:(0,O.G7)(Z),...q}),st||(this._writeQuad(n,a,A,w,{texcoords:j,offsets:S.top,color:(0,O.G7)(Z),...q}),this._writeQuad(n,a,A,w,{texcoords:E,offsets:S.bot,color:(0,O.G7)(Z),...q}),this._writeQuad(n,a,A,w,{texcoords:p,offsets:S.left,color:(0,O.G7)(Z),...q}),this._writeQuad(n,a,A,w,{texcoords:L,offsets:S.right,color:(0,O.G7)(Z),...q}))),st&&(this._writeQuad(n,a,A,w,{texcoords:Q,offsets:S.top,color:(0,O.G7)(st),...q}),this._writeQuad(n,a,A,w,{texcoords:Q,offsets:S.bot,color:(0,O.G7)(st),...q}),this._writeQuad(n,a,A,w,{texcoords:ot,offsets:S.left,color:(0,O.G7)(st),...q}),this._writeQuad(n,a,A,w,{texcoords:ot,offsets:S.right,color:(0,O.G7)(st),...q}))}_writeQuad(n,a,A,w,S){const k=n.vertexCount();this._writeVertex(n,a,A,w,S),n.indexWrite(k+0),n.indexWrite(k+1),n.indexWrite(k+2),n.indexWrite(k+1),n.indexWrite(k+3),n.indexWrite(k+2)}}const H=R=>Math.round(R*(254/360))}}]);