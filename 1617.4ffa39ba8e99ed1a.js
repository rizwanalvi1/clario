"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[1617],{6118:(R,P,t)=>{t.d(P,{JZ:()=>x,RL:()=>T,eY:()=>v});var g=t(15861),u=t(79412),_=t(92899),E=t(44406),h=t(93266),D=t(64456),m=t(98634),c=t(39237),n=t(17091),d=t(22784);function x(o){return o&&"render"in o}function T(o){const i=document.createElement("canvas");return i.width=o.width,i.height=o.height,o.render(i.getContext("2d")),i}class v extends D.s{constructor(i=null,a=!1){super(),this.blendFunction="standard",this._sourceWidth=0,this._sourceHeight=0,this._textureInvalidated=!1,this._texture=null,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.immutable=a,this.source=i,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null),null!=this._uploadStatus&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(i){this._height=i}get source(){return this._source}set source(i){null==i&&null==this._source||(this._source=i,this.invalidateTexture(),this.requestRender())}get width(){return void 0!==this._width?this._width:this._sourceWidth}set width(i){this._width=i}beforeRender(i){super.beforeRender(i),this.updateTexture(i)}setSourceAsync(i,a){var s=this;return(0,g.Z)(function*(){null!=s._uploadStatus&&s._uploadStatus.controller.abort();const M=new AbortController,p=(0,u.hh)();return(0,u.$F)(a,()=>M.abort()),(0,u.$F)(M,f=>p.reject(f)),s._uploadStatus={controller:M,resolver:p},s.source=i,p.promise})()}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):this._source&&(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width))}updateTransitionProperties(i,a){i>=64&&(this.fadeTransitionEnabled=!1,this.inFadeTransition=!1),super.updateTransitionProperties(i,a)}setTransform(i){const a=(0,_.yR)(this.transforms.displayViewScreenMat3),[s,M]=i.toScreenNoRotation([0,0],[this.x,this.y]),p=this.resolution/this.pixelRatio/i.resolution,f=p*this.width,y=p*this.height,e=Math.PI*this.rotation/180;(0,_.Iu)(a,a,(0,h.al)(s,M)),(0,_.Iu)(a,a,(0,h.al)(f/2,y/2)),(0,_.U1)(a,a,-e),(0,_.Iu)(a,a,(0,h.al)(-f/2,-y/2)),(0,_.ex)(a,a,(0,h.al)(f,y)),(0,_.Jp)(this.transforms.displayViewScreenMat3,i.displayViewMat3,a)}setSamplingProfile(i){this._texture&&(i.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(i.samplingMode))}bind(i,a){this._texture&&i.bindTexture(this._texture,a)}updateTexture({context:i,painter:a}){var s=this;return(0,g.Z)(function*(){if(!s._textureInvalidated)return;if(s._textureInvalidated=!1,s._texture||(s._texture=s._createTexture(i)),!s.source)return void s._texture.setData(null);s._texture.resize(s._sourceWidth,s._sourceHeight);const M=function B(o){return x(o)?o instanceof m.Z?o.getRenderedRasterPixels()?.renderedRasterPixels:T(o):o}(s.source);try{if(null!=s._uploadStatus){const{controller:p,resolver:f}=s._uploadStatus,y={signal:p.signal},{width:e,height:r}=s,l=s._texture;yield a.textureUploadManager.enqueueTextureUpdate({data:M,texture:l,width:e,height:r},y),f.resolve(),s._uploadStatus=null}else s._texture.setData(M);s.ready()}catch(p){(0,u.H9)(p)}})()}onDetach(){this.destroy()}_createTransforms(){return{displayViewScreenMat3:(0,E.Ue)()}}_createTexture(i){const a=this.immutable,s=new d.X;return s.internalFormat=a?c.lP.RGBA8:c.VI.RGBA,s.wrapMode=c.e8.CLAMP_TO_EDGE,s.isImmutable=a,s.width=this._sourceWidth,s.height=this._sourceHeight,new n.x(i,s)}}},98634:(R,P,t)=>{t.d(P,{Z:()=>g});class g{constructor(_,E,h){this.pixelBlock=_,this.extent=E,this.originalPixelBlock=h}get width(){return null!=this.pixelBlock?this.pixelBlock.width:0}get height(){return null!=this.pixelBlock?this.pixelBlock.height:0}render(_){const E=this.pixelBlock;if(null==E)return;const h=this.filter({extent:this.extent,pixelBlock:this.originalPixelBlock??E});if(null==h.pixelBlock)return;h.pixelBlock.maskIsAlpha&&(h.pixelBlock.premultiplyAlpha=!0);const D=h.pixelBlock.getAsRGBA(),m=_.createImageData(h.pixelBlock.width,h.pixelBlock.height);m.data.set(D),_.putImageData(m,0,0)}getRenderedRasterPixels(){const _=this.filter({extent:this.extent,pixelBlock:this.pixelBlock});return null==_.pixelBlock?null:(_.pixelBlock.maskIsAlpha&&(_.pixelBlock.premultiplyAlpha=!0),{width:_.pixelBlock.width,height:_.pixelBlock.height,renderedRasterPixels:new Uint8Array(_.pixelBlock.getAsRGBA().buffer)})}}},75747:(R,P,t)=>{t.d(P,{Z:()=>m});var g=t(14007),u=t(43101),_=t(92311),E=t(46356),h=t(87546);const D=(c,n)=>c.key.level-n.key.level!=0?c.key.level-n.key.level:c.key.row-n.key.row!=0?c.key.row-n.key.row:c.key.col-n.key.col;class m extends _.Z{constructor(n){super(),this._tileInfoView=n}renderChildren(n){this.sortChildren(D),this.setStencilReference(n),super.renderChildren(n)}createRenderParams(n){const{state:d}=n,x=super.createRenderParams(n);return x.requiredLevel=this._tileInfoView.getClosestInfoForScale(d.scale).level,x.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(d.scale),x}prepareRenderPasses(n){const d=super.prepareRenderPasses(n);return d.push(n.registerRenderPass({name:"stencil",brushes:[E.Z],drawPhase:u.jx.DEBUG|u.jx.MAP|u.jx.HIGHLIGHT|u.jx.LABEL,target:()=>this.getStencilTarget()})),(0,g.Z)("esri-tiles-debug")&&d.push(n.registerRenderPass({name:"tileInfo",brushes:[h.Z],drawPhase:u.jx.DEBUG,target:()=>this.children})),d}getStencilTarget(){return this.children}setStencilReference(n){let d=1;for(const x of this.children)x.stencilRef=d++}}},7514:(R,P,t)=>{t.r(P),t.d(P,{default:()=>y});var g=t(15861),u=t(50484),_=t(4703),E=t(79412),h=t(80543),c=(t(14007),t(65311),t(10141)),n=t(33721),d=t(3601),x=t(83124),T=t(73430),B=t(6777),v=t(54529),o=t(87766),i=t(40394),a=t(50145),s=t(32126);const M=new Set([102113,102100,3857,3785,900913]),p=[0,0];let f=class extends((0,s.Z)((0,d.Y)((0,x.y)(a.Z)))){constructor(){super(...arguments),this._tileStrategy=null,this._fetchQueue=null,this.layer=null}get tileMatrixSet(){const e=this._getTileMatrixSetBySpatialReference(this.layer.activeLayer);return e?(e.id!==this.layer.activeLayer.tileMatrixSetId&&(this.layer.activeLayer.tileMatrixSetId=e.id),e):null}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume()}attach(){const e=this.tileMatrixSet?.tileInfo;e&&(this._tileInfoView=new B.Z(e),this._fetchQueue=new o.Z({tileInfoView:this._tileInfoView,concurrency:16,process:(r,l)=>this.fetchTile(r,l)}),this._tileStrategy=new i.Z({cachePolicy:"keep",resampling:!0,acquireTile:r=>this.acquireTile(r),releaseTile:r=>this.releaseTile(r),tileInfoView:this._tileInfoView}),this.addAttachHandles(this._updatingHandles.add(()=>[this.layer?.activeLayer?.styleId,this.tileMatrixSet],()=>this.doRefresh())),super.attach())}detach(){super.detach(),this._tileStrategy?.destroy(),this._fetchQueue?.destroy(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(e){return this.layer.activeLayer.tileMatrixSets?.some(r=>(0,n.fS)(r.tileInfo?.spatialReference,e))??!1}doRefresh(){var e=this;return(0,g.Z)(function*(){if(e.attached){if(e.suspended)return e._tileStrategy.clear(),void e.requestUpdate();e._fetchQueue.reset(),e._tileStrategy.refresh(r=>e._updatingHandles.addPromise(e._enqueueTileFetch(r)))}})()}acquireTile(e){const r=this._bitmapView.createTile(e),l=r.bitmap;return[l.x,l.y]=this._tileInfoView.getTileCoords(p,r.key),l.resolution=this._tileInfoView.getTileResolution(r.key),[l.width,l.height]=this._tileInfoView.tileInfo.size,this._updatingHandles.addPromise(this._enqueueTileFetch(r)),this._bitmapView.addChild(r),this.requestUpdate(),r}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once("detach",()=>e.destroy()),this.requestUpdate()}fetchTile(e,r={}){var l=this;return(0,g.Z)(function*(){const I="tilemapCache"in l.layer?l.layer.tilemapCache:null,{signal:O,resamplingLevel:S=0}=r;if(!I)return l._fetchImage(e,O);const L=new v.Z(0,0,0,0);let U;try{yield I.fetchAvailabilityUpsample(e.level,e.row,e.col,L,{signal:O}),U=yield l._fetchImage(L,O)}catch(w){if((0,E.D_)(w))throw w;if(S<3){const A=l._tileInfoView.getTileParentId(e.id);if(A){const C=new v.Z(A),W=yield l.fetchTile(C,{...r,resamplingLevel:S+1});return(0,T.i)(l._tileInfoView,W,C,e)}}throw w}return(0,T.i)(l._tileInfoView,U,L,e)})()}canResume(){return super.canResume()&&null!==this.tileMatrixSet}_enqueueTileFetch(e){var r=this;return(0,g.Z)(function*(){if(!r._fetchQueue.has(e.key.id)){try{const l=yield r._fetchQueue.push(e.key);e.bitmap.source=l,e.bitmap.width=r._tileInfoView.tileInfo.size[0],e.bitmap.height=r._tileInfoView.tileInfo.size[1],e.once("attach",()=>r.requestUpdate())}catch(l){(0,E.D_)(l)||_.Z.getLogger(r).error(l)}r.requestUpdate()}})()}_fetchImage(e,r){var l=this;return(0,g.Z)(function*(){return l.layer.fetchImageBitmapTile(e.level,e.row,e.col,{signal:r})})()}_getTileMatrixSetBySpatialReference(e){const r=this.view.spatialReference;if(!e.tileMatrixSets)return null;let l=e.tileMatrixSets.find(I=>(0,n.fS)(I.tileInfo?.spatialReference,r));return!l&&r.isWebMercator&&(l=e.tileMatrixSets.find(I=>M.has(I.tileInfo?.spatialReference.wkid??-1))),l}};(0,u._)([(0,h.Cb)({readOnly:!0})],f.prototype,"tileMatrixSet",null),f=(0,u._)([(0,c.j)("esri.views.2d.layers.WMTSLayerView2D")],f);const y=f}}]);