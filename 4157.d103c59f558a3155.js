"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[4157],{52540:(Ge,_e,y)=>{y.d(_e,{z:()=>ce});var I=y(39921);class ce{constructor(Y,V){this._storage=new I.WJ,this.id="",this.name="",this.size=0,this._storage.maxSize=Y,this._storage.register(this),V&&this._storage.registerRemoveFunc("",V)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(Y,V,oe=1){this._storage.put(this,Y,V,oe,1)}pop(Y){return this._storage.pop(this,Y)}get(Y){return this._storage.get(this,Y)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(Y){this._storage.maxSize=Y}resetHitRate(){}}},39921:(Ge,_e,y)=>{y.d(_e,{WJ:()=>oe,Xq:()=>V});var Y,de,I=y(43029);(de=Y||(Y={}))[de.ALL=0]="ALL",de[de.SOME=1]="SOME";class V{constructor(_,p,S){this.name=_,this._storage=p,this.id=be+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),S&&(this._storage.registerRemoveFunc(this.id,S),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(_){return this._storage.getSize(this,_)}resetHitRate(){this._hit=this._miss=0}put(_,p,S,P=0){this._storage.put(this,_,p,S,P)}pop(_){const p=this._storage.pop(this,_);return void 0===p?++this._miss:++this._hit,p}get(_){const p=this._storage.get(this,_);return void 0===p?++this._miss:++this._hit,p}peek(_){return this._storage.peek(this,_)}updateSize(_,p,S){this._storage.updateSize(this,_,p,S)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class oe{get size(){return this._size}constructor(_=10485760){this._maxSize=_,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new I.Z,this._users=new I.Z}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(_){this._users.push(_)}deregister(_){this._users.removeUnordered(_)}registerRemoveFunc(_,p){this._removeFuncs.push([_,p])}deregisterRemoveFunc(_){this._removeFuncs.filterInPlace(p=>p[0]!==_)}get maxSize(){return this._maxSize}set maxSize(_){this._maxSize=Math.max(_,-1),this._checkSize()}getSize(_,p){return this._db.get(_.id+p)?.size??0}put(_,p,S,P,B){const R=this._db.get(p=_.id+p);if(R&&(this._size-=R.size,_.size-=R.size,this._db.delete(p),R.entry!==S&&this._notifyRemove(p,R.entry,R.size,Y.ALL)),P>this._maxSize)return void this._notifyRemove(p,S,P,Y.ALL);if(void 0===S)return void console.warn("Refusing to cache undefined entry ");if(!P||P<0)return console.warn(`Refusing to cache entry with size ${P} for key ${p}`),void this._notifyRemove(p,S,0,Y.ALL);const j=1+Math.max(B,-4)- -3;this._db.set(p,new H(S,P,j)),this._size+=P,_.size+=P,this._checkSize()}updateSize(_,p,S,P){const B=this._db.get(p=_.id+p);if(B&&B.entry===S){for(this._size-=B.size,_.size-=B.size;P>this._maxSize;){const R=this._notifyRemove(p,S,P,Y.SOME);if(!(null!=R&&R>0))return void this._db.delete(p);P=R}B.size=P,this._size+=P,_.size+=P,this._checkSize()}}pop(_,p){const S=this._db.get(p=_.id+p);if(S)return this._size-=S.size,_.size-=S.size,this._db.delete(p),++this._hit,S.entry;++this._miss}get(_,p){const S=this._db.get(p=_.id+p);if(void 0!==S)return this._db.delete(p),S.lives=S.lifetime,this._db.set(p,S),++this._hit,S.entry;++this._miss}peek(_,p){const S=this._db.get(_.id+p);return S?++this._hit:++this._miss,S?.entry}get performanceInfo(){const _={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},p={},S=new Array;this._db.forEach((R,j)=>{const Ae=R.lifetime;S[Ae]=(S[Ae]||0)+R.size,this._users.forAll(xe=>{const{id:Ne,name:Pe}=xe;j.startsWith(Ne)&&(p[Pe]=(p[Pe]||0)+R.size)})});const P={};this._users.forAll(R=>{const j=R.name;"hitRate"in R&&"number"==typeof R.hitRate&&!isNaN(R.hitRate)&&R.hitRate>0?(p[j]=p[j]||0,P[j]=Math.round(100*R.hitRate)+"%"):P[j]="0%"});const B=Object.keys(p);B.sort((R,j)=>p[j]-p[R]),B.forEach(R=>_[R]=Math.round(p[R]/2**20)+"MB / "+P[R]);for(let R=S.length-1;R>=0;--R){const j=S[R];j&&(_["Priority "+(R+-3-1)]=Math.round(j/this._size*100)+"%")}return _}resetStats(){this._hit=this._miss=0,this._users.forAll(_=>_.resetHitRate())}clear(_){const p=_.id;this._db.forEach((S,P)=>{P.startsWith(p)&&(this._size-=S.size,this._db.delete(P),this._notifyRemove(P,S.entry,S.size,Y.ALL))}),_.size=0}clearAll(){this._db.forEach((_,p)=>this._notifyRemove(p,_.entry,_.size,Y.ALL)),this._users.forAll(_=>_.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(_,p,S,P){let B;return this._removeFuncs.some(R=>{if(_.startsWith(R[0])){const j=R[1](p,P,S);return"number"==typeof j&&(B=j),!0}return!1}),B}_checkSize(){this._users.forAll(_=>this._checkSizeLimits(_)),this._checkSizeLimits()}_checkSizeLimits(_){const p=_??this;if(p.maxSize<0||p.size<=p.maxSize)return;const S=_?.id;let P=!0;for(;P;){P=!1;for(const[B,R]of this._db)if(0===R.lifetime&&(!S||B.startsWith(S))){if(this._purgeItem(B,R,_),p.size<=.9*p.maxSize)return;P||=this._db.has(B)}}for(const[B,R]of this._db)if((!S||B.startsWith(S))&&(this._purgeItem(B,R,_),p.size<=.9*p.maxSize))return}_purgeItem(_,p,S=this._users.find(P=>_.startsWith(P.id))){if(this._db.delete(_),p.lives<=1){this._size-=p.size,S&&(S.size-=p.size);const P=this._notifyRemove(_,p.entry,p.size,Y.SOME);null!=P&&P>0&&(this._size+=P,S&&(S.size+=P),p.lives=p.lifetime,p.size=P,this._db.set(_,p))}else--p.lives,this._db.set(_,p)}}let be=0;class H{constructor(_,p,S){this.entry=_,this.size=p,this.lifetime=S,this.lives=S}}},48238:(Ge,_e,y)=>{y.d(_e,{q:()=>$t});var I=y(15861),ce=y(57678),ne=y(57964),Y=y(89317),V=y(34222),oe=y(51172),be=y(39921),H=y(79412),de=y(49602),_=y(83821),p=y(27048),S=y(45425),P=y(43585),B=y(40637),R=y(93566),j=y(33721),Ae=y(10842),xe=y(52540),Ne=y(85904),Ce=y(51217);const Le=new class Pe{constructor(t,i){this._cache=new xe.z(t),this._invalidCache=new xe.z(i)}get(t,i){const r=`${i.uid}:${t}`,o=this._cache.get(r);if(o)return o;if(null!=this._invalidCache.get(r))return null;try{const n=Ne.WhereClause.create(t,i);return this._cache.put(r,n),n}catch(n){return this._invalidCache.put(r,n),null}}getError(t,i){return this._invalidCache.get(`${i.uid}:${t}`)??null}}(50,500),Ue="unsupported-query",Ye=" as ",Ke=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeBigInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong"]),Be=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),x=new Set(["esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...Ke,...Be]);function G(f,t,i={}){const r=ae(t,f);if(!r){const n=Le.getError(t,f);throw new ne.Z(Ue,"invalid SQL expression",{expression:t,error:n})}const o=i.expressionName||"expression";if(i.validateStandardized&&!r.isStandardized)throw new ne.Z(Ue,`${o} is not standard`,{expression:t});if(i.validateAggregate&&!r.isAggregate)throw new ne.Z(Ue,`${o} does not contain a valid aggregate function`,{expression:t});return r.fieldNames}function ae(f,t){return f?Le.get(f,t):null}function me(f){return/\((.*?)\)/.test(f)?f:f.split(Ye)[0]}function E(f,t,i,r={}){const o=new Map;if(function b(f,t,i,r,o){const n=o.includes("*")?[...i,...o.filter(h=>"*"!==h)]:o;for(const h of n)if(t.get(h))w(f,t,i,r,h);else try{const d=G(t,me(h),{validateStandardized:!0});for(const m of d)w(f,t,i,r,m)}catch(d){f.set(h,{type:"expression-error",expression:h,error:d})}}(o,f,t,r.allowedFieldTypes??x,i),o.size)throw new ne.Z(Ue,`${r.expressionName??"expression"} contains invalid or missing fields`,{errors:Array.from(o.values()),query:r.query})}function w(f,t,i,r,o){const n=t.get(o);n?i.has(n.name)?"all"!==r&&!1===r?.has(n.type)&&f.set(o,{type:"invalid-type",fieldName:n.name,fieldType:Ce.v.fromJSON(n.type),allowedFieldTypes:Array.from(r,h=>Ce.v.fromJSON(h))}):f.set(o,{type:"missing-field",fieldName:n.name}):f.set(o,{type:"invalid-field",fieldName:o})}var N=y(29085),W=y(58829),he=y(85559),ue=y(56880),Ie=y(14138),le=y(66398),ee=y(85295),ge=y(71518),Z=y(46169),pe=y(4978);class Se{constructor(t,i,r){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=t.returnDistinctValues??!1,this.fieldsIndex=r,this.featureAdapter=i;const o=t.outFields;if(o&&!o.includes("*")){this.outFields=o;let n=0;for(const h of o){const d=me(h),m=this.fieldsIndex.get(d),g=m?null:ae(d,r),T=m?m.name:h.split(Ye)[1]||"FIELD_EXP_"+n++;this._fieldDataCache.set(h,{alias:T,clause:g})}}}countDistinctValues(t){return this.returnDistinctValues?(t.forEach(i=>this.getAttributes(i)),this._returnDistinctMap.size):t.length}getAttributes(t){const i=this._processAttributesForOutFields(t);return this._processAttributesForDistinctValues(i)}getFieldValue(t,i,r){const o=r?r.name:i;let n=null;return this._fieldDataCache.has(o)?n=this._fieldDataCache.get(o)?.clause:r||(n=ae(i,this.fieldsIndex),this._fieldDataCache.set(o,{alias:o,clause:n})),r?this.featureAdapter.getAttribute(t,o):n?.calculateValue(t,this.featureAdapter)}getDataValues(t,i,r=!0){const o=i.normalizationType,n=i.normalizationTotal,h=this.fieldsIndex.get(i.field),d=(0,ee.UQ)(h)||(0,ee.ig)(h),m=(0,ee.sX)(h);return t.map(g=>{let T=i.field&&this.getFieldValue(g,i.field,this.fieldsIndex.get(i.field));if(i.field2?(T=`${(0,Z.wk)(T)}${i.fieldDelimiter}${(0,Z.wk)(this.getFieldValue(g,i.field2,this.fieldsIndex.get(i.field2)))}`,i.field3&&(T=`${T}${i.fieldDelimiter}${(0,Z.wk)(this.getFieldValue(g,i.field3,this.fieldsIndex.get(i.field3)))}`)):"string"==typeof T&&r&&(d?T=T?new Date(T).getTime():null:m&&(T=T?(0,ge.yO)(T):null)),o&&Number.isFinite(T)){const F="field"===o&&i.normalizationField?this.getFieldValue(g,i.normalizationField,this.fieldsIndex.get(i.normalizationField)):null;T=(0,Z.fk)(T,o,F,n)}return T})}getExpressionValues(t,i,r,o,n){var h=this;return(0,I.Z)(function*(){const{arcadeUtils:d}=yield(0,pe.LC)(),m=d.hasGeometryOperations(i);m&&(yield d.enableGeometryOperations());const g=d.createFunction(i),T=d.getViewInfo(r),F={fields:h.fieldsIndex.fields};return t.map(A=>{const L={attributes:h.featureAdapter.getAttributes(A),layer:F,geometry:m?{...(0,N.Op)(o.geometryType,o.hasZ,o.hasM,h.featureAdapter.getGeometry(A)),spatialReference:r?.spatialReference}:null},O=d.createExecContext(L,T,n);return d.executeFunction(g,O)})})()}validateItem(t,i){return this._fieldDataCache.has(i)||this._fieldDataCache.set(i,{alias:i,clause:ae(i,this.fieldsIndex)}),this._fieldDataCache.get(i)?.clause?.testFeature(t,this.featureAdapter)??!1}validateItems(t,i){return this._fieldDataCache.has(i)||this._fieldDataCache.set(i,{alias:i,clause:ae(i,this.fieldsIndex)}),this._fieldDataCache.get(i)?.clause?.testSet(t,this.featureAdapter)??!1}_processAttributesForOutFields(t){const i=this.outFields;if(!i?.length)return this.featureAdapter.getAttributes(t);const r={};for(const o of i){const{alias:n,clause:h}=this._fieldDataCache.get(o);r[n]=h?h.calculateValue(t,this.featureAdapter):this.featureAdapter.getAttribute(t,n)}return r}_processAttributesForDistinctValues(t){if(null==t||!this.returnDistinctValues)return t;const i=this.outFields,r=[];if(i)for(const h of i){const{alias:d}=this._fieldDataCache.get(h);r.push(t[d])}else for(const h in t)r.push(t[h]);const o=`${(i||["*"]).join(",")}=${r.join(",")}`;let n=this._returnDistinctMap.get(o)||0;return this._returnDistinctMap.set(o,++n),n>1?null:t}}function je(f,t,i){return{objectId:f,target:t,distance:i,type:"vertex"}}function ke(f,t,i,r,o,n=!1){return{objectId:f,target:t,distance:i,type:"edge",start:r,end:o,draped:n}}class se{constructor(t,i,r){this.items=t,this.query=i,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.fieldsIndex=r.fieldsIndex,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.featureAdapter=r.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const t=new Se(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return t.countDistinctValues(this.items);const{groupByFieldsForStatistics:i,having:r,outStatistics:o}=this.query;if(!i?.length)return 1;const h=new Map,d=new Map,m=new Set;for(const g of o){const{statisticType:T}=g,F="exceedslimit"!==T?g.onStatisticField:void 0;if(!d.has(F)){const L=[];for(const O of i){const D=this._getAttributeValues(t,O,h);L.push(D)}d.set(F,this._calculateUniqueValues(L,t.returnDistinctValues))}const A=d.get(F);for(const L in A){const{data:O,items:D}=A[L],C=O.join(",");r&&!t.validateItems(D,r)||m.add(C)}}return m.size}createQueryResponse(){var t=this;return(0,I.Z)(function*(){let i;if(i=t.query.outStatistics?t.query.outStatistics.some(r=>"exceedslimit"===r.statisticType)?t._createExceedsLimitQueryResponse(t.query):yield t._createStatisticsQueryResponse(t.query):t._createFeatureQueryResponse(t.query),t.query.returnQueryGeometry){const r=t.query.geometry;i.queryGeometry=(0,j.JY)(t.query.outSR)&&!(0,j.fS)(r.spatialReference,t.query.outSR)?(0,N.S2)({spatialReference:t.query.outSR,...(0,W.iV)(r,r.spatialReference,t.query.outSR)}):(0,N.S2)({spatialReference:t.query.outSR,...r})}return i})()}createSnappingResponse(t,i){const r=this.featureAdapter,o=Fe(this.hasZ,this.hasM),{point:n,mode:h}=t,d="number"==typeof t.distance?t.distance:t.distance.x,m="number"==typeof t.distance?t.distance:t.distance.y,g={candidates:[]},T="esriGeometryPolygon"===this.geometryType,F=this._getPointCreator(h,this.spatialReference,i),A=new we(null,0),L=new we(null,0),O={x:0,y:0,z:0};for(const D of this.items){const C=r.getGeometry(D);if(null==C)continue;const{coords:Q,lengths:te}=C;if(A.coords=Q,L.coords=Q,t.returnEdge){let J=0;for(let q=0;q<te.length;q++){const M=te[q];for(let U=0;U<M;U++,J+=o){const k=A;if(k.coordsIndex=J,U!==M-1){const K=L;K.coordsIndex=J+o;const fe=O;Oe(O,n,k,K);const De=(n.x-fe.x)/d,Ve=(n.y-fe.y)/m,et=De*De+Ve*Ve;et<=1&&g.candidates.push(ke(r.getObjectId(D),F(fe),Math.sqrt(et),F(k),F(K)))}}}}if("none"!==t.vertexMode){const J=T?Q.length-o:Q.length;if("all"===t.vertexMode)for(let q=0;q<J;q+=o){const M=A;M.coordsIndex=q;const U=(n.x-M.x)/d,k=(n.y-M.y)/m,K=U*U+k*k;K<=1&&g.candidates.push(je(r.getObjectId(D),F(M),Math.sqrt(K)))}else if("ends"===t.vertexMode){const q=[0];T||q.push(Q.length-o);for(const M of q){const U=A;U.coordsIndex=M;const k=(n.x-U.x)/d,K=(n.y-U.y)/m,fe=k*k+K*K;fe<=1&&g.candidates.push(je(r.getObjectId(D),F(U),Math.sqrt(fe)))}}}}return g.candidates.sort((D,C)=>D.distance-C.distance),g}_getPointCreator(t,i,r){const o=null==r||(0,j.fS)(i,r)?d=>d:d=>(0,W.iV)(d,i,r),{hasZ:n}=this;return"3d"===t?n?({x:d,y:m,z:g})=>o({x:d,y:m,z:g}):({x:d,y:m})=>o({x:d,y:m,z:0}):({x:d,y:m})=>o({x:d,y:m})}createSummaryStatisticsResponse(t){var i=this;return(0,I.Z)(function*(){const{field:r,valueExpression:o,normalizationField:n,normalizationType:h,normalizationTotal:d,minValue:m,maxValue:g,scale:T,timeZone:F}=t,A=i.fieldsIndex.get(r),L=(0,ee.y2)(A)||(0,ee.UQ)(A)||(0,ee.ig)(A),O=yield i._getDataValues({field:r,valueExpression:o,normalizationField:n,normalizationType:h,normalizationTotal:d,scale:T,timeZone:F}),D=(0,Z.S5)({normalizationType:h,normalizationField:n,minValue:m,maxValue:g}),C={value:.5,fieldType:A?.type},Q=(0,ee.qN)(A)?(0,Z.H0)({values:O,supportsNullCount:D,percentileParams:C}):(0,Z.i5)({values:O,minValue:m,maxValue:g,useSampleStdDev:!h,supportsNullCount:D,percentileParams:C});return(0,Z.F_)(Q,L)})()}createUniqueValuesResponse(t){var i=this;return(0,I.Z)(function*(){const{field:r,valueExpression:o,domains:n,returnAllCodedValues:h,scale:d,timeZone:m}=t,g=yield i._getDataValues({field:r,field2:t.field2,field3:t.field3,fieldDelimiter:t.fieldDelimiter,valueExpression:o,scale:d,timeZone:m},!1),T=(0,Z.eT)(g);return(0,Z.Qm)(T,n,h,t.fieldDelimiter)})()}createClassBreaksResponse(t){var i=this;return(0,I.Z)(function*(){const{field:r,valueExpression:o,normalizationField:n,normalizationType:h,normalizationTotal:d,classificationMethod:m,standardDeviationInterval:g,minValue:T,maxValue:F,numClasses:A,scale:L,timeZone:O}=t,D=yield i._getDataValues({field:r,valueExpression:o,normalizationField:n,normalizationType:h,normalizationTotal:d,scale:L,timeZone:O}),C=(0,Z.G2)(D,{field:r,normalizationField:n,normalizationType:h,normalizationTotal:d,classificationMethod:m,standardDeviationInterval:g,minValue:T,maxValue:F,numClasses:A});return(0,Z.DL)(C,m)})()}createHistogramResponse(t){var i=this;return(0,I.Z)(function*(){const{field:r,valueExpression:o,normalizationField:n,normalizationType:h,normalizationTotal:d,classificationMethod:m,standardDeviationInterval:g,minValue:T,maxValue:F,numBins:A,scale:L,timeZone:O}=t,D=yield i._getDataValues({field:r,valueExpression:o,normalizationField:n,normalizationType:h,normalizationTotal:d,scale:L,timeZone:O});return(0,Z.oF)(D,{field:r,normalizationField:n,normalizationType:h,normalizationTotal:d,classificationMethod:m,standardDeviationInterval:g,minValue:T,maxValue:F,numBins:A})})()}_sortFeatures(t,i,r){if(t.length>1&&i?.length)for(const o of i.reverse()){const n=o.split(" "),h=n[0],d=this.fieldsIndex.get(h),m=!!n[1]&&"desc"===n[1].toLowerCase(),g=(0,Z.Lq)(d?.type,m);t.sort((T,F)=>{const A=r(T,h,d),L=r(F,h,d);return g(A,L)})}}_createFeatureQueryResponse(t){const i=this.items,{geometryType:r,hasM:o,hasZ:n,objectIdField:h,spatialReference:d}=this,{outFields:m,outSR:g,quantizationParameters:T,resultRecordCount:F,resultOffset:A,returnZ:L,returnM:O}=t,D=null!=F&&i.length>(A||0)+F,C=m&&(m.includes("*")?[...this.fieldsIndex.fields]:m.map(Q=>this.fieldsIndex.get(Q)));return{exceededTransferLimit:D,features:this._createFeatures(t,i),fields:C,geometryType:r,hasM:o&&O,hasZ:n&&L,objectIdFieldName:h,spatialReference:(0,N.S2)(g||d),transform:T&&(0,le.vY)(T)||null}}_createFeatures(t,i){const r=new Se(t,this.featureAdapter,this.fieldsIndex),{hasM:o,hasZ:n}=this,{orderByFields:h,quantizationParameters:d,returnGeometry:m,returnCentroid:g,maxAllowableOffset:T,resultOffset:F,resultRecordCount:A,returnZ:L=!1,returnM:O=!1}=t,D=n&&L,C=o&&O;let Q=[],te=0;const J=[...i];if(this._sortFeatures(J,h,(M,U,k)=>r.getFieldValue(M,U,k)),this.geometryType&&(m||g)){const M=(0,le.vY)(d)??void 0,U="esriGeometryPolygon"===this.geometryType||"esriGeometryPolyline"===this.geometryType;if(m&&!g)for(const k of J){const K=this.featureAdapter.getGeometry(k),fe={attributes:r.getAttributes(k),geometry:(0,N.Op)(this.geometryType,this.hasZ,this.hasM,K,T,M,D,C)};U&&K&&!fe.geometry&&(fe.centroid=(0,N.EG)(this,this.featureAdapter.getCentroid(k,this),M)),Q[te++]=fe}else if(!m&&g)for(const k of J)Q[te++]={attributes:r.getAttributes(k),centroid:(0,N.EG)(this,this.featureAdapter.getCentroid(k,this),M)};else for(const k of J)Q[te++]={attributes:r.getAttributes(k),centroid:(0,N.EG)(this,this.featureAdapter.getCentroid(k,this),M),geometry:(0,N.Op)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(k),T,M,D,C)}}else for(const M of J){const U=r.getAttributes(M);U&&(Q[te++]={attributes:U})}const q=F||0;return null!=A&&(Q=Q.slice(q,Math.min(Q.length,q+A))),Q}_createExceedsLimitQueryResponse(t){let i=!1,r=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY;for(const h of t.outStatistics??[])if("exceedslimit"===h.statisticType){r=null!=h.maxPointCount?h.maxPointCount:Number.POSITIVE_INFINITY,o=null!=h.maxRecordCount?h.maxRecordCount:Number.POSITIVE_INFINITY,n=null!=h.maxVertexCount?h.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)i=this.items.length>r;else if(this.items.length>o)i=!0;else{const h=Fe(this.hasZ,this.hasM),d=this.featureAdapter;i=this.items.reduce((m,g)=>{const T=d.getGeometry(g);return m+(null!=T&&T.coords.length||0)},0)/h>n}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(i)}}]}}_createStatisticsQueryResponse(t){var i=this;return(0,I.Z)(function*(){const r={attributes:{}},o=[],n=new Map,h=new Map,d=new Map,m=new Map,g=new Se(t,i.featureAdapter,i.fieldsIndex),T=t.outStatistics,{groupByFieldsForStatistics:F,having:A,orderByFields:L,resultRecordCount:O}=t,D=F?.length,C=!!D,Q=C?F[0]:null,te=C&&!i.fieldsIndex.get(Q);for(const q of T??[]){const{outStatisticFieldName:M,statisticType:U}=q,k=q,K="exceedslimit"!==U?q.onStatisticField:void 0,fe="percentile_disc"===U||"percentile_cont"===U,De="EnvelopeAggregate"===U||"CentroidAggregate"===U||"ConvexHullAggregate"===U,Ve=C&&1===D&&(K===Q||te)&&"count"===U;if(C){if(!d.has(K)){const tt=[];for(const ht of F){const st=i._getAttributeValues(g,ht,n);tt.push(st)}d.set(K,i._calculateUniqueValues(tt,!De&&g.returnDistinctValues))}const Me=d.get(K);if(!Me)continue;const dt=Object.keys(Me);for(const tt of dt){const{count:ht,data:st,items:It,itemPositions:Bt}=Me[tt],St=st.join(",");if(!A||g.validateItems(It,A)){const $e=m.get(St)||{attributes:{}};if(De){$e.aggregateGeometries||($e.aggregateGeometries={});const{aggregateGeometries:ze,outStatisticFieldName:We}=yield i._getAggregateGeometry(k,It);$e.aggregateGeometries[We]=ze}else{let ze=null;if(Ve)ze=ht;else{const We=i._getAttributeValues(g,K,n),vt=Bt.map(Wt=>We[Wt]);ze=fe&&"statisticParameters"in k?i._getPercentileValue(k,vt):i._getStatisticValue(k,vt,null,g.returnDistinctValues)}$e.attributes[M]=ze}let Ht=0;F.forEach((ze,We)=>$e.attributes[i.fieldsIndex.get(ze)?ze:"EXPR_"+ ++Ht]=st[We]),m.set(St,$e)}}}else if(De){r.aggregateGeometries||(r.aggregateGeometries={});const{aggregateGeometries:Me,outStatisticFieldName:dt}=yield i._getAggregateGeometry(k,i.items);r.aggregateGeometries[dt]=Me}else{const Me=i._getAttributeValues(g,K,n);r.attributes[M]=fe&&"statisticParameters"in k?i._getPercentileValue(k,Me):i._getStatisticValue(k,Me,h,g.returnDistinctValues)}const et="min"!==U&&"max"!==U||!(0,ee.qN)(i.fieldsIndex.get(K))&&!i._isAnyDateField(K)?null:i.fieldsIndex.get(K)?.type;o.push({name:M,alias:M,type:et||"esriFieldTypeDouble"})}const J=C?Array.from(m.values()):[r];return i._sortFeatures(J,L,(q,M)=>q.attributes[M]),O&&(J.length=Math.min(O,J.length)),{fields:o,features:J}})()}_isAnyDateField(t){const i=this.fieldsIndex.get(t);return(0,ee.y2)(i)||(0,ee.UQ)(i)||(0,ee.ig)(i)||(0,ee.sX)(i)}_getAggregateGeometry(t,i){var r=this;return(0,I.Z)(function*(){const{convexHull:o,union:n}=yield Promise.all([y.e(9465),y.e(8592)]).then(y.bind(y,49574)),{statisticType:h,outStatisticFieldName:d}=t,{featureAdapter:m,spatialReference:g,geometryType:T,hasZ:F,hasM:A}=r,L=i.map(C=>(0,N.Op)(T,F,A,m.getGeometry(C))),O=o(g,L,!0)[0],D={aggregateGeometries:null,outStatisticFieldName:null};if("EnvelopeAggregate"===h){const C=O?(0,Ie._w)(O):(0,Ie.aO)(n(g,L));D.aggregateGeometries={...C,spatialReference:g},D.outStatisticFieldName=d||"extent"}else if("CentroidAggregate"===h){const C=O?(0,ue.tO)(O):(0,ue.$G)((0,Ie.aO)(n(g,L)));D.aggregateGeometries={x:C[0],y:C[1],spatialReference:g},D.outStatisticFieldName=d||"centroid"}else"ConvexHullAggregate"===h&&(D.aggregateGeometries=O,D.outStatisticFieldName=d||"convexHull");return D})()}_getStatisticValue(t,i,r,o){const{onStatisticField:n,statisticType:h}=t;let d=null;return d=r?.has(n)?r.get(n):(0,ee.qN)(this.fieldsIndex.get(n))||this._isAnyDateField(n)?(0,Z.H0)({values:i,returnDistinct:o}):(0,Z.i5)({values:o?[...new Set(i)]:i,minValue:null,maxValue:null,useSampleStdDev:!0}),r&&r.set(n,d),d["var"===h?"variance":h]}_getPercentileValue(t,i){const{onStatisticField:r,statisticParameters:o,statisticType:n}=t,{value:h,orderBy:d}=o,m=this.fieldsIndex.get(r);return(0,Z.XL)(i,{value:h,orderBy:d,fieldType:m?.type,isDiscrete:"percentile_disc"===n})}_getAttributeValues(t,i,r){if(r.has(i))return r.get(i);const o=this.fieldsIndex.get(i),n=this.items.map(h=>t.getFieldValue(h,i,o));return r.set(i,n),n}_calculateUniqueValues(t,i){const r={},o=this.items,n=o.length;for(let h=0;h<n;h++){const d=o[h],m=[];for(const T of t)m.push(T[h]);const g=m.join(",");null==r[g]?r[g]={count:1,data:m,items:[d],itemPositions:[h]}:(i||r[g].count++,r[g].items.push(d),r[g].itemPositions.push(h))}return r}_getDataValues(t,i=!0){var r=this;return(0,I.Z)(function*(){const o=new Se(r.query,r.featureAdapter,r.fieldsIndex),{valueExpression:n,scale:h,timeZone:d}=t;return n?o.getExpressionValues(r.items,n,{viewingMode:"map",scale:h,spatialReference:r.query.outSR||r.spatialReference},{geometryType:r.geometryType,hasZ:r.hasZ,hasM:r.hasM},d):o.getDataValues(r.items,(0,V.d9)(t),i)})()}}function Oe(f,t,i,r){const o=r.x-i.x,n=r.y-i.y,m=Math.min(1,Math.max(0,((t.x-i.x)*o+(t.y-i.y)*n)/(o*o+n*n)));f.x=i.x+o*m,f.y=i.y+n*m}function Fe(f,t){return f?t?4:3:t?3:2}class we{constructor(t,i){this.coords=t,this.coordsIndex=i}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+1]}get z(){return this.coords[this.coordsIndex+2]}}var ye=y(44452),re=y(51089);const Ee="unsupported-query";function ie(f,t){return Ze.apply(this,arguments)}function Ze(){return(Ze=(0,I.Z)(function*(f,{fieldsIndex:t,geometryType:i,spatialReference:r,availableFields:o}){if((f.distance??0)<0||null!=f.geometryPrecision||f.multipatchOption&&"xyFootprint"!==f.multipatchOption||f.pixelSize||f.relationParam||f.text)throw new ne.Z(Ee,"Unsupported query options",{query:f});return qe(t,o,f),function Rt(f,t,i){const{outStatistics:r,groupByFieldsForStatistics:o,having:n}=i,h=o?.length,d=r?.length;if(n){if(!h||!d)throw new ne.Z(Ee,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:i});!function X(f,t,i,r,o){if(!i)return!0;const n="having clause",h=G(f,i,{validateAggregate:!0,expressionName:n});if(E(f,t,h,{expressionName:n,query:o}),!ae(i,f)?.getExpressions().every(g=>{const{aggregateType:T,field:F}=g,A=f.get(F)?.name;return r.some(L=>{const{onStatisticField:O,statisticType:D}=L;return f.get(O)?.name===A&&D.toLowerCase().trim()===T})}))throw new ne.Z(Ue,"expressions in having clause should also exist in outStatistics",{having:i})}(f,t,n,r,i)}if(d){if(!function Ot(f){return null!=f&&f.every(t=>"exceedslimit"!==t.statisticType)}(r))return;E(f,t,r.map(g=>g.onStatisticField).filter(Boolean),{expressionName:"onStatisticFields",query:i}),h&&E(f,t,o,{expressionName:"groupByFieldsForStatistics",query:i});for(const g of r){const{onStatisticField:T,statisticType:F}=g;if("percentile_disc"!==F&&"percentile_cont"!==F||!("statisticParameters"in g))f.get(T)&&"count"!==F&&"min"!==F&&"max"!==F&&E(f,t,[T],{expressionName:`outStatistics with '${F}' statistic type`,allowedFieldTypes:Ft,query:i});else{const{statisticParameters:A}=g;if(!A)throw new ne.Z(Ee,"statisticParameters should be set for percentile type",{definition:g,query:i})}}}}(t,o,f),Promise.all([(0,re.P0)(f,i,r),(0,W._W)(r,f.outSR)]).then(()=>f)})).apply(this,arguments)}function qe(f,t,i){const{outFields:r,orderByFields:o,returnDistinctValues:n,outStatistics:h}=i,d=h?h.map(m=>m.outStatisticFieldName&&m.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if(o&&o.length>0){const m=" asc",g=" desc";E(f,t,o.map(F=>{const A=F.toLowerCase();return A.includes(m)?A.split(m)[0]:A.includes(g)?A.split(g)[0]:F}).filter(F=>!d.includes(F)),{expressionName:"orderByFields",query:i})}if(r&&r.length>0)E(f,t,r,{expressionName:"outFields",query:i,allowedFieldTypes:"all"});else if(n)throw new ne.Z(Ee,"outFields should be specified for returnDistinctValues",{query:i});!function $(f,t,i,r){if(!i)return!0;const o="where clause";E(f,t,G(f,i,{validateStandardized:!0,expressionName:o}),{expressionName:o,query:r})}(f,t,i.where,i)}const Ft=new Set([...Ke,...Be]);function it(){return(it=(0,I.Z)(function*(f,t,{fieldsIndex:i,geometryType:r,spatialReference:o,availableFields:n}){if((f.distance??0)<0||null!=f.geometryPrecision||f.multipatchOption||f.pixelSize||f.relationParam||f.text||f.outStatistics||f.groupByFieldsForStatistics||f.having||f.orderByFields)throw new ne.Z(Ee,"Unsupported query options",{query:f});return qe(i,n,f),Promise.all([Ct(i,n,t,f),(0,re.P0)(f,r,o),(0,W._W)(o,f.outSR)]).then(()=>f)})).apply(this,arguments)}function Ct(f,t,i,r){return rt.apply(this,arguments)}function rt(){return(rt=(0,I.Z)(function*(f,t,i,r){let o=[];if(i.valueExpression){const{arcadeUtils:n}=yield(0,pe.LC)();o=n.extractFieldNames(i.valueExpression)}if(i.field&&o.push(i.field),i.field2&&o.push(i.field2),i.field3&&o.push(i.field3),i.normalizationField&&o.push(i.normalizationField),!o.length&&!i.valueExpression)throw new ne.Z(Ee,"field or valueExpression is required",{params:i});E(f,t,o,{expressionName:"statistics",query:r})})).apply(this,arguments)}var ft=y(21418),bt=y(40100),Nt=y(50433),Pt=(y(14007),y(4703)),nt=y(44169),at=y(43029),ot=y(77675),lt=y(45974),ve=y(95854);const mt=Symbol("Yield");class Dt{constructor(){this._tasks=new Array,this._runningTasks=(0,lt.t)(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(t){if(0===this.length)return mt;for(;!t.done&&this._process(t);)t.madeProgress()}push(t,i,r){return++this._runningTasks.value,new Promise((o,n)=>this._tasks.push(new gt(o,n,t,i,r))).finally(()=>--this._runningTasks.value)}unshift(t,i,r){return++this._runningTasks.value,new Promise((o,n)=>this._tasks.unshift(new gt(o,n,t,i,r))).finally(()=>--this._runningTasks.value)}_process(t){if(0===this._tasks.length)return!1;const i=this._tasks.shift();try{const r=(0,H.Hc)(i.signal);if(r&&!i.abortCallback)i.reject((0,H.zE)());else{const o=r?i.abortCallback?.((0,H.zE)()):i.callback(t);(0,H.y8)(o)?o.then(i.resolve,i.reject):i.resolve(o)}}catch(r){i.reject(r)}return!0}cancelAll(){const t=(0,H.zE)();for(const i of this._tasks)if(i.abortCallback){const r=i.abortCallback(t);i.resolve(r)}else i.reject(t);this._tasks.length=0}}class gt{constructor(t,i,r,o=void 0,n=void 0){this.resolve=t,this.reject=i,this.callback=r,this.signal=o,this.abortCallback=n}}var ut=y(50484),Mt=y(73514),pt=y(80543),zt=(y(65311),y(10141));let He=class extends Mt.Z{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,ut._)([(0,pt.Cb)()],He.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,ut._)([(0,pt.Cb)()],He.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),He=(0,ut._)([(0,zt.j)("esri.views.support.debugFlags")],He);const Lt=new He;var Te,f,z;(f=Te||(Te={}))[f.ANIMATING=0]="ANIMATING",f[f.INTERACTING=1]="INTERACTING",f[f.IDLE=2]="IDLE",function(f){f.RESOURCE_CONTROLLER_IMMEDIATE="immediate",f.RESOURCE_CONTROLLER="schedule",f.SLIDE="slide",f.STREAM_DATA_LOADER="stream loader",f.ELEVATION_QUERY="elevation query",f.TERRAIN_SURFACE="terrain",f.SURFACE_GEOMETRY_UPDATES="surface geometry updates",f.LOD_RENDERER="LoD renderer",f.GRAPHICS_CORE="Graphics3D",f.I3S_CONTROLLER="I3S",f.POINT_CLOUD_LAYER="point cloud",f.FEATURE_TILE_FETCHER="feature fetcher",f.OVERLAY="overlay",f.STAGE="stage",f.GRAPHICS_DECONFLICTOR="graphics deconflictor",f.FILTER_VISIBILITY="Graphics3D filter visibility",f.SCALE_VISIBILITY="Graphics3D scale visibility",f.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",f.POINT_OF_INTEREST_FREQUENT="POI frequent",f.POINT_OF_INTEREST_INFREQUENT="POI infrequent",f.LABELER="labeler",f.FEATURE_QUERY_ENGINE="feature query",f.FEATURE_TILE_TREE="feature tile tree",f.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",f.ELEVATION_ALIGNMENT="elevation alignment",f.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",f.TEXT_TEXTURE_ATLAS="text texture atlas",f.TEXTURE_UNLOAD="texture unload",f.LINE_OF_SIGHT_TOOL="line of sight tool",f.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",f.ELEVATION_PROFILE="elevation profile",f.SNAPPING="snapping",f.SHADOW_ACCUMULATOR="shadow accumulator",f.CLOUDS_GENERATOR="clouds generator",f[f.NONE=0]="NONE",f[f.TEST_PRIO=1]="TEST_PRIO"}(z||(z={}));const yt=new Map([[z.RESOURCE_CONTROLLER_IMMEDIATE,0],[z.RESOURCE_CONTROLLER,4],[z.SLIDE,0],[z.STREAM_DATA_LOADER,0],[z.ELEVATION_QUERY,0],[z.TERRAIN_SURFACE,1],[z.SURFACE_GEOMETRY_UPDATES,1],[z.LOD_RENDERER,2],[z.GRAPHICS_CORE,2],[z.I3S_CONTROLLER,2],[z.POINT_CLOUD_LAYER,2],[z.FEATURE_TILE_FETCHER,2],[z.OVERLAY,4],[z.STAGE,4],[z.GRAPHICS_DECONFLICTOR,4],[z.FILTER_VISIBILITY,4],[z.SCALE_VISIBILITY,4],[z.FRUSTUM_VISIBILITY,4],[z.CLOUDS_GENERATOR,4],[z.POINT_OF_INTEREST_FREQUENT,6],[z.POINT_OF_INTEREST_INFREQUENT,30],[z.LABELER,8],[z.FEATURE_QUERY_ENGINE,8],[z.FEATURE_TILE_TREE,16],[z.FEATURE_TILE_TREE_ACTIVE,0],[z.ELEVATION_ALIGNMENT,12],[z.ELEVATION_ALIGNMENT_SCENE,14],[z.TEXT_TEXTURE_ATLAS,12],[z.TEXTURE_UNLOAD,12],[z.LINE_OF_SIGHT_TOOL,16],[z.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[z.SNAPPING,0],[z.SHADOW_ACCUMULATOR,30]]);function _t(f){return yt.has(f)?yt.get(f):"number"==typeof f?f:1}const Ut=(0,ve.HA)(6.5),Et=(0,ve.HA)(1),wt=(0,ve.HA)(30),Zt=(0,ve.HA)(1e3/30),Qt=(0,ve.HA)(100);var Xe,Qe;(function(f){f.Scheduler=class t{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(n=>n.needsUpdate)}constructor(){this._updating=(0,lt.t)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new nt.Z("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=Te.INTERACTING,this._tasks=new at.Z,this._runQueue=new at.Z,this._load=0,this._idleStateCallbacks=new at.Z,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,ot.YP)(()=>Lt.SCHEDULER_LOG_SLOW_TASKS,n=>this._debug=n,ot.nn);for(const n of Object.keys(z))this.performanceInfo.tasks.set(z[n],new nt.Z(z[n]))}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),(0,oe.hw)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(n,h){const d=new i(this,n,h);return this._tasks.push(d),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new nt.Z(n)),d}registerIdleStateCallbacks(n,h){const d={idleBegin:n,idleEnd:h};this._idleStateCallbacks.push(d),this.state===Te.IDLE&&this._idleUpdatesStartFired&&d.idleBegin();const m=this;return{remove:()=>this._removeIdleStateCallbacks(d),set idleBegin(g){m._idleUpdatesStartFired&&(d.idleEnd(),m._state===Te.IDLE&&g()),d.idleBegin=g},set idleEnd(g){d.idleEnd=g}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==Te.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(h=>h.idleEnd())))}get state(){return this._state}updateBudget(n){++this._frameNumber;let h=Ut,d=n.frameDuration,m=Et;switch(this.state){case Te.IDLE:h=(0,ve.HA)(0),d=(0,ve.HA)(Math.max(Qt,n.frameDuration)),m=wt;break;case Te.INTERACTING:d=(0,ve.HA)(Math.max(Zt,n.frameDuration))}return d=(0,ve.HA)(d-n.elapsedFrameTime-h),this.state!==Te.IDLE&&d<Et&&!this._forceTask?(this._forceTask=!0,!1):(d=(0,ve.HA)(Math.max(d,m)),this._budget.reset(d,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Te.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case Te.INTERACTING:this._runInteracting();break;default:this._runAnimating()}}stopFrame(){this._budget.reset((0,ve.HA)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(h=>{h.name===n&&h.setPriority(n)})}_getState(n){if(this._runQueue.some(d=>d.name===n))return Qe.SCHEDULED;let h=Qe.IDLE;return this._tasks.forAll(d=>{d.name===n&&d.needsUpdate&&(d.schedulePriority<=1?h=Qe.READY:h!==Qe.READY&&(h=Qe.WAITING))}),h}_getRuntime(n){let h=0;return this._tasks.forAll(d=>{d.name===n&&(h+=d.runtime)}),h}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(d=>{d.needsUpdate&&n.set(d.name,(n.get(d.name)||0)+1)}),0===n.size)return null;let h="";return n.forEach((d,m)=>{h+=d>1?` ${d}x ${m}`:` ${m}`}),h}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((h,d)=>d.needsUpdate?++h:h,0);this._load=.9*this._load+n*(1-.9)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{0===n.basePriority&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});0===this._runQueue.length;){let n=!1,h=0;if(this._tasks.forAll(d=>{d.needsUpdate&&0!==d.schedulePriority&&0!==d.basePriority&&d.blockFrame!==this._frameNumber&&(n=!0,h=Math.max(h,d.basePriority),1===d.schedulePriority?(d.schedulePriority=0,this._runQueue.push(d)):--d.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const h=this._budget.now(),d=this._runQueue.pop();this._budget.resetProgress();try{d.task.runTask(this._budget)===mt&&(d.blockFrame=this._frameNumber)}catch(g){Pt.Z.getLogger("esri.views.support.Scheduler").error(`Exception in task "${d.name}"`,g),d.blockFrame=this._frameNumber}!this._budget.hasProgressed&&d.blockFrame!==this._frameNumber&&d.needsUpdate&&(d.blockFrame=this._frameNumber),d.schedulePriority=d.basePriority;const m=this._budget.now()-h;if(d.runtime+=m,this._frameTaskTimes.set(d.priority,this._frameTaskTimes.get(d.priority)+m),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-n)}}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(z))this._frameTaskTimes.set(z[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((h,d)=>this.performanceInfo.tasks.get(d).record(h)),this.performanceInfo.total.record(n)}get test(){}};class i{get task(){return this._task.value}get updating(){return this._queue.running}constructor(n,h,d){this._scheduler=n,this.name=h,this.blockFrame=0,this.runtime=0,this._queue=new Dt,this._handles=new Nt.Z,this._basePriority=_t(h),this.schedulePriority=this._basePriority,this._task=(0,lt.t)(d??this._queue),this._handles.add((0,ot.gx)(()=>this.task.running,m=>n.taskRunningChanged(m)))}remove(){this.processQueue(Je),this._scheduler.removeTask(this),this.schedule=xt.schedule,this.reschedule=xt.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){if(this.name===n)return;this.name=n;const h=_t(n);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=h),this._basePriority=h}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,h,d){return this._queue.push(n,h,d)}reschedule(n,h,d){return this._queue.unshift(n,h,d)}processQueue(n){return this._queue.runTask(n)}}class r{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Te.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(!0===n()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,h){this._begin=this.now(),this._budget=n,this._state=h,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}f.Budget=r})(Xe||(Xe={})),function(f){f.SCHEDULED="s",f.READY="r",f.WAITING="w",f.IDLE="i"}(Qe||(Qe={}));const Je=(()=>{const f=new Xe.Budget;return f.enabled=!1,f})(),xt=new class Vt{remove(){}processQueue(){}schedule(t,i,r){try{if((0,H.Hc)(i)){const o=(0,H.zE)();return r?Promise.resolve(r(o)):Promise.reject(o)}return(0,H.gx)(t(Je))}catch(o){return Promise.reject(o)}}reschedule(t,i,r){return this.schedule(t,i,r)}},jt=new be.WJ(2e6);let kt=0;class $t{constructor(t){this._geometryQueryCache=null,this._changeHandle=null,this.capabilities={query:he.g},this.geometryType=t.geometryType,this.hasM=!!t.hasM,this.hasZ=!!t.hasZ,this.objectIdField=t.objectIdField,this.spatialReference=t.spatialReference,this.definitionExpression=t.definitionExpression,this.featureStore=t.featureStore,this.aggregateAdapter=t.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache()),this.timeInfo=t.timeInfo,t.cacheSpatialQueries&&(this._geometryQueryCache=new be.Xq(kt+++"$$",jt)),this.fieldsIndex=(0,Y.AK)(t.fieldsIndex)?t.fieldsIndex:bt.Z.fromJSON(t.fieldsIndex),this.availableFields=!t.availableFields||1===t.availableFields.length&&"*"===t.availableFields[0]?new Set(this.fieldsIndex.fields.map(i=>i.name)):new Set(t.availableFields.map(i=>this.fieldsIndex.get(i)?.name).filter(i=>null!=i)),t.scheduler&&t.priority&&(this._frameTask=t.scheduler.registerTask(t.priority))}destroy(){this._frameTask=(0,oe.hw)(this._frameTask),this.clearCache(),(0,oe.SC)(this._geometryQueryCache),this._changeHandle=(0,oe.hw)(this._changeHandle)}get featureAdapter(){return this.featureStore.featureAdapter}clearCache(){this._geometryQueryCache?.clear(),this._allFeaturesPromise=null,this._timeExtentPromise=null,this._fullExtentPromise=null}executeQuery(t,i){var r=this;return(0,I.Z)(function*(){const o=(0,H.$h)(i);try{return(yield r._executeQuery(t,{},o)).createQueryResponse()}catch(n){if(n!==ye.Ti)throw n;return new se([],t,r).createQueryResponse()}})()}executeQueryForCount(t={},i){var r=this;return(0,I.Z)(function*(){const o=(0,H.$h)(i);try{return(yield r._executeQuery(t,{returnGeometry:!1,returnCentroid:!1,outSR:null},o)).createQueryResponseForCount()}catch(n){if(n!==ye.Ti)throw n;return 0}})()}executeQueryForExtent(t,i){var r=this;return(0,I.Z)(function*(){const o=(0,H.$h)(i),n=t.outSR;try{const h=yield r._executeQuery(t,{returnGeometry:!0,returnCentroid:!1,outSR:null},o),d=h.size;return d?{count:d,extent:yield r._getBounds(h.items,h.spatialReference,n||r.spatialReference)}:{count:0,extent:null}}catch(h){if(h===ye.Ti)return{count:0,extent:null};throw h}})()}executeQueryForIds(t,i){var r=this;return(0,I.Z)(function*(){return r.executeQueryForIdSet(t,i).then(o=>Array.from(o))})()}executeQueryForIdSet(t,i){var r=this;return(0,I.Z)(function*(){const o=(0,H.$h)(i);try{const n=yield r._executeQuery(t,{returnGeometry:!0,returnCentroid:!1,outSR:null},o),h=n.items,d=new Set;return yield r._reschedule(()=>{for(const m of h)d.add(n.featureAdapter.getObjectId(m))},o),d}catch(n){if(n===ye.Ti)return new Set;throw n}})()}executeQueryForSnapping(t,i){var r=this;return(0,I.Z)(function*(){const o=(0,H.$h)(i),{point:n,distance:h,returnEdge:d,vertexMode:m}=t;if(!d&&"none"===m)return{candidates:[]};let g=(0,V.d9)(t.query);g=yield r._schedule(()=>(0,ye.j6)(g,r.definitionExpression,r.spatialReference),o),g=yield r._reschedule(()=>ie(g,{availableFields:r.availableFields,fieldsIndex:r.fieldsIndex,geometryType:r.geometryType,spatialReference:r.spatialReference}),o);const T=!(0,j.fS)(n.spatialReference,r.spatialReference);T&&(yield(0,W._W)(n.spatialReference,r.spatialReference));const F="number"==typeof h?h:h.x,A="number"==typeof h?h:h.y,L={xmin:n.x-F,xmax:n.x+F,ymin:n.y-A,ymax:n.y+A,spatialReference:n.spatialReference},O=T?(0,W.iV)(L,r.spatialReference):L;if(!O)return{candidates:[]};const D=(yield(0,R.aX)((0,B.im)(n),null,{signal:o}))[0],C=(yield(0,R.aX)((0,B.im)(O),null,{signal:o}))[0];if(null==D||null==C)return{candidates:[]};const Q=new se(yield r._reschedule(()=>r._searchFeatures(ct(C.toJSON())),o),g,r);yield r._reschedule(()=>r._executeObjectIdsQuery(Q),o),yield r._reschedule(()=>r._executeTimeQuery(Q),o),yield r._reschedule(()=>r._executeAttributesQuery(Q),o),yield r._reschedule(()=>r._executeGeometryQueryForSnapping(Q,o),o);const te=D.toJSON(),J=T?(0,W.iV)(te,r.spatialReference):te,q=T?Math.max(O.xmax-O.xmin,O.ymax-O.ymin)/2:h;return Q.createSnappingResponse({...t,point:J,distance:q},n.spatialReference)})()}executeQueryForLatestObservations(t,i){var r=this;return(0,I.Z)(function*(){const o=(0,H.$h)(i);if(!r.timeInfo?.trackIdField)throw new ne.Z("unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:t,timeInfo:r.timeInfo});try{const n=yield r._executeQuery(t,{},o);return yield r._reschedule(()=>r._filterLatest(n),o),n.createQueryResponse()}catch(n){if(n!==ye.Ti)throw n;return new se([],t,r).createQueryResponse()}})()}executeQueryForSummaryStatistics(t={},i,r){var o=this;return(0,I.Z)(function*(){const n=(0,H.$h)(r),{field:h,normalizationField:d,valueExpression:m}=i;return(yield o._executeQueryForStatistics(t,{field:h,normalizationField:d,valueExpression:m},n)).createSummaryStatisticsResponse(i)})()}executeQueryForUniqueValues(t={},i,r){var o=this;return(0,I.Z)(function*(){const n=(0,H.$h)(r),{field:h,field2:d,field3:m,valueExpression:g}=i;return(yield o._executeQueryForStatistics(t,{field:h,field2:d,field3:m,valueExpression:g},n)).createUniqueValuesResponse(i)})()}executeQueryForClassBreaks(t={},i,r){var o=this;return(0,I.Z)(function*(){const n=(0,H.$h)(r),{field:h,normalizationField:d,valueExpression:m}=i;return(yield o._executeQueryForStatistics(t,{field:h,normalizationField:d,valueExpression:m},n)).createClassBreaksResponse(i)})()}executeQueryForHistogram(t={},i,r){var o=this;return(0,I.Z)(function*(){const n=(0,H.$h)(r),{field:h,normalizationField:d,valueExpression:m}=i;return(yield o._executeQueryForStatistics(t,{field:h,normalizationField:d,valueExpression:m},n)).createHistogramResponse(i)})()}fetchRecomputedExtents(t){var i=this;return(0,I.Z)(function*(){const r=(0,H.$h)(t);i._timeExtentPromise||=(0,ft.R)(i.timeInfo,i.featureStore);const[o,n]=yield Promise.all([i._getFullExtent(),i._timeExtentPromise]);return(0,H.k_)(r),{fullExtent:o,timeExtent:n}})()}_getBounds(t,i,r){var o=this;return(0,I.Z)(function*(){const n=(0,p.t8)((0,p.Ue)(),p.G_);yield o.featureStore.forEachBounds(t,m=>(0,p.TC)(n,m));const h={xmin:n[0],ymin:n[1],xmax:n[3],ymax:n[4],spatialReference:(0,N.S2)(o.spatialReference)};o.hasZ&&isFinite(n[2])&&isFinite(n[5])&&(h.zmin=n[2],h.zmax=n[5],h.hasZ=!0);const d=(0,W.iV)(h,i,r);if(d.spatialReference=(0,N.S2)(r),d.xmax-d.xmin==0){const m=(0,de.c9)(d.spatialReference);d.xmin-=m,d.xmax+=m}if(d.ymax-d.ymin==0){const m=(0,de.c9)(d.spatialReference);d.ymin-=m,d.ymax+=m}if(o.hasZ&&null!=d.zmin&&null!=d.zmax&&d.zmax-d.zmin==0){const m=(0,de.c9)(d.spatialReference);d.zmin-=m,d.zmax+=m}return d})()}_getFullExtent(){return this._fullExtentPromise||="getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getAllFeatures().then(t=>this._getBounds(t,this.spatialReference,this.spatialReference)),this._fullExtentPromise}_schedule(t,i){var r=this;return(0,I.Z)(function*(){return null!=r._frameTask?r._frameTask.schedule(t,i):t(Je)})()}_reschedule(t,i){var r=this;return(0,I.Z)(function*(){return null!=r._frameTask?r._frameTask.reschedule(t,i):t(Je)})()}_getAllFeaturesQueryEngineResult(t){var i=this;return(0,I.Z)(function*(){return new se(yield i._getAllFeatures(),t,i)})()}_getAllFeatures(){var t=this;return(0,I.Z)(function*(){if(null==t._allFeaturesPromise){const o=[];t._allFeaturesPromise=(0,I.Z)(function*(){yield t.featureStore.forEach(n=>o.push(n))})().then(()=>o)}const i=t._allFeaturesPromise,r=yield i;return i===t._allFeaturesPromise?r.slice():t._getAllFeatures()})()}_executeQuery(t,i,r){var o=this;return(0,I.Z)(function*(){t=(0,V.d9)(t),t=yield o._schedule(()=>(0,ye.Up)(t,o.definitionExpression,o.spatialReference),r),t=yield o._reschedule(()=>ie(t,{availableFields:o.availableFields,fieldsIndex:o.fieldsIndex,geometryType:o.geometryType,spatialReference:o.spatialReference}),r),t={...t,...i};const n=yield o._reschedule(()=>o._executeSceneFilterQuery(t,r),r),h=yield o._reschedule(()=>o._executeGeometryQuery(t,n,r),r);return yield o._reschedule(()=>o._executeAggregateIdsQuery(h),r),yield o._reschedule(()=>o._executeObjectIdsQuery(h),r),yield o._reschedule(()=>o._executeTimeQuery(h),r),yield o._reschedule(()=>o._executeAttributesQuery(h),r),h})()}_executeSceneFilterQuery(t,i){var r=this;return(0,I.Z)(function*(){if(null==t.sceneFilter)return null;const{outSR:o,returnGeometry:n,returnCentroid:h}=t,d=r.featureStore.featureSpatialReference,m=t.sceneFilter.geometry,g=null==d||(0,j.fS)(d,m.spatialReference)?m:(0,W.iV)(m,d);if(!g)return null;const T=n||h,F=(0,j.JY)(o)&&!(0,j.fS)(r.spatialReference,o)&&T?function(){var C=(0,I.Z)(function*(Q){return r._project(Q,o)});return function(Q){return C.apply(this,arguments)}}():C=>C,A=r.featureAdapter,L=yield r._reschedule(()=>r._searchFeatures(ct(g)),i);if("disjoint"===t.sceneFilter.spatialRelationship){if(!L.length)return null;const C=new Set;for(const J of L)C.add(A.getObjectId(J));const Q=yield r._reschedule(()=>r._getAllFeatures(),i);return F(yield r._reschedule((0,I.Z)(function*(){const J=yield(0,re.cW)("esriSpatialRelDisjoint",g,r.geometryType,r.hasZ,r.hasM),M=yield r._runSpatialFilter(Q,U=>!C.has(A.getObjectId(U))||J(A.getGeometry(U)),i);return new se(M,t,r)}),i))}if(!L.length)return new se([],t,r);if(r._canExecuteSinglePass(g,t))return F(new se(L,t,r));const O=yield(0,re.cW)("esriSpatialRelContains",g,r.geometryType,r.hasZ,r.hasM),D=yield r._runSpatialFilter(L,C=>O(A.getGeometry(C)),i);return F(new se(D,t,r))})()}_executeGeometryQuery(t,i,r){var o=this;return(0,I.Z)(function*(){if(null!=i&&0===i.items.length)return i;t=null!=i?i.query:t;const{geometry:n,outSR:h,spatialRel:d,returnGeometry:m,returnCentroid:g}=t,T=o.featureStore.featureSpatialReference,F=!n||null==T||(0,j.fS)(T,n.spatialReference)?n:(0,W.iV)(n,T),A=m||g,L=(0,j.JY)(h)&&!(0,j.fS)(o.spatialReference,h),O=o._geometryQueryCache&&null==i?JSON.stringify(L&&A?{originalFilterGeometry:n,spatialRelationship:d,outSpatialReference:h}:{originalFilterGeometry:n,spatialRelationship:d}):null,D=O?o._geometryQueryCache.get(O):null;if(null!=D)return new se(D,t,o);const C=function(){var M=(0,I.Z)(function*(U){return L&&A&&(yield o._project(U,h)),O&&o._geometryQueryCache.put(O,U.items,U.items.length+1),U});return function(k){return M.apply(this,arguments)}}();if(!F)return C(i??(yield o._getAllFeaturesQueryEngineResult(t)));const Q=o.featureAdapter;let te=yield o._reschedule(()=>o._searchFeatures(ct(n)),r);if("esriSpatialRelDisjoint"===d){if(!te.length)return C(i??(yield o._getAllFeaturesQueryEngineResult(t)));const M=new Set;for(const K of te)M.add(Q.getObjectId(K));const U=null!=i?i.items:yield o._reschedule(()=>o._getAllFeatures(),r);return C(yield o._reschedule((0,I.Z)(function*(){const K=yield(0,re.cW)(d,F,o.geometryType,o.hasZ,o.hasM),De=yield o._runSpatialFilter(U,Ve=>!M.has(Q.getObjectId(Ve))||K(Q.getGeometry(Ve)),r);return new se(De,t,o)}),r))}if(null!=i){const M=new ce.SO;te=te.filter(U=>(0,ce.cq)(i.items,U,i.items.length,M)>=0)}if(!te.length){const M=new se([],t,o);return O&&o._geometryQueryCache.put(O,M.items,1),M}if(o._canExecuteSinglePass(F,t))return C(new se(te,t,o));const J=yield(0,re.cW)(d,F,o.geometryType,o.hasZ,o.hasM),q=yield o._runSpatialFilter(te,M=>J(Q.getGeometry(M)),r);return C(new se(q,t,o))})()}_executeGeometryQueryForSnapping(t,i){var r=this;return(0,I.Z)(function*(){const{query:o}=t,{spatialRel:n}=o;if(!t?.items?.length||!o.geometry||!n)return;const h=yield(0,re.cW)(n,o.geometry,r.geometryType,r.hasZ,r.hasM),d=yield r._runSpatialFilter(t.items,m=>h(m.geometry),i);t.items=d})()}_executeAggregateIdsQuery(t){if(0===t.items.length||!t.query.aggregateIds?.length||null==this.aggregateAdapter)return;const i=new Set;for(const o of t.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(o).forEach(n=>i.add(n));const r=this.featureAdapter.getObjectId;t.items=t.items.filter(o=>i.has(r(o)))}_executeObjectIdsQuery(t){if(0===t.items.length||!t.query.objectIds?.length)return;const i=new Set(t.query.objectIds),r=this.featureAdapter.getObjectId;t.items=t.items.filter(o=>i.has(r(o)))}_executeTimeQuery(t){if(0===t.items.length)return;const i=(0,ft.y)(this.timeInfo,t.query.timeExtent,this.featureAdapter);null!=i&&(t.items=t.items.filter(i))}_executeAttributesQuery(t){if(0===t.items.length)return;const i=ae(t.query.where,this.fieldsIndex);if(i){if(!i.isStandardized)throw new TypeError("Where clause is not standardized");t.items=t.items.filter(r=>i.testFeature(r,this.featureAdapter))}}_runSpatialFilter(t,i,r){var o=this;return(0,I.Z)(function*(){if(!i)return t;if(null==o._frameTask)return t.filter(m=>i(m));let n=0;const h=new Array,d=function(){var m=(0,I.Z)(function*(g){for(;n<t.length;){const T=t[n++];i(T)&&(h.push(T),g.madeProgress()),g.done&&(yield o._reschedule(F=>d(F),r))}});return function(T){return m.apply(this,arguments)}}();return o._reschedule(m=>d(m),r).then(()=>h)})()}_filterLatest(t){const{trackIdField:i,startTimeField:r,endTimeField:o}=this.timeInfo,n=o||r,h=new Map,d=this.featureAdapter.getAttribute;for(const m of t.items){const g=d(m,i),T=d(m,n),F=h.get(g);(!F||T>d(F,n))&&h.set(g,m)}t.items=Array.from(h.values())}_canExecuteSinglePass(t,i){const{spatialRel:r}=i;return(0,re.hN)(t)&&("esriSpatialRelEnvelopeIntersects"===r||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r))}_project(t,i){var r=this;return(0,I.Z)(function*(){if(!i||(0,j.fS)(r.spatialReference,i))return t;const o=r.featureAdapter;let n;try{const d=yield r._getFullExtent();n=(0,_.getTransformation)(r.spatialReference,i,d)}catch{}const h=yield(0,W.oj)(t.items.map(d=>(0,N.Op)(r.geometryType,r.hasZ,r.hasM,o.getGeometry(d))),r.spatialReference,i,n);return t.items=h.map((d,m)=>o.cloneWithGeometry(t.items[m],(0,Ae.GH)(d,r.hasZ,r.hasM))),t})()}_searchFeatures(t){var i=this;return(0,I.Z)(function*(){const r=new Set;yield Promise.all(t.map(n=>i.featureStore.forEachInBounds(n,h=>r.add(h))));const o=Array.from(r.values());return r.clear(),o})()}_executeQueryForStatistics(t,i,r){var o=this;return(0,I.Z)(function*(){t=(0,V.d9)(t);try{t=yield o._schedule(()=>(0,ye.Up)(t,o.definitionExpression,o.spatialReference),r),t=yield o._reschedule(()=>function At(f,t,i){return it.apply(this,arguments)}(t,i,{availableFields:o.availableFields,fieldsIndex:o.fieldsIndex,geometryType:o.geometryType,spatialReference:o.spatialReference}),r);const n=yield o._reschedule(()=>o._executeSceneFilterQuery(t,r),r),h=yield o._reschedule(()=>o._executeGeometryQuery(t,n,r),r);return yield o._reschedule(()=>o._executeAggregateIdsQuery(h),r),yield o._reschedule(()=>o._executeObjectIdsQuery(h),r),yield o._reschedule(()=>o._executeTimeQuery(h),r),yield o._reschedule(()=>o._executeAttributesQuery(h),r),h}catch(n){if(n!==ye.Ti)throw n;return new se([],t,o)}})()}}function ct(f){if((0,re.hN)(f)){if((0,B.YX)(f))return[(0,S.al)(Math.min(f.xmin,f.xmax),Math.min(f.ymin,f.ymax),Math.max(f.xmin,f.xmax),Math.max(f.ymin,f.ymax))];if((0,B.oU)(f))return f.rings.map(t=>(0,S.al)(Math.min(t[0][0],t[2][0]),Math.min(t[0][1],t[2][1]),Math.max(t[0][0],t[2][0]),Math.max(t[0][1],t[2][1])))}return[(0,P.$P)((0,S.Ue)(),f)]}},85559:(Ge,_e,y)=>{y.d(_e,{g:()=>I});const I={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},14309:(Ge,_e,y)=>{y.d(_e,{n:()=>Y});var I=y(70587),ce=y(83502),ne=y(62209);const Y={getObjectId:V=>V.objectId,getAttributes:V=>V.attributes,getAttribute:(V,oe)=>V.attributes[oe],cloneWithGeometry:(V,oe)=>new ce.u_(oe,V.attributes,null,V.objectId),getGeometry:V=>V.geometry,getCentroid:(V,oe)=>(null==V.centroid&&(V.centroid=(0,I.Y)(new ne.Z,V.geometry,oe.hasZ,oe.hasM)),V.centroid)}},71518:(Ge,_e,y)=>{y.d(_e,{do:()=>Ce,gq:()=>xe,qQ:()=>Ne,yO:()=>Pe});var I=y(15861),Y=(y(2189),y(57964),y(55768)),V=y(51431),oe=y(43814),be=y(66398),H=y(33721),de=y(85295),_=y(96043),p=y(43157),S=y(46169),P=y(4978),B=y(44107);let R=null;const j=/^(?<hh>([0-1][0-9])|([2][0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?([.](?<ms>\d+))?$/;function xe(v,E,b,w){const N=(0,H.MP)(b)?(0,H.C5)(b):null,W=N?Math.round((N.valid[1]-N.valid[0])/E.scale[0]):null;return v.map(he=>{const ue=new B.Z(he.geometry);return(0,be.RF)(E,ue,ue),he.geometry=N?function Ae(v,E,b){return v.x<0?v.x+=E:v.x>b&&(v.x-=E),v}(ue,W??0,w[0]):ue,he})}function Ne(v,E=18,b,w,N){const W=new Float64Array(w*N);E=Math.round((0,Y.F2)(E));let he=Number.POSITIVE_INFINITY,ue=Number.NEGATIVE_INFINITY;const Ie=(0,_.wx)(b);for(const{geometry:le,attributes:ee}of v){const{x:ge,y:Z}=le,pe=Math.max(0,ge-E),Se=Math.max(0,Z-E),je=Math.min(N,Z+E),ke=Math.min(w,ge+E),se=+Ie(ee);for(let Oe=Se;Oe<je;Oe++)for(let Fe=pe;Fe<ke;Fe++){const we=Oe*w+Fe,ye=(0,_.If)(Fe-ge,Oe-Z,E)*se,re=W[we]+=ye;he=Math.min(he,re),ue=Math.max(ue,re)}}return{min:he,max:ue}}function Pe(v){const E=j.exec(v);if(!E)return null;const{hh:b,mm:w,ss:N,ms:W}=E.groups;return Number(b)*V.fM.hours+Number(w)*V.fM.minutes+Number(N)*V.fM.seconds+Number(W||0)}function Ce(v,E){return Le.apply(this,arguments)}function Le(){return(Le=(0,I.Z)(function*(v,E,b=!0){if(!E)return[];const{field:w,field2:N,field3:W,fieldDelimiter:he,fieldInfos:ue,timeZone:Ie}=v,le=w&&ue?.find(re=>re.name.toLowerCase()===w.toLowerCase()),ee=!!le&&(0,de.sX)(le),ge=!!le&&(0,p.a8)(le),Z=v.valueExpression,pe=v.normalizationType,Se=v.normalizationField,je=v.normalizationTotal,ke=[],se=v.viewInfoParams;let Oe=null,Fe=null;if(Z){if(!R){const{arcadeUtils:re}=yield(0,P.LC)();R=re}R.hasGeometryOperations(Z)&&(yield R.enableGeometryOperations()),Oe=R.createFunction(Z),Fe=se?R.getViewInfo({viewingMode:se.viewingMode,scale:se.scale,spatialReference:new oe.Z(se.spatialReference)}):null}const we=v.fieldInfos,ye=E[0]&&"declaredClass"in E[0]&&"esri.Graphic"===E[0].declaredClass||!we?null:{fields:we};return E.forEach(re=>{const Ee=re.attributes;let ie;if(Z){const Ze=ye?{...re,layer:ye}:re,qe=R.createExecContext(Ze,Fe,Ie);ie=R.executeFunction(Oe,qe)}else Ee&&(ie=Ee[w],N?(ie=`${(0,S.wk)(ie)}${he}${(0,S.wk)(Ee[N])}`,W&&(ie=`${ie}${he}${(0,S.wk)(Ee[W])}`)):"string"==typeof ie&&b&&(ge?ie=ie?new Date(ie).getTime():null:ee&&(ie=ie?Pe(ie):null)));if(pe&&"number"==typeof ie&&isFinite(ie)){const Ze=Ee&&parseFloat(Ee[Se]);ie=(0,S.fk)(ie,pe,Ze,je)}ke.push(ie)}),ke})).apply(this,arguments)}},43157:(Ge,_e,y)=>{y.d(_e,{$8:()=>Be,a8:()=>B});var I=y(94678),ce=y(85295),V=(y(4978),y(63335),y(764));function B(x){return(0,ce.y2)(x)||(0,ce.UQ)(x)||(0,ce.ig)(x)}function Be(x,G){const{format:$,timeZoneOptions:X,fieldType:ae}=G??{};let me,v;if(X&&({timeZone:me,timeZoneName:v}=(0,V.Np)(X.layerTimeZone,X.datesInUnknownTimezone,X.viewTimeZone,(0,I.Ze)($||"short-date-short-time"),ae)),"string"==typeof x&&isNaN(Date.parse("time-only"===ae?`1970-01-01T${x}Z`:x)))return x;switch(ae){case"date-only":{const E=(0,I.Ze)($||"short-date");return"string"==typeof x?(0,I.o8)(x,{...E}):(0,I.p6)(x,{...E,timeZone:V.pt})}case"time-only":{const E=(0,I.Ze)($||"short-time");return"string"==typeof x?(0,I.LJ)(x,E):(0,I.p6)(x,{...E,timeZone:V.pt})}case"timestamp-offset":{if(!me&&"string"==typeof x&&new Date(x).toISOString()!==x)return x;const E=$||X?(0,I.Ze)($||"short-date-short-time"):void 0,b=E?{...E,timeZone:me,timeZoneName:v}:void 0;return"string"==typeof x?(0,I.i$)(x,b):(0,I.p6)(x,b)}default:{const E=$||X?(0,I.Ze)($||"short-date-short-time"):void 0;return(0,I.p6)("string"==typeof x?new Date(x):x,E?{...E,timeZone:me,timeZoneName:v}:void 0)}}}}}]);