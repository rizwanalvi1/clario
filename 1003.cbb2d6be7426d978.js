"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[1003],{56761:(tt,z,p)=>{p.d(z,{UG:()=>F,UO:()=>b,YI:()=>m,dI:()=>f,el:()=>P,hV:()=>x,z7:()=>U});var h=p(72578);const o="__begin__",c="__end__",g=new RegExp(o,"ig"),$=new RegExp(c,"ig"),W=new RegExp("^"+o,"i"),M=new RegExp(c+"$","i"),L='"',S=L+" + ",B=" + "+L;function F(T){return T.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function U(T){return T.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function x(T){const D={expression:"",type:"none"};return T.labelExpressionInfo?T.labelExpressionInfo.value?(D.expression=T.labelExpressionInfo.value,D.type="conventional"):T.labelExpressionInfo.expression&&(D.expression=T.labelExpressionInfo.expression,D.type="arcade"):null!=T.labelExpression&&(D.expression=F(T.labelExpression),D.type="conventional"),D}function m(T){const D=x(T);if(!D)return null;switch(D.type){case"conventional":return f(D.expression);case"arcade":return D.expression}return null}function b(T){const D=x(T);if(!D)return null;switch(D.type){case"conventional":return function O(T){return T?.match(v)?.[1].trim()||null}(D.expression);case"arcade":return P(D.expression)}return null}function f(T){let D;return T?(D=(0,h.gx)(T,V=>o+'$feature["'+V+'"]'+c),D=W.test(D)?D.replace(W,""):L+D,D=M.test(D)?D.replace(M,""):D+L,D=D.replaceAll(g,S).replaceAll($,B)):D='""',D}const v=/^\s*\{([^}]+)\}\s*$/i,I=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,A=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,R=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;function P(T){if(!T)return null;let D=I.exec(T)||A.exec(T);return D?D[1]||D[3]:(D=R.exec(T),D?D[2]:null)}},33820:(tt,z,p)=>{p.d(z,{L:()=>o,v:()=>h});const h=15.5,o=1024},35935:(tt,z,p)=>{p.d(z,{Ht:()=>h,QS:()=>F,jL:()=>L});const h=8388607,o=8388608,L=U=>U&h;function F(U,x){return((x?o:0)|U)>>>0}},78607:(tt,z,p)=>{p.d(z,{yu:()=>Ot,XB:()=>mt,Qt:()=>st,ri:()=>Mt,oo:()=>It,Pz:()=>pt,Ou:()=>lt,qH:()=>_t,xh:()=>J,Kw:()=>ht,e5:()=>at});var h=p(50484),c=(p(14007),p(4703)),g=p(72578),$=p(57964),W=p(92426),M=p(98694);class S{constructor(){this._includedModules=new Map}include(a,d){this._includedModules.has(a)?this._includedModules.get(a):(this._includedModules.set(a,d),a(this.builder,d))}}class B extends S{constructor(){super(...arguments),this.vertex=new x,this.fragment=new x,this.attributes=new m,this.varyings=new b,this.extensions=new f,this.constants=new v}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(a,d=!0){const E=this.extensions.generateSource(a),w=this.attributes.generateSource(a),C=this.varyings.generateSource(a),j="vertex"===a?this.vertex:this.fragment,G=j.uniforms.generateSource(),Y=j.code.generateSource(),Z="vertex"===a?I:function O(H=!0){return`#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif\n${H?"out vec4 fragColor;":""}\n`}(d),q=this.constants.generateSource().concat(j.constants.generateSource());return`${d?"#version 300 es":""}\n${E.join("\n")}\n${Z}\n${q.join("\n")}\n${G.join("\n")}\n${w.join("\n")}\n${C.join("\n")}\n${Y.join("\n")}`}generateBindPass(a){const d=new Map;this.vertex.uniforms.entries.forEach(C=>{const j=C.bind[W.P.Pass];j&&d.set(C.name,j)}),this.fragment.uniforms.entries.forEach(C=>{const j=C.bind[W.P.Pass];j&&d.set(C.name,j)});const E=Array.from(d.values()),w=E.length;return(C,j)=>{for(let G=0;G<w;++G)E[G](a,C,j)}}generateBindDraw(a){const d=new Map;this.vertex.uniforms.entries.forEach(C=>{const j=C.bind[W.P.Draw];j&&d.set(C.name,j)}),this.fragment.uniforms.entries.forEach(C=>{const j=C.bind[W.P.Draw];j&&d.set(C.name,j)});const E=Array.from(d.values()),w=E.length;return(C,j,G)=>{for(let Y=0;Y<w;++Y)E[Y](a,C,j,G)}}}class F{constructor(){this._entries=new Map}add(...a){for(const d of a)this._add(d)}get(a){return this._entries.get(a)}_add(a){if(null!=a){if(this._entries.has(a.name)&&!this._entries.get(a.name).equals(a))throw new $.Z(`Duplicate uniform name ${a.name} for different uniform type`);this._entries.set(a.name,a)}else c.Z.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder").error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map(a=>null!=a.arraySize?`uniform ${a.type} ${a.name}[${a.arraySize}];`:`uniform ${a.type} ${a.name};`)}get entries(){return Array.from(this._entries.values())}}class U{constructor(){this._entries=new Array}add(a){this._entries.push(a)}generateSource(){return this._entries}}class x extends S{constructor(){super(...arguments),this.uniforms=new F,this.code=new U,this.constants=new v}get builder(){return this}}class m{constructor(){this._entries=new Array}add(a,d){this._entries.push([a,d])}generateSource(a){return"fragment"===a?[]:this._entries.map(d=>`in ${d[1]} ${d[0]};`)}}class b{constructor(){this._entries=new Map}add(a,d){this._entries.has(a)&&(0,M.hu)(this._entries.get(a)===d),this._entries.set(a,d)}generateSource(a){const d=new Array;return this._entries.forEach((E,w)=>d.push("vertex"===a?`out ${E} ${w};`:`in ${E} ${w};`)),d}}class f{constructor(){this._entries=new Set}add(a){this._entries.add(a)}generateSource(a){const d="vertex"===a?f.ALLOWLIST_VERTEX:f.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(E=>d.includes(E)).map(E=>`#extension ${E} : enable`)}}f.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],f.ALLOWLIST_VERTEX=[];class v{constructor(){this._entries=new Set}add(a,d,E){let w="ERROR_CONSTRUCTOR_STRING";switch(d){case"float":w=v._numberToFloatStr(E);break;case"int":w=v._numberToIntStr(E);break;case"bool":w=E.toString();break;case"vec2":w=`vec2(${v._numberToFloatStr(E[0])},                            ${v._numberToFloatStr(E[1])})`;break;case"vec3":w=`vec3(${v._numberToFloatStr(E[0])},                            ${v._numberToFloatStr(E[1])},                            ${v._numberToFloatStr(E[2])})`;break;case"vec4":w=`vec4(${v._numberToFloatStr(E[0])},                            ${v._numberToFloatStr(E[1])},                            ${v._numberToFloatStr(E[2])},                            ${v._numberToFloatStr(E[3])})`;break;case"ivec2":w=`ivec2(${v._numberToIntStr(E[0])},                             ${v._numberToIntStr(E[1])})`;break;case"ivec3":w=`ivec3(${v._numberToIntStr(E[0])},                             ${v._numberToIntStr(E[1])},                             ${v._numberToIntStr(E[2])})`;break;case"ivec4":w=`ivec4(${v._numberToIntStr(E[0])},                             ${v._numberToIntStr(E[1])},                             ${v._numberToIntStr(E[2])},                             ${v._numberToIntStr(E[3])})`;break;case"mat2":case"mat3":case"mat4":w=`${d}(${Array.prototype.map.call(E,C=>v._numberToFloatStr(C)).join(", ")})`}return this._entries.add(`const ${d} ${a} = ${w};`),this}static _numberToIntStr(a){return a.toFixed(0)}static _numberToFloatStr(a){return Number.isInteger(a)?a.toFixed(1):a.toString()}generateSource(){return Array.from(this._entries)}}const I="precision highp float;\nprecision highp sampler2D;";var A=p(49598);function P(H,a,d){const E=a.split("\n");for(const w of E)if(w.trim().length){{let C="";null!=d&&(C+=`/*id:${d??"000"}*/   `),H.body+=C.padEnd(14)}H.body+=" ".repeat(H.indent)+w+"\n"}}class T{write(a){for(const d of a.rootOutputNodes())a.shouldPruneOutputNode(d)||(d.variableName=this._write(a,d.node));return a}_createVarName(a,d){let E="";return"boolean"!=typeof d&&"number"!=typeof d&&d.debugInfo.name&&(E=`${d.debugInfo.name}_`),`${E}v${a.varCount++}`}_write(a,d,E=!1){if("number"==typeof d||"boolean"==typeof d)return d.toString();let w=a.getEmit(d);if(w)return w;switch(d.shaderType){case"scope-node":w=this._writeScopeNode(a,d);break;case"primitive-node":w=this._writePrimitiveNode(a,d,E);break;case"function-node":w=this._writeFunctionNode(a,d);break;case"property-access-node":w=this._writePropertyAccessNode(a,d);break;case"text-node":w=d.text;break;case"block-node":w=this._writeBlockNode(a,d);break;case"condition-node":w=this._writeConditionNode(a,d)}return a.setEmit(d,w),w}_writeScopeNode(a,d){const E=new d.child.constructor;E.setDebugName(d.debugInfo.name);const w=this._write(a,E,!0);return P(a,`{ /*ScopeStart: ${d.uid} ${d.debugInfo.name}*/`),a.indent+=2,P(a,`${w} = ${this._write(a,d.child)};`),a.indent-=2,P(a,`} /*ScopeEnd: ${d.uid} ${d.debugInfo.name}*/`),w}_writeConditionNode(a,d){const E=new d.ifTrue.constructor,w=this._write(a,E,!0);P(a,`if (${this._write(a,d.condition)}) {`),a.indent+=2;const C=a.createSubgraphContext(),j=this._write(C,d.ifTrue);if(a.body+=C.body,j&&P(a,`${w} = ${j};`),a.indent-=2,P(a,"}"),d.ifFalse){P(a,"else {"),a.indent+=2;const G=a.createSubgraphContext(),Y=this._write(G,d.ifFalse);a.body+=G.body,Y&&P(a,`${w} = ${Y};`),a.indent-=2,P(a,"}")}return w}_writeBlockNode(a,d){const{captureList:E,generator:w,returnType:C}=d,j={};for(const q in E){if(!E[q])continue;const ct=this._write(a,E[q]);j[q]=ct}const G=new C,Y=this._write(a,G,!0);if(j.out=Y,d.subgraph){const q=a.createSubgraphContext(),ct=this._write(q,d.subgraph.child);j.subgraph={varName:ct,body:q.body}}const Z=w(j);return P(a,"{\n"),a.indent+=2,P(a,Z),a.indent-=2,P(a,"}\n"),Y}_writePropertyAccessNode(a,d){const E=this._write(a,d.target);return"string"==typeof d.property&&d.property.includes("[")?`${E}${d.property}`:"string"!=typeof d.property?`${E}[${this._write(a,d.property)}]`:`${E}.${d.property}`}_writeFunctionNode(a,d){const E=d.returnType.type;if(d.isInfix){const[j,G]=d.children.map(Z=>this._write(a,Z)),Y=this._createVarName(a,d);return P(a,`${E.padEnd(5)} ${Y} = ${j} ${d.token} ${G};`,d.uid),Y}const w=d.children.map(j=>this._write(a,j)).join(", "),C=this._createVarName(a,d);return P(a,`${E.padEnd(5)} ${C} = ${d.token}(${w});`,d.uid),C}_writePrimitiveNode(a,d,E=!1){const w=a.getInput(d);if(w)return w.isUsed=!0,w.variableName;if(d.isImplicit||1===d.children.length&&d.children[0]?.type===d.type)return this._write(a,d.children[0]);const j=this._createVarName(a,d);if(E)return P(a,`${d.type.padEnd(5)} ${j};`,d.uid),j;const G=!d.debugInfo.name&&!d.isMutable;if(G&&"float"===d.type&&"number"==typeof d.children[0])return Number.isInteger(d.children[0])?d.children[0].toFixed(1):d.children[0].toString();if(G&&"int"===d.type&&"number"==typeof d.children[0]&&Number.isInteger(d.children[0]))return d.children[0].toString();const Y=d.children.map(Z=>this._write(a,Z)).join(", ");return"array"===d.type?(P(a,`${d.type.padEnd(5)} ${j} = [${Y}];`,d.uid),j):G?`${d.type}(${Y})`:(P(a,`${d.type.padEnd(5)} ${j} = ${d.type}(${Y});`,d.uid),j)}}var D=p(98151);class V{constructor(a,d,E){this.variableName=a,this.variableInputType=d,this.node=E,this.type="shader-input",this.isUsed=!1}clone(){return new V(this.variableName,this.variableInputType,(0,D.UV)(this.node))}}class Q{constructor(a,d,E){this.outVariableName=a,this.outVariableType=d,this.node=E,this.type="shader-output"}clone(){const a=new Q(this.outVariableName,this.outVariableType,(0,D.UV)(this.node));return a.variableName=this.variableName,a}}class X{static createVertex(a,d,E,w,C,j){const G=[];for(const Z in a){const q=a[Z],ct=E.get(Z);G.push(ct?new V(ct,"builtin",q):new V("a_"+Z,"attribute",q))}for(const Z of w)G.push(new V(Z.uniformName,"uniform",Z.uniformHydrated));const Y=[];for(const Z in d){const q=d[Z];Y.push("glPosition"===Z?new Q("gl_Position","builtin",q):"glPointSize"===Z?new Q("gl_PointSize","builtin",q):new Q("v_"+Z,"varying",q))}return new X(G,Y,C,j)}static createFragment(a,d,E,w,C,j){const G=[],Y=Array.from(C.rootOutputNodes());for(const q in a){const ct=a[q],gt=E.get(q);if(gt){G.push(new V(gt,"builtin",ct));continue}const Dt=Y.find(Vt=>Vt.node===ct);Dt&&G.push(new V(Dt.outVariableName,Dt.outVariableType,ct))}for(const q of w)G.push(new V(q.uniformName,"uniform",q.uniformHydrated));const Z=[];for(const q in d){const ct=d[q],gt=E.get(q);if("discard"===q)Z.push(new Q(null,"discard",ct));else{if(!gt)throw new Error(`Member ${q} in shader fragment output shoule be tagged as builtin`);Z.push(new Q(gt,"builtin",ct))}}return new X(G,Z,j)}constructor(a,d,E,w){this.type="shader-graph-context",this.indent=0,this.body="",this.varCount=0,this._inputShaderTypesByNodeUid=new Map,this._nodeEmitMap=new Map;for(const C of a)this._inputShaderTypesByNodeUid.set(C.node.uid,C);this._outputShaderTypes=d,this._transformFeedbackBindings=E,this._transformFeedbackNames=new Set(E.map(C=>"v_"+C.propertyKey)),this._usedInFragmentShader=w}shouldPruneOutputNode(a){return!!this._usedInFragmentShader&&"builtin"!==a.outVariableType&&!this._transformFeedbackNames.has(a.outVariableName)&&!this._usedInFragmentShader.has(a.node.uid)}setEmit(a,d){this._nodeEmitMap.set(a.uid,d)}getEmit(a){return this._nodeEmitMap.get(a.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(a){return this._inputShaderTypesByNodeUid.get(a.uid)}*rootOutputNodes(){for(const a of this._outputShaderTypes)yield a}*nodes(){const a=[];for(const d of this._outputShaderTypes.values())a.push(d.node);for(;a.length;){const d=a.pop();"number"!=typeof d&&"boolean"!=typeof d&&a.push(...d.children.filter(Boolean)),yield d}}*nodesOfTypeOrFunction(){for(const a of this.nodes())"number"!=typeof a&&"boolean"!=typeof a&&(yield a)}createSubgraphContext(){const a=this.clone();return a.body="",a.indent=this.indent+2,a._nodeEmitMap=new Map(this._nodeEmitMap),a}clone(){const a=new X([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);return a._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid,a.indent=this.indent,a.body=this.body,a.varCount=this.varCount,a._nodeEmitMap=this._nodeEmitMap,a}insertVertexShader(a){a.vertex.code.add(""),this._insertInputs(a,"vertex"),a.vertex.code.add(""),a.vertex.code.add("// OUTPUTS: "),a.vertex.code.add("// --------------------------------------------------------- ");for(const d of this.rootOutputNodes()){const E="builtin"===d.outVariableType;this.shouldPruneOutputNode(d)||a.vertex.code.add(E?`// ${d.outVariableType.padEnd(7)} ${d.node.type.padEnd(9)} ${d.outVariableName};`:`${d.outVariableType.padEnd(10)} ${d.node.type.padEnd(9)} ${d.outVariableName};`)}a.vertex.code.add(""),a.vertex.code.add("void main() {"),a.vertex.code.add("  "+this.body.split("\n").join("\n  "));for(const d of this.rootOutputNodes())this.shouldPruneOutputNode(d)||a.vertex.code.add(`  ${d.outVariableName} = ${d.variableName};`);a.vertex.code.add("}")}insertFragmentShader(a){this._insertInputs(a,"fragment"),a.fragment.code.add(""),a.fragment.code.add("void main() {"),a.fragment.code.add("  "+this.body.split("\n").join("\n  "));for(const d of this.rootOutputNodes())"discard"===d.outVariableType?(a.fragment.code.add("  // TODO: Should ensure codegen for discard appears first in fragment shader"),a.fragment.code.add(`  if (${d.variableName}) {`),a.fragment.code.add("    discard;"),a.fragment.code.add("  }"),a.fragment.code.add("  ")):a.fragment.code.add(`  ${d.outVariableName} = ${d.variableName};`);a.fragment.code.add("}")}_insertInputs(a,d){a[d].code.add("// INPUTS: "),a[d].code.add("// --------------------------------------------------------- ");for(const E of this.inputs())E.isUsed&&"builtin"!==E.variableInputType&&a[d].code.add("array"===E.node.type?`${E.variableInputType.padEnd(10)} ${E.node.elementType.type.padEnd(9)} ${E.variableName}[${E.node.size}];`:`${E.variableInputType.padEnd(10)} ${E.node.type.padEnd(9)} ${E.variableName};`)}}var nt=p(78619);function rt(H){return new H}function it(H,a,d){const E=H.constructor[a]??[];H.constructor.hasOwnProperty(a)||Object.defineProperty(H.constructor,a,{value:E.slice()}),H.constructor[a].push(d)}function J(H,a){return(d,E)=>{it(d,"locations",{typeCtor:a,propertyKey:E,parameterIndex:null,index:H})}}const _t=H=>(a,d,E)=>{it(a,"inputs",{inputCtor:H,propertyKey:d,parameterIndex:E})},at=H=>(a,d)=>{it(a,"uniforms",{typeCtor:H,propertyKey:d})},ht=H=>(a,d)=>{it(a,"options",{typeCtor:H,propertyKey:d})},lt=(H,a)=>{it(H,"defines",{propertyKey:a})},xt=(H,a)=>(d,E)=>{d.constructor.builtins.push({builtin:H,propertyKey:E,typeCtor:a})};class pt{}pt.builtins=[],(0,h._)([xt("gl_VertexID",A.J7)],pt.prototype,"glVertexID",void 0);class Ot{}class mt{}mt.builtins=[],(0,h._)([xt("gl_FragCoord",A.T8)],mt.prototype,"glFragCoord",void 0),(0,h._)([xt("gl_PointCoord",A.Sg)],mt.prototype,"glPointCoord",void 0);class st{}(0,h._)([("gl_FragColor",(a,d)=>{it(a,"builtins",{builtin:"gl_FragColor",propertyKey:d})})],st.prototype,"glFragColor",void 0);class It{constructor(){this.type="uniform-group"}get _uniforms(){return this.constructor.uniforms??[]}}class Mt{constructor(){this.logShader=!1,this.computeAttributes={}}get vertexInput(){const a=this._shaderModuleClass.inputs.findLast(d=>"vertex"===d.propertyKey&&0===d.parameterIndex);if(!a)throw new Error("Unable to find vertex input parameter");return a}get computeInput(){return this._shaderModuleClass.inputs.findLast(a=>"vertex"===a.propertyKey&&1===a.parameterIndex)}get fragmentInput(){const a=this._shaderModuleClass.inputs.findLast(d=>"fragment"===d.propertyKey);if(!a)throw new Error("Unable to find fragment input parameter");return a}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){return[...this.vertexInput.inputCtor.locations,...this.computeInput?.inputCtor.locations??[]]}get locationsMap(){const a=new Map,d=new Set;for(const E of this.locations)d.has(E.index)?c.Z.getLogger("esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule").warnOnce("mapview-rendering",`Unable to assigned attribute ${E.propertyKey} to ${E.index}. Index already in use`,{locationsMap:a}):(a.set(E.propertyKey,E.index),d.add(E.index));return a}get locationInfo(){if(!this._locationInfo){const a=this.locationsMap,d=Array.from(a.entries()).map(([C,j])=>`${C}.${j}`).join("."),E=(0,g.hP)(d);this._locationInfo={hash:E,locations:a,computeAttributeMap:this.computeAttributes}}return this._locationInfo}get renamedLocationsMap(){const a=new Map;for(const d of this.locations)a.set("a_"+d.propertyKey,d.index);return a}get optionPropertyKeys(){if(!this._optionPropertyKeys){const a=new Set;for(const d of this._options)a.add(d.propertyKey);this._optionPropertyKeys=a}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(a,d,E,w){try{const{vertex:C,fragment:j,uniformBindings:G}=this._generateShaders(a,d,E,w);return new nt.X(C,j,this.renamedLocationsMap,this.locationInfo,G,this.transformFeedbackBindings)}catch{return new nt.X("","",this.renamedLocationsMap,this.locationInfo,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(a){const d=this._options.find(w=>w.propertyKey===a);if(d)return{type:"option",className:d.typeCtor};const E=this._uniforms.find(w=>w.propertyKey===a);if(!E)throw new Error(`Unable to find uniform class type for property: ${a}`);return{type:"required",className:E.typeCtor}}getShaderKey(a,d,E,w){const C=Object.keys(a).map(Z=>`${Z}.${a[Z]}`).join("."),j=Object.keys(E).map(Z=>`${Z}.${E[Z]}`).join("."),G=Object.keys(w).map(Z=>`${Z}.${w[Z]}`).join("."),Y=Object.keys(d).filter(Z=>this.optionPropertyKeys.has(Z)&&d[Z]).join(".");return`${this.constructor.name}.${C}.${j}.${G}.${Y}`}_generateShaders(a,d,E,w){const C=[];this._setDefines(E),this._setOptionalUniforms(C,d),this._setRequiredUniforms(C);const j=this._hydrateVertexInput(w),G=this._injectPackPrecisionFactor(j,a),Y=this._hydrateComputeInput(),Z=Y&&this._injectComputePackPrecisionFactor(Y,a),q=this.vertex(G,Z),ct=this._hydrateFragmentInput(q),gt=this.fragment(ct),Dt=new Set;for(const Kt in gt)(0,D.Q0)(Dt,gt[Kt]);const Vt=this._getVertexInputBuiltins(),ft=X.createVertex({...j,...Y},q,Vt,C,this.transformFeedbackBindings,Dt);(new T).write(ft);const dt=this._getFragmentInputBuiltins(gt);dt.set("glPointCoord","gl_PointCoord");const N=X.createFragment(ct,gt,dt,C,ft,this.transformFeedbackBindings);(new T).write(N);const ut=this._createShaderBuilder(ft,N),Pt=ut.generate("vertex",!1),St=ut.generate("fragment",!1);return this.logShader&&(console.log(Pt),console.log(St)),{vertex:Pt,fragment:St,uniformBindings:C}}_setDefines(a){for(const d in a)this[d]=a[d]}_setOptionalUniforms(a,d){for(const E of this._options)this[E.propertyKey]=d[E.propertyKey]?this._hydrateUniformGroup(a,E):null}_setRequiredUniforms(a){for(const d of this._uniforms)this[d.propertyKey]=this._hydrateUniformGroup(a,d)}_hydrateUniformGroup(a,d){const E=new d.typeCtor;for(const w of E._uniforms??[]){const C=rt(w.typeCtor),j=`u_${d.propertyKey}_${w.propertyKey}`,G=C.type,Y=[d.propertyKey,w.propertyKey].join(".");a.push("type"in w.typeCtor&&"array"===w.typeCtor.type?{shaderModulePath:Y,uniformName:j,uniformType:G,uniformArrayLength:C.size,uniformArrayElementType:C.elementType.type,uniformHydrated:C}:{shaderModulePath:Y,uniformName:j,uniformType:G,uniformHydrated:C}),E[w.propertyKey]=C}return E}_hydrateVertexInput(a){const d=this.vertexInput.inputCtor,E=d.locations.reduce((w,C)=>!1===a[C.propertyKey]?w:{...w,[C.propertyKey]:rt(C.typeCtor)},{});for(const{propertyKey:w,typeCtor:C}of d.builtins){const j=rt(C);E[w]=j}return E}_hydrateComputeInput(){return null==this.computeInput?null:this.computeInput.inputCtor.locations.reduce((a,d)=>({...a,[d.propertyKey]:rt(d.typeCtor)}),{})}_injectPackPrecisionFactor(a,d){const E={};for(const w in a){const C=a[w],j=d[w];if(j){if("float"!==C.type&&"vec2"!==C.type&&"vec3"!==C.type&&"vec4"!==C.type)throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${C.type}`);E[w]=C.divide(new A.bv(j))}else E[w]=C}return E}_injectComputePackPrecisionFactor(a,d){const E={},w=new Map;for(const C in this.computeAttributes)for(const j of this.computeAttributes[C]??[])w.set(j,C);for(const C in a){const j=a[C],G=w.get(C);if(!G)continue;const Y=d[G];if(Y){if("float"!==j.type&&"vec2"!==j.type&&"vec3"!==j.type&&"vec4"!==j.type)throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${j.type}`);E[C]=j.divide(new A.bv(Y))}else E[C]=j}return E}_hydrateFragmentInput(a){const d={};for(const E in a)d[E]=a[E];for(const{propertyKey:E,typeCtor:w}of mt.builtins){const C=rt(w);d[E]=C}return d}_getVertexInputBuiltins(){const a=this.vertexInput.inputCtor,d=new Map;for(const{builtin:E,propertyKey:w}of a.builtins)d.set(w,E);return d}_getFragmentInputBuiltins(a){const d=a.constructor,E=new Map;for(const w of d.builtins??[])E.set(w.propertyKey,w.builtin);return E}_createShaderBuilder(a,d){const E=new B;return this._insertDebugInfo(E),a.insertVertexShader(E),d.insertFragmentShader(E),E}_insertDebugInfo(a){a.vertex.code.add("// DEFINES: "),a.vertex.code.add("// --------------------------------------------------------- ");for(const d of this._defines)a.vertex.code.add(this[d.propertyKey]?`//   ${d.propertyKey}: true`:`//   ${d.propertyKey}: false`);a.vertex.code.add(""),a.vertex.code.add("// OPTIONS: "),a.vertex.code.add("// --------------------------------------------------------- ");for(const d of this._options)a.vertex.code.add(this[d.propertyKey]?`//   ${d.propertyKey}: true`:`//   ${d.propertyKey}: false`)}}},98151:(tt,z,p)=>{function o(U,x){const m=[];for(m.push(x);m.length;){const b=m.pop();if("object"==typeof b&&!U.has(b.uid)){U.add(b.uid);for(const f of b.children)m.push(f)}}}p.d(z,{Q0:()=>o,UV:()=>g,Yo:()=>S,Ys:()=>F,h9:()=>$,lJ:()=>B,rK:()=>L});class c{constructor(){this.uid=c.NodeCount++,this._debugName=null,this._isMutable=!1,this.isImplicit=!1}get isMutable(){return this._isMutable}setMutable(){return this._isMutable=!0,this}setDebugName(x){return x=function h(U){return U.split(" ").map((x,m)=>m>0?x.charAt(0).toUpperCase()+x.slice(1):x).join("")}(x),this._debugName=x,this.isImplicit&&this.children[0]instanceof c&&this.children[0].setDebugName(x),this}get debugInfo(){return{name:this._debugName??""}}cloneInto(x){x._debugName=this._debugName,x._isMutable=this._isMutable,x.isImplicit=this.isImplicit,x.uid=this.uid}}function g(U){return"object"==typeof U?U.clone():U}c.NodeCount=0;class $ extends c{constructor(){super(...arguments),this.shaderType="primitive-node"}}class W extends c{constructor(x){super(),this.child=x,this.shaderType="scope-node"}get children(){return[this.child]}clone(){const x=new W(g(this.child));return this.cloneInto(x),x}}class L extends c{constructor(x,m,b){super(),this.property=x,this.target=m,this.returnType=b,this.shaderType="property-access-node"}get children(){const x=[this.target];return"string"!=typeof this.property&&x.push(this.property),x}clone(){const x=new L(this.property,g(this.target),this.returnType);return this.cloneInto(x),x}}class S extends c{constructor(x,m,b){super(),this.condition=x,this.ifTrue=m,this.ifFalse=b,this.shaderType="condition-node"}get children(){return[this.condition,this.ifTrue,this.ifFalse]}clone(){const x=g(this.ifTrue),m=this.ifFalse?g(this.ifFalse):null,b=new S(this.condition,x,m);return this.cloneInto(b),b}}class B extends c{constructor(x,m,b,f){super(),this.captureList=x,this.returnType=m,this.generator=f,this.shaderType="block-node",b&&(this.subgraph=new W(b))}get children(){return Object.keys(this.captureList).map(x=>this.captureList[x]).concat(this.subgraph??[])}clone(){const x={};for(const b in this.captureList)x[b]=g(this.captureList[b]);const m=new B(x,this.returnType,this.subgraph?g(this.subgraph.child):this.subgraph,this.generator);return this.cloneInto(m),m}}class F extends c{constructor(x,m,b,f,v,O=!1){super(),this.token=x,this._children=m,this.isInfix=b,this.isPropertyAccess=f,this.returnType=v,this.isTernary=O,this.shaderType="function-node"}get children(){return this._children}clone(){const x=new F(this.token,this._children.map(g),this.isInfix,this.isPropertyAccess,this.returnType,this.isTernary);return this.cloneInto(x),x}}},49598:(tt,z,p)=>{p.d(z,{AK:()=>ae,AO:()=>_t,CD:()=>pe,CW:()=>ve,Dg:()=>kt,Eg:()=>it,Fp:()=>de,Fv:()=>fe,GW:()=>ue,Iz:()=>Xt,J7:()=>Mt,K4:()=>Z,KJ:()=>jt,Nb:()=>me,O$:()=>Nt,Qj:()=>Qt,R3:()=>q,Sg:()=>ot,T8:()=>at,TE:()=>oe,Tu:()=>w,VV:()=>he,Wn:()=>re,ZI:()=>le,bv:()=>J,e$:()=>G,ff:()=>ye,fz:()=>Y,hx:()=>Jt,ig:()=>ge,kE:()=>ce,ln:()=>Yt,mC:()=>zt,mD:()=>se,or:()=>Wt,r7:()=>te,tS:()=>qt,tW:()=>pt,tk:()=>St,uZ:()=>ie,v8:()=>rt,vh:()=>ct,wO:()=>Dt,wQ:()=>_e,wV:()=>Zt,xD:()=>Ft,yb:()=>C});var c,g,$,W,M,L,S,B,F,U,x,m,b,f,h=p(50484),o=p(98151);function D(s){return new Proxy(s,{get(_,y){if("constructor"===y)return new Proxy(_.constructor,{construct:(K,k,et)=>D(new K(...k))});if(y in _)return _[y];if("string"==typeof y){const K=function T(s){const _=[["float","vec2","vec3","vec4"],["int","ivec2","ivec3","ivec4"],["uint","uvec2","uvec3","uvec4"],["bool","bvec2","bvec3","bvec4"]];for(const y of _)if(y.includes(s))return y.map(K=>j[K]);throw new Error("Unable to find type family")}(s.type);return ft(s,y,K[y.length-1])}}})}function V(s){return new Proxy(s,{construct:(_,y,K)=>D(new _(...y))})}class nt extends Error{}let rt=c=class extends o.h9{constructor(s,_){super(),this.elementType=s,this.size=_,this.children=[],this.type="array"}clone(){const s=new c(this.elementType,this.size);return super.cloneInto(s),s}get(s){if("number"==typeof s){const _=new Mt(s);return _.isImplicit=!0,ft(this,_,this.elementType.constructor)}return ft(this,s,this.elementType.constructor)}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(s,_,y){return function Ht(s,_,y=0,K=s.size){const k=new Mt(y).setMutable().setDebugName("FindIndexIterator"),et=_(s.get(k)).setDebugName("FindIndexPredicate");return Kt({iter:k},Mt,et,({out:Et,iter:vt,subgraph:Ut})=>`\n${Et} = -1;\n\nfor (; ${vt} < ${K}; ${vt}++) {\n\n${Ut.body}\n\n  if (${Ut.varName}) {\n    ${Et} = ${vt};\n    break;\n  }\n\n}\n`).setDebugName("FindIndexBlock")}(this,s,_,y)}glslFindIndex(s,_,y){return function Gt(s,_,y=0,K=s.size){return Kt({array:s},Mt,null,({out:et,array:bt})=>`\n${et} = -1;\nfor (int i = ${y}; i < ${K}; i++) {\n  bool condition;\n  ${_({array:bt,i:"i",out:"condition"})}\n  if (condition) {\n    ${et} = i;\n    break;\n  }\n}\n`).setDebugName("GlslFindIndexBlock")}(this,s,_,y)}static ofType(s,_){const y={construct:(K,k)=>new c(new s,_)};return new Proxy(c,y)}};rt.type="array",rt=c=(0,h._)([function X(s){return new Proxy(s,{construct:(_,y,K)=>function Q(s){return new Proxy(s,{get(_,y){if(y in _)return _[y];if("string"==typeof y){const K=parseInt(y,10);if(!isNaN(K))return ft(s,`[${K}]`,s.elementType.constructor)}}})}(new _(...y))})}],rt);let it=(()=>{class s extends o.h9{constructor(){super(...arguments),this.type="sampler2D",this.children=[]}clone(){const y=new s;return y.children=this.children.map(o.UV),super.cloneInto(y),y}}return s.type="sampler2D",s})(),J=(()=>{class s extends o.h9{constructor(y){super(),this.type="float",this.children=[y]}clone(){const y=new s((0,o.UV)(this.children[0]));return super.cloneInto(y),y}multiply(y){return wt(this,"number"==typeof y?st(y,s):y)}divide(y){return Ct(this,"number"==typeof y?st(y,s):y)}add(y){return Tt(this,"number"==typeof y?st(y,s):y)}subtract(y){return At(this,"number"==typeof y?st(y,s):y)}}return s.type="float",s})(),ot=g=class extends o.h9{constructor(s,_){super(),this.type="vec2",this.children=[s,_].filter(y=>null!=y)}clone(){const s=new g((0,o.UV)(this.children[0]),(0,o.UV)(this.children[1]));return super.cloneInto(s),s}get 0(){return ft(this,"[0]",J)}get 1(){return ft(this,"[1]",J)}get 2(){throw new nt}get 3(){throw new nt}multiply(s){return wt(this,"number"==typeof s?st(s,J):s)}divide(s){return Ct(this,"number"==typeof s?st(s,J):s)}add(s){return Tt(this,"number"==typeof s?st(s,J):s)}subtract(s){return At(this,"number"==typeof s?st(s,J):s)}};ot.type="vec2",ot=g=(0,h._)([V],ot);let _t=$=class extends o.h9{constructor(s,_,y){super(),this.type="vec3",this.children=[s,_,y].filter(K=>null!=K)}get 0(){return ft(this,"[0]",J)}get 1(){return ft(this,"[1]",J)}get 2(){return ft(this,"[2]",J)}get 3(){throw new nt}clone(){const s=new $((0,o.UV)(this.children[0]),(0,o.UV)(this.children[1]),(0,o.UV)(this.children[2]));return super.cloneInto(s),s}multiply(s){return wt(this,"number"==typeof s?st(s,J):s)}divide(s){return Ct(this,"number"==typeof s?st(s,J):s)}add(s){return Tt(this,"number"==typeof s?st(s,J):s)}subtract(s){return At(this,"number"==typeof s?st(s,J):s)}};_t.type="vec3",_t=$=(0,h._)([V],_t);let at=W=class extends o.h9{constructor(s,_,y,K){super(),this.type="vec4",this.children=[s,_,y,K].filter(k=>null!=k)}clone(){const s=new W((0,o.UV)(this.children[0]),(0,o.UV)(this.children[1]),(0,o.UV)(this.children[2]),(0,o.UV)(this.children[3]));return super.cloneInto(s),s}get 0(){return ft(this,"[0]",J)}get 1(){return ft(this,"[1]",J)}get 2(){return ft(this,"[2]",J)}get 3(){return ft(this,"[3]",J)}multiply(s){return wt(this,"number"==typeof s?st(s,J):s)}divide(s){return Ct(this,"number"==typeof s?st(s,J):s)}add(s){return Tt(this,"number"==typeof s?st(s,J):s)}subtract(s){return At(this,"number"==typeof s?st(s,J):s)}};at.type="vec4",at=W=(0,h._)([V],at);let ht=M=class extends o.h9{constructor(s){super(),this.type="uint",this.children=[s]}clone(){const s=new M((0,o.UV)(this.children[0]));return super.cloneInto(s),s}};ht.type="uint",ht=M=(0,h._)([V],ht);let lt=L=class extends o.h9{constructor(s,_){super(),this.type="uvec2",this.children=[s,_].filter(y=>null!=y)}clone(){const s=new L((0,o.UV)(this.children[0]),(0,o.UV)(this.children[1]));return super.cloneInto(s),s}};lt.type="uvec2",lt=L=(0,h._)([V],lt);let yt=S=class extends o.h9{constructor(s,_,y){super(),this.type="uvec3",this.children=[s,_,y].filter(K=>null!=K)}clone(){const s=new S((0,o.UV)(this.children[0]),(0,o.UV)(this.children[1]),(0,o.UV)(this.children[2]));return super.cloneInto(s),s}};yt.type="uvec3",yt=S=(0,h._)([V],yt);let xt=B=class extends o.h9{constructor(s,_,y,K){super(),this.type="uvec4",this.children=[s,_,y,K].filter(k=>null!=k)}clone(){const s=new B((0,o.UV)(this.children[0]),(0,o.UV)(this.children[1]),(0,o.UV)(this.children[2]),(0,o.UV)(this.children[3]));return super.cloneInto(s),s}};xt.type="uvec4",xt=B=(0,h._)([V],xt);let pt=(()=>{class s extends o.h9{constructor(y){super(),this.type="bool",this.children=[y]}and(y){return Ft(this,y)}or(y){return Wt(this,y)}clone(){const y=new s((0,o.UV)(this.children[0]));return super.cloneInto(y),y}}return s.type="bool",s})(),Ot=F=class extends o.h9{constructor(s,_){super(),this.type="bvec2",this.children=[s,_].filter(y=>null!=y)}all(){return Rt(this)}any(){return Lt(this)}clone(){const s=new F((0,o.UV)(this.children[0]),(0,o.UV)(this.children[1]));return super.cloneInto(s),s}};Ot.type="bvec2",Ot=F=(0,h._)([V],Ot);let mt=U=class extends o.h9{constructor(s,_,y){super(),this.type="bvec3",this.children=[s,_,y].filter(K=>null!=K)}all(){return Rt(this)}any(){return Lt(this)}clone(){const s=new U((0,o.UV)(this.children[0]),(0,o.UV)(this.children[1]),(0,o.UV)(this.children[2]));return super.cloneInto(s),s}};function st(s,_){return"number"==typeof s?new _(s):s}mt.type="bvec3",mt=U=(0,h._)([V],mt);let It=x=class extends o.h9{constructor(s,_,y,K){super(),this.type="bvec4",this.children=[s,_,y,K].filter(k=>null!=k)}all(){return Rt(this)}any(){return Lt(this)}clone(){const s=new x((0,o.UV)(this.children[0]),(0,o.UV)(this.children[1]),(0,o.UV)(this.children[2]),(0,o.UV)(this.children[3]));return super.cloneInto(s),s}};It.type="bvec4",It=x=(0,h._)([V],It);let Mt=(()=>{class s extends o.h9{constructor(y){super(),this.type="int",this.children=[y]}multiply(y){return wt(this,st(y,s))}add(y){return Tt(this,st(y,s))}subtract(y){return At(this,st(y,s))}divide(y){return Ct(this,st(y,s))}clone(){const y=new s((0,o.UV)(this.children[0]));return super.cloneInto(y),y}}return s.type="int",s})(),H=m=class extends o.h9{constructor(s,_){super(),this.type="ivec2",this.children=[s,_].filter(y=>null!=y)}clone(){const s=new m((0,o.UV)(this.children[0]),(0,o.UV)(this.children[1]));return super.cloneInto(s),s}};H.type="ivec2",H=m=(0,h._)([V],H);let a=b=class extends o.h9{constructor(s,_,y){super(),this.type="ivec3",this.children=[s,_,y].filter(K=>null!=K)}clone(){const s=new b((0,o.UV)(this.children[0]),(0,o.UV)(this.children[1]),(0,o.UV)(this.children[2]));return super.cloneInto(s),s}};a.type="ivec3",a=b=(0,h._)([V],a);let d=f=class extends o.h9{constructor(s,_,y,K){super(),this.type="ivec4",this.children=[s,_,y,K].filter(k=>null!=k)}clone(){const s=new f((0,o.UV)(this.children[0]),(0,o.UV)(this.children[1]),(0,o.UV)(this.children[2]),(0,o.UV)(this.children[3]));return super.cloneInto(s),s}};d.type="ivec4",d=f=(0,h._)([V],d);let w=(()=>{class s extends o.h9{static identity(){return new s(1,0,0,0,1,0,0,0,1)}static fromRotation(y){const K=Nt(y),k=zt(y);return new s(k,K,0,St(K),k,0,0,0,1)}constructor(y,K,k,et,bt,Et,vt,Ut,Bt){super(),this.type="mat3",this.children=[y,K,k,et,bt,Et,vt,Ut,Bt]}add(y){return Tt(this,y)}multiply(y){return wt(this,y)}clone(){const y=new s((0,o.UV)(this.children[0]),(0,o.UV)(this.children[1]),(0,o.UV)(this.children[2]),(0,o.UV)(this.children[3]),(0,o.UV)(this.children[4]),(0,o.UV)(this.children[5]),(0,o.UV)(this.children[6]),(0,o.UV)(this.children[7]),(0,o.UV)(this.children[8]));return super.cloneInto(y),y}}return s.type="mat3",s})(),C=(()=>{class s extends o.h9{static identity(){return new s(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}constructor(y,K,k,et,bt,Et,vt,Ut,Bt,Ee,be,xe,Oe,Me,De,Pe){super(),this.type="mat4",this.children=[y,K,k,et,bt,Et,vt,Ut,Bt,Ee,be,xe,Oe,Me,De,Pe]}static fromColumns(y,K,k,et){return new s(y.x,y.y,y.z,y.w,K.x,K.y,K.z,K.w,k.x,k.y,k.z,k.w,et.x,et.y,et.z,et.w)}multiply(y){return wt(this,y)}clone(){const y=new s((0,o.UV)(this.children[0]),(0,o.UV)(this.children[1]),(0,o.UV)(this.children[2]),(0,o.UV)(this.children[3]),(0,o.UV)(this.children[4]),(0,o.UV)(this.children[5]),(0,o.UV)(this.children[6]),(0,o.UV)(this.children[7]),(0,o.UV)(this.children[8]),(0,o.UV)(this.children[9]),(0,o.UV)(this.children[10]),(0,o.UV)(this.children[11]),(0,o.UV)(this.children[12]),(0,o.UV)(this.children[13]),(0,o.UV)(this.children[14]),(0,o.UV)(this.children[15]));return super.cloneInto(y),y}}return s.type="mat4",s})();const j={float:J,vec2:ot,vec3:_t,vec4:at,int:Mt,ivec2:H,ivec3:a,ivec4:d,uint:ht,uvec2:lt,uvec3:yt,uvec4:xt,bool:pt,bvec2:Ot,bvec3:mt,bvec4:It},G=(...s)=>new Mt(...s),Y=(...s)=>new J(...s),Z=(...s)=>new ot(...s),q=(...s)=>new _t(...s),ct=(...s)=>new at(...s),Dt=(...s)=>new w(...s);function ft(s,_,y){const K=new y(new o.rK(_,s,y));return K.isImplicit=!0,K}function dt(s,_,y,K=null){if(K){const et=new K,bt=new K(new o.Ys(s,[_,y],!0,!1,et));return bt.isImplicit=!0,bt}if("float"===_.type||"int"===_.type){const et=new y.constructor(new o.Ys(s,[_,y],!0,!1,y.constructor));return et.isImplicit=!0,et}if(("mat2"===_.type||"mat3"===_.type||"mat4"===_.type)&&"float"!==y.type){const et=new y.constructor(new o.Ys(s,[_,y],!0,!1,y.constructor));return et.isImplicit=!0,et}const k=new _.constructor(new o.Ys(s,[_,y],!0,!1,_.constructor));return k.isImplicit=!0,k}function N(s,_,y=_.constructor){const K=new y(new o.Ys(s,[_],!1,!1,y));return K.isImplicit=!0,K}function ut(s,_,y,K=_.constructor){const k=new K(new o.Ys(s,[_,y],!1,!1,K));return k.isImplicit=!0,k}function Pt(s,_,y,K,k=_.constructor){const et=new k(new o.Ys(s,[_,y,K],!1,!1,k));return et.isImplicit=!0,et}function St(s){return wt(s,Y(-1))}function Kt(s,_,y,K){return new _(new o.lJ(s,_,y,K))}function jt(s,_,y){const K="function"==typeof _?_():_,k="function"==typeof y?y():y,et=new K.constructor(new o.Yo(s,K,k));return et.isImplicit=!0,et}function Zt(...s){const _=s.map(([Et,vt])=>"function"==typeof vt?[Et,vt()]:[Et,vt]),y=_[0][1].constructor,K=_.findIndex(Et=>!0===Et[0]);if(-1===K)throw new Error("A cond must have a fallthrough case with `true`/; ");const bt=new y(_.slice(0,K).reduceRight((Et,vt)=>jt(vt[0],vt[1],Et),_[K][1]));return bt.isImplicit=!0,bt}function wt(s,_){return dt("*",s,_)}function Ct(s,_){return dt("/",s,_)}function Tt(s,_){return dt("+",s,_)}function At(s,_){return dt("-",s,_)}function kt(s,_){return dt(">>",s,_)}function Jt(s,_){return dt("&",s,_)}function Yt(s,_){return dt("==",s,_,pt)}function Qt(s,_){return dt("<",s,_,pt)}function Xt(s,_){return dt("<=",s,_,pt)}function qt(s,_){return dt(">",s,_,pt)}function te(s,_){return dt(">=",s,_,pt)}function Wt(...s){return s.length<=1?s[0]:s.slice(1).reduce((_,y)=>function ee(s,_){return dt("||",s,_,pt)}(_,y),s[0])}function Ft(...s){return s.length<=1?s[0]:s.slice(1).reduce((_,y)=>function ne(s,_){return dt("&&",s,_,pt)}(_,y),s[0])}function re(s){return N("abs",s)}function Rt(s){return N("all",s,pt)}function Lt(s){return N("any",s,pt)}function se(s){return N("ceil",s)}function ie(s,_,y){return Pt("clamp",s,_,y,s.constructor)}function zt(s){return N("cos",s)}function oe(s,_){return ut("distance",s,_,J)}function ae(s,_){return ut("dot",s,_,J)}function ue(s){return N("floor",s)}function le(s){return N("fract",s)}function ce(s){return N("length",s,J)}function de(s,_){return ut("max",s,_)}function he(s,_){return ut("min",s,_)}function pe(s,_,y){return Pt("mix",s,_,y)}function _e(s,_){return ut("mod",s,_)}function fe(s){return N("normalize",s)}function ye(s){return N("bool"===s.type?"!":"not",s)}function Nt(s){return N("sin",s)}function ve(s,_,y){return Pt("smoothstep",s,_,y)}function me(s,_){return ut("step",s,_,_.constructor)}function ge(s,_){return ut("texture2D",s,_,at)}},75399:(tt,z,p)=>{var h,o;p.d(z,{t:()=>h}),(o=h||(h={}))[o.Fill=0]="Fill",o[o.PatternFill=1]="PatternFill",o[o.ComplexFill=2]="ComplexFill",o[o.OutlineFill=3]="OutlineFill",o[o.PatternOutlineFill=4]="PatternOutlineFill",o[o.ComplexOutlineFill=5]="ComplexOutlineFill",o[o.Marker=6]="Marker",o[o.PieChart=7]="PieChart",o[o.Line=8]="Line",o[o.TexturedLine=9]="TexturedLine",o[o.Text=10]="Text",o[o.Label=11]="Label",o[o.Heatmap=12]="Heatmap",o[o.DotDensity=13]="DotDensity",o[o.Test=14]="Test"},76455:(tt,z,p)=>{p.d(z,{m:()=>h});const h={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4}}},29564:(tt,z,p)=>{p.d(z,{Ie:()=>m,RS:()=>U,fz:()=>x,HN:()=>F});var h=p(50484),o=p(5633),c=p(78607),g=p(49598),$=p(14007),W=p(73089);class M extends c.oo{getVisualVariableData(f){if(!this._vvData){const v=this.getAttributeDataCoords(f);this._vvData=(0,g.ig)(this.visualVariableData,v).setDebugName("storage2")}return this._vvData}getAttributeDataCoords(f){if(!this._uv){const v=(0,W.Wv)(f),O=this.size,I=(0,g.e$)(v.x),A=(0,g.e$)(v.y).multiply((0,g.e$)(256)),R=(0,g.e$)(v.z).multiply((0,g.e$)(256)).multiply((0,g.e$)(256)),P=(0,g.fz)(I.add(A).add(R)),T=(0,g.wQ)(P,O),D=P.subtract(T).divide(O);this._uv=new g.Sg(T,D).add(.5).divide(O)}return this._uv}getFilterData(f){const v=this.getAttributeDataCoords(f);return(0,g.ig)(this.filterFlags,v).setDebugName("storage0")}getAnimationData(f){const v=this.getAttributeDataCoords(f);return(0,g.ig)(this.animation,v).setDebugName("storage1")}getVVData(f){return this.getVisualVariableData(f)}getDataDrivenData0(f){const v=this.getAttributeDataCoords(f);return(0,g.ig)(this.dataDriven0,v).setDebugName("storage30")}getDataDrivenData1(f){const v=this.getAttributeDataCoords(f);return(0,g.ig)(this.dataDriven1,v).setDebugName("storage31")}getDataDrivenData2(f){const v=this.getAttributeDataCoords(f);return(0,g.ig)(this.dataDriven2,v).setDebugName("storage32")}getGPGPUData(f){const v=this.getAttributeDataCoords(f);return(0,g.ig)(this.gpgpu,v).setDebugName("storage4")}getFilterFlags(f){return(0,$.Z)("webgl-ignores-sampler-precision")?(0,g.mD)(this.getFilterData(f).x.multiply((0,g.fz)(255))):this.getFilterData(f).x.multiply((0,g.fz)(255))}getAnimationValue(f){return this.getAnimationData(f).x}getSizeValue(f){return this.getVisualVariableData(f).x}getColorValue(f){return this.getVisualVariableData(f).y}getOpacityValue(f){return this.getVisualVariableData(f).z}getRotationValue(f){return this.getVisualVariableData(f).w}}(0,h._)([(0,c.e5)(g.Eg)],M.prototype,"filterFlags",void 0),(0,h._)([(0,c.e5)(g.Eg)],M.prototype,"animation",void 0),(0,h._)([(0,c.e5)(g.Eg)],M.prototype,"gpgpu",void 0),(0,h._)([(0,c.e5)(g.Eg)],M.prototype,"visualVariableData",void 0),(0,h._)([(0,c.e5)(g.Eg)],M.prototype,"dataDriven0",void 0),(0,h._)([(0,c.e5)(g.Eg)],M.prototype,"dataDriven1",void 0),(0,h._)([(0,c.e5)(g.Eg)],M.prototype,"dataDriven2",void 0),(0,h._)([(0,c.e5)(g.bv)],M.prototype,"size",void 0);class L extends c.oo{}(0,h._)([(0,c.e5)(g.bv)],L.prototype,"activeReasons",void 0),(0,h._)([(0,c.e5)(g.bv)],L.prototype,"highlightAll",void 0);class S extends c.oo{}(0,h._)([(0,c.e5)(g.Sg)],S.prototype,"position",void 0),(0,h._)([(0,c.e5)(g.bv)],S.prototype,"distance",void 0),(0,h._)([(0,c.e5)(g.bv)],S.prototype,"smallSymbolDistance",void 0),(0,h._)([(0,c.e5)(g.bv)],S.prototype,"smallSymbolSizeThreshold",void 0);var B=p(66511);class F extends c.Pz{}(0,h._)([(0,c.xh)(0,g.AO)],F.prototype,"id",void 0),(0,h._)([(0,c.xh)(1,g.bv)],F.prototype,"bitset",void 0),(0,h._)([(0,c.xh)(2,g.Sg)],F.prototype,"pos",void 0);class U extends c.yu{}(0,h._)([(0,c.xh)(14,g.Sg)],U.prototype,"nextPos1",void 0),(0,h._)([(0,c.xh)(15,g.Sg)],U.prototype,"nextPos2",void 0);class x extends c.XB{}class m extends c.ri{clip(f,v){let O=new g.bv(0);const I=this.storage.getFilterFlags(f);if(O=O.add((0,g.fz)(2).multiply((0,g.fz)(1).subtract((0,W.bG)(I,0)))),this.inside?O=O.add((0,g.fz)(2).multiply((0,g.fz)(1).subtract((0,W.bG)(I,1)))):this.outside?O=O.add((0,g.fz)(2).multiply((0,W.bG)(I,1))):this.highlight&&(O=O.add((0,g.fz)(2).multiply((0,g.fz)(1).subtract(this._checkHighlight(I))))),null!=v){const A=new g.bv(1).subtract((0,g.Nb)(v.x,this.view.currentZoom)),R=(0,g.Nb)(v.y,this.view.currentZoom);O=O.add(new g.bv(2).multiply(A.add(R)))}return O}getFragmentOutput(f,v,O=new g.bv(1/255)){const I=new c.Qt;return I.glFragColor=this._maybeWriteHittest(v)??this._maybeHighlight(f,O)??f,I}_maybeHighlight(f,v){return this.highlight?new g.T8(f.rgb,(0,g.Nb)(v,f.a)):null}_checkHighlight(f){let v=this._checkHighlightBit(f,0);for(let O=1;O<o.Oo.length;O++)v=v.add(this._checkHighlightBit(f,O));return(0,g.Nb)(new g.bv(.1),v.add(this.highlight.highlightAll))}_checkHighlightBit(f,v){return(0,W.hG)(f,v).multiply((0,W.qD)(this.highlight.activeReasons,v))}maybeRunHittest(f,v,O){if(null==this.hittestRequest)return null;const I=this.hittest(f,v,O);let A=(0,g.KJ)((0,g.tS)(I,this.hittestRequest.distance),new g.bv(2),new g.bv(0));const R=this.storage.getAttributeDataCoords(f.id),P=(0,W.pK)(R);A=A.add(this.clip(f.id,f.zoomRange));const T=new g.T8(new g.bv(1/255),0,0,0);return{glPointSize:new g.bv(1),glPosition:new g.T8(P,A,1),color:T}}_maybeWriteHittest(f){return null!=this.hittestRequest?f.color:null}}(0,h._)([c.Ou],m.prototype,"inside",void 0),(0,h._)([c.Ou],m.prototype,"outside",void 0),(0,h._)([(0,c.Kw)(L)],m.prototype,"highlight",void 0),(0,h._)([(0,c.e5)(M)],m.prototype,"storage",void 0),(0,h._)([(0,c.e5)(B.C)],m.prototype,"view",void 0),(0,h._)([(0,c.Kw)(S)],m.prototype,"hittestRequest",void 0)},82812:(tt,z,p)=>{p.d(z,{LU:()=>b,Oh:()=>m,YW:()=>x});var h=p(50484),o=p(78607),c=p(49598),g=p(29564),$=p(90450),W=p(20220),M=p(79310),L=p(54108),S=p(73089);class B extends W.F{}function x(f,v){const O=f.view.requiredZoomFactor,I=new c.Sg(v.width,v.height),A=I.multiply(v.scale).multiply(O),R=v.angle.multiply($.e4),P=(0,c.O$)(R),T=(0,c.mC)(R),D=function U(f,v,O,I,A){const R=(0,c.ln)((0,S.qD)(A,$.Ux),(0,c.fz)(1)),P=(0,S.JH)(new c.T8(f,0));return(0,c.KJ)(R,(0,c.wO)(I.divide(v.x),O.divide(v.y),0,(0,c.tk)(O.divide(v.x)),I.divide(v.y),0,(0,S.TN)((0,c.K4)(P,0)),(0,S.TN)((0,c.K4)(0,P)),1),(0,c.wO)(I.divide(v.x),O.divide(v.y),0,(0,c.tk)(O.divide(v.x)),I.divide(v.y),0,0,0,1))}(v.id,A,P,T,v.bitset),V=f.localTileOffset.getPatternOffsetAtTileOrigin(I,P,T),Q=O.multiply(v.scale).multiply(v.offset.subtract(V)).divide(A),X=new c.AO(v.pos,1),nt=D.multiply(X).xy.subtract(Q),rt=v.tlbr.divide(f.mosaicInfo.size.xyxy);let it=(0,S.qD)(v.bitset,$.GS);return null!=f.visualVariableColor&&(it=(0,c.KJ)((0,S.In)(f.storage.getColorValue(v.id)),new c.bv(0),it)),{tileTextureCoord:nt,tlbr:rt,sampleAlphaOnly:it}}function m(f,v){const O=(0,c.wQ)(v.tileTextureCoord,new c.bv(1)),I=(0,c.CD)(v.tlbr.xy,v.tlbr.zw,O);let A=(0,c.ig)(f.mosaicInfo.texture,I);return A=(0,c.KJ)((0,c.tS)(v.sampleAlphaOnly,new c.bv(.5)),A.aaaa,A),v.color.multiply(A)}(0,h._)([(0,o.xh)(5,c.T8)],B.prototype,"tlbr",void 0),(0,h._)([(0,o.xh)(6,c.bv)],B.prototype,"width",void 0),(0,h._)([(0,o.xh)(7,c.bv)],B.prototype,"height",void 0),(0,h._)([(0,o.xh)(8,c.Sg)],B.prototype,"offset",void 0),(0,h._)([(0,o.xh)(9,c.Sg)],B.prototype,"scale",void 0),(0,h._)([(0,o.xh)(10,c.bv)],B.prototype,"angle",void 0);class b extends W.C{vertex(v,O){return{...super.vertex(v,O),...x(this,v)}}fragment(v){const O=m(this,v);return this.getFragmentOutput(O,v,new c.bv(0))}}(0,h._)([(0,o.e5)(L.N)],b.prototype,"mosaicInfo",void 0),(0,h._)([(0,o.e5)(M.H)],b.prototype,"localTileOffset",void 0),(0,h._)([(0,h.a)(0,(0,o.qH)(B)),(0,h.a)(1,(0,o.qH)(g.RS))],b.prototype,"vertex",null),(0,h._)([(0,h.a)(0,(0,o.qH)(class F extends g.fz{}))],b.prototype,"fragment",null)},91197:(tt,z,p)=>{p.d(z,{$1:()=>U,NS:()=>m,Nz:()=>v});var h=p(50484),o=p(78607),c=p(49598),g=p(29564),$=p(82812),W=p(78139),M=p(46074),L=p(79310),S=p(54108),B=p(15690),F=p(48303);const U=16,x=1/U,m=128;class b extends g.HN{}(0,h._)([(0,o.xh)(3,c.T8)],b.prototype,"color",void 0),(0,h._)([(0,o.xh)(4,c.T8)],b.prototype,"tlbr",void 0),(0,h._)([(0,o.xh)(5,c.bv)],b.prototype,"angle",void 0),(0,h._)([(0,o.xh)(6,c.bv)],b.prototype,"aux1",void 0),(0,h._)([(0,o.xh)(7,c.bv)],b.prototype,"aux2",void 0),(0,h._)([(0,o.xh)(8,c.Sg)],b.prototype,"aux3",void 0),(0,h._)([(0,o.xh)(9,c.Sg)],b.prototype,"aux4",void 0),(0,h._)([(0,o.xh)(10,c.Sg)],b.prototype,"zoomRange",void 0);class v extends B.VV{vertex(I,A){const{aux1:R,aux2:P,aux3:T,aux4:D}=I,V={...I,width:R,height:P,offset:T,scale:D.multiply(x)},Q={...I,halfWidth:R,referenceHalfWidth:P,offset:T,normal:D.subtract(m).multiply(x)},X=(0,B.R0)(this,Q),nt=(0,$.YW)(this,V),rt=(0,c.tS)(X.isOutline,new c.bv(.5));return{...X,...nt,...this.maybeRunHittest(I,A,rt)}}fragment(I){const{isOutline:A}=I,R=(0,c.tS)(A,new c.bv(.5)),P=(0,M.zj)(I,this.antialiasingControls.blur),T=(0,$.Oh)(this,I),D=(0,c.KJ)(R,P,T),V=(0,c.KJ)(R,new c.bv(1/255),new c.bv(0));return this.getFragmentOutput(D,I,V)}hittest(I,A,R){return(0,c.KJ)(R,(0,W.Oz)(this.hittestRequest),(0,W.CC)(this,I,A))}}(0,h._)([(0,o.e5)(S.N)],v.prototype,"mosaicInfo",void 0),(0,h._)([(0,o.e5)(L.H)],v.prototype,"localTileOffset",void 0),(0,h._)([(0,h.a)(0,(0,o.qH)(b)),(0,h.a)(1,(0,o.qH)(g.RS))],v.prototype,"vertex",null),(0,h._)([(0,h.a)(0,(0,o.qH)(class f extends F.K7{}))],v.prototype,"fragment",null)},20220:(tt,z,p)=>{p.d(z,{C:()=>B,F:()=>S});var h=p(50484),o=p(78607),c=p(49598),g=p(29564),$=p(78139),W=p(43158),M=p(28121),L=p(56166);class S extends g.HN{}(0,h._)([(0,o.xh)(3,c.T8)],S.prototype,"color",void 0),(0,h._)([(0,o.xh)(4,c.Sg)],S.prototype,"zoomRange",void 0);class B extends g.Ie{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(U,x){const m=(0,L.sY)(this,U.id),b=(0,L.Zt)(this,U.id,U.color).multiply(m),f=this.view.displayViewScreenMat3.multiply(new c.AO(U.pos.xy,1)),v=this.clip(U.id,U.zoomRange);return{glPosition:new c.T8(f.xy,v,1),color:b,...this.maybeRunHittest(U,x,null)}}fragment(U){return this.getFragmentOutput(U.color,U,new c.bv(0))}hittest(U,x){return(0,$.CC)(this,U,x)}}(0,h._)([(0,o.Kw)(W.W)],B.prototype,"visualVariableColor",void 0),(0,h._)([(0,o.Kw)(M.V)],B.prototype,"visualVariableOpacity",void 0),(0,h._)([(0,h.a)(0,(0,o.qH)(S)),(0,h.a)(1,(0,o.qH)(g.RS))],B.prototype,"vertex",null),(0,h._)([(0,h.a)(0,(0,o.qH)(g.fz))],B.prototype,"fragment",null)},46074:(tt,z,p)=>{p.d(z,{Pf:()=>P,Wc:()=>O,b$:()=>f,fc:()=>b,tp:()=>m,uY:()=>A,zj:()=>R});var h=p(50484),o=p(78607),c=p(49598),g=p(29564),$=p(90450),W=p(78139),M=p(43158),L=p(28121),S=p(87965),B=p(38577),F=p(45597),U=p(76972),x=p(56166);class m extends g.HN{}(0,h._)([(0,o.xh)(3,c.T8)],m.prototype,"color",void 0),(0,h._)([(0,o.xh)(4,c.Sg)],m.prototype,"offset",void 0),(0,h._)([(0,o.xh)(5,c.Sg)],m.prototype,"normal",void 0),(0,h._)([(0,o.xh)(6,c.bv)],m.prototype,"halfWidth",void 0),(0,h._)([(0,o.xh)(7,c.bv)],m.prototype,"referenceHalfWidth",void 0),(0,h._)([(0,o.xh)(8,c.Sg)],m.prototype,"zoomRange",void 0);class b extends g.fz{}class f extends o.oo{}function v(T){return(0,c.Fp)(new c.bv($.Ay).multiply((0,c.Nb)(T,new c.bv($.xp))),new c.bv(1))}function O(T,D){const{halfWidth:V,normal:Q}=T,X=v(V),nt=(0,c.kE)(Q).multiply(V);return(0,c.uZ)(X.multiply(V.subtract(nt)).divide(D.add(X).subtract(new c.bv(1))),new c.bv(0),new c.bv(1))}function A(T,D){const{id:V,offset:Q,pos:X,normal:nt,zoomRange:rt}=D,{displayViewScreenMat3:it,displayViewMat3:J}=T.view,ot=(0,x.Zt)(T,V,D.color),_t=(0,x.sY)(T,V),at=function I(T,D){const{id:V,halfWidth:Q,referenceHalfWidth:X}=D;if((0,x.lA)(T)){const nt=new c.bv(2).multiply(X),rt=(0,x.Vm)(T,V,nt);return new c.bv(.5).multiply(Q.divide((0,c.Fp)(X,new c.bv($.Ho)))).multiply(rt)}return Q}(T,D),ht=new c.bv(.5).multiply(T.antialiasingControls.antialiasing),lt=(0,c.Fp)(at.add(ht),new c.bv(.45)).add(new c.bv(.1).multiply(ht)),yt=v(lt).multiply(lt).multiply(Q),xt=J.multiply(new c.AO(yt,new c.bv(0))),pt=it.multiply(new c.AO(X,new c.bv(1))).add(xt),Ot=new c.bv(2).multiply((0,c.Nb)(at,new c.bv(0))).add(T.clip(V,rt)),mt=new c.T8(pt.xy,Ot,1);return{color:ot,opacity:_t,halfWidth:lt,normal:nt,scaledOffset:yt,scaledHalfWidth:at,glPosition:new c.T8(mt.xy,Ot,1)}}function R(T,D){const{opacity:V,color:Q}=T,X=O(T,D);return V.multiply(Q).multiply(X)}(0,h._)([(0,o.e5)(c.bv)],f.prototype,"antialiasing",void 0),(0,h._)([(0,o.e5)(c.bv)],f.prototype,"blur",void 0);class P extends g.Ie{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(D,V){const Q=A(this,D);return{...Q,...this.maybeRunHittest(D,V,Q.halfWidth)}}fragment(D){const V=R(D,this.antialiasingControls.blur);return this.getFragmentOutput(V,D)}hittest(D,V,Q){const{viewMat3:X,tileMat3:nt}=this.view,rt=X.multiply(nt),it=rt.multiply(new c.AO(D.pos,1)),J=rt.multiply(new c.AO(V.nextPos1,1)),ot=rt.multiply(new c.AO(V.nextPos2,1)),{distance:_t,smallSymbolDistance:at,smallSymbolSizeThreshold:ht}=this.hittestRequest,lt=(0,c.Nb)(Q,ht.multiply(.5)).multiply(_t.subtract(at)),yt=this.hittestRequest.position;return(0,c.VV)((0,W.bA)(yt,it.xy,J.xy),(0,W.bA)(yt,it.xy,ot.xy)).subtract(Q).add(lt)}}(0,h._)([(0,o.e5)(f)],P.prototype,"antialiasingControls",void 0),(0,h._)([(0,o.Kw)(M.W)],P.prototype,"visualVariableColor",void 0),(0,h._)([(0,o.Kw)(L.V)],P.prototype,"visualVariableOpacity",void 0),(0,h._)([(0,o.Kw)(S.k)],P.prototype,"visualVariableSizeMinMaxValue",void 0),(0,h._)([(0,o.Kw)(B.U)],P.prototype,"visualVariableSizeScaleStops",void 0),(0,h._)([(0,o.Kw)(F.W)],P.prototype,"visualVariableSizeStops",void 0),(0,h._)([(0,o.Kw)(U.V)],P.prototype,"visualVariableSizeUnitValue",void 0),(0,h._)([(0,h.a)(0,(0,o.qH)(m)),(0,h.a)(1,(0,o.qH)(g.RS))],P.prototype,"vertex",null),(0,h._)([(0,h.a)(0,(0,o.qH)(b))],P.prototype,"fragment",null)},79310:(tt,z,p)=>{p.d(z,{H:()=>$});var h=p(50484),o=p(78607),c=p(49598),g=p(90450);class $ extends o.oo{getPatternOffsetAtTileOrigin(M,L=new c.bv(0),S=new c.bv(1)){const B=new c.Sg(g.ad).divide(M);let F=M.multiply((0,c.ZI)(this.maxIntsToLocalOrigin.multiply(B))).add(this.tileOffsetFromLocalOrigin).subtract(new c.bv(.5).multiply(M));return F=new c.Sg(F.x.multiply(S).subtract(F.y.multiply(L)),F.x.multiply(L).add(F.y.multiply(S))),(0,c.wQ)(F,M)}}(0,h._)([(0,o.e5)(c.Sg)],$.prototype,"tileOffsetFromLocalOrigin",void 0),(0,h._)([(0,o.e5)(c.Sg)],$.prototype,"maxIntsToLocalOrigin",void 0)},54108:(tt,z,p)=>{p.d(z,{N:()=>g});var h=p(50484),o=p(78607),c=p(49598);class g extends o.oo{}(0,h._)([(0,o.e5)(c.Sg)],g.prototype,"size",void 0),(0,h._)([(0,o.e5)(c.Eg)],g.prototype,"texture",void 0)},15690:(tt,z,p)=>{p.d(z,{N8:()=>f,R0:()=>O,VV:()=>I,jt:()=>v,py:()=>A});var h=p(50484),o=p(78607),c=p(49598),g=p(29564),$=p(90450),W=p(78139),M=p(46074),L=p(73089),S=p(43158),B=p(28121),F=p(87965),U=p(38577),x=p(45597),m=p(76972),b=p(56166);class f extends g.HN{}(0,h._)([(0,o.xh)(3,c.Sg)],f.prototype,"offset",void 0),(0,h._)([(0,o.xh)(4,c.T8)],f.prototype,"color",void 0),(0,h._)([(0,o.xh)(5,c.Sg)],f.prototype,"normal",void 0),(0,h._)([(0,o.xh)(6,c.bv)],f.prototype,"halfWidth",void 0),(0,h._)([(0,o.xh)(7,c.bv)],f.prototype,"referenceHalfWidth",void 0),(0,h._)([(0,o.xh)(8,c.Sg)],f.prototype,"zoomRange",void 0);class v extends M.fc{}function O(R,P,T){const{id:D,bitset:V}=P,Q=(0,L.qD)(V,$.WD),X=(0,c.tS)(Q,new c.bv(.5)),nt=(0,M.uY)(R,P),rt=(0,c.KJ)(X,nt.halfWidth,new c.bv(0)),it=(0,b.sY)(R,D),J=(0,b.Zt)(R,D,P.color),ot=(0,c.KJ)(X,P.color,J.multiply(it)),_t=R.view.displayViewScreenMat3.multiply(new c.AO(P.pos.xy,1)),at=R.clip(P.id),ht=new c.T8(_t.xy,at,1),lt=(0,c.KJ)(X,nt.glPosition,ht),yt=T&&R.maybeRunHittest(P,T,X);return{isOutline:Q,color:ot,opacity:new c.bv(1),halfWidth:rt,normal:nt.normal,glPosition:lt,...yt}}class I extends g.Ie{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}}(0,h._)([(0,o.e5)(M.b$)],I.prototype,"antialiasingControls",void 0),(0,h._)([(0,o.Kw)(S.W)],I.prototype,"visualVariableColor",void 0),(0,h._)([(0,o.Kw)(B.V)],I.prototype,"visualVariableOpacity",void 0),(0,h._)([(0,o.Kw)(F.k)],I.prototype,"visualVariableSizeMinMaxValue",void 0),(0,h._)([(0,o.Kw)(U.U)],I.prototype,"visualVariableSizeScaleStops",void 0),(0,h._)([(0,o.Kw)(x.W)],I.prototype,"visualVariableSizeStops",void 0),(0,h._)([(0,o.Kw)(m.V)],I.prototype,"visualVariableSizeUnitValue",void 0);class A extends I{vertex(P,T){return O(this,P,T)}fragment(P){const{color:T,isOutline:D}=P,V=(0,c.tS)(D,new c.bv(.5)),Q=(0,M.zj)(P,this.antialiasingControls.blur),X=(0,c.KJ)(V,Q,T),nt=(0,c.KJ)(V,new c.bv(1/255),new c.bv(0));return this.getFragmentOutput(X,P,nt)}hittest(P,T,D){return(0,c.KJ)(D,(0,W.Oz)(this.hittestRequest),(0,W.CC)(this,P,T))}}(0,h._)([(0,h.a)(0,(0,o.qH)(f)),(0,h.a)(1,(0,o.qH)(g.RS))],A.prototype,"vertex",null),(0,h._)([(0,h.a)(0,(0,o.qH)(v))],A.prototype,"fragment",null)},48366:(tt,z,p)=>{p.d(z,{DS:()=>U,Qp:()=>F,lA:()=>x});var h=p(50484),o=p(78607),c=p(49598),g=p(29564),$=p(20220),W=p(79310),M=p(54108);class L extends $.F{}function F(m,b){const f=b.tlbr.xy,v=b.tlbr.zw,O=v.x.subtract(f.x),I=f.y.subtract(v.y),A=new c.Sg(O,I).multiply(b.inverseRasterizationScale),R=A.multiply(m.view.requiredZoomFactor),P=function B(m){const b=new c.bv(1),f=new c.bv(0);return new c.Tu(b.divide(m.x),f.divide(m.y),0,(0,c.tk)(f.divide(m.x)),b.divide(m.y),0,0,0,1)}(R),T=m.localTileOffset.getPatternOffsetAtTileOrigin(A).divide(R),D=new c.AO(b.pos,1);return{tileTextureCoord:P.multiply(D).xy.subtract(T),tlbr:b.tlbr.divide(m.mosaicInfo.size.xyxy)}}function U(m,b){const f=(0,c.wQ)(m.tileTextureCoord,new c.bv(1)),v=(0,c.CD)(m.tlbr.xy,m.tlbr.zw,f),O=(0,c.ig)(b.texture,v);return m.color.multiply(O)}(0,h._)([(0,o.xh)(5,c.T8)],L.prototype,"tlbr",void 0),(0,h._)([(0,o.xh)(6,c.bv)],L.prototype,"inverseRasterizationScale",void 0);class x extends $.C{vertex(b,f){return{...super.vertex(b,f),...F(this,b)}}fragment(b){const f=U(b,this.mosaicInfo);return this.getFragmentOutput(f,b,new c.bv(0))}}(0,h._)([(0,o.e5)(M.N)],x.prototype,"mosaicInfo",void 0),(0,h._)([(0,o.e5)(W.H)],x.prototype,"localTileOffset",void 0),(0,h._)([(0,h.a)(0,(0,o.qH)(L)),(0,h.a)(1,(0,o.qH)(g.RS))],x.prototype,"vertex",null),(0,h._)([(0,h.a)(0,(0,o.qH)(class S extends g.fz{}))],x.prototype,"fragment",null)},48303:(tt,z,p)=>{p.d(z,{K7:()=>F,Zd:()=>U});var h=p(50484),o=p(78607),c=p(49598),g=p(29564),$=p(46074),W=p(79310),M=p(54108),L=p(15690),S=p(48366);class B extends L.N8{}(0,h._)([(0,o.xh)(9,c.T8)],B.prototype,"tlbr",void 0),(0,h._)([(0,o.xh)(10,c.bv)],B.prototype,"inverseRasterizationScale",void 0);class F extends L.jt{}class U extends L.py{vertex(m,b){return{...(0,L.R0)(this,m,b),...(0,S.Qp)(this,m)}}fragment(m){const{isOutline:b}=m,f=(0,c.tS)(b,new c.bv(.5)),v=(0,$.zj)(m,this.antialiasingControls.blur),O=(0,S.DS)(m,this.mosaicInfo),I=(0,c.KJ)(f,v,O),A=(0,c.KJ)(f,new c.bv(1/255),new c.bv(0));return this.getFragmentOutput(I,m,A)}}(0,h._)([(0,o.e5)(M.N)],U.prototype,"mosaicInfo",void 0),(0,h._)([(0,o.e5)(W.H)],U.prototype,"localTileOffset",void 0),(0,h._)([(0,h.a)(0,(0,o.qH)(B)),(0,h.a)(1,(0,o.qH)(g.RS))],U.prototype,"vertex",null),(0,h._)([(0,h.a)(0,(0,o.qH)(F))],U.prototype,"fragment",null)},66511:(tt,z,p)=>{p.d(z,{C:()=>g});var h=p(50484),o=p(78607),c=p(49598);class g extends o.oo{}(0,h._)([(0,o.e5)(c.Tu)],g.prototype,"displayViewScreenMat3",void 0),(0,h._)([(0,o.e5)(c.Tu)],g.prototype,"displayViewMat3",void 0),(0,h._)([(0,o.e5)(c.Tu)],g.prototype,"displayMat3",void 0),(0,h._)([(0,o.e5)(c.Tu)],g.prototype,"viewMat3",void 0),(0,h._)([(0,o.e5)(c.Tu)],g.prototype,"tileMat3",void 0),(0,h._)([(0,o.e5)(c.bv)],g.prototype,"displayZoomFactor",void 0),(0,h._)([(0,o.e5)(c.bv)],g.prototype,"requiredZoomFactor",void 0),(0,h._)([(0,o.e5)(c.Sg)],g.prototype,"tileOffset",void 0),(0,h._)([(0,o.e5)(c.bv)],g.prototype,"currentScale",void 0),(0,h._)([(0,o.e5)(c.bv)],g.prototype,"currentZoom",void 0),(0,h._)([(0,o.e5)(c.bv)],g.prototype,"metersPerSRUnit",void 0),(0,h._)([(0,o.e5)(c.bv)],g.prototype,"rotation",void 0),(0,h._)([(0,o.e5)(c.bv)],g.prototype,"pixelRatio",void 0)},43158:(tt,z,p)=>{p.d(z,{W:()=>$});var h=p(50484),o=p(78607),c=p(49598),g=p(73089);class $ extends o.oo{getColor(M,L,S){return(0,c.wV)([(0,c.or)((0,g.In)(M),S),L],[(0,c.Iz)(M,this.values.first()),this.colors.first()],[(0,c.r7)(M,this.values.last()),this.colors.last()],[!0,()=>{const B=this.values.findIndex(b=>(0,c.tS)(b,M)),F=this.values.get(B),U=B.subtract(1),x=this.values.get(U),m=M.subtract(x).divide(F.subtract(x));return(0,c.CD)(this.colors.get(U),this.colors.get(B),m)}])}}(0,h._)([(0,o.e5)(c.v8.ofType(c.T8,8))],$.prototype,"colors",void 0),(0,h._)([(0,o.e5)(c.v8.ofType(c.bv,8))],$.prototype,"values",void 0)},28121:(tt,z,p)=>{p.d(z,{V:()=>$});var h=p(50484),o=p(78607),c=p(49598),g=p(73089);class $ extends o.oo{getOpacity(M){return(0,c.wV)([(0,g.In)(M),new c.bv(1)],[(0,c.Iz)(M,this.opacityValues.first()),this.opacities.first()],[(0,c.r7)(M,this.opacityValues.last()),this.opacities.last()],[!0,()=>{const L=this.opacityValues.findIndex(x=>(0,c.tS)(x,M)),S=this.opacityValues.get(L),B=L.subtract(1),F=this.opacityValues.get(B),U=M.subtract(F).divide(S.subtract(F));return(0,c.CD)(this.opacities.get(B),this.opacities.get(L),U)}])}}(0,h._)([(0,o.e5)(c.v8.ofType(c.bv,8))],$.prototype,"opacities",void 0),(0,h._)([(0,o.e5)(c.v8.ofType(c.bv,8))],$.prototype,"opacityValues",void 0)},87965:(tt,z,p)=>{p.d(z,{k:()=>$});var h=p(50484),o=p(78607),c=p(49598),g=p(73089);class $ extends o.oo{getSize(M,L){const S=this.minMaxValueAndSize.xy,B=this.minMaxValueAndSize.zw;return(0,c.KJ)((0,g.In)(M),L,()=>{const F=M.subtract(S.x).divide(S.y.subtract(S.x)),U=(0,c.uZ)(F,new c.bv(0),new c.bv(1));return B.x.add(U.multiply(B.y.subtract(B.x)))})}}(0,h._)([(0,o.e5)(c.T8)],$.prototype,"minMaxValueAndSize",void 0)},38577:(tt,z,p)=>{p.d(z,{U:()=>g});var h=p(50484),o=p(78607),c=p(49598);class g extends o.oo{getSizeForViewScale(W){return(0,c.wV)([(0,c.Iz)(W,this.values.first()),this.sizes.first()],[(0,c.r7)(W,this.values.last()),this.sizes.last()],[!0,()=>{const M=this.values.findIndex(U=>(0,c.tS)(U,W)),L=this.values.get(M),S=M.subtract(1),B=this.values.get(S),F=W.subtract(B).divide(L.subtract(B));return(0,c.CD)(this.sizes.get(S),this.sizes.get(M),F)}])}}(0,h._)([(0,o.e5)(c.v8.ofType(c.bv,8))],g.prototype,"sizes",void 0),(0,h._)([(0,o.e5)(c.v8.ofType(c.bv,8))],g.prototype,"values",void 0)},45597:(tt,z,p)=>{p.d(z,{W:()=>$});var h=p(50484),o=p(78607),c=p(49598),g=p(73089);class $ extends o.oo{getSize(M,L){const S=(0,c.wV)([(0,g.In)(M),L],[(0,c.Iz)(M,this.values.first()),this.sizes.first()],[(0,c.r7)(M,this.values.last()),this.sizes.last()],[!0,()=>{const B=this.values.findIndex(b=>(0,c.tS)(b,M)),F=this.values.get(B),U=B.subtract(1),x=this.values.get(U),m=M.subtract(x).divide(F.subtract(x));return(0,c.CD)(this.sizes.get(U),this.sizes.get(B),m)}]);return(0,c.KJ)((0,g.In)(S),L,S)}}(0,h._)([(0,o.e5)(c.v8.ofType(c.bv,8))],$.prototype,"sizes",void 0),(0,h._)([(0,o.e5)(c.v8.ofType(c.bv,8))],$.prototype,"values",void 0)},76972:(tt,z,p)=>{p.d(z,{V:()=>$});var h=p(50484),o=p(78607),c=p(49598),g=p(73089);class $ extends o.oo{getSize(M,L){return(0,c.KJ)((0,g.In)(M),L,M.multiply(this.unitValueToPixelsRatio))}}(0,h._)([(0,o.e5)(c.bv)],$.prototype,"unitValueToPixelsRatio",void 0)},90450:(tt,z,p)=>{var h,lt;p.d(z,{$r:()=>at,Ay:()=>L,B7:()=>ot,GS:()=>V,Ho:()=>f,Ke:()=>m,MO:()=>h,T5:()=>v,Ux:()=>it,V_:()=>x,WD:()=>rt,Wq:()=>J,ad:()=>ht,e4:()=>c,k9:()=>T,mL:()=>_t,nF:()=>o,nU:()=>M,xp:()=>S}),(lt=h||(h={}))[lt.Geographic=0]="Geographic",lt[lt.Arithmatic=1]="Arithmatic";const o=3.14159265359/180,c=3.14159265359/128,M=1,L=1.1,S=1,x=24,m=8,f=1e-5,v=.05,T=1e-30,V=4,rt=0,it=2,J=2,ot=3,_t=0,at=3,ht=16777216},78139:(tt,z,p)=>{p.d(z,{CC:()=>F,Oz:()=>B,P0:()=>S,XM:()=>U,bA:()=>$,hF:()=>M,lD:()=>W});var h=p(49598),o=p(90450),c=p(73089);function $(x,m,b){const f=b.subtract(m),v=function g(x,m){return(0,h.AK)(x,(0,h.Fv)(m))}(x.subtract(m),f),O=(0,h.uZ)(v.divide((0,h.kE)(f)),new h.bv(0),new h.bv(1));return(0,h.TE)(x,m.add(O.multiply(b.subtract(m))))}function W(x){const m=(0,h.Wn)(x);return(0,h.Nb)(m.x.add(m.y).add(m.z),new h.bv(1.05))}function M(x,m,b,f){const v=new h.Tu(b.x.multiply(f.y).subtract(f.x.multiply(b.y)),f.x.multiply(m.y).subtract(m.x.multiply(f.y)),m.x.multiply(b.y).subtract(b.x.multiply(m.y)),b.y.subtract(f.y),f.y.subtract(m.y),m.y.subtract(b.y),f.x.subtract(b.x),m.x.subtract(f.x),b.x.subtract(m.x)),O=m.x.multiply(b.y.subtract(f.y)),I=b.x.multiply(f.y.subtract(m.y)),A=f.x.multiply(m.y.subtract(b.y)),R=O.add(I).add(A);return new h.bv(1).divide(R).multiply(v.multiply(new h.AO(1,x)))}function L(x,m,b,f){return(0,h.ln)(W(M(x,m,b,f)),new h.bv(1))}function S(x,m,b,f){const v=b.subtract(m),O=f.subtract(m),I=(0,c.xQ)(v,O),A=(0,h.xD)((0,h.Qj)(I,new h.bv(o.T5)),(0,h.tS)(I,new h.bv(-o.T5)));return(0,h.wV)([(0,h.xD)((0,h.ff)(A),L(x.xy,m,b,f)),new h.bv(-1)],[!0,()=>{const R=$(x,m,b),P=$(x,b,f),T=$(x,f,m);return(0,h.VV)((0,h.VV)(R,P),T)}])}function B(x){return x.distance.add(1)}function F(x,m,b){const{viewMat3:f,tileMat3:v}=x.view,O=f.multiply(v),I=O.multiply(new h.AO(m.pos,1)),A=O.multiply(new h.AO(b.nextPos1,1)),R=O.multiply(new h.AO(b.nextPos2,1));return S(x.hittestRequest.position,I.xy,A.xy,R.xy)}function U(x,m,b){return(0,h.TE)(x,b).subtract(m)}},73089:(tt,z,p)=>{p.d(z,{In:()=>$,JH:()=>m,TN:()=>g,Wv:()=>x,X3:()=>b,bG:()=>F,h7:()=>B,hG:()=>U,pK:()=>L,qD:()=>S,xQ:()=>M});var h=p(5633),o=p(49598),c=p(90450);function g(f){const v=(0,o.fz)(12.9898),O=(0,o.fz)(78.233),I=(0,o.fz)(43758.5453),A=(0,o.AK)(f,(0,o.K4)(v,O)),R=(0,o.wQ)(A,(0,o.fz)(3.14));return(0,o.ZI)((0,o.O$)(R).multiply(I))}function $(f){return(0,o.ln)(f,(0,o.fz)(c.k9))}function M(f,v){return f.x.multiply(v.y).subtract(v.x.multiply(f.y))}function L(f){return f.multiply(2).subtract(1)}function S(f,v){const O=(0,o.fz)(2**v);return(0,o.wQ)((0,o.GW)(f.divide(O)),(0,o.fz)(2))}function B(f,v){return(0,o.tS)(S(f,v),(0,o.fz)(.5))}function F(f,v){return S(f,v+h.Oo.length)}function U(f,v){return S(f,v)}function x(f){const v=S(f.z,7),O=(0,o.fz)(1).subtract(v),I=f.xyz.subtract((0,o.R3)(0,0,(0,o.fz)(128)));return O.multiply(f).add(v.multiply(I))}function m(f){const v=(0,o.vh)(.99609375,.0038909912109375,1519918441772461e-20,5.9371814131736755e-8);return(0,o.AK)(f,v)}function b(f){return(0,o.Fp)((0,o.Fp)((0,o.Fp)(f.x,f.y),f.z),f.w)}},56166:(tt,z,p)=>{p.d(z,{H8:()=>W,Vm:()=>c,Zt:()=>g,lA:()=>o,sY:()=>$});var h=p(49598);function o(M){return null!=M.visualVariableSizeMinMaxValue||null!=M.visualVariableSizeScaleStops||null!=M.visualVariableSizeStops||null!=M.visualVariableSizeUnitValue}function c(M,L,S){if(o(M)){const B=M.storage.getSizeValue(L);return M.visualVariableSizeMinMaxValue?.getSize(B,S)??M.visualVariableSizeScaleStops?.getSizeForViewScale(M.view.currentScale)??M.visualVariableSizeStops?.getSize(B,S)??M.visualVariableSizeUnitValue?.getSize(B,S)}return S}function g(M,L,S,B=new h.tW(!1)){if(null==M.visualVariableColor)return S;const F=M.storage.getColorValue(L);return M.visualVariableColor.getColor(F,S,B)}function $(M,L){if(null==M.visualVariableOpacity)return new h.bv(1);const S=M.storage.getOpacityValue(L);return M.visualVariableOpacity.getOpacity(S)}function W(M,L){if(null==M.visualVariableRotation)return h.Tu.identity();const S=M.storage.getRotationValue(L);return M.visualVariableRotation.getVVRotationMat3(S)}},78619:(tt,z,p)=>{p.d(z,{X:()=>b});var h=p(57964),o=p(4703),c=p(71763),S=(p(65311),p(14007),p(35208),p(39237),p(83018),p(21450)),U=(p(3380),p(17091),p(32196));function m(f,v,O){const I=v.length;if(I!==O){const A=new h.Z("Invalid Uniform",`Invalid length, expected ${O} but got ${I}`,{uniformName:f,values:v});o.Z.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram").errorOnce(A)}}class b{constructor(v,O,I,A,R,P){this._program=null,this._vao=null,this._temporaryTextures=[],this.vertexShader=v,this.fragmentShader=O,this._locations=I,this._locationInfo=A,this._uniformBindings=R,this._transformFeedbackBindings=P}destroy(){this._program&&this._program.dispose(),this.cleanupTemporaryTextures()}get locations(){return this._locations}get locationInfo(){return this._locationInfo}setUniforms(v){this._uniforms=v}cleanupTemporaryTextures(){for(const v of this._temporaryTextures)v.dispose();this._temporaryTextures=[]}bind(v){const O=this._uniforms;if(!this._program){const A=new Map;for(const[P,T]of this._locations)A.set(P,T);const R=[];for(const P of this._transformFeedbackBindings??[]){const{index:T,propertyKey:D}=P;R[T]=`v_${D}`}this._program=new S.$(v,this.vertexShader,this.fragmentShader,A,new Map,R)}const I=this._program;v.useProgram(I);for(const A of this._uniformBindings){const{shaderModulePath:R,uniformName:P,uniformType:T,uniformArrayLength:D}=A,V=(0,c.hS)(R,O);if(null==V){if("sampler2D"===T)continue;throw new Error(`Failed to find uniform value for ${R}`)}switch("array"===T?A.uniformArrayElementType:T){case"sampler2D":{const{unit:Q,texture:X}=V;if(I.setUniform1i(P,Q),"type"in X)v.bindTexture(X,Q);else{const nt=(0,U.cU)(v,X.descriptor,X.data);v.bindTexture(nt,Q)}break}case"int":if(!D){I.setUniform1i(P,V);break}m(A.uniformName,V,D),I.setUniform1iv(P,V);break;case"float":if(!D){I.setUniform1f(P,V);break}m(A.uniformName,V,D),I.setUniform1fv(P,V);break;case"vec2":if(!D){I.setUniform2f(P,V[0],V[1]);break}m(A.uniformName,V,D),I.setUniform2fv(P,V.flat());break;case"vec3":if(!D){I.setUniform3f(P,V[0],V[1],V[2]);break}m(A.uniformName,V,D),I.setUniform3fv(P,V.flat());break;case"vec4":if(!D){I.setUniform4f(P,V[0],V[1],V[2],V[3]);break}m(A.uniformName,V,D),I.setUniform4fv(P,V.flat());break;case"mat3":I.setUniformMatrix3fv(P,V.flat());break;case"mat4":I.setUniformMatrix4fv(P,V.flat());break;default:throw new Error(`Unable to set uniform for type ${T}`)}}}}},82070:(tt,z,p)=>{p.d(z,{x:()=>F});var h=p(50484),o=p(73514),c=p(14007),g=p(13649),$=p(77675),W=p(80543),S=(p(4703),p(65311),p(10141)),B=p(90110);let F=class extends o.Z{constructor(U){super(U),this.debugName="",this._updatingHandles=new B.R,this._idToUpdatingState=new g.Z}get updating(){const U=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some(x=>x);if((0,c.Z)("esri-2d-log-updating")){const x=Array.from(this._idToUpdatingState.entries()).map(([m,b])=>`-> ${m}: ${b}`).join("\n");console.log(`${this.debugName}: Updating: ${U}\n-> Handles: ${this._updatingHandles.updating}\n${x}`)}return U}addUpdateTracking(U,x){const m=(0,$.YP)(()=>x.updating,b=>this._idToUpdatingState.set(U,b),{sync:!0});this.addHandles(m)}addPromise(U){return this._updatingHandles.addPromise(U)}};(0,h._)([(0,W.Cb)({constructOnly:!0})],F.prototype,"debugName",void 0),(0,h._)([(0,W.Cb)({readOnly:!0})],F.prototype,"updating",null),F=(0,h._)([(0,S.j)("esri.views.2d.layers.support.UpdateTracking2D")],F)},92426:(tt,z,p)=>{var h,o;p.d(z,{P:()=>h}),(o=h||(h={}))[o.Pass=0]="Pass",o[o.Draw=1]="Draw"},98694:(tt,z,p)=>{p.d(z,{hu:()=>W,yK:()=>L}),p(89014),p(5710),(0,p(23515).Ue)();class ${constructor(b){this.message=b}toString(){return`AssertException: ${this.message}`}}function W(m,b){if(!m){b=b||"Assertion";const f=new Error(b).stack;throw new $(`${b} at ${f}`)}}function L(m,b,f,v){let O,I=(f[0]-m[0])/b[0],A=(v[0]-m[0])/b[0];I>A&&(O=I,I=A,A=O);let R=(f[1]-m[1])/b[1],P=(v[1]-m[1])/b[1];if(R>P&&(O=R,R=P,P=O),I>P||R>A)return!1;R>I&&(I=R),P<A&&(A=P);let T=(f[2]-m[2])/b[2],D=(v[2]-m[2])/b[2];return T>D&&(O=T,T=D,D=O),!(I>D||T>A||(D<A&&(A=D),A<0))}}}]);