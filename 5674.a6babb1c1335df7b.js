"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[5674],{11462:(J,A,l)=>{l.d(A,{I:()=>c,v:()=>M});var w=l(55117);function c(m,o,e=0){const h=(0,w.uZ)(m,0,g);for(let a=0;a<4;a++)o[e+a]=Math.floor(256*f(h*u[a]))}function M(m,o=0){let e=0;for(let h=0;h<4;h++)e+=m[o+h]*D[h];return e}const u=[1,256,65536,16777216],D=[1/256,1/65536,1/16777216,1/4294967296],g=M(new Uint8ClampedArray([255,255,255,255]));function f(m){return m-Math.floor(m)}},40485:(J,A,l)=>{l.d(A,{Z:()=>f});var M,m,w=l(14007),c=l(51479);(m=M||(M={}))[m.varint=0]="varint",m[m.fixed64=1]="fixed64",m[m.delimited=2]="delimited",m[m.fixed32=5]="fixed32",m[m.unknown=99]="unknown";const u=4294967296,D=new TextDecoder("utf-8"),g=(0,w.Z)("safari")||(0,w.Z)("ios")?6:(0,w.Z)("ff")?12:32;class f{constructor(o,e,h=0,a=(o?o.byteLength:0)){this._tag=0,this._dataType=M.unknown,this._init(o,e,h,a)}_init(o,e,h,a){this._data=o,this._dataView=e,this._pos=h,this._end=a}asUnsafe(){return this}clone(){return new f(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(o){this._pos=o}nextTag(o){for(;;){if(this._pos===this._end)return!1;const e=this._decodeVarint();if(this._tag=e>>3,this._dataType=7&e,!o||o===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const o=this._decodeVarint();return this._tag=o>>3,this._dataType=7&o,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let o=4294967295;if(o=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128||(o=(o|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128)||(o=(o|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128)||(o=(o|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128)||(o=(o|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128))return o;throw new Error("Varint overflow")}getUInt64(){return this._decodeVarint()}getSInt32(){const o=this.getUInt32();return o>>>1^-(1&o)}getSInt64(){return this._decodeSVarint()}getBool(){const o=0!==this._data[this._pos];return this._skip(1),o}getEnum(){return this._decodeVarint()}getFixed64(){const o=this._dataView,e=this._pos,h=o.getUint32(e,!0)+o.getUint32(e+4,!0)*u;return this._skip(8),h}getSFixed64(){const o=this._dataView,e=this._pos,h=o.getUint32(e,!0)+o.getInt32(e+4,!0)*u;return this._skip(8),h}getDouble(){const o=this._dataView.getFloat64(this._pos,!0);return this._skip(8),o}getFixed32(){const o=this._dataView.getUint32(this._pos,!0);return this._skip(4),o}getSFixed32(){const o=this._dataView.getInt32(this._pos,!0);return this._skip(4),o}getFloat(){const o=this._dataView.getFloat32(this._pos,!0);return this._skip(4),o}getString(){const o=this._getLength(),e=this._pos,h=this._toString(this._data,e,e+o);return this._skip(o),h}getBytes(){const o=this._getLength(),e=this._pos,h=this._toBytes(this._data,e,e+o);return this._skip(o),h}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(o,e,h,a){const _=this.getMessage(),R=o(_,e,h,a);return _.release(),R}processMessage(o){const e=this.getMessage(),h=o(e);return e.release(),h}getMessage(){const o=this._getLength(),e=f.pool.acquire();return e._init(this._data,this._dataView,this._pos,this._pos+o),this._skip(o),e}release(){f.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case M.varint:this._decodeVarint();break;case M.fixed64:this._skip(8);break;case M.delimited:this._skip(this._getLength());break;case M.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(o){this._skip(o)}_skip(o){if(this._pos+o>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=o}_decodeVarint(){const o=this._data;let e=this._pos,h=0,a=0;if(this._end-e>=10)do{if(a=o[e++],h|=127&a,!(128&a&&(a=o[e++],h|=(127&a)<<7,128&a)&&(a=o[e++],h|=(127&a)<<14,128&a)&&(a=o[e++],h|=(127&a)<<21,128&a)&&(a=o[e++],h+=268435456*(127&a),128&a)&&(a=o[e++],h+=34359738368*(127&a),128&a)&&(a=o[e++],h+=4398046511104*(127&a),128&a)&&(a=o[e++],h+=562949953421312*(127&a),128&a)&&(a=o[e++],h+=72057594037927940*(127&a),128&a)&&(a=o[e++],h+=0x8000000000000000*(127&a),128&a)))break;throw new Error("Varint too long!")}while(0);else{let _=1;for(;e!==this._end&&(a=o[e],128&a);)++e,h+=(127&a)*_,_*=128;if(e===this._end)throw new Error("Varint overrun!");++e,h+=a*_}return this._pos=e,h}_decodeSVarint(){const o=this._data;let e,h=0,a=0;const _=1&o[this._pos];if(a=o[this._pos++],h|=127&a,!(128&a&&(a=o[this._pos++],h|=(127&a)<<7,128&a)&&(a=o[this._pos++],h|=(127&a)<<14,128&a)&&(a=o[this._pos++],h|=(127&a)<<21,128&a)&&(a=o[this._pos++],h+=268435456*(127&a),128&a)&&(a=o[this._pos++],h+=34359738368*(127&a),128&a)&&(a=o[this._pos++],h+=4398046511104*(127&a),128&a)))return _?-(h+1)/2:h/2;if(e=BigInt(h),a=o[this._pos++],e+=0x2000000000000n*BigInt(127&a),!(128&a&&(a=o[this._pos++],e+=0x100000000000000n*BigInt(127&a),128&a)&&(a=o[this._pos++],e+=0x8000000000000000n*BigInt(127&a),128&a)))return Number(_?-(e+1n)/2n:e/2n);throw new Error("Varint too long!")}_getLength(){if(this._dataType!==M.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(o,e,h){if((h=Math.min(this._end,h))-e>g){const R=o.subarray(e,h);return D.decode(R)}let a="",_="";for(let R=e;R<h;++R){const Z=o[R];128&Z?_+="%"+Z.toString(16):(a+=decodeURIComponent(_)+String.fromCharCode(Z),_="")}return _.length&&(a+=decodeURIComponent(_)),a}_toBytes(o,e,h){return h=Math.min(this._end,h),new Uint8Array(o.buffer,e,h-e)}}f.pool=new c.Z(f,void 0,m=>{m._data=null,m._dataView=null})},47403:(J,A,l)=>{l.d(A,{Q:()=>et});var w=l(50484),c=l(73514),u=(l(57964),l(14007)),g=(l(4703),l(80543)),m=(l(65311),l(10141)),o=l(99657),e=l(55117),h=l(84249);class tt{constructor(p,T,E){this._width=p*E,this._height=T*E,this._pixelRatio=E;const I=Math.ceil(this._width/1),S=Math.ceil(this._height/1);this._cols=I,this._rows=S,this._cells=h.p.create(I*S)}insertMetrics(p){this._markMetrics(p)}hasCollision(p){let T=0;for(const{computedX:E,computedY:I,width:S,height:y}of p.bounds)switch(this._collide(E,I,(S+o.gj)*this._pixelRatio,(y+o.gj)*this._pixelRatio)){case 2:return 2;case 1:T++}return T===p.bounds.length?1:0}getCellId(p,T){return p+T*this._cols}has(p){return this._cells.has(p)}hasRange(p,T){return this._cells.hasRange(p,T)}set(p){this._cells.set(p)}setRange(p,T){this._cells.setRange(p,T)}_collide(p,T,E,I){const S=p-E/2,y=T-I/2,C=S+E,b=y+I;if(C<0||b<0||S>this._width||y>this._height)return 1;const B=(0,e.uZ)(Math.floor(S/1),0,this._cols),L=(0,e.uZ)(Math.floor(y/1),0,this._rows),j=(0,e.uZ)(Math.ceil(C/1),0,this._cols),V=(0,e.uZ)(Math.ceil(b/1),0,this._rows);for(let P=L;P<=V;P++)for(let U=B;U<=j;U++){const k=this.getCellId(U,P);if(this.has(k))return 2}return 0}_mark(p,T,E,I,S){const y=p-E/2,C=T-I/2,b=y+E,B=C+I,L=(0,e.uZ)(Math.floor(y/1),0,this._cols),j=(0,e.uZ)(Math.floor(C/1),0,this._rows),V=(0,e.uZ)(Math.ceil(b/1),0,this._cols),P=(0,e.uZ)(Math.ceil(B/1),0,this._rows);for(let U=j;U<=P;U++)for(let k=L;k<=V;k++){const ot=this.getCellId(k,U);this.set(ot)}return!1}_markMetrics(p){for(const{computedX:T,computedY:E,width:I,height:S}of p.bounds)this._mark(T,E,(I+o.gj)*this._pixelRatio,(S+o.gj)*this._pixelRatio,p.entityTexel)}}const Q=254,Y=255;function N(O,p){const T=O.children.slice();T.sort((E,I)=>E.tileAge-I.tileAge),T.forEach(E=>{null!=E.labelMetrics&&E.isReady&&p(E,E.labelMetrics)})}function $(O,p){return(!O.minScale||O.minScale>=p)&&(!O.maxScale||O.maxScale<=p)}class at{run(p,T,E,I){const S=[];for(let y=p.length-1;y>=0;y--){const C=p[y];C.labelingCollisionInfos?.length&&S.push(...C.labelingCollisionInfos)}(0,u.Z)("esri-2d-update-debug")&&S.length&&console.debug("CollisionEngine.run"),this._transformMetrics(S),this._runCollision(S,T,E,I);for(const y of S)y.container.requestRender()}_runCollision(p,T,E,I){const[S,y]=T.state.size,C=new tt(S,y,T.pixelRatio);for(const{container:b,deconflictionEnabled:B,visible:L}of p){const j=b.attributeView;B?L?(this._prepare(b),this._collideVisible(C,b,E,I),this._collideInvisible(C,b)):N(b,(V,P)=>{for(const U of P)j.setLabelMinZoom(U.entityTexel,Y)}):N(b,(V,P)=>{for(const U of P)$(U,E)?(j.setLabelMinZoom(U.entityTexel,0),L&&C.insertMetrics(U)):j.setLabelMinZoom(U.entityTexel,Q)})}}_isFiltered(p,T,E){const I=T.getFilterFlags(p);return!((!E.hasFilter||I&o.g3)&&(null==E.featureEffect||E.featureEffect.excludedLabelsVisible||I&o.kU))}_prepare(p){const T=p.attributeView,E=new Set;N(p,(I,S)=>{for(const y of S){const C=y.entityTexel;if(!E.has(C)){if(E.add(C),this._isFiltered(C,T,p.layerView)){T.setLabelMinZoom(C,Q);continue}0!==T.getLabelMinZoom(C)?T.setLabelMinZoom(C,Y):T.setLabelMinZoom(C,0)}}})}_collideVisible(p,T,E,I){const S=T.attributeView,y=new Set;N(T,(C,b)=>{for(let B=0;B<b.length;B++){const L=b[B].entityTexel;if(y.has(L))continue;if(C.key.level!==I){S.setLabelMinZoom(L,Q),y.add(L);continue}if(!$(b[B],E)){S.setLabelMinZoom(L,Q),y.add(L);continue}if(0!==S.getLabelMinZoom(L)){y.add(L);continue}let j=!1,V=!0;const P=B;let U=B;for(;U<b.length;U++){const k=b[U];if(k.entityTexel!==L)break;if(!j)switch(p.hasCollision(k)){case 1:break;case 2:j=!0,V=!1;break;case 0:V=!1}}if(!j)for(let k=P;k<U;k++)p.insertMetrics(b[k]);B=U-1,V||(y.add(L),S.setLabelMinZoom(L,j?Q:0))}})}_collideInvisible(p,T){const E=T.attributeView,I=new Set;N(T,(S,y)=>{for(let C=0;C<y.length;C++){const b=y[C].entityTexel;if(I.has(b))continue;if(E.getLabelMinZoom(b)!==Y){I.add(b);continue}let B=!1,L=!0;const j=C;let V=C;for(;V<y.length;V++){const P=y[V];if(P.entityTexel!==b)break;if(!B)switch(p.hasCollision(P)){case 1:break;case 2:B=!0,L=!1;break;case 0:L=!1}}if(!B)for(let P=j;P<V;P++)p.insertMetrics(y[P]);C=V-1,L||(I.add(b),E.setLabelMinZoom(b,B?Y:0))}})}_transformMetrics(p){for(const{container:T,geometryType:E,vvEvaluators:I}of p)N(T,(S,y)=>{const C=T.attributeView,b=S.transforms.labelMat2d;b[4]=Math.round(b[4]),b[5]=Math.round(b[5]);const B="polyline"===E;for(const L of y){const{entityTexel:j,anchorX:V,anchorY:P}=L;let U=L.referenceBounds?.size??0;const k=I[0];if(null!=k){const i=k(C.getVVSize(j));U=isNaN(i)||null==i||i===1/0?U:i}const ot=L.directionX*(U/2),nt=L.directionY*(U/2);for(const i of L.bounds){let v=V,K=P;if(B){let W=v+i.x+ot,it=K+i.y+nt;W=b[0]*W+b[2]*it+b[4],it=b[1]*W+b[3]*it+b[5],i.computedX=Math.floor(W),i.computedY=Math.floor(it)}else{v=b[0]*V+b[2]*P+b[4],K=b[1]*V+b[3]*P+b[5];const it=K+i.y+nt;i.computedX=v+i.x+ot,i.computedY=it}}}})}}let et=class extends c.Z{constructor(O){super(O),this._lastUpdate=0,this.collisionEngine=new at,this.lastUpdateId=-1,this.updateRequested=!1,this.view=null}get updating(){return(0,u.Z)("esri-2d-log-updating")&&console.log(`Updating LabelManager ${this.updateRequested}:\n-> updateRequested: ${this.updateRequested}`),this.updateRequested}update(O){const p=performance.now();p-this._lastUpdate>=32?(this._lastUpdate=p,this.doUpdate(O)):this.requestUpdate()}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view?.requestUpdate())}processUpdate(O){this.updateRequested&&(this.updateRequested=!1,this.update(O))}doUpdate(O){const p=this.view;if(p)try{const T=O.state.scale,E=p.featuresTilingScheme.getClosestInfoForScale(T).level;this.collisionEngine.run(p.allLayerViews.items,O,T,E)}catch{}}};(0,w._)([(0,g.Cb)()],et.prototype,"updateRequested",void 0),(0,w._)([(0,g.Cb)()],et.prototype,"updating",null),(0,w._)([(0,g.Cb)()],et.prototype,"view",void 0),et=(0,w._)([(0,m.j)("esri.views.2d.LabelManager")],et)},17866:(J,A,l)=>{var w,c,M,u;l.d(A,{Fr:()=>M,_K:()=>c,al:()=>w}),(u=w||(w={}))[u.FILL=1]="FILL",u[u.LINE=2]="LINE",u[u.SYMBOL=3]="SYMBOL",u[u.CIRCLE=4]="CIRCLE",function(u){u[u.BACKGROUND=0]="BACKGROUND",u[u.FILL=1]="FILL",u[u.OUTLINE=2]="OUTLINE",u[u.LINE=3]="LINE",u[u.ICON=4]="ICON",u[u.CIRCLE=5]="CIRCLE",u[u.TEXT=6]="TEXT",u[u.TILEINFO=7]="TILEINFO"}(c||(c={})),function(u){u[u.PAINTER_CHANGED=0]="PAINTER_CHANGED",u[u.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",u[u.LAYER_CHANGED=2]="LAYER_CHANGED",u[u.LAYER_REMOVED=3]="LAYER_REMOVED",u[u.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(M||(M={}))},7081:(J,A,l)=>{l.d(A,{Q:()=>g});var w=l(90295),c=l(88278),M=l(14007),u=l(13646);const D=(0,M.Z)("esri-2d-profiler");class g{constructor(m,o){if(this._events=new c.Z,this._entries=new Map,this._timings=new w.Z(10),this._currentContainer=null,this._currentPass=null,this._currentBrush=null,this._currentSummary=null,!D)return;this._ext=(0,u.mO)(m.gl,{}),this._debugOutput=o;const e=m.gl;if(!this.enableCommandLogging)return;let h;for(h in e)if("function"==typeof e[h]){const a=e[h],_=h.includes("draw");e[h]=(...R)=>(this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:h,args:R,isDrawCommand:_}),this._currentSummary&&(this._currentSummary.commands++,_&&this._currentSummary.drawCommands++),a.apply(e,R))}}get enableCommandLogging(){return!("object"==typeof D&&D.disableCommands)}recordContainerStart(m){D&&(this._currentContainer=m)}recordContainerEnd(){D&&(this._currentContainer=null)}recordPassStart(m){D&&(this._currentPass=m,this._initSummary())}recordPassEnd(){D&&(this._currentPass=null,this._emitSummary())}recordBrushStart(m){D&&(this._currentBrush=m)}recordBrushEnd(){D&&(this._currentBrush=null)}recordStart(m){if(D&&null!=this._ext){if(this._entries.has(m)){const e=this._entries.get(m),h=this._ext.resultAvailable(e.query),a=this._ext.disjoint();if(h&&!a){const _=this._ext.getResult(e.query)/1e6;let R=0;if(null!=this._timings.enqueue(_)){const Q=this._timings.entries,Y=Q.length;let X=0;for(const N of Q)X+=N;R=X/Y}const Z=_.toFixed(2),tt=R?R.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${m}, ${Z} ms (${tt} last 10 avg)\n${e.commandsLen} Commands (${e.drawCommands} draw)`),console.log("RenderPass breakdown: "),console.table(e.summaries),console.log("Commands: ",e.commands),console.groupEnd()):console.log(`Frame report for ${m}, ${Z} ms (${tt} last 10 avg)`),this._debugOutput.innerHTML=`${Z} (${tt})`}for(const _ of e.handles)_.remove();this._ext.deleteQuery(e.query),this._entries.delete(m)}const o={name:m,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(o.handles.push(this._events.on("command",e=>{o.commandsLen++,o.commands.push(e),e.isDrawCommand&&o.drawCommands++})),o.handles.push(this._events.on("summary",e=>{o.summaries.push(e)}))),this._ext.beginTimeElapsed(o.query),this._entries.set(m,o)}}recordEnd(m){D&&null!=this._ext&&this._entries.has(m)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._currentSummary&&this._events.emit("summary",this._currentSummary)}}},59319:(J,A,l)=>{l.d(A,{Q:()=>c});var w=l(61362);const c={shaders:{vertexShader:(0,w.w)("bitBlit/bitBlit.vert"),fragmentShader:(0,w.w)("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])}},8735:(J,A,l)=>{l.d(A,{C:()=>c,y:()=>M});var w=l(61362);const c={shaders:{vertexShader:(0,w.w)("highlight/textured.vert"),fragmentShader:(0,w.w)("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},M={shaders:{vertexShader:(0,w.w)("highlight/textured.vert"),fragmentShader:(0,w.w)("highlight/blur.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])}},6016:(J,A,l)=>{l.d(A,{F:()=>u,c:()=>M});var w=l(61362),c=l(82003);const M={shaders:{vertexShader:(0,w.w)("magnifier/magnifier.vert"),fragmentShader:(0,w.w)("magnifier/magnifier.frag")},attributes:new Map([["a_pos",0]])};function u(D){return(0,c.H)(D,M)}},23783:(J,A,l)=>{l.d(A,{H:()=>c});var w=l(61362);const c={shaders:{vertexShader:(0,w.w)("stencil/stencil.vert"),fragmentShader:(0,w.w)("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])}},46266:(J,A,l)=>{l.d(A,{Z:()=>dt});var w=l(15861),c=l(50484),M=l(96212),u=l(73514),D=l(14007),g=l(51172),f=l(95854),m=l(80543),h=(l(4703),l(65311),l(10141)),a=l(44107),_=l(31898),R=l(55768),Z=l(83321);const tt="esri-zoom-box",Q={container:`${tt}__container`,overlay:`${tt}__overlay`,background:`${tt}__overlay-background`,box:`${tt}__outline`};let X=class extends u.Z{constructor(s){super(s),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._rafId=null,this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(s){this.removeAllHandles(),this._destroyOverlay(),this._set("view",s),s&&this.addHandles([s.on("drag",["Shift"],t=>this._handleDrag(t,1),Z.f.INTERNAL),s.on("drag",["Shift","Control"],t=>this._handleDrag(t,-1),Z.f.INTERNAL)])}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin()}_update(s,t,n,r){this._box.x=s,this._box.y=t,this._box.width=n,this._box.height=r,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(s,t,n,r,d){const x=this.view,F=x.toMap((0,R.vW)(s+.5*n,t+.5*r));let z=Math.max(n/x.width,r/x.height);-1===d&&(z=1/z),this._destroyOverlay(),this.navigation.end(),x.goTo({center:F,scale:x.scale*z},{animationMode:"always",duration:(0,f.HA)((0,D.Z)("mapview-essential-goto-duration"))})}_updateBox(s,t,n,r){const d=this._boxShape;d.setAttributeNS(null,"x",""+s),d.setAttributeNS(null,"y",""+t),d.setAttributeNS(null,"width",""+n),d.setAttributeNS(null,"height",""+r),d.setAttributeNS(null,"class",Q.box)}_updateBackground(s,t,n,r){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(s,t,n,r,this.view.width,this.view.height))}_createContainer(){const s=document.createElement("div");s.className=Q.container,this.view.root.appendChild(s),this._container=s}_createOverlay(){const s=this.view.width,t=this.view.height,n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttributeNS(null,"d","M 0 0 L "+s+" 0 L "+s+" "+t+" L 0 "+t+" Z"),n.setAttributeNS(null,"class",Q.background);const r=document.createElementNS("http://www.w3.org/2000/svg","rect"),d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),d.setAttributeNS(null,"class",Q.overlay),d.appendChild(n),d.appendChild(r),this._container.appendChild(d),this._backgroundShape=n,this._boxShape=r,this._overlay=d}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(s,t,n,r,d,x){const F=s+n,z=t+r;return"M 0 0 L "+d+" 0 L "+d+" "+x+" L 0 "+x+" ZM "+s+" "+t+" L "+s+" "+z+" L "+F+" "+z+" L "+F+" "+t+" Z"}_handleDrag(s,t){const n=s.x,r=s.y,d=s.origin.x,x=s.origin.y;let F,z,G,H;switch(n>d?(F=d,G=n-d):(F=n,G=d-n),r>x?(z=x,H=r-x):(z=r,H=x-r),s.action){case"start":this._start();break;case"update":this._update(F,z,G,H);break;case"end":this._end(F,z,G,H,t)}s.stopPropagation()}_redraw(){if(!this._rafId||(this._rafId=null,!this._overlay))return;const{x:s,y:t,width:n,height:r}=this._box;this._updateBox(s,t,n,r),this._updateBackground(s,t,n,r),this._rafId=requestAnimationFrame(this._redraw)}};(0,c._)([(0,m.Cb)()],X.prototype,"navigation",void 0),(0,c._)([(0,m.Cb)()],X.prototype,"view",null),X=(0,c._)([(0,h.j)("esri.views.2d.navigation.ZoomBox")],X);const N=X;l(2189);var at=l(77675),st=l(43548),et=l(73145);class O{constructor(t){this._gain=t,this.lastValue=void 0,this.filteredDelta=void 0}update(t){if(this.hasLastValue()){const n=this.computeDelta(t);this._updateDelta(n)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return void 0!==this.lastValue}hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(t){return void 0===this.lastValue?NaN:t-this.lastValue}_updateDelta(t){this.filteredDelta=void 0!==this.filteredDelta?(1-this._gain)*this.filteredDelta+this._gain*t:t}}class p{constructor(t,n,r){this._initialVelocity=t,this._stopVelocity=n,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,n){const r=this.value(t);return this.value(t+n)-r}valueFromInitialVelocity(t,n){n=Math.min(n,this.duration);const r=1-this.friction;return t*(r**n-1)/Math.log(r)}}class T extends p{constructor(t,n,r,d,x){super(t,n,r),this._sceneVelocity=d,this.direction=x}value(t){return super.valueFromInitialVelocity(this._sceneVelocity,t)}}class E{constructor(t=300,n=12,r=.84){this._minimumInitialVelocity=t,this._stopVelocity=n,this._friction=r,this.enabled=!0,this._time=new O(.6),this._screen=[new O(.4),new O(.4)],this._scene=[new O(.6),new O(.6),new O(.6)],this._tmpDirection=(0,et.Ue)()}add(t,n,r){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(r)<.015)return;this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._scene[0].update(n[0]),this._scene[1].update(n[1]),this._scene[2].update(n[2]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const t=this._screen[0].filteredDelta,n=this._screen[1].filteredDelta,r=null==t||null==n?0:Math.sqrt(t*t+n*n),d=this._time.filteredDelta,x=null==d||null==r?0:r/d;return Math.abs(x)<this._minimumInitialVelocity?null:this.createMomentum(x,this._stopVelocity,this._friction)}createMomentum(t,n,r){(0,st.s)(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const d=(0,st.l)(this._tmpDirection);d>0&&(0,st.j)(this._tmpDirection,this._tmpDirection,1/d);const x=this._time.filteredDelta;return new T(t,n,r,null==x?0:d/x,this._tmpDirection)}}let I=class extends u.Z{constructor(s){super(s),this.animationTime=0,this.momentumEstimator=new E(500,6,.92),this.momentum=null,this.tmpMomentum=(0,et.Ue)(),this.momentumFinished=!1,this.viewpoint=new M.Z({targetGeometry:new a.Z,scale:0,rotation:0}),this._previousDrag=null,(0,at.gx)(()=>this.momentumFinished,()=>this.navigation.stop())}begin(s,t){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(t),this._previousDrag=t}update(s,t){this.addToEstimator(t);let n=t.center.x,r=t.center.y;const d=this._previousDrag;n=d?d.center.x-n:-n,r=d?r-d.center.y:r,s.viewpoint=(0,_.Rx)(this.viewpoint,s.viewpoint,[n||0,r||0]),this._previousDrag=t}end(s,t){this.addToEstimator(t),this.momentum=s.navigation.effectiveMomentumEnabled?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(s),this._previousDrag=null,this.navigation.end()}addToEstimator(s){const t=s.center.x,n=s.center.y,r=(0,R.s1)(-t,n),d=(0,et.al)(-t,n,0);this.momentumEstimator.add(r,d,.001*s.timestamp)}onAnimationUpdate(s){this.navigation.animationManager?.animateContinuous(s.viewpoint,(t,n)=>{const{momentum:r,animationTime:d,tmpMomentum:x}=this,F=.001*n;if(!(this.momentumFinished=!r||r.isFinished(d))){const z=r.valueDelta(d,F);(0,st.j)(x,r.direction,z),(0,_.Rx)(t,t,x),s.constraints.constrainByGeometry(t)}this.animationTime+=F})}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}};(0,c._)([(0,m.Cb)()],I.prototype,"momentumFinished",void 0),(0,c._)([(0,m.Cb)()],I.prototype,"viewpoint",void 0),(0,c._)([(0,m.Cb)()],I.prototype,"navigation",void 0),I=(0,c._)([(0,h.j)("esri.views.2d.navigation.actions.Pan")],I);const S=I;var y=l(29726),C=l(89014),b=l(55117);class B{constructor(t=2.5,n=.01,r=.95,d=12){this._minimumInitialVelocity=t,this._stopVelocity=n,this._friction=r,this._maxVelocity=d,this.enabled=!0,this.value=new O(.8),this.time=new O(.3)}add(t,n){if(this.enabled&&null!=n){if(this.time.hasLastValue()){if(this.time.computeDelta(n)<.01)return;if(this.value.hasFilteredDelta()){const r=this.value.computeDelta(t);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(n),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let t=this.value.filteredDelta/this.time.filteredDelta;return t=(0,b.uZ)(t,-this._maxVelocity,this._maxVelocity),Math.abs(t)<this._minimumInitialVelocity?null:this.createMomentum(t,this._stopVelocity,this._friction)}createMomentum(t,n,r){return new p(t,n,r)}}class L extends B{constructor(t=3,n=.01,r=.95,d=12){super(t,n,r,d)}add(t,n){const r=this.value.lastValue;if(null!=r){let d=t-r;for(;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;t=r+d}super.add(t,n)}}class j extends p{constructor(t,n,r){super(t,n,r)}value(t){const n=super.value(t);return Math.exp(n)}valueDelta(t,n){const r=super.value(t),d=super.value(t+n)-r;return Math.exp(d)}}class V extends B{constructor(t=2.5,n=.01,r=.95,d=12){super(t,n,r,d)}add(t,n){super.add(Math.log(t),n)}createMomentum(t,n,r){return new j(t,n,r)}}let P=class extends u.Z{constructor(s){super(s),this._animationTime=0,this._momentumFinished=!1,this._previousAngle=0,this._previousRadius=0,this._previousCenter=null,this._rotationMomentumEstimator=new L(.6,.15,.95),this._rotationDirection=1,this._startAngle=0,this._startRadius=0,this._updateTimestamp=null,this._zoomDirection=1,this._zoomMomentumEstimator=new V,this._zoomOnly=null,this.viewpoint=new M.Z({targetGeometry:new a.Z,scale:0,rotation:0}),this.zoomMomentum=null,this.rotateMomentum=null,this.addHandles((0,at.gx)(()=>this._momentumFinished,()=>this.navigation.stop()))}begin(s,t){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=t.angle,this._previousRadius=this._startRadius=t.radius,this._previousCenter=t.center,this._updateTimestamp=null,s.constraints.rotationEnabled&&this.addToRotateEstimator(0,t.timestamp),this.addToZoomEstimator(t,1)}update(s,t){null===this._updateTimestamp&&(this._updateTimestamp=t.timestamp);const n=t.angle,r=t.radius,d=t.center,x=Math.abs(180*(n-this._startAngle)/Math.PI),F=Math.abs(r-this._startRadius),z=this._startRadius/r;if(this._previousRadius&&this._previousCenter){const G=r/this._previousRadius;let H=180*(n-this._previousAngle)/Math.PI;this._rotationDirection=H>=0?1:-1,this._zoomDirection=G>=1?1:-1,s.constraints.rotationEnabled?(null===this._zoomOnly&&t.timestamp-this._updateTimestamp>200&&(this._zoomOnly=F-x>0),null===this._zoomOnly||this._zoomOnly?H=0:this.addToRotateEstimator(n-this._startAngle,t.timestamp)):H=0,this.addToZoomEstimator(t,z),this.navigation.setViewpoint([d.x,d.y],1/G,H,[this._previousCenter.x-d.x,d.y-this._previousCenter.y])}this._previousAngle=n,this._previousRadius=r,this._previousCenter=d}end(s){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(s),this.navigation.end()}addToRotateEstimator(s,t){this._rotationMomentumEstimator.add(s,.001*t)}addToZoomEstimator(s,t){this._zoomMomentumEstimator.add(t,.001*s.timestamp)}canZoomIn(s){const n=s.constraints.effectiveMaxScale;return 0===n||s.scale>n}canZoomOut(s){const n=s.constraints.effectiveMinScale;return 0===n||s.scale<n}onAnimationUpdate(s){this.navigation.animationManager?.animateContinuous(s.viewpoint,(t,n)=>{const r=!this.canZoomIn(s)&&this._zoomDirection>1||!this.canZoomOut(s)&&this._zoomDirection<1,d=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime),x=r||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime),F=.001*n;if(this._momentumFinished=d&&x,!this._momentumFinished){const z=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,F))*this._rotationDirection*180/Math.PI:0;let G=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,F)):1;const H=(0,C.Ue)(),rt=(0,C.Ue)();if(this._previousCenter){(0,y.t8)(H,this._previousCenter.x,this._previousCenter.y),(0,_.Dq)(rt,s.size,s.padding),(0,y.IH)(H,H,rt);const{constraints:ht,scale:lt}=s,_t=lt*G;G<1&&!ht.canZoomInTo(_t)?(G=lt/ht.effectiveMaxScale,this.zoomMomentum=null,this.rotateMomentum=null):G>1&&!ht.canZoomOutTo(_t)&&(G=lt/ht.effectiveMinScale,this.zoomMomentum=null,this.rotateMomentum=null),(0,_.UZ)(t,s.viewpoint,G,z,H,s.size),s.constraints.constrainByGeometry(t)}}this._animationTime+=F})}stopMomentumNavigation(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}};(0,c._)([(0,m.Cb)()],P.prototype,"_momentumFinished",void 0),(0,c._)([(0,m.Cb)()],P.prototype,"viewpoint",void 0),(0,c._)([(0,m.Cb)()],P.prototype,"navigation",void 0),P=(0,c._)([(0,h.j)("esri.views.2d.navigation.actions.Pinch")],P);const U=P,k=(0,C.Ue)(),ot=(0,C.Ue)();let nt=class extends u.Z{constructor(s){super(s),this._previousCenter=(0,C.Ue)(),this.viewpoint=new M.Z({targetGeometry:new a.Z,scale:0,rotation:0})}begin(s,t){this.navigation.begin(),(0,y.t8)(this._previousCenter,t.center.x,t.center.y)}update(s,t){const{state:{size:n,padding:r}}=s;(0,y.t8)(k,t.center.x,t.center.y),(0,_.ni)(ot,n,r),s.viewpoint=(0,_.$H)(this.viewpoint,s.state.paddedViewState.viewpoint,(0,_.dI)(ot,this._previousCenter,k)),(0,y.JG)(this._previousCenter,k)}end(){this.navigation.end()}};(0,c._)([(0,m.Cb)()],nt.prototype,"viewpoint",void 0),(0,c._)([(0,m.Cb)()],nt.prototype,"navigation",void 0),nt=(0,c._)([(0,h.j)("esri.views.2d.navigation.actions.Rotate")],nt);const i=nt,v=10,W=new M.Z({targetGeometry:new a.Z}),it=[0,0];let q=class extends u.Z{constructor(s){super(s),this._endTimer=null,this._lastEventTimestamp=null,this.animationManager=null,this.interacting=!1}initialize(){this.pan=new S({navigation:this}),this.rotate=new i({navigation:this}),this.pinch=new U({navigation:this}),this.zoomBox=new N({view:this.view,navigation:this})}destroy(){this.pan=(0,g.SC)(this.pan),this.rotate=(0,g.SC)(this.rotate),this.pinch=(0,g.SC)(this.pinch),this.zoomBox=(0,g.SC)(this.zoomBox),this.animationManager=null}begin(){this.stop(),this._set("interacting",!0)}end(){this._lastEventTimestamp=performance.now(),this._startTimer(250)}zoom(s,t=this._getDefaultAnchor()){var n=this;return(0,w.Z)(function*(){if(n.begin(),n.view.constraints.snapToZoom&&n.view.constraints.effectiveLODs)return s<1?n.zoomIn(t):n.zoomOut(t);n.setViewpoint(t,s,0,[0,0])})()}zoomIn(s){var t=this;return(0,w.Z)(function*(){const n=t.view,r=n.constraints.snapToNextScale(n.scale);return t._zoomToScale(r,s)})()}zoomOut(s){var t=this;return(0,w.Z)(function*(){const n=t.view,r=n.constraints.snapToPreviousScale(n.scale);return t._zoomToScale(r,s)})()}setViewpoint(s,t,n,r){this.begin(),this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,s,t,n,r),this.end()}setViewpointImmediate(s,t=0,n=[0,0],r=this._getDefaultAnchor()){this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,r,s,t,n)}continuousRotateClockwise(){const s=this.view.viewpoint;this.animationManager?.animateContinuous(s,t=>{(0,_.$H)(t,t,-1)})}continuousRotateCounterclockwise(){const s=this.view.viewpoint;this.animationManager?.animateContinuous(s,t=>{(0,_.$H)(t,t,1)})}resetRotation(){this.view.constraints.rotationEnabled&&(this.view.rotation=0)}continuousPanLeft(){this._continuousPan([-v,0])}continuousPanRight(){this._continuousPan([v,0])}continuousPanUp(){this._continuousPan([0,v])}continuousPanDown(){this._continuousPan([0,-v])}continuousPanVector({x:s,y:t}){this._continuousPan([s*v,t*v])}stop(){this.pan.stopMomentumNavigation(),this.animationManager?.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}_continuousPan(s){const t=this.view.viewpoint;this.animationManager?.animateContinuous(t,n=>{(0,_.Rx)(n,n,s),this.view.constraints.constrainByGeometry(n)})}_startTimer(s){return null!==this._endTimer||(this._endTimer=setTimeout(()=>{this._endTimer=null;const t=performance.now()-(this._lastEventTimestamp??0);t<250?this._endTimer=this._startTimer(t):this._set("interacting",!1)},s)),this._endTimer}_getDefaultAnchor(){const{size:s,padding:{left:t,right:n,top:r,bottom:d}}=this.view;return it[0]=.5*(s[0]-n+t),it[1]=.5*(s[1]-d+r),it}_zoomToScale(s,t=this._getDefaultAnchor()){var n=this;return(0,w.Z)(function*(){const{view:r}=n,{constraints:d,scale:x,viewpoint:F,size:z,padding:G}=r,H=d.canZoomInTo(s),rt=d.canZoomOutTo(s);if(!(s<x&&!H||s>x&&!rt))return(0,_.gG)(W,F,s/x,0,t,z,G),d.constrainByGeometry(W),r.goTo(W,{animate:!0,animationMode:"always",duration:(0,f.HA)((0,D.Z)("mapview-essential-goto-duration")),pickClosestTarget:!1})})()}_scaleRotateTranslateViewpoint(s,t,n,r,d){const{view:x}=this,{size:F,padding:z,constraints:G,scale:H,viewpoint:rt}=x,ht=H*n,lt=G.canZoomInTo(ht),_t=G.canZoomOutTo(ht);return(n<1&&!lt||n>1&&!_t)&&(n=1),(0,_.Rx)(rt,rt,d),(0,_.gG)(s,rt,n,r,t,F,z),G.constrainByGeometry(s)}};(0,c._)([(0,m.Cb)()],q.prototype,"animationManager",void 0),(0,c._)([(0,m.Cb)({type:Boolean,readOnly:!0})],q.prototype,"interacting",void 0),(0,c._)([(0,m.Cb)()],q.prototype,"pan",void 0),(0,c._)([(0,m.Cb)()],q.prototype,"pinch",void 0),(0,c._)([(0,m.Cb)()],q.prototype,"rotate",void 0),(0,c._)([(0,m.Cb)()],q.prototype,"view",void 0),(0,c._)([(0,m.Cb)()],q.prototype,"zoomBox",void 0),q=(0,c._)([(0,h.j)("esri.views.2d.navigation.MapViewNavigation")],q);const dt=q},53299:(J,A,l)=>{l.d(A,{H:()=>M,K:()=>c});const c=class w{};function M(u,...D){let g="";for(let f=0;f<D.length;f++)g+=u[f]+D[f];return g+=u[u.length-1],g}var u;(u=M||(M={})).int=function D(f){return Math.round(f).toString()},u.float=function g(f){return f.toPrecision(8)}},15182:(J,A,l)=>{var w,c,M,u,D,g,f,m,o,e;l.d(A,{Gv:()=>c,Iq:()=>m,JJ:()=>f,Rw:()=>u,Ti:()=>o,V_:()=>g,Vr:()=>w,Xx:()=>M,hU:()=>D}),(e=w||(w={}))[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT",function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(c||(c={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(M||(M={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(u||(u={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(D||(D={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(g||(g={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(f||(f={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(m||(m={})),function(e){e.DDS_ENCODING="image/vnd-ms.dds",e.KTX2_ENCODING="image/ktx2",e.BASIS_ENCODING="image/x.basis"}(o||(o={}))},89437:(J,A,l)=>{l.d(A,{G:()=>c});var w=l(51172);class c{constructor(){this._result=!1}dispose(){this._program=(0,w.M2)(this._program)}get result(){return null!=this._program&&(this._result=this._test(this._program),this.dispose()),this._result}}},13646:(J,A,l)=>{l.d(A,{mO:()=>M});class w{constructor(D,g,f,m,o,e,h,a,_){this.createQuery=D,this.deleteQuery=g,this.resultAvailable=f,this.getResult=m,this.disjoint=o,this.beginTimeElapsed=e,this.endTimeElapsed=h,this.createTimestamp=a,this.timestampBits=_}}let c=!1;function M(u,D){if(D.disjointTimerQuery)return null;let g=u.getExtension("EXT_disjoint_timer_query_webgl2");return g?new w(()=>u.createQuery(),f=>{u.deleteQuery(f),c=!1},f=>u.getQueryParameter(f,u.QUERY_RESULT_AVAILABLE),f=>u.getQueryParameter(f,u.QUERY_RESULT),()=>u.getParameter(g.GPU_DISJOINT_EXT),f=>{c||(c=!0,u.beginQuery(g.TIME_ELAPSED_EXT,f))},()=>{u.endQuery(g.TIME_ELAPSED_EXT),c=!1},f=>g.queryCounterEXT(f,g.TIMESTAMP_EXT),()=>u.getQuery(g.TIMESTAMP_EXT,g.QUERY_COUNTER_BITS_EXT)):(g=u.getExtension("EXT_disjoint_timer_query"),g?new w(()=>g.createQueryEXT(),f=>{g.deleteQueryEXT(f),c=!1},f=>g.getQueryObjectEXT(f,g.QUERY_RESULT_AVAILABLE_EXT),f=>g.getQueryObjectEXT(f,g.QUERY_RESULT_EXT),()=>u.getParameter(g.GPU_DISJOINT_EXT),f=>{c||(c=!0,g.beginQueryEXT(g.TIME_ELAPSED_EXT,f))},()=>{g.endQueryEXT(g.TIME_ELAPSED_EXT),c=!1},f=>g.queryCounterEXT(f,g.TIMESTAMP_EXT),()=>g.getQueryEXT(g.TIMESTAMP_EXT,g.QUERY_COUNTER_BITS_EXT)):null)}},89877:(J,A,l)=>{l.d(A,{BK:()=>o,LZ:()=>m,if:()=>M,jp:()=>nt,sm:()=>X,wK:()=>u,zp:()=>f});var w=l(15182),c=l(39237);function M(i,v,K=c.db.ADD,W=[0,0,0,0]){return{srcRgb:i,srcAlpha:i,dstRgb:v,dstAlpha:v,opRgb:K,opAlpha:K,color:{r:W[0],g:W[1],b:W[2],a:W[3]}}}function u(i,v,K,W,it=c.db.ADD,ut=c.db.ADD,q=[0,0,0,0]){return{srcRgb:i,srcAlpha:v,dstRgb:K,dstAlpha:W,opRgb:it,opAlpha:ut,color:{r:q[0],g:q[1],b:q[2],a:q[3]}}}const D={face:c.LR.BACK,mode:c.Wf.CCW},g={face:c.LR.FRONT,mode:c.Wf.CCW},f=i=>i===w.Vr.Back?D:i===w.Vr.Front?g:null,m={zNear:0,zFar:1},o={r:!0,g:!0,b:!0,a:!0};function e(i){return at.intern(i)}function h(i){return et.intern(i)}function a(i){return p.intern(i)}function _(i){return E.intern(i)}function R(i){return S.intern(i)}function Z(i){return C.intern(i)}function tt(i){return B.intern(i)}function Q(i){return j.intern(i)}function Y(i){return P.intern(i)}function X(i){return k.intern(i)}class N{constructor(v,K){this._makeKey=v,this._makeRef=K,this._interns=new Map}intern(v){if(!v)return null;const K=this._makeKey(v),W=this._interns;return W.has(K)||W.set(K,this._makeRef(v)),W.get(K)??null}}function $(i){return"["+i.join(",")+"]"}const at=new N(st,i=>({__tag:"Blending",...i}));function st(i){return i?$([i.srcRgb,i.srcAlpha,i.dstRgb,i.dstAlpha,i.opRgb,i.opAlpha,i.color.r,i.color.g,i.color.b,i.color.a]):null}const et=new N(O,i=>({__tag:"Culling",...i}));function O(i){return i?$([i.face,i.mode]):null}const p=new N(T,i=>({__tag:"PolygonOffset",...i}));function T(i){return i?$([i.factor,i.units]):null}const E=new N(I,i=>({__tag:"DepthTest",...i}));function I(i){return i?$([i.func]):null}const S=new N(y,i=>({__tag:"StencilTest",...i}));function y(i){return i?$([i.function.func,i.function.ref,i.function.mask,i.operation.fail,i.operation.zFail,i.operation.zPass]):null}const C=new N(b,i=>({__tag:"DepthWrite",...i}));function b(i){return i?$([i.zNear,i.zFar]):null}const B=new N(L,i=>({__tag:"ColorWrite",...i}));function L(i){return i?$([i.r,i.g,i.b,i.a]):null}const j=new N(V,i=>({__tag:"StencilWrite",...i}));function V(i){return i?$([i.mask]):null}const P=new N(U,i=>({__tag:"DrawBuffers",...i}));function U(i){return i?$(i.buffers):null}const k=new N(function ot(i){return i?$([st(i.blending),O(i.culling),T(i.polygonOffset),I(i.depthTest),y(i.stencilTest),b(i.depthWrite),L(i.colorWrite),V(i.stencilWrite),U(i.drawBuffers)]):null},i=>({blending:e(i.blending),culling:h(i.culling),polygonOffset:a(i.polygonOffset),depthTest:_(i.depthTest),stencilTest:R(i.stencilTest),depthWrite:Z(i.depthWrite),colorWrite:tt(i.colorWrite),stencilWrite:Q(i.stencilWrite),drawBuffers:Y(i.drawBuffers)}));class nt{constructor(v){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=v}setPipeline(v){(this._pipelineInvalid||v!==this._pipeline)&&(this._setBlending(v.blending),this._setCulling(v.culling),this._setPolygonOffset(v.polygonOffset),this._setDepthTest(v.depthTest),this._setStencilTest(v.stencilTest),this._setDepthWrite(v.depthWrite),this._setColorWrite(v.colorWrite),this._setStencilWrite(v.stencilWrite),this._setDrawBuffers(v.drawBuffers),this._pipeline=v),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(v){this._blending=this._setSubState(v,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(v){this._culling=this._setSubState(v,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(v){this._polygonOffset=this._setSubState(v,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(v){this._depthTest=this._setSubState(v,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(v){this._stencilTest=this._setSubState(v,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(v){this._depthWrite=this._setSubState(v,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(v){this._colorWrite=this._setSubState(v,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(v){this._stencilWrite=this._setSubState(v,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(v){this._drawBuffers=this._setSubState(v,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(v,K,W,it){return(W||v!==K)&&(it(v),this._pipelineInvalid=!0),v}}},90771:(J,A,l)=>{l.d(A,{d:()=>o});var w=l(40176),c=l(39853),M=l(39237),u=l(83018),D=l(17091),g=l(22784),f=l(46682),m=l(89437);class o extends m.G{constructor(a){super(),this._rctx=a,this._program=a.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv = a_pos;\n      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor = texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(a){const _=this._rctx;if(!_.gl)return a.dispose(),!0;const R=new g.X(1);R.wrapMode=M.e8.CLAMP_TO_EDGE,R.samplingMode=M.cw.NEAREST;const Z=new u.X(_,R),tt=c.f.createVertex(_,M.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),Q=new f.U(_,new Map([["a_pos",0]]),w.cD,{geometry:tt}),Y=new g.X;Y.samplingMode=M.cw.LINEAR,Y.wrapMode=M.e8.CLAMP_TO_EDGE;const X=new D.x(_,Y,e);_.useProgram(a),_.bindTexture(X,0),a.setUniform1i("u_texture",0);const N=_.getBoundFramebufferObject(),{x:$,y:at,width:st,height:et}=_.getViewport();_.bindFramebuffer(Z),_.setViewport(0,0,1,1),_.setClearColor(0,0,0,0),_.setBlendingEnabled(!1),_.clear(M.lk.COLOR_BUFFER_BIT),_.bindVAO(Q),_.drawArrays(M.MX.TRIANGLE_STRIP,0,4);const O=new Uint8Array(4);return Z.readPixels(0,0,1,1,M.VI.RGBA,M.Br.UNSIGNED_BYTE,O),Q.dispose(),Z.dispose(),X.dispose(),_.setViewport($,at,st,et),_.bindFramebuffer(N),255!==O[0]}}const e=new Image;e.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",e.width=5,e.height=5,e.decode()}}]);