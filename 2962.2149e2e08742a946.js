"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[2962,318],{38519:(ge,ne,u)=>{function A(){return[1,0,0,0,1,0,0,0,1]}function J(H,C,V,L,j,K,N,ee,z){return[H,C,V,L,j,K,N,ee,z]}u.d(ne,{Ue:()=>A,Wd:()=>W,al:()=>J});const W=[1,0,0,0,1,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:W,clone:function f(H){return[H[0],H[1],H[2],H[3],H[4],H[5],H[6],H[7],H[8]]},create:A,createView:function G(H,C){return new Float64Array(H,C,9)},fromValues:J},Symbol.toStringTag,{value:"Module"}))},26540:(ge,ne,u)=>{u.d(ne,{Q:()=>W});var A=u(57678),J=(u(14007),u(43029)),G=u(4758);class W{constructor(n=9,p){this._compareMinX=K,this._compareMinY=N,this._toBBox=d=>d,this._maxEntries=Math.max(4,n||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),p&&("function"==typeof p?this._toBBox=p:this._initFormat(p)),this.clear()}destroy(){this.clear(),Q.prune(),g.prune(),h.prune(),y.prune()}all(n){H(this._data,n)}search(n,p){let d=this._data;const P=this._toBBox;if($(n,d))for(Q.clear();d;){for(let E=0,R=d.children.length;E<R;E++){const M=d.children[E],U=d.leaf?P(M):M;$(n,U)&&(d.leaf?p(M):D(n,U)?H(M,p):Q.push(M))}d=Q.pop()}}collides(n){let p=this._data;const d=this._toBBox;if(!$(n,p))return!1;for(Q.clear();p;){for(let P=0,E=p.children.length;P<E;P++){const R=p.children[P],M=p.leaf?d(R):R;if($(n,M)){if(p.leaf||D(n,M))return!0;Q.push(R)}}p=Q.pop()}return!1}load(n){if(!n.length)return this;if(n.length<this._minEntries){for(let d=0,P=n.length;d<P;d++)this.insert(n[d]);return this}let p=this._build(n.slice(0,n.length),0,n.length-1,0);if(this._data.children.length)if(this._data.height===p.height)this._splitRoot(this._data,p);else{if(this._data.height<p.height){const d=this._data;this._data=p,p=d}this._insert(p,this._data.height-p.height-1,!0)}else this._data=p;return this}insert(n){return n&&this._insert(n,this._data.height-1),this}clear(){return this._data=new _([]),this}remove(n){if(!n)return this;let p,d=this._data,P=null,E=0,R=!1;const M=this._toBBox(n);for(h.clear(),y.clear();d||h.length>0;){if(d||(d=h.pop(),P=h.data[h.length-1],E=y.pop()??0,R=!0),d.leaf&&(p=(0,A.cq)(d.children,n,d.children.length,d.indexHint),-1!==p))return d.children.splice(p,1),h.push(d),this._condense(h),this;R||d.leaf||!D(d,M)?P?(E++,d=P.children[E],R=!1):d=null:(h.push(d),y.push(E),E=0,P=d,d=d.children[0])}return this}toJSON(){return this._data}fromJSON(n){return this._data=n,this}_build(n,p,d,P){const E=d-p+1;let R=this._maxEntries;if(E<=R){const T=new _(n.slice(p,d+1));return V(T,this._toBBox),T}P||(P=Math.ceil(Math.log(E)/Math.log(R)),R=Math.ceil(E/R**(P-1)));const M=new v([]);M.height=P;const U=Math.ceil(E/R),Y=U*Math.ceil(Math.sqrt(R));re(n,p,d,Y,this._compareMinX);for(let T=p;T<=d;T+=Y){const Z=Math.min(T+Y-1,d);re(n,T,Z,U,this._compareMinY);for(let k=T;k<=Z;k+=U){const se=Math.min(k+U-1,Z);M.children.push(this._build(n,k,se,P-1))}}return V(M,this._toBBox),M}_insert(n,p,d){const E=d?n:(0,this._toBBox)(n);h.clear();const R=function F(a,n,p,d){for(;d.push(n),!0!==n.leaf&&d.length-1!==p;){let P,E=1/0,R=1/0;for(let M=0,U=n.children.length;M<U;M++){const Y=n.children[M],T=ee(Y),Z=b(a,Y)-T;Z<R?(R=Z,E=T<E?T:E,P=Y):Z===R&&T<E&&(E=T,P=Y)}n=P||n.children[0]}return n}(E,this._data,p,h);for(R.children.push(n),j(R,E);p>=0&&h.data[p].children.length>this._maxEntries;)this._split(h,p),p--;!function C(a,n,p){for(let d=p;d>=0;d--)j(n.data[d],a)}(E,h,p)}_split(n,p){const d=n.data[p],P=d.children.length,E=this._minEntries;this._chooseSplitAxis(d,E,P);const R=this._chooseSplitIndex(d,E,P);if(!R)return;const M=d.children.splice(R,d.children.length-R),U=d.leaf?new _(M):new v(M);U.height=d.height,V(d,this._toBBox),V(U,this._toBBox),p?n.data[p-1].children.push(U):this._splitRoot(d,U)}_splitRoot(n,p){this._data=new v([n,p]),this._data.height=n.height+1,V(this._data,this._toBBox)}_chooseSplitIndex(n,p,d){let P,E,R;P=E=1/0;for(let M=p;M<=d-p;M++){const U=L(n,0,M,this._toBBox),Y=L(n,M,d,this._toBBox),T=X(U,Y),Z=ee(U)+ee(Y);T<P?(P=T,R=M,E=Z<E?Z:E):T===P&&Z<E&&(E=Z,R=M)}return R}_chooseSplitAxis(n,p,d){const P=n.leaf?this._compareMinX:K,E=n.leaf?this._compareMinY:N;this._allDistMargin(n,p,d,P)<this._allDistMargin(n,p,d,E)&&n.children.sort(P)}_allDistMargin(n,p,d,P){n.children.sort(P);const E=this._toBBox,R=L(n,0,p,E),M=L(n,d-p,d,E);let U=z(R)+z(M);for(let Y=p;Y<d-p;Y++){const T=n.children[Y];j(R,n.leaf?E(T):T),U+=z(R)}for(let Y=d-p-1;Y>=p;Y--){const T=n.children[Y];j(M,n.leaf?E(T):T),U+=z(M)}return U}_condense(n){for(let p=n.length-1;p>=0;p--){const d=n.data[p];if(0===d.children.length)if(p>0){const P=n.data[p-1],E=P.children;E.splice((0,A.cq)(E,d,E.length,P.indexHint),1)}else this.clear();else V(d,this._toBBox)}}_initFormat(n){const p=["return a"," - b",";"];this._compareMinX=new Function("a","b",p.join(n[0])),this._compareMinY=new Function("a","b",p.join(n[1])),this._toBBox=new Function("a","return {minX: a"+n[0]+", minY: a"+n[1]+", maxX: a"+n[2]+", maxY: a"+n[3]+"};")}}function H(a,n){let p=a;for(g.clear();p;){if(!0===p.leaf)for(const d of p.children)n(d);else g.pushArray(p.children);p=g.pop()??null}}function V(a,n){L(a,0,a.children.length,n,a)}function L(a,n,p,d,P){P||(P=new _([])),P.minX=1/0,P.minY=1/0,P.maxX=-1/0,P.maxY=-1/0;for(let E,R=n;R<p;R++)E=a.children[R],j(P,a.leaf?d(E):E);return P}function j(a,n){a.minX=Math.min(a.minX,n.minX),a.minY=Math.min(a.minY,n.minY),a.maxX=Math.max(a.maxX,n.maxX),a.maxY=Math.max(a.maxY,n.maxY)}function K(a,n){return a.minX-n.minX}function N(a,n){return a.minY-n.minY}function ee(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function z(a){return a.maxX-a.minX+(a.maxY-a.minY)}function b(a,n){return(Math.max(n.maxX,a.maxX)-Math.min(n.minX,a.minX))*(Math.max(n.maxY,a.maxY)-Math.min(n.minY,a.minY))}function X(a,n){const p=Math.max(a.minX,n.minX),d=Math.max(a.minY,n.minY),P=Math.min(a.maxX,n.maxX),E=Math.min(a.maxY,n.maxY);return Math.max(0,P-p)*Math.max(0,E-d)}function D(a,n){return a.minX<=n.minX&&a.minY<=n.minY&&n.maxX<=a.maxX&&n.maxY<=a.maxY}function $(a,n){return n.minX<=a.maxX&&n.minY<=a.maxY&&n.maxX>=a.minX&&n.maxY>=a.minY}function re(a,n,p,d,P){const E=[n,p];for(;E.length;){const R=E.pop(),M=E.pop();if(R-M<=d)continue;const U=M+Math.ceil((R-M)/d/2)*d;(0,G.q)(a,U,M,R,P),E.push(M,U,U,R)}}const Q=new J.Z,g=new J.Z,h=new J.Z,y=new J.Z({deallocator:void 0});class x{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class I extends x{constructor(){super(...arguments),this.height=1,this.indexHint=new A.SO}}class _ extends I{constructor(n){super(),this.children=n,this.leaf=!0}}class v extends I{constructor(n){super(),this.children=n,this.leaf=!1}}},95150:(ge,ne,u)=>{u.d(ne,{SR:()=>V,Ui:()=>C});var A=u(89317),f=u(45425),J=u(43585),G=u(54746),W=u(40637),F=u(23991),H=u(33721);function C(g){return L(g,!0)}function V(g){return L(g,!1)}function L(g,h){if(null==g)return null;const y=g.spatialReference,x=(0,H.C5)(y),I=(0,A.AK)(g)?g.toJSON():g;if(!x)return I;const _=(0,H.sS)(y)?102100:4326,v=F.UZ[_].maxX,a=F.UZ[_].minX;if((0,W.wp)(I))return K(I,v,a);if((0,W.aW)(I))return I.points=I.points.map(n=>K(n,v,a)),I;if((0,W.YX)(I))return function j(g,h){if(!h)return g;const y=function N(g,h){const y=[],{ymin:x,ymax:I,xmin:_,xmax:v}=g,a=g.xmax-g.xmin,[n,p]=h.valid,{x:d,frameId:P}=ee(g.xmin,h),{x:E,frameId:R}=ee(g.xmax,h),M=d===E&&a>0;if(a>2*p){const U={xmin:_<v?d:E,ymin:x,xmax:p,ymax:I},Y={xmin:n,ymin:x,xmax:_<v?E:d,ymax:I},T={xmin:0,ymin:x,xmax:p,ymax:I},Z={xmin:n,ymin:x,xmax:0,ymax:I},k=[],se=[];z(U,T)&&k.push(P),z(U,Z)&&se.push(P),z(Y,T)&&k.push(R),z(Y,Z)&&se.push(R);for(let le=P+1;le<R;le++)k.push(le),se.push(le);y.push(new D(U,[P]),new D(Y,[R]),new D(T,k),new D(Z,se))}else d>E||M?y.push(new D({xmin:d,ymin:x,xmax:p,ymax:I},[P]),new D({xmin:n,ymin:x,xmax:E,ymax:I},[R])):y.push(new D({xmin:d,ymin:x,xmax:E,ymax:I},[P]));return y}(g,h).map(x=>x.extent);return y.length<2?y[0]||g:y.length>2?(g.xmin=h.valid[0],g.xmax=h.valid[1],g):{rings:y.map(x=>[[x.xmin,x.ymin],[x.xmin,x.ymax],[x.xmax,x.ymax],[x.xmax,x.ymin],[x.xmin,x.ymin]])}}(I,x);if((0,W.oU)(I)||(0,W.l9)(I)){const n=(0,J.$P)($,I),p={xmin:n[0],ymin:n[1],xmax:n[2],ymax:n[3]},d=(0,F.XZ)(p.xmin,a)*(2*v),P=0===d?I:(0,F.Sy)(I,d);return p.xmin+=d,p.xmax+=d,p.xmax>v?X(P,v,h):p.xmin<a?X(P,a,h):P}return I}function K(g,h,y){if(Array.isArray(g)){const x=g[0];if(x>h){const I=(0,F.XZ)(x,h);g[0]=x+I*(-2*h)}else if(x<y){const I=(0,F.XZ)(x,y);g[0]=x+I*(-2*y)}}else{const x=g.x;if(x>h){const I=(0,F.XZ)(x,h);g.x+=I*(-2*h)}else if(x<y){const I=(0,F.XZ)(x,y);g.x+=I*(-2*y)}}return g}function ee(g,h){const[y,x]=h.valid,I=2*x;let _,v=0;return g>x?(_=Math.ceil(Math.abs(g-x)/I),g-=_*I,v=_):g<y&&(_=Math.ceil(Math.abs(g-y)/I),g+=_*I,v=-_),{x:g,frameId:v}}function z(g,h){const{xmin:y,ymin:x,xmax:I,ymax:_}=h;return b(g,y,x)&&b(g,y,_)&&b(g,I,_)&&b(g,I,x)}function b(g,h,y){return h>=g.xmin&&h<=g.xmax&&y>=g.ymin&&y<=g.ymax}function X(g,h,y=!0){const x=!(0,W.l9)(g);if(x&&(0,G.Zy)(g),y)return(new re).cut(g,h);const I=x?g.rings:g.paths,_=x?4:2,v=I.length,a=-2*h;for(let n=0;n<v;n++){const p=I[n];if(p&&p.length>=_){const d=[];for(const P of p)d.push([P[0]+a,P[1]]);I.push(d)}}return x?g.rings=I:g.paths=I,g}class D{constructor(h,y){this.extent=h,this.frameIds=y}}const $=(0,f.Ue)();class re{constructor(){this._linesIn=[],this._linesOut=[]}cut(h,y){let x;if(this._xCut=y,h.rings)this._closed=!0,x=h.rings,this._minPts=4;else{if(!h.paths)return null;this._closed=!1,x=h.paths,this._minPts=2}for(const _ of x){if(!_||_.length<this._minPts)continue;let v=!0;for(const a of _)v?(this.moveTo(a),v=!1):this.lineTo(a);this._closed&&this.close()}this._pushLineIn(),this._pushLineOut(),x=[];for(const _ of this._linesIn)_&&_.length>=this._minPts&&x.push(_);const I=-2*this._xCut;for(const _ of this._linesOut)if(_&&_.length>=this._minPts){for(const v of _)v[0]+=I;x.push(_)}return this._closed?h.rings=x:h.paths=x,h}moveTo(h){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(h[0]),this._moveTo(h[0],h[1],this._prevSide),this._prevPt=h,this._firstPt=h}lineTo(h){const y=this._side(h[0]);if(y*this._prevSide==-1){const x=this._intersect(this._prevPt,h);this._lineTo(this._xCut,x,0),this._prevSide=0,this._lineTo(h[0],h[1],y)}else this._lineTo(h[0],h[1],y);this._prevSide=y,this._prevPt=h}close(){const h=this._firstPt,y=this._prevPt;h[0]===y[0]&&h[1]===y[1]||this.lineTo(h),this._checkClosingPt(this._lineIn),this._checkClosingPt(this._lineOut)}_moveTo(h,y,x){this._closed?(this._lineIn.push([x<=0?h:this._xCut,y]),this._lineOut.push([x>=0?h:this._xCut,y])):(x<=0&&this._lineIn.push([h,y]),x>=0&&this._lineOut.push([h,y]))}_lineTo(h,y,x){this._closed?(Q(this._lineIn,x<=0?h:this._xCut,y),Q(this._lineOut,x>=0?h:this._xCut,y)):x<0?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([h,y])):x>0?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([h,y])):this._prevSide<0?(this._lineIn.push([h,y]),this._lineOut.push([h,y])):this._prevSide>0&&(this._lineOut.push([h,y]),this._lineIn.push([h,y]))}_checkClosingPt(h){const y=h.length;y>3&&h[0][0]===this._xCut&&h[y-2][0]===this._xCut&&h[1][0]===this._xCut&&(h[0][1]=h[y-2][1],h.pop())}_side(h){return h<this._xCut?-1:h>this._xCut?1:0}_intersect(h,y){return h[1]+(this._xCut-h[0])/(y[0]-h[0])*(y[1]-h[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn),this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut),this._lineOut=[]}}function Q(g,h,y){const x=g.length;x>1&&g[x-1][0]===h&&g[x-2][0]===h?g[x-1][1]=y:g.push([h,y])}},94643:(ge,ne,u)=>{u.r(ne),u.d(ne,{default:()=>St});var A=u(15861),f=u(50484),J=u(83944),G=u(57964),W=u(4703),F=u(3233),H=u(79412),C=u(80543),V=u(73018),K=(u(65311),u(14007),u(62185)),N=u(10141),ee=u(7547),z=u(60301),b=u(95060),X=u(19855),D=u(80099),$=u(70509),re=u(29717),Q=u(25387),g=u(89317),h=u(12933),y=u(55768),x=u(92899),I=u(38519),_=u(29726),v=u(89014),a=u(44107),n=u(5391),p=u(83821),d=u(43814);let P=class extends Q.j{projectOrWarn(e,t){if(null==e)return e;const{geometry:l,pending:c}=(0,p.projectOrLoad)(e,t);return c?null:c||l?l:(W.Z.getLogger(this).warn("geometry could not be projected to the spatial reference",{georeference:this,geometry:e,sourceSpatialReference:e.spatialReference,targetSpatialReference:t}),null)}};P=(0,f._)([(0,N.j)("esri.layers.support.GeoreferenceBase")],P);const E=P,R=(0,I.Ue)(),M=(0,v.Ue)();let U=class extends g.wq{};(0,f._)([(0,C.Cb)({type:Number,json:{write:!0}})],U.prototype,"x",void 0),(0,f._)([(0,C.Cb)({type:Number,json:{write:!0}})],U.prototype,"y",void 0),U=(0,f._)([(0,N.j)("esri.layers.support.ControlPointsGeoreference.ControlPointJSONType")],U);let Y=class extends Q.j{constructor(){super(...arguments),this.sourcePoint=null,this.mapPoint=null}};(0,f._)([(0,C.Cb)()],Y.prototype,"sourcePoint",void 0),(0,f._)([(0,C.Cb)({type:a.Z})],Y.prototype,"mapPoint",void 0),Y=(0,f._)([(0,N.j)("esri.layers.support.ControlPointsGeoreference.ControlPoint")],Y);let T=class extends((0,g.eC)(E)){constructor(e){super(e),this.controlPoints=null,this.height=0,this.type="control-points",this.width=0}readControlPoints(e,t){const l=d.Z.fromJSON(t.spatialReference),c=(0,I.al)(...t.coefficients,1);return e.map(m=>((0,_.t8)(M,m.x,m.y),(0,h.H)(M,M,c),{sourcePoint:m,mapPoint:new a.Z({x:M[0],y:M[1],spatialReference:l})}))}writeControlPoints(e,t,l,c){if(null!=this.transform)null!=e&&Z(e[0])&&(t.controlPoints=e.map(m=>{const O=m.sourcePoint;return{x:O.x,y:O.y}}),t.spatialReference=e[0].mapPoint.spatialReference.toJSON(),t.coefficients=this.transform.slice(0,8));else{const m=new G.Z("web-document-write:invalid-georeference","Invalid 'controlPoints', 'width', 'height' configuration.",{layer:c?.layer,georeference:this});c?.messages?c.messages.push(m):W.Z.getLogger(this).error(m.name,m.message)}}get coords(){if(null==this.controlPoints)return null;const e=this._updateTransform(R);return null!=e&&Z(this.controlPoints[0])?function et(e,t,l,c){const m=(0,v.al)(0,l),O=(0,v.al)(0,0),S=(0,v.al)(t,0),B=(0,v.al)(t,l);return(0,h.H)(m,m,e),(0,h.H)(O,O,e),(0,h.H)(S,S,e),(0,h.H)(B,B,e),new n.Z({rings:[[m,O,S,B,m]],spatialReference:c})}(e,this.width,this.height,this.controlPoints[0].mapPoint.spatialReference):null}set coords(e){if(null==this.controlPoints||!Z(this.controlPoints[0]))return;const t=this.controlPoints[0].mapPoint.spatialReference;if(null==(e=this.projectOrWarn(e,t)))return;const{width:l,height:c}=this,{rings:[[m,O,S,B]]}=e,w={sourcePoint:(0,y.vW)(0,c),mapPoint:new a.Z({x:m[0],y:m[1],spatialReference:t})},q={sourcePoint:(0,y.vW)(0,0),mapPoint:new a.Z({x:O[0],y:O[1],spatialReference:t})},te={sourcePoint:(0,y.vW)(l,0),mapPoint:new a.Z({x:S[0],y:S[1],spatialReference:t})},oe={sourcePoint:(0,y.vW)(l,c),mapPoint:new a.Z({x:B[0],y:B[1],spatialReference:t})};Z(w)&&Z(q)&&Z(te)&&Z(oe)&&(We(R,w,q,te,oe),this.controlPoints=this.controlPoints.map(({sourcePoint:ae})=>((0,_.t8)(M,ae.x,ae.y),(0,h.H)(M,M,R),{sourcePoint:ae,mapPoint:new a.Z({x:M[0],y:M[1],spatialReference:t})})))}get inverseTransform(){return null==this.transform?null:(0,x.U_)((0,I.Ue)(),this.transform)}get transform(){return this._updateTransform()}toMap(e){if(null==e||null==this.transform||null==this.controlPoints||!Z(this.controlPoints[0]))return null;(0,_.t8)(M,e.x,e.y);const t=this.controlPoints[0].mapPoint.spatialReference;return(0,h.H)(M,M,this.transform),new a.Z({x:M[0],y:M[1],spatialReference:t})}toSource(e){if(null==e||null==this.inverseTransform||null==this.controlPoints||!Z(this.controlPoints[0]))return null;const t=this.controlPoints[0].mapPoint.spatialReference;return e=e.normalize(),null==(e=(0,p.projectOrLoad)(e,t).geometry)?null:((0,_.t8)(M,e.x,e.y),(0,h.H)(M,M,this.inverseTransform),(0,y.vW)(M[0],M[1]))}toSourceNormalized(e){const t=this.toSource(e);return null!=t&&(t.x/=this.width,t.y/=this.height),t}_updateTransform(e){const{controlPoints:t,width:l,height:c}=this;if(!(null!=t&&l>0&&c>0))return null;const[m,O,S,B]=t;if(!Z(m))return null;const w=m.mapPoint.spatialReference,q=this._projectControlPoint(O,w),te=this._projectControlPoint(S,w),oe=this._projectControlPoint(B,w);if(!(q.valid&&te.valid&&oe.valid&&Z(q.controlPoint)))return null;null==e&&(e=(0,I.Ue)());let ae=null;return ae=Z(te.controlPoint)&&Z(oe.controlPoint)?We(e,m,q.controlPoint,te.controlPoint,oe.controlPoint):Z(te.controlPoint)?function Qe(e,t,l,c){return de(k,he,t),de(se,ue,l),de(le,xe,c),(0,_.t7)(pe,k,se,.5),(0,_.U1)(pe,le,pe,Math.PI),(0,_.t7)(me,he,ue,.5),(0,_.U1)(me,xe,me,Math.PI),Ue(e,k,se,le,pe,he,ue,xe,me)}(e,m,q.controlPoint,te.controlPoint):function Je(e,t,l){return de(k,he,t),de(se,ue,l),(0,_.U1)(le,se,k,Le),(0,_.U1)(pe,k,se,Le),(0,_.U1)(xe,ue,he,-Le),(0,_.U1)(me,he,ue,-Le),Ue(e,k,se,le,pe,he,ue,xe,me)}(e,m,q.controlPoint),ae.every(Be=>0===Be)?null:ae}_projectControlPoint(e,t){if(!Z(e))return{valid:!0,controlPoint:e};const{sourcePoint:l,mapPoint:c}=e,{geometry:m,pending:O}=(0,p.projectOrLoad)(c,t);return O?{valid:!1,controlPoint:null}:O||m?{valid:!0,controlPoint:{sourcePoint:l,mapPoint:m}}:(W.Z.getLogger(this).warn("map point could not be projected to the spatial reference",{georeference:this,controlPoint:e,sourceSpatialReference:c.spatialReference,targetSpatialReference:t}),{valid:!1,controlPoint:null})}};function Z(e){return null!=e?.sourcePoint&&null!=e.mapPoint}(0,f._)([(0,C.Cb)({type:[Y],json:{write:{allowNull:!1,isRequired:!0,target:{controlPoints:{type:[U]},coefficients:{type:[Number]},spatialReference:{type:d.Z}}}}})],T.prototype,"controlPoints",void 0),(0,f._)([(0,K.r)("controlPoints")],T.prototype,"readControlPoints",null),(0,f._)([(0,ee.c)("controlPoints")],T.prototype,"writeControlPoints",null),(0,f._)([(0,C.Cb)({clonable:!1})],T.prototype,"coords",null),(0,f._)([(0,C.Cb)({type:Number,nonNullable:!0,json:{write:!0}})],T.prototype,"height",void 0),(0,f._)([(0,C.Cb)({readOnly:!0})],T.prototype,"inverseTransform",null),(0,f._)([(0,C.Cb)({readOnly:!0})],T.prototype,"transform",null),(0,f._)([(0,C.Cb)({type:Number,nonNullable:!0,json:{write:!0}})],T.prototype,"width",void 0),T=(0,f._)([(0,N.j)("esri.layers.support.ControlPointsGeoreference")],T);const k=(0,v.Ue)(),se=(0,v.Ue)(),le=(0,v.Ue)(),pe=(0,v.Ue)(),he=(0,v.Ue)(),ue=(0,v.Ue)(),xe=(0,v.Ue)(),me=(0,v.Ue)(),Le=Math.PI/2;function de(e,t,l){(0,_.t8)(e,l.sourcePoint.x,l.sourcePoint.y),(0,_.t8)(t,l.mapPoint.x,l.mapPoint.y)}function We(e,t,l,c,m){return de(k,he,t),de(se,ue,l),de(le,xe,c),de(pe,me,m),Ue(e,k,se,le,pe,he,ue,xe,me)}const ke=new Array(8).fill(0),qe=new Array(8).fill(0);function He(e,t,l,c,m){return e[0]=t[0],e[1]=t[1],e[2]=l[0],e[3]=l[1],e[4]=c[0],e[5]=c[1],e[6]=m[0],e[7]=m[1],e}function Ue(e,t,l,c,m,O,S,B,w){return(0,h.E)(e,He(ke,t,l,c,m),He(qe,O,S,B,w))}const Me=T;var tt=u(66476),nt=u(26517),Pe=u(6785),st=u(19986),it=u(84373),Xe=u(67016);const Oe=(0,v.Ue)();let fe=class extends E{constructor(e){super(e),this.bottomLeft=null,this.bottomRight=null,this.topLeft=null,this.topRight=null,this.type="corners"}get coords(){let{topLeft:e,topRight:t,bottomLeft:l,bottomRight:c}=this;if(null==e||null==t||null==l||null==c)return null;const m=e.spatialReference;return t=this.projectOrWarn(t,m),l=this.projectOrWarn(l,m),c=this.projectOrWarn(c,m),null==t||null==l||null==c?null:new n.Z({rings:[[[l.x,l.y],[e.x,e.y],[t.x,t.y],[c.x,c.y],[l.x,l.y]]],spatialReference:m})}set coords(e){const{topLeft:t}=this;if(null==t)return;const l=t.spatialReference;if(null==(e=this.projectOrWarn(e,l)))return;const{rings:[[c,m,O,S]]}=e;this.bottomLeft=new a.Z({x:c[0],y:c[1],spatialReference:l}),this.topLeft=new a.Z({x:m[0],y:m[1],spatialReference:l}),this.topRight=new a.Z({x:O[0],y:O[1],spatialReference:l}),this.bottomRight=new a.Z({x:S[0],y:S[1],spatialReference:l})}toSourceNormalized(e){const{topLeft:t,topRight:l,bottomRight:c,bottomLeft:m}=this;if(null==e||null==t||null==l||null==c||null==m)return null;const O=t.spatialReference;e=e.normalize();const S=(0,p.projectOrLoad)(e,O).geometry;if(null==S)return null;(0,_.t8)(Oe,S.x,S.y);const B=(0,h.E)((0,I.Ue)(),[t.x,t.y,m.x,m.y,l.x,l.y,c.x,c.y],[0,0,0,1,1,0,1,1]);return(0,h.H)(Oe,Oe,B),(0,y.vW)(Oe[0],Oe[1])}};(0,f._)([(0,C.Cb)({clonable:!1})],fe.prototype,"coords",null),(0,f._)([(0,C.Cb)({type:a.Z})],fe.prototype,"bottomLeft",void 0),(0,f._)([(0,C.Cb)({type:a.Z})],fe.prototype,"bottomRight",void 0),(0,f._)([(0,C.Cb)({type:a.Z})],fe.prototype,"topLeft",void 0),(0,f._)([(0,C.Cb)({type:a.Z})],fe.prototype,"topRight",void 0),fe=(0,f._)([(0,N.j)("esri.layers.support.CornersGeoreference")],fe);const ot=fe;var Te=u(55117),rt=u(89612),je=u(26894);let Ee=class extends E{constructor(e){super(e),this.extent=null,this.rotation=0,this.type="extent-and-rotation"}get coords(){if(null==this.extent)return null;const{xmin:e,ymin:t,xmax:l,ymax:c,spatialReference:m}=this.extent;let O;if(this.rotation){const{x:S,y:B}=this.extent.center,w=De(S,B,this.rotation);O=[w(e,t),w(e,c),w(l,c),w(l,t)],O.push(O[0])}else O=[[e,t],[e,c],[l,c],[l,t],[e,t]];return new n.Z({rings:[O],spatialReference:m})}set coords(e){if(null==e||null==this.extent)return;const t=this.extent.spatialReference;if(e=this.projectOrWarn(e,t),null==e?.extent)return;const{rings:[[l,c,m]],extent:{center:{x:O,y:S}}}=e,B=(0,Te.BV)(Math.PI/2-Math.atan2(c[1]-l[1],c[0]-l[0])),w=De(O,S,-B),[q,te]=w(l[0],l[1]),[oe,ae]=w(m[0],m[1]);this.extent=new je.Z({xmin:q,ymin:te,xmax:oe,ymax:ae,spatialReference:t}),this.rotation=B}toSourceNormalized(e){const{extent:t,rotation:l}=this;if(null==e||null==t)return null;const{xmin:c,ymin:m,xmax:O,ymax:S,center:B,spatialReference:w}=t;e=e.normalize();const q=(0,p.projectOrLoad)(e,w).geometry;if(null==q)return null;let te=q.x,oe=q.y;return l&&([te,oe]=De(B.x,B.y,-l)(te,oe)),(0,y.vW)((0,Te.bA)(te,c,O,0,1),(0,Te.bA)(oe,S,m,0,1))}};function De(e,t,l){const c=(0,rt.c$)(l),m=Math.cos(c),O=Math.sin(c);return(S,B)=>[m*(S-e)+O*(B-t)+e,m*(B-t)-O*(S-e)+t]}(0,f._)([(0,C.Cb)({clonable:!1})],Ee.prototype,"coords",null),(0,f._)([(0,C.Cb)({type:je.Z})],Ee.prototype,"extent",void 0),(0,f._)([(0,C.Cb)({type:Number})],Ee.prototype,"rotation",void 0),Ee=(0,f._)([(0,N.j)("esri.layers.support.ExtentAndRotationGeoreference")],Ee);const lt=Ee;u(2189);var at=u(33721);function Ye(e,t){const l=(0,z.M9)(t);return function ht(e){return"media"===e?.type}(e)&&!!e.portalItem&&null!=l&&l>z.s3.PORTAL_ITEM}const dt={key:"type",base:E,typeMap:{"control-points":Me,corners:ot,"extent-and-rotation":lt}},pt={key:"type",base:E,typeMap:{"control-points":Me}};let ve=class extends((0,it.iv)((0,F.R)(Xe.Z))){constructor(e){super(e),this.georeference=null,this.opacity=1}readGeoreference(e){return Me.fromJSON(e)}writeGeoreference(e,t,l,c){const m=c?.resources?.pendingOperations,O=()=>{const S=function ut(e,t,l){if(!e||"control-points"===e.type)return e;const{coords:c}=e;if(5!==c?.rings[0]?.length)return null;const[m,O,S,B]=c.rings[0],{spatialReference:w}=c;return new Me({controlPoints:[{mapPoint:new a.Z({x:m[0],y:m[1],spatialReference:w}),sourcePoint:(0,y.vW)(0,l)},{mapPoint:new a.Z({x:O[0],y:O[1],spatialReference:w}),sourcePoint:(0,y.vW)(0,0)},{mapPoint:new a.Z({x:S[0],y:S[1],spatialReference:w}),sourcePoint:(0,y.vW)(t,0)},{mapPoint:new a.Z({x:B[0],y:B[1],spatialReference:w}),sourcePoint:(0,y.vW)(t,l)}],width:t,height:l})}(this.georeference,this.contentWidth,this.contentHeight);if(S){if("control-points"!==e.type&&W.Z.getLogger(this).warn(`only georeference of type 'control-points' may be persisted. The georeference of type '${e.type}' has been automatically converted.`),4!==S.controlPoints?.length&&c?.messages)return void c.messages.push(new G.Z("property:unsupported","only 'control-points' georeference with 4 control points may be persisted."));t[l]=S.write({},c)}};if("control-points"!==e.type&&!this.loaded&&m)return t[l]={},void m.push(this.load().then(O));O()}get contentWidth(){return 0}get contentHeight(){return 0}toSource(e){const{georeference:t,contentWidth:l,contentHeight:c}=this;if(null==e||null==t||0===l||0===c)return null;const m=t.toSourceNormalized(e);return null==m?null:(m.x*=l,m.y*=c,m)}};(0,f._)([(0,C.Cb)({types:dt,json:{write:!0,types:pt}})],ve.prototype,"georeference",void 0),(0,f._)([(0,K.r)("georeference")],ve.prototype,"readGeoreference",null),(0,f._)([(0,ee.c)("georeference")],ve.prototype,"writeGeoreference",null),(0,f._)([(0,C.Cb)({json:{read:!1,write:!1}})],ve.prototype,"opacity",void 0),ve=(0,f._)([(0,N.j)("esri.layers.support.MediaElementBase")],ve);const Ae=ve;var mt=u(79387),Re=u(19677);let ce=class extends Ae{constructor(e){super(e),this.animationOptions=null,this.content=null,this.image=null,this.type="image",this.image=null}load(){const e=this.image;if("string"==typeof e){const t=(0,nt.n$)(e).then(l=>{this._set("content",l)});this.addResolvingPromise(t)}else if(e instanceof HTMLImageElement){const t=e.decode().then(()=>{this._set("content",e)});this.addResolvingPromise(t)}else e?this._set("content",e):this.addResolvingPromise(Promise.reject(new G.Z("image-element:invalid-image-type","Invalid image type",{image:e})));return Promise.resolve(this)}get contentWidth(){return null==this.content?0:this.content instanceof HTMLImageElement?this.content.naturalWidth:this.content.width}get contentHeight(){return null==this.content?0:this.content instanceof HTMLImageElement?this.content.naturalHeight:this.content.height}readImage(e,t,l){return(0,Re.f)(t.url,l)}writeImage(e,t,l,c){if(null==e)return;const m=c?.portalItem,O=c?.resources;if(!m||!O)return void("string"==typeof e&&(t[l]=(0,Re.t)(e,c)));const S=function ft(e){return"string"==typeof e&&!(0,Pe.HK)(e)&&!(0,Pe.jc)(e)}(e)?e:null;if(S){if(null==(0,Re.i)(S))return void(t[l]=S);const B=(0,Re.t)(S,{...c,verifyItemRelativeUrls:c?.verifyItemRelativeUrls?{writtenUrls:c.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},Re.M.NO);if(m&&B&&!(0,Pe.YP)(B))return O.toKeep.push({resource:m.resourceFromPath(B),compress:!1}),void(t[l]=B)}t[l]="<pending>",O.pendingOperations.push(function yt(e){return be.apply(this,arguments)}(e).then(B=>{const w=function gt(e,t){const l=(0,st.DO)(),c=`${(0,Pe.v_)("media",l)}.${(0,mt.B)({type:"blob",blob:e})}`;return t.resourceFromPath(c)}(B,m);t[l]=w.itemRelativeUrl,O.toAdd.push({resource:w,content:{type:"blob",blob:B},compress:!1,finish:q=>{this.image=q.url}})}))}write(e,t){const l=super.write(e,t);return"mediaType"in l&&!l.url&&delete l.mediaType,l}};(0,f._)([(0,C.Cb)()],ce.prototype,"animationOptions",void 0),(0,f._)([(0,C.Cb)({readOnly:!0})],ce.prototype,"content",void 0),(0,f._)([(0,C.Cb)({readOnly:!0})],ce.prototype,"contentWidth",null),(0,f._)([(0,C.Cb)({readOnly:!0})],ce.prototype,"contentHeight",null),(0,f._)([(0,C.Cb)({json:{name:"url",type:String,write:{overridePolicy:(e,t,l)=>({enabled:!Ye(l?.layer,l?.origin)})}}})],ce.prototype,"image",void 0),(0,f._)([(0,K.r)("image",["url"])],ce.prototype,"readImage",null),(0,f._)([(0,ee.c)("image")],ce.prototype,"writeImage",null),(0,f._)([(0,C.Cb)({readOnly:!0,json:{read:!1,write:{target:"mediaType",ignoreOrigin:!0}}})],ce.prototype,"type",void 0),ce=(0,f._)([(0,N.j)("esri.layers.support.ImageElement")],ce);const Ke=ce;function be(){return(be=(0,A.Z)(function*(e){return"string"==typeof e?(0,Pe.HK)(e)?(0,Pe.fw)(e):(yield(0,tt.Z)(e,{responseType:"blob"})).data:new Promise(t=>function _t(e){if(e instanceof HTMLCanvasElement)return e;const t=e instanceof HTMLImageElement?e.naturalWidth:e.width,l=e instanceof HTMLImageElement?e.naturalHeight:e.height,c=document.createElement("canvas"),m=c.getContext("2d");return c.width=t,c.height=l,e instanceof HTMLImageElement?m.drawImage(e,0,0,e.width,e.height):e instanceof ImageData&&m.putImageData(e,0,0),c}(e).toBlob(t))})).apply(this,arguments)}var xt=u(18626),vt=u(88278),Pt=u(47868),Et=u(77675),It=u(45425),Mt=u(26230),Ot=u(46872),Rt=u(46687),Ct=u(90984);let _e=class extends Ae{constructor(e){super(e),this.autoplay=!0,this.content=null,this.type="video"}load(){const e=this.video;if("string"==typeof e){const t=document.createElement("video");t.src=e,t.crossOrigin="anonymous",t.autoplay=!0,t.muted=!0,t.loop=!0,t.playsInline=!0,this.addResolvingPromise(this._loadVideo(t).then(()=>{this._set("content",t)}))}else e instanceof HTMLVideoElement?this.addResolvingPromise(this._loadVideo(e).then(()=>{this._set("content",e)})):this.addResolvingPromise(Promise.reject(new G.Z("video-element:invalid-video-type","Invalid video type",{video:e})));return Promise.resolve(this)}get contentWidth(){return this.content?.videoWidth??0}get contentHeight(){return this.content?.videoHeight??0}set video(e){"not-loaded"===this.loadStatus?this._set("video",e):W.Z.getLogger(this).error("#video","video cannot be changed after the element is loaded.")}_loadVideo(e){return new Promise((t,l)=>{const c=(0,Ct.IH)(e,"canplay",()=>{this.removeHandles("canplay"),this.autoplay?e.play().then(t,l):t()});this.addHandles(c,"canplay"),"anonymous"!==e.crossOrigin&&(e.crossOrigin="anonymous",e.src?.includes("blob:")||(e.src=e.src))})}};(0,f._)([(0,C.Cb)()],_e.prototype,"autoplay",void 0),(0,f._)([(0,C.Cb)({readOnly:!0})],_e.prototype,"content",void 0),(0,f._)([(0,C.Cb)({readOnly:!0})],_e.prototype,"contentWidth",null),(0,f._)([(0,C.Cb)({readOnly:!0})],_e.prototype,"contentHeight",null),(0,f._)([(0,C.Cb)()],_e.prototype,"video",null),_e=(0,f._)([(0,N.j)("esri.layers.support.VideoElement")],_e);const Ne=_e,Ve=J.Z.ofType({key:"type",defaultKeyValue:"image",base:Ae,typeMap:{image:Ke,video:Ne}});let Ie=class extends(Xe.Z.LoadableMixin((0,Pt.v)(vt.Z.EventedAccessor))){constructor(e){super(e),this._index=new Ot.H,this._elementViewsMap=new Map,this._elementsIndexes=new Map,this._elementsChangedHandler=t=>{for(const c of t.removed){const m=this._elementViewsMap.get(c);this._elementViewsMap.delete(c),this._index.delete(m),this.removeHandles(m),m.destroy(),this.notifyChange("fullExtent")}const{spatialReference:l}=this;for(const c of t.added){if(this._elementViewsMap.get(c))continue;const m=new Rt.L({spatialReference:l,element:c});this._elementViewsMap.set(c,m);const O=(0,Et.YP)(()=>m.coords,()=>this._updateIndexForElement(m,!1));this._updateIndexForElement(m,!0),this.addHandles(O,m)}this._elementsIndexes.clear(),this.elements.forEach((c,m)=>this._elementsIndexes.set(c,m)),this.emit("refresh")},this.elements=new Ve}load(e){var t=this;return(0,A.Z)(function*(){if((0,H.k_)(e),!t.spatialReference){const l=t.elements.find(c=>null!=c.georeference?.coords);t._set("spatialReference",l?l.georeference.coords.spatialReference:d.Z.WGS84)}return t._elementsChangedHandler({added:t.elements.items,removed:[]}),t.addHandles(t.elements.on("change",t._elementsChangedHandler)),t})()}destroy(){this._index.clear(),this._elementViewsMap.clear(),this._elementsIndexes.clear()}set elements(e){this._set("elements",(0,xt.Z)(e,this._get("elements"),Ve))}get fullExtent(){if("not-loaded"===this.loadStatus)return null;const e=this._index.fullBounds;return null==e?null:new je.Z({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:this.spatialReference})}set spatialReference(e){"not-loaded"===this.loadStatus?this._set("spatialReference",e):W.Z.getLogger(this).error("#spatialReference","spatialReference cannot be changed after the source is loaded.")}queryElements(e,t){var l=this;return(0,A.Z)(function*(){yield l.load(),yield(0,p.initializeProjection)(e.spatialReference,l.spatialReference,null,t);const c=(0,at.fS)(e.spatialReference,l.spatialReference)?e:(0,p.project)(e,l.spatialReference);if(!c)return[];const m=c.normalize(),O=[];for(const S of m)l._index.forEachInBounds((0,It.oJ)(S),({normalizedCoords:B,element:w})=>{null!=B&&(0,Mt.Nl)(S,B)&&O.push(w)});return O.sort((S,B)=>l._elementsIndexes.get(S)-l._elementsIndexes.get(B)),O})()}hasElement(e){return this.elements.includes(e)}_updateIndexForElement(e,t){const l=e.normalizedBounds,c=this._index.has(e),m=null!=l;this._index.delete(e),m&&this._index.set(e,l),this.notifyChange("fullExtent"),t||(c!==m?this.emit("refresh"):this.emit("change",{element:e.element}))}};(0,f._)([(0,C.Cb)()],Ie.prototype,"elements",null),(0,f._)([(0,C.Cb)({readOnly:!0})],Ie.prototype,"fullExtent",null),(0,f._)([(0,C.Cb)()],Ie.prototype,"spatialReference",null),Ie=(0,f._)([(0,N.j)("esri.layers.support.LocalMediaElementSource")],Ie);const Ce=Ie;var Se=u(84735);function Ze(e){return"object"==typeof e&&null!=e&&"type"in e}function Ge(e){return Ze(e)&&"image"===e.type}let ie=class extends((0,X.h7)((0,re.M)((0,D.q)((0,$.I)((0,F.R)(b.Z)))))){constructor(e){var t;super(e),t=this,this.effectiveSource=null,this.georeference=null,this.copyright=null,this.operationalLayerType="MediaLayer",this.spatialReference=null,this.type="media",this._debouncedSaveOperations=(0,H.Ds)(function(){var l=(0,A.Z)(function*(c,m,O){const{save:S,saveAs:B}=yield Promise.all([u.e(8592),u.e(6573)]).then(u.bind(u,16473));switch(c){case Se.x.SAVE:return S(t,m);case Se.x.SAVE_AS:return B(t,O,m)}});return function(c,m,O){return l.apply(this,arguments)}}()),this.source=new Ce}load(e){return this.addResolvingPromise(this._doLoad(e)),Promise.resolve(this)}_doLoad(e){var t=this;return(0,A.Z)(function*(){yield t.loadFromPortal({supportedTypes:["Media Layer"]},e);let l=t.source;if(!l)throw new G.Z("media-layer:source-missing","Set 'MediaLayer.source' before loading the layer.");const c=t._getSourceOverride(l,t.georeference);c&&(t.setAtOrigin("source",c,"web-map"),t.setAtOrigin("source",c,"web-scene"),l=c);const m=Ze(l)?new Ce({elements:new J.Z([l])}):l;t._set("effectiveSource",m),t.spatialReference&&(m.spatialReference=t.spatialReference),yield m.load(e),t.spatialReference=m.spatialReference})()}destroy(){this.effectiveSource?.destroy(),this.effectiveSource!==this.source&&this.source?.destroy()}readGeoreference(e,t){return e&&"itemId"in t&&t.itemId?e:void 0}get fullExtent(){return this.loaded?this.effectiveSource.fullExtent:null}set source(e){"loaded"!==this.loadStatus&&"failed"!==this.loadStatus?this._set("source",e):W.Z.getLogger(this).error("#source","source cannot be changed after the layer is loaded.")}castSource(e){return e?Array.isArray(e)?new Ce({elements:new J.Z(e)}):e instanceof J.Z?new Ce({elements:e}):e:null}readSource(e,t,l){if("itemId"in t&&t.itemId)return;const c=this._createSource(t);return c?.read(t,l),c}writeSource(e,t,l,c){if(e&&e instanceof Ce){const m=e.elements.length;if(1!==m)return void(c?.messages&&c.messages.push(new G.Z("media-layer:unsupported-source",`local media element source can only be persisted if it contains exactly one ImageElement, but it has ${m}.`)));e=e.elements.at(0)}Ge(e)?e.write(t,c):c?.messages&&c.messages.push(new G.Z("media-layer:unsupported-source",e?"only media elements of type 'ImageElement' can be persisted":"the media layer is missing a source"))}save(e){var t=this;return(0,A.Z)(function*(){return t._debouncedSaveOperations(Se.x.SAVE,e)})()}saveAs(e,t){var l=this;return(0,A.Z)(function*(){return l._debouncedSaveOperations(Se.x.SAVE_AS,t,e)})()}_createSource(e){if("mediaType"in e)switch(e.mediaType){case"image":return new Ke;case"video":return new Ne}return null}_getSourceOverride(e,t){if(Ze(e)&&this.originIdOf("source")===z.s3.PORTAL_ITEM&&t&&(this.originIdOf("georeference")===z.s3.WEB_MAP||this.originIdOf("georeference")===z.s3.WEB_SCENE)){const l=e.toJSON(),c=this._createSource(l);return c.read({...l},{origin:"portal-item"}),c.read({georeference:t},{origin:"web-map"}),c.read({georeference:t},{origin:"web-scene"}),c}return null}};(0,f._)([(0,C.Cb)({readOnly:!0})],ie.prototype,"effectiveSource",void 0),(0,f._)([(0,C.Cb)({readOnly:!0,json:{read:!1,write:!1,origins:{"web-document":{read:!0}}}})],ie.prototype,"georeference",void 0),(0,f._)([(0,K.r)("web-document","georeference")],ie.prototype,"readGeoreference",null),(0,f._)([(0,C.Cb)({type:String})],ie.prototype,"copyright",void 0),(0,f._)([(0,C.Cb)({readOnly:!0})],ie.prototype,"fullExtent",null),(0,f._)([(0,C.Cb)({type:["MediaLayer"]})],ie.prototype,"operationalLayerType",void 0),(0,f._)([(0,C.Cb)({type:["show","hide"]})],ie.prototype,"listMode",void 0),(0,f._)([(0,C.Cb)({nonNullable:!0,json:{write:{enabled:!0,allowNull:!1,target:{url:{type:String},mediaType:{type:["image"]},georeference:{type:Me}},overridePolicy(e,t,l){return{enabled:!0,allowNull:!1,ignoreOrigin:Ye(this,l?.origin)&&Ge(e)&&!!e.georeference&&e.originIdOf("georeference")>z.s3.PORTAL_ITEM}}}}})],ie.prototype,"source",null),(0,f._)([(0,V.p)("source")],ie.prototype,"castSource",null),(0,f._)([(0,K.r)("source",["url"])],ie.prototype,"readSource",null),(0,f._)([(0,ee.c)("source")],ie.prototype,"writeSource",null),(0,f._)([(0,C.Cb)()],ie.prototype,"spatialReference",void 0),(0,f._)([(0,C.Cb)({readOnly:!0})],ie.prototype,"type",void 0),ie=(0,f._)([(0,N.j)("esri.layers.MediaLayer")],ie);const St=ie},46872:(ge,ne,u)=>{u.d(ne,{H:()=>C});var A=u(14007),f=u(26540),J=u(45425);const W={minX:0,minY:0,maxX:0,maxY:0};class C{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new f.Q(9,(0,A.Z)("esri-csp-restrictions")?L=>({minX:L[0],minY:L[1],maxX:L[2],maxY:L[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const L=new Array(this._idByBounds.size);let j=0;this._idByBounds.forEach((K,N)=>{L[j++]=N}),this._indexInvalid=!1,this._index.clear(),this._index.load(L)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(L=>this._idByBounds.has(L))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const L=(0,J.cS)();for(const j of this._boundsById.values())j&&(L[0]=Math.min(j[0],L[0]),L[1]=Math.min(j[1],L[1]),L[2]=Math.max(j[2],L[2]),L[3]=Math.max(j[3],L[3]));return L}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(L){const j=this._boundsById.get(L);this._boundsById.delete(L),j&&(this._idByBounds.delete(j),this._indexInvalid||this._index.remove(j))}forEachInBounds(L,j){this._loadIndex(),function H(V,L,j){(function F(V){W.minX=V[0],W.minY=V[1],W.maxX=V[2],W.maxY=V[3]})(L),V.search(W,j)}(this._index,L,K=>j(this._idByBounds.get(K)))}get(L){return this._boundsById.get(L)}has(L){return this._boundsById.has(L)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(L,j){if(!this._indexInvalid){const K=this._boundsById.get(L);K&&(this._index.remove(K),this._idByBounds.delete(K))}this._boundsById.set(L,j),j&&(this._idByBounds.set(j,L),this._indexInvalid||(this._boundsToLoad.push(j),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},70509:(ge,ne,u)=>{u.d(ne,{I:()=>h});var A=u(15861),f=u(50484),J=u(11931),G=u(26152),W=u(66476),F=u(37636),H=u(57964),C=u(4703),V=u(51172),L=u(79412),j=u(6785),K=u(80543),z=(u(14007),u(65311),u(62185)),b=u(10141),X=u(7547),D=u(85971),$=u(61018),re=u(27835),Q=u(57437),g=u(50318);const h=x=>{let I=class extends x{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,V.SC)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(_){_!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",_))}readPortalItem(_,v,a){if(v.itemId)return new re.default({id:v.itemId,portal:a?.portal})}writePortalItem(_,v){_?.id&&(v.itemId=_.id)}loadFromPortal(_,v){var a=this;return(0,A.Z)(function*(){if(a.portalItem?.id)try{const{load:n}=yield Promise.all([u.e(2772),u.e(8592),u.e(6964)]).then(u.bind(u,36964));return(0,L.k_)(v),yield n({instance:a,supportedTypes:_.supportedTypes,validateItem:_.validateItem,supportsData:_.supportsData,layerModuleTypeMap:_.layerModuleTypeMap},v)}catch(n){throw(0,L.D_)(n)||C.Z.getLogger(a).warn(`Failed to load layer (${a.title}, ${a.id}) portal item (${a.portalItem.id})\n  ${n}`),n}})()}finishLoadEditablePortalLayer(_){var v=this;return(0,A.Z)(function*(){v._set("userHasEditingPrivileges",yield v._fetchUserHasEditingPrivileges(_).catch(a=>((0,L.r9)(a),!0)))})()}setUserPrivileges(_,v){var a=this;return(0,A.Z)(function*(){if(!J.default.userPrivilegesApplied)return a.finishLoadEditablePortalLayer(v);if(a.url)try{const{features:{edit:n,fullEdit:p},content:{updateItem:d}}=yield a._fetchUserPrivileges(_,v);a._set("userHasEditingPrivileges",n),a._set("userHasFullEditingPrivileges",p),a._set("userHasUpdateItemPrivileges",d)}catch(n){(0,L.r9)(n)}})()}_fetchUserPrivileges(_,v){var a=this;return(0,A.Z)(function*(){let n=a.portalItem;if(!_||!n||!n.loaded||n.sourceUrl)return a._fetchFallbackUserPrivileges(v);const p=_===n.id;if(p&&n.portal.user)return(0,g.Ss)(n);let d,P;if(p)d=n.portal.url;else try{d=yield(0,D.oP)(a.url,v)}catch(U){(0,L.r9)(U)}if(!d||!(0,j.Zo)(d,n.portal.url))return a._fetchFallbackUserPrivileges(v);try{const U=null!=v?v.signal:null;P=yield G.id?.getCredential(`${d}/sharing`,{prompt:!1,signal:U})}catch(U){(0,L.r9)(U)}if(!P)return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}};try{if(p?yield n.reload():(n=new re.default({id:_,portal:{url:d}}),yield n.load(v)),n.portal.user)return(0,g.Ss)(n)}catch(U){(0,L.r9)(U)}return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}}})()}_fetchFallbackUserPrivileges(_){var v=this;return(0,A.Z)(function*(){let a=!0;try{a=yield v._fetchUserHasEditingPrivileges(_)}catch(n){(0,L.r9)(n)}return{features:{edit:a,fullEdit:!1},content:{updateItem:!1}}})()}_fetchUserHasEditingPrivileges(_){var v=this;return(0,A.Z)(function*(){const a=v.url?G.id?.findCredential(v.url):null;if(!a)return!0;const n=y.credential===a?y.user:yield v._fetchEditingUser(_);return y.credential=a,y.user=n,null==n?.privileges||n.privileges.includes("features:user:edit")})()}_fetchEditingUser(_){var v=this;return(0,A.Z)(function*(){const a=v.portalItem?.portal?.user;if(a)return a;const n=G.id?.findServerInfo(v.url??"");if(!n?.owningSystemUrl)return null;const p=`${n.owningSystemUrl}/sharing/rest`,d=$.Z.getDefault();if(d&&d.loaded&&(0,j.Fv)(d.restUrl)===(0,j.Fv)(p))return d.user;const P=`${p}/community/self`,E=null!=_?_.signal:null,R=yield(0,F.q6)((0,W.Z)(P,{authMode:"no-prompt",query:{f:"json"},signal:E}));return R.ok?Q.Z.fromJSON(R.value.data):null})()}read(_,v){v&&(v.layer=this),super.read(_,v)}write(_,v){const a=v?.portal,n=this.portalItem?.id&&(this.portalItem.portal||$.Z.getDefault());return a&&n&&!(0,j.tm)(n.restUrl,a.restUrl)?(v.messages&&v.messages.push(new H.Z("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(_,{...v,layer:this})}};return(0,f._)([(0,K.Cb)({type:re.default})],I.prototype,"portalItem",null),(0,f._)([(0,z.r)("web-document","portalItem",["itemId"])],I.prototype,"readPortalItem",null),(0,f._)([(0,X.c)("web-document","portalItem",{itemId:{type:String}})],I.prototype,"writePortalItem",null),(0,f._)([(0,K.Cb)({clonable:!1})],I.prototype,"resourceReferences",void 0),(0,f._)([(0,K.Cb)({type:Boolean,readOnly:!0})],I.prototype,"userHasEditingPrivileges",void 0),(0,f._)([(0,K.Cb)({type:Boolean,readOnly:!0})],I.prototype,"userHasFullEditingPrivileges",void 0),(0,f._)([(0,K.Cb)({type:Boolean,readOnly:!0})],I.prototype,"userHasUpdateItemPrivileges",void 0),I=(0,f._)([(0,b.j)("esri.layers.mixins.PortalLayer")],I),I},y={credential:null,user:null}},50318:(ge,ne,u)=>{u.d(ne,{$o:()=>K,Fj:()=>V,IW:()=>j,Ss:()=>z,_$:()=>C,ck:()=>L,hz:()=>ee,qj:()=>H});var A=u(15861),f=u(83821),J=u(43814),G=u(48230);function F(){return(F=(0,A.Z)(function*(b){const X=b.spatialReference;if(X.isWGS84)return b.clone();if(X.isWebMercator)return(0,G.Sx)(b);const D=J.Z.WGS84;return yield(0,f.initializeProjection)(X,D),(0,f.project)(b,D)})).apply(this,arguments)}function H(b,X){if(!C(b,X)){const D=b.typeKeywords;D?D.push(X):b.typeKeywords=[X]}}function C(b,X){return!!b.typeKeywords?.includes(X)}function V(b){return C(b,ee.HOSTED_SERVICE)}function L(b,X){const D=b.typeKeywords;if(D){const $=D.indexOf(X);$>-1&&D.splice($,1)}}function j(b,X,D){D?H(b,X):L(b,X)}function K(b){return N.apply(this,arguments)}function N(){return N=(0,A.Z)(function*(b){const X=b.clone().normalize();let D;if(X.length>1)for(const $ of X)D?$.width>D.width&&(D=$):D=$;else D=X[0];return function W(b){return F.apply(this,arguments)}(D)}),N.apply(this,arguments)}const ee={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function z(b){const{portal:X,isOrgItem:D,itemControl:$}=b,re=X.user?.privileges;let Q=!re||re.includes("features:user:edit"),g=!!D&&!!re?.includes("features:user:fullEdit");const h="update"===$||"admin"===$;return h?g=Q=!0:g&&(Q=!0),{features:{edit:Q,fullEdit:g},content:{updateItem:h}}}},84735:(ge,ne,u)=>{var A,f;u.d(ne,{x:()=>A}),(f=A||(A={}))[f.SAVE=0]="SAVE",f[f.SAVE_AS=1]="SAVE_AS"}}]);