"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[9474],{52540:(ut,st,p)=>{p.d(st,{z:()=>Y});var C=p(39921);class Y{constructor(V,H){this._storage=new C.WJ,this.id="",this.name="",this.size=0,this._storage.maxSize=V,this._storage.register(this),H&&this._storage.registerRemoveFunc("",H)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(V,H,N=1){this._storage.put(this,V,H,N,1)}pop(V){return this._storage.pop(this,V)}get(V){return this._storage.get(this,V)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(V){this._storage.maxSize=V}resetHitRate(){}}},39921:(ut,st,p)=>{p.d(st,{WJ:()=>N,Xq:()=>H});var V,d,C=p(43029);(d=V||(V={}))[d.ALL=0]="ALL",d[d.SOME=1]="SOME";class H{constructor(c,r,n){this.name=c,this._storage=r,this.id=tt+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),n&&(this._storage.registerRemoveFunc(this.id,n),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(c){return this._storage.getSize(this,c)}resetHitRate(){this._hit=this._miss=0}put(c,r,n,y=0){this._storage.put(this,c,r,n,y)}pop(c){const r=this._storage.pop(this,c);return void 0===r?++this._miss:++this._hit,r}get(c){const r=this._storage.get(this,c);return void 0===r?++this._miss:++this._hit,r}peek(c){return this._storage.peek(this,c)}updateSize(c,r,n){this._storage.updateSize(this,c,r,n)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class N{get size(){return this._size}constructor(c=10485760){this._maxSize=c,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new C.Z,this._users=new C.Z}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(c){this._users.push(c)}deregister(c){this._users.removeUnordered(c)}registerRemoveFunc(c,r){this._removeFuncs.push([c,r])}deregisterRemoveFunc(c){this._removeFuncs.filterInPlace(r=>r[0]!==c)}get maxSize(){return this._maxSize}set maxSize(c){this._maxSize=Math.max(c,-1),this._checkSize()}getSize(c,r){return this._db.get(c.id+r)?.size??0}put(c,r,n,y,g){const v=this._db.get(r=c.id+r);if(v&&(this._size-=v.size,c.size-=v.size,this._db.delete(r),v.entry!==n&&this._notifyRemove(r,v.entry,v.size,V.ALL)),y>this._maxSize)return void this._notifyRemove(r,n,y,V.ALL);if(void 0===n)return void console.warn("Refusing to cache undefined entry ");if(!y||y<0)return console.warn(`Refusing to cache entry with size ${y} for key ${r}`),void this._notifyRemove(r,n,0,V.ALL);const T=1+Math.max(g,-4)- -3;this._db.set(r,new z(n,y,T)),this._size+=y,c.size+=y,this._checkSize()}updateSize(c,r,n,y){const g=this._db.get(r=c.id+r);if(g&&g.entry===n){for(this._size-=g.size,c.size-=g.size;y>this._maxSize;){const v=this._notifyRemove(r,n,y,V.SOME);if(!(null!=v&&v>0))return void this._db.delete(r);y=v}g.size=y,this._size+=y,c.size+=y,this._checkSize()}}pop(c,r){const n=this._db.get(r=c.id+r);if(n)return this._size-=n.size,c.size-=n.size,this._db.delete(r),++this._hit,n.entry;++this._miss}get(c,r){const n=this._db.get(r=c.id+r);if(void 0!==n)return this._db.delete(r),n.lives=n.lifetime,this._db.set(r,n),++this._hit,n.entry;++this._miss}peek(c,r){const n=this._db.get(c.id+r);return n?++this._hit:++this._miss,n?.entry}get performanceInfo(){const c={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},n=new Array;this._db.forEach((v,T)=>{const x=v.lifetime;n[x]=(n[x]||0)+v.size,this._users.forAll(I=>{const{id:P,name:it}=I;T.startsWith(P)&&(r[it]=(r[it]||0)+v.size)})});const y={};this._users.forAll(v=>{const T=v.name;"hitRate"in v&&"number"==typeof v.hitRate&&!isNaN(v.hitRate)&&v.hitRate>0?(r[T]=r[T]||0,y[T]=Math.round(100*v.hitRate)+"%"):y[T]="0%"});const g=Object.keys(r);g.sort((v,T)=>r[T]-r[v]),g.forEach(v=>c[v]=Math.round(r[v]/2**20)+"MB / "+y[v]);for(let v=n.length-1;v>=0;--v){const T=n[v];T&&(c["Priority "+(v+-3-1)]=Math.round(T/this._size*100)+"%")}return c}resetStats(){this._hit=this._miss=0,this._users.forAll(c=>c.resetHitRate())}clear(c){const r=c.id;this._db.forEach((n,y)=>{y.startsWith(r)&&(this._size-=n.size,this._db.delete(y),this._notifyRemove(y,n.entry,n.size,V.ALL))}),c.size=0}clearAll(){this._db.forEach((c,r)=>this._notifyRemove(r,c.entry,c.size,V.ALL)),this._users.forAll(c=>c.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(c,r,n,y){let g;return this._removeFuncs.some(v=>{if(c.startsWith(v[0])){const T=v[1](r,y,n);return"number"==typeof T&&(g=T),!0}return!1}),g}_checkSize(){this._users.forAll(c=>this._checkSizeLimits(c)),this._checkSizeLimits()}_checkSizeLimits(c){const r=c??this;if(r.maxSize<0||r.size<=r.maxSize)return;const n=c?.id;let y=!0;for(;y;){y=!1;for(const[g,v]of this._db)if(0===v.lifetime&&(!n||g.startsWith(n))){if(this._purgeItem(g,v,c),r.size<=.9*r.maxSize)return;y||=this._db.has(g)}}for(const[g,v]of this._db)if((!n||g.startsWith(n))&&(this._purgeItem(g,v,c),r.size<=.9*r.maxSize))return}_purgeItem(c,r,n=this._users.find(y=>c.startsWith(y.id))){if(this._db.delete(c),r.lives<=1){this._size-=r.size,n&&(n.size-=r.size);const y=this._notifyRemove(c,r.entry,r.size,V.SOME);null!=y&&y>0&&(this._size+=y,n&&(n.size+=y),r.lives=r.lifetime,r.size=y,this._db.set(c,r))}else--r.lives,this._db.set(c,r)}}let tt=0;class z{constructor(c,r,n){this.entry=c,this.size=r,this.lifetime=n,this.lives=n}}},657:(ut,st,p)=>{p.d(st,{$c:()=>g,Hg:()=>v,jW:()=>r,uD:()=>n});var C=p(73514),Y=p(83944),k=p(49301);const V=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function H(x){return x instanceof C.Z}function N(x){return x instanceof Y.Z?Object.keys(x.items):H(x)?(0,k.vw)(x).keys():x?Object.keys(x):[]}function tt(x,I){return x instanceof Y.Z?x.items[I]:x[I]}function d(x){return x?x.declaredClass:null}function c(x,I){const P=x.diff;if(P&&"function"==typeof P)return P(x,I);const it=N(x),$=N(I);if(0===it.length&&0===$.length)return;if(!it.length||!$.length||function z(x,I){return!(!Array.isArray(x)||!Array.isArray(I))&&x.length!==I.length}(x,I))return{type:"complete",oldValue:x,newValue:I};const J=$.filter(X=>!it.includes(X)),Q=it.filter(X=>!$.includes(X)),L=it.filter(X=>$.includes(X)&&tt(x,X)!==tt(I,X)).concat(J,Q).sort(),B=d(x);if(B&&V.has(B)&&L.length)return{type:"complete",oldValue:x,newValue:I};let A;const U=H(x)&&H(I);for(const X of L){const D=tt(x,X),f=tt(I,X);let b;if((U||"function"!=typeof D&&"function"!=typeof f)&&D!==f&&(null!=D||null!=f)){if(P&&P[X]&&"function"==typeof P[X])b=P[X]?.(D,f);else if(D instanceof Date&&f instanceof Date){if(D.getTime()===f.getTime())continue;b={type:"complete",oldValue:D,newValue:f}}else b="object"==typeof D&&"object"==typeof f&&d(D)===d(f)?c(D,f):{type:"complete",oldValue:D,newValue:f};null!=b&&(null!=A?A.diff[X]=b:A={type:"partial",diff:{[X]:b}})}}return A}function r(x,I){return n(x,I)}function n(x,I){if(null==x)return!1;const P=I.split(".");let it=x;for(const $ of P){if("complete"===it.type)return!0;if("partial"!==it.type)return!1;{const J=it.diff[$];if(!J)return!1;it=J}}return!0}function g(x,I){if(!x)return!1;if("partial"===x.type){const P=Object.keys(x.diff);return 1===P.length&&P[0]===I}return!1}function v(x,I){if("function"!=typeof x&&"function"!=typeof I&&(null!=x||null!=I))return null==x||null==I||"object"==typeof x&&"object"==typeof I&&d(x)!==d(I)?{type:"complete",oldValue:x,newValue:I}:c(x,I)}},11462:(ut,st,p)=>{p.d(st,{I:()=>Y,v:()=>k});var C=p(55117);function Y(z,d,c=0){const r=(0,C.uZ)(z,0,N);for(let n=0;n<4;n++)d[c+n]=Math.floor(256*tt(r*V[n]))}function k(z,d=0){let c=0;for(let r=0;r<4;r++)c+=z[d+r]*H[r];return c}const V=[1,256,65536,16777216],H=[1/256,1/65536,1/16777216,1/4294967296],N=k(new Uint8ClampedArray([255,255,255,255]));function tt(z){return z-Math.floor(z)}},26540:(ut,st,p)=>{p.d(st,{Q:()=>H});var C=p(57678),k=(p(14007),p(43029)),V=p(4758);class H{constructor(f=9,b){this._compareMinX=n,this._compareMinY=y,this._toBBox=w=>w,this._maxEntries=Math.max(4,f||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),b&&("function"==typeof b?this._toBBox=b:this._initFormat(b)),this.clear()}destroy(){this.clear(),$.prune(),J.prune(),Q.prune(),L.prune()}all(f){tt(this._data,f)}search(f,b){let w=this._data;const E=this._toBBox;if(P(f,w))for($.clear();w;){for(let O=0,j=w.children.length;O<j;O++){const G=w.children[O],q=w.leaf?E(G):G;P(f,q)&&(w.leaf?b(G):I(f,q)?tt(G,b):$.push(G))}w=$.pop()}}collides(f){let b=this._data;const w=this._toBBox;if(!P(f,b))return!1;for($.clear();b;){for(let E=0,O=b.children.length;E<O;E++){const j=b.children[E],G=b.leaf?w(j):j;if(P(f,G)){if(b.leaf||I(f,G))return!0;$.push(j)}}b=$.pop()}return!1}load(f){if(!f.length)return this;if(f.length<this._minEntries){for(let w=0,E=f.length;w<E;w++)this.insert(f[w]);return this}let b=this._build(f.slice(0,f.length),0,f.length-1,0);if(this._data.children.length)if(this._data.height===b.height)this._splitRoot(this._data,b);else{if(this._data.height<b.height){const w=this._data;this._data=b,b=w}this._insert(b,this._data.height-b.height-1,!0)}else this._data=b;return this}insert(f){return f&&this._insert(f,this._data.height-1),this}clear(){return this._data=new U([]),this}remove(f){if(!f)return this;let b,w=this._data,E=null,O=0,j=!1;const G=this._toBBox(f);for(Q.clear(),L.clear();w||Q.length>0;){if(w||(w=Q.pop(),E=Q.data[Q.length-1],O=L.pop()??0,j=!0),w.leaf&&(b=(0,C.cq)(w.children,f,w.children.length,w.indexHint),-1!==b))return w.children.splice(b,1),Q.push(w),this._condense(Q),this;j||w.leaf||!I(w,G)?E?(O++,w=E.children[O],j=!1):w=null:(Q.push(w),L.push(O),O=0,E=w,w=w.children[0])}return this}toJSON(){return this._data}fromJSON(f){return this._data=f,this}_build(f,b,w,E){const O=w-b+1;let j=this._maxEntries;if(O<=j){const nt=new U(f.slice(b,w+1));return d(nt,this._toBBox),nt}E||(E=Math.ceil(Math.log(O)/Math.log(j)),j=Math.ceil(O/j**(E-1)));const G=new X([]);G.height=E;const q=Math.ceil(O/j),lt=q*Math.ceil(Math.sqrt(j));it(f,b,w,lt,this._compareMinX);for(let nt=b;nt<=w;nt+=lt){const dt=Math.min(nt+lt-1,w);it(f,nt,dt,q,this._compareMinY);for(let gt=nt;gt<=dt;gt+=q){const Pt=Math.min(gt+q-1,dt);G.children.push(this._build(f,gt,Pt,E-1))}}return d(G,this._toBBox),G}_insert(f,b,w){const O=w?f:(0,this._toBBox)(f);Q.clear();const j=function N(D,f,b,w){for(;w.push(f),!0!==f.leaf&&w.length-1!==b;){let E,O=1/0,j=1/0;for(let G=0,q=f.children.length;G<q;G++){const lt=f.children[G],nt=g(lt),dt=T(D,lt)-nt;dt<j?(j=dt,O=nt<O?nt:O,E=lt):dt===j&&nt<O&&(O=nt,E=lt)}f=E||f.children[0]}return f}(O,this._data,b,Q);for(j.children.push(f),r(j,O);b>=0&&Q.data[b].children.length>this._maxEntries;)this._split(Q,b),b--;!function z(D,f,b){for(let w=b;w>=0;w--)r(f.data[w],D)}(O,Q,b)}_split(f,b){const w=f.data[b],E=w.children.length,O=this._minEntries;this._chooseSplitAxis(w,O,E);const j=this._chooseSplitIndex(w,O,E);if(!j)return;const G=w.children.splice(j,w.children.length-j),q=w.leaf?new U(G):new X(G);q.height=w.height,d(w,this._toBBox),d(q,this._toBBox),b?f.data[b-1].children.push(q):this._splitRoot(w,q)}_splitRoot(f,b){this._data=new X([f,b]),this._data.height=f.height+1,d(this._data,this._toBBox)}_chooseSplitIndex(f,b,w){let E,O,j;E=O=1/0;for(let G=b;G<=w-b;G++){const q=c(f,0,G,this._toBBox),lt=c(f,G,w,this._toBBox),nt=x(q,lt),dt=g(q)+g(lt);nt<E?(E=nt,j=G,O=dt<O?dt:O):nt===E&&dt<O&&(O=dt,j=G)}return j}_chooseSplitAxis(f,b,w){const E=f.leaf?this._compareMinX:n,O=f.leaf?this._compareMinY:y;this._allDistMargin(f,b,w,E)<this._allDistMargin(f,b,w,O)&&f.children.sort(E)}_allDistMargin(f,b,w,E){f.children.sort(E);const O=this._toBBox,j=c(f,0,b,O),G=c(f,w-b,w,O);let q=v(j)+v(G);for(let lt=b;lt<w-b;lt++){const nt=f.children[lt];r(j,f.leaf?O(nt):nt),q+=v(j)}for(let lt=w-b-1;lt>=b;lt--){const nt=f.children[lt];r(G,f.leaf?O(nt):nt),q+=v(G)}return q}_condense(f){for(let b=f.length-1;b>=0;b--){const w=f.data[b];if(0===w.children.length)if(b>0){const E=f.data[b-1],O=E.children;O.splice((0,C.cq)(O,w,O.length,E.indexHint),1)}else this.clear();else d(w,this._toBBox)}}_initFormat(f){const b=["return a"," - b",";"];this._compareMinX=new Function("a","b",b.join(f[0])),this._compareMinY=new Function("a","b",b.join(f[1])),this._toBBox=new Function("a","return {minX: a"+f[0]+", minY: a"+f[1]+", maxX: a"+f[2]+", maxY: a"+f[3]+"};")}}function tt(D,f){let b=D;for(J.clear();b;){if(!0===b.leaf)for(const w of b.children)f(w);else J.pushArray(b.children);b=J.pop()??null}}function d(D,f){c(D,0,D.children.length,f,D)}function c(D,f,b,w,E){E||(E=new U([])),E.minX=1/0,E.minY=1/0,E.maxX=-1/0,E.maxY=-1/0;for(let O,j=f;j<b;j++)O=D.children[j],r(E,D.leaf?w(O):O);return E}function r(D,f){D.minX=Math.min(D.minX,f.minX),D.minY=Math.min(D.minY,f.minY),D.maxX=Math.max(D.maxX,f.maxX),D.maxY=Math.max(D.maxY,f.maxY)}function n(D,f){return D.minX-f.minX}function y(D,f){return D.minY-f.minY}function g(D){return(D.maxX-D.minX)*(D.maxY-D.minY)}function v(D){return D.maxX-D.minX+(D.maxY-D.minY)}function T(D,f){return(Math.max(f.maxX,D.maxX)-Math.min(f.minX,D.minX))*(Math.max(f.maxY,D.maxY)-Math.min(f.minY,D.minY))}function x(D,f){const b=Math.max(D.minX,f.minX),w=Math.max(D.minY,f.minY),E=Math.min(D.maxX,f.maxX),O=Math.min(D.maxY,f.maxY);return Math.max(0,E-b)*Math.max(0,O-w)}function I(D,f){return D.minX<=f.minX&&D.minY<=f.minY&&f.maxX<=D.maxX&&f.maxY<=D.maxY}function P(D,f){return f.minX<=D.maxX&&f.minY<=D.maxY&&f.maxX>=D.minX&&f.maxY>=D.minY}function it(D,f,b,w,E){const O=[f,b];for(;O.length;){const j=O.pop(),G=O.pop();if(j-G<=w)continue;const q=G+Math.ceil((j-G)/w/2)*w;(0,V.q)(D,q,G,j,E),O.push(G,q,q,j)}}const $=new k.Z,J=new k.Z,Q=new k.Z,L=new k.Z({deallocator:void 0});class B{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class A extends B{constructor(){super(...arguments),this.height=1,this.indexHint=new C.SO}}class U extends A{constructor(f){super(),this.children=f,this.leaf=!0}}class X extends A{constructor(f){super(),this.children=f,this.leaf=!1}}},40485:(ut,st,p)=>{p.d(st,{Z:()=>tt});var k,z,C=p(14007),Y=p(51479);(z=k||(k={}))[z.varint=0]="varint",z[z.fixed64=1]="fixed64",z[z.delimited=2]="delimited",z[z.fixed32=5]="fixed32",z[z.unknown=99]="unknown";const V=4294967296,H=new TextDecoder("utf-8"),N=(0,C.Z)("safari")||(0,C.Z)("ios")?6:(0,C.Z)("ff")?12:32;class tt{constructor(d,c,r=0,n=(d?d.byteLength:0)){this._tag=0,this._dataType=k.unknown,this._init(d,c,r,n)}_init(d,c,r,n){this._data=d,this._dataView=c,this._pos=r,this._end=n}asUnsafe(){return this}clone(){return new tt(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(d){this._pos=d}nextTag(d){for(;;){if(this._pos===this._end)return!1;const c=this._decodeVarint();if(this._tag=c>>3,this._dataType=7&c,!d||d===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const d=this._decodeVarint();return this._tag=d>>3,this._dataType=7&d,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let d=4294967295;if(d=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128||(d=(d|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128)||(d=(d|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128)||(d=(d|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128)||(d=(d|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128))return d;throw new Error("Varint overflow")}getUInt64(){return this._decodeVarint()}getSInt32(){const d=this.getUInt32();return d>>>1^-(1&d)}getSInt64(){return this._decodeSVarint()}getBool(){const d=0!==this._data[this._pos];return this._skip(1),d}getEnum(){return this._decodeVarint()}getFixed64(){const d=this._dataView,c=this._pos,r=d.getUint32(c,!0)+d.getUint32(c+4,!0)*V;return this._skip(8),r}getSFixed64(){const d=this._dataView,c=this._pos,r=d.getUint32(c,!0)+d.getInt32(c+4,!0)*V;return this._skip(8),r}getDouble(){const d=this._dataView.getFloat64(this._pos,!0);return this._skip(8),d}getFixed32(){const d=this._dataView.getUint32(this._pos,!0);return this._skip(4),d}getSFixed32(){const d=this._dataView.getInt32(this._pos,!0);return this._skip(4),d}getFloat(){const d=this._dataView.getFloat32(this._pos,!0);return this._skip(4),d}getString(){const d=this._getLength(),c=this._pos,r=this._toString(this._data,c,c+d);return this._skip(d),r}getBytes(){const d=this._getLength(),c=this._pos,r=this._toBytes(this._data,c,c+d);return this._skip(d),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(d,c,r,n){const y=this.getMessage(),g=d(y,c,r,n);return y.release(),g}processMessage(d){const c=this.getMessage(),r=d(c);return c.release(),r}getMessage(){const d=this._getLength(),c=tt.pool.acquire();return c._init(this._data,this._dataView,this._pos,this._pos+d),this._skip(d),c}release(){tt.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case k.varint:this._decodeVarint();break;case k.fixed64:this._skip(8);break;case k.delimited:this._skip(this._getLength());break;case k.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(d){this._skip(d)}_skip(d){if(this._pos+d>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=d}_decodeVarint(){const d=this._data;let c=this._pos,r=0,n=0;if(this._end-c>=10)do{if(n=d[c++],r|=127&n,!(128&n&&(n=d[c++],r|=(127&n)<<7,128&n)&&(n=d[c++],r|=(127&n)<<14,128&n)&&(n=d[c++],r|=(127&n)<<21,128&n)&&(n=d[c++],r+=268435456*(127&n),128&n)&&(n=d[c++],r+=34359738368*(127&n),128&n)&&(n=d[c++],r+=4398046511104*(127&n),128&n)&&(n=d[c++],r+=562949953421312*(127&n),128&n)&&(n=d[c++],r+=72057594037927940*(127&n),128&n)&&(n=d[c++],r+=0x8000000000000000*(127&n),128&n)))break;throw new Error("Varint too long!")}while(0);else{let y=1;for(;c!==this._end&&(n=d[c],128&n);)++c,r+=(127&n)*y,y*=128;if(c===this._end)throw new Error("Varint overrun!");++c,r+=n*y}return this._pos=c,r}_decodeSVarint(){const d=this._data;let c,r=0,n=0;const y=1&d[this._pos];if(n=d[this._pos++],r|=127&n,!(128&n&&(n=d[this._pos++],r|=(127&n)<<7,128&n)&&(n=d[this._pos++],r|=(127&n)<<14,128&n)&&(n=d[this._pos++],r|=(127&n)<<21,128&n)&&(n=d[this._pos++],r+=268435456*(127&n),128&n)&&(n=d[this._pos++],r+=34359738368*(127&n),128&n)&&(n=d[this._pos++],r+=4398046511104*(127&n),128&n)))return y?-(r+1)/2:r/2;if(c=BigInt(r),n=d[this._pos++],c+=0x2000000000000n*BigInt(127&n),!(128&n&&(n=d[this._pos++],c+=0x100000000000000n*BigInt(127&n),128&n)&&(n=d[this._pos++],c+=0x8000000000000000n*BigInt(127&n),128&n)))return Number(y?-(c+1n)/2n:c/2n);throw new Error("Varint too long!")}_getLength(){if(this._dataType!==k.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(d,c,r){if((r=Math.min(this._end,r))-c>N){const g=d.subarray(c,r);return H.decode(g)}let n="",y="";for(let g=c;g<r;++g){const v=d[g];128&v?y+="%"+v.toString(16):(n+=decodeURIComponent(y)+String.fromCharCode(v),y="")}return y.length&&(n+=decodeURIComponent(y)),n}_toBytes(d,c,r){return r=Math.min(this._end,r),new Uint8Array(d.buffer,c,r-c)}}tt.pool=new Y.Z(tt,void 0,z=>{z._data=null,z._dataView=null})},80247:(ut,st,p)=>{var Y,k,c;p.d(st,{E9:()=>V,I6:()=>tt,Vl:()=>Y,bN:()=>N}),(c=Y||(Y={}))[c.Unknown=0]="Unknown",c[c.Point=1]="Point",c[c.LineString=2]="LineString",c[c.Polygon=3]="Polygon";class V{constructor(r,n){this.x=r,this.y=n}clone(){return new V(this.x,this.y)}equals(r,n){return r===this.x&&n===this.y}isEqual(r){return r.x===this.x&&r.y===this.y}setCoords(r,n){return this.x=r,this.y=n,this}normalize(){const r=this.x,n=this.y,y=Math.sqrt(r*r+n*n);return this.x/=y,this.y/=y,this}rightPerpendicular(){const r=this.x;return this.x=this.y,this.y=-r,this}leftPerpendicular(){const r=this.x;return this.x=-this.y,this.y=r,this}move(r,n){return this.x+=r,this.y+=n,this}assign(r){return this.x=r.x,this.y=r.y,this}assignAdd(r,n){return this.x=r.x+n.x,this.y=r.y+n.y,this}assignSub(r,n){return this.x=r.x-n.x,this.y=r.y-n.y,this}rotate(r,n){const y=this.x,g=this.y;return this.x=y*r-g*n,this.y=y*n+g*r,this}scale(r){return this.x*=r,this.y*=r,this}length(){const r=this.x,n=this.y;return Math.sqrt(r*r+n*n)}sub(r){return this.x-=r.x,this.y-=r.y,this}add(r){return this.x+=r.x,this.y+=r.y,this}static distance(r,n){const y=n.x-r.x,g=n.y-r.y;return Math.sqrt(y*y+g*g)}static add(r,n){return new V(r.x+n.x,r.y+n.y)}static sub(r,n){return new V(r.x-n.x,r.y-n.y)}}class H{constructor(r,n,y){this.ratio=r,this.x=n,this.y=y}}class N{constructor(r,n,y,g=8,v=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=g,this._pixelMargin=v,this._tileSize=512*g,this._dz=r,this._yPos=n,this._xPos=y}setPixelMargin(r){r!==this._pixelMargin&&(this._pixelMargin=r,this.setExtent(this._extent))}setExtent(r){this._extent=r,this._finalRatio=this._tileSize/r*(1<<this._dz);let n=this._pixelRatio*this._pixelMargin;n/=this._finalRatio;const y=r>>this._dz;n>y&&(n=y),this._margin=n,this._xmin=y*this._xPos-n,this._ymin=y*this._yPos-n,this._xmax=this._xmin+y+2*n,this._ymax=this._ymin+y+2*n}reset(r){this._type=r,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(r,n){this._pushLine(),this._prevIsIn=this._isIn(r,n),this._moveTo(r,n,this._prevIsIn),this._prevPt=new V(r,n),this._firstPt=new V(r,n),this._dist=0}lineTo(r,n){const y=this._isIn(r,n),g=new V(r,n),v=V.distance(this._prevPt,g);let T,x,I,P,it,$,J,Q;if(y)this._prevIsIn?this._lineTo(r,n,!0):(T=this._prevPt,x=g,I=this._intersect(x,T),this._start=this._dist+v*(1-this._r),this._lineTo(I.x,I.y,!0),this._lineTo(x.x,x.y,!0));else if(this._prevIsIn)x=this._prevPt,T=g,I=this._intersect(x,T),this._lineTo(I.x,I.y,!0),this._lineTo(T.x,T.y,!1);else{const L=this._prevPt,B=g;if(L.x<=this._xmin&&B.x<=this._xmin||L.x>=this._xmax&&B.x>=this._xmax||L.y<=this._ymin&&B.y<=this._ymin||L.y>=this._ymax&&B.y>=this._ymax)this._lineTo(B.x,B.y,!1);else{const A=[];if((L.x<this._xmin&&B.x>this._xmin||L.x>this._xmin&&B.x<this._xmin)&&(P=(this._xmin-L.x)/(B.x-L.x),Q=L.y+P*(B.y-L.y),Q<=this._ymin?$=!1:Q>=this._ymax?$=!0:A.push(new H(P,this._xmin,Q))),(L.x<this._xmax&&B.x>this._xmax||L.x>this._xmax&&B.x<this._xmax)&&(P=(this._xmax-L.x)/(B.x-L.x),Q=L.y+P*(B.y-L.y),Q<=this._ymin?$=!1:Q>=this._ymax?$=!0:A.push(new H(P,this._xmax,Q))),(L.y<this._ymin&&B.y>this._ymin||L.y>this._ymin&&B.y<this._ymin)&&(P=(this._ymin-L.y)/(B.y-L.y),J=L.x+P*(B.x-L.x),J<=this._xmin?it=!1:J>=this._xmax?it=!0:A.push(new H(P,J,this._ymin))),(L.y<this._ymax&&B.y>this._ymax||L.y>this._ymax&&B.y<this._ymax)&&(P=(this._ymax-L.y)/(B.y-L.y),J=L.x+P*(B.x-L.x),J<=this._xmin?it=!1:J>=this._xmax?it=!0:A.push(new H(P,J,this._ymax))),0===A.length)this._lineTo(it?this._xmax:this._xmin,$?this._ymax:this._ymin,!0);else if(A.length>1&&A[0].ratio>A[1].ratio)this._start=this._dist+v*A[1].ratio,this._lineTo(A[1].x,A[1].y,!0),this._lineTo(A[0].x,A[0].y,!0);else{this._start=this._dist+v*A[0].ratio;for(let U=0;U<A.length;U++)this._lineTo(A[U].x,A[U].y,!0)}this._lineTo(B.x,B.y,!1)}}this._dist+=v,this._prevIsIn=y,this._prevPt=g}close(){if(this._line.length>2){const r=this._firstPt,n=this._prevPt;r.x===n.x&&r.y===n.y||this.lineTo(r.x,r.y);const y=this._line;let g=y.length;for(;g>=4&&(y[0].x===y[1].x&&y[0].x===y[g-2].x||y[0].y===y[1].y&&y[0].y===y[g-2].y);)y.pop(),y[0].x=y[g-2].x,y[0].y=y[g-2].y,--g}}result(r=!0){return this._pushLine(),0===this._lines.length?null:(this._type===Y.Polygon&&r&&z.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==Y.LineString)throw new Error("Only valid for lines");this._pushLine();const r=this._lines,n=r.length;if(0===n)return null;const y=[];for(let g=0;g<n;g++)y.push({line:r[g],start:this._starts[g]||0});return y}_isIn(r,n){return r>=this._xmin&&r<=this._xmax&&n>=this._ymin&&n<=this._ymax}_intersect(r,n){let y,g,v;if(n.x>=this._xmin&&n.x<=this._xmax)g=n.y<=this._ymin?this._ymin:this._ymax,v=(g-r.y)/(n.y-r.y),y=r.x+v*(n.x-r.x);else if(n.y>=this._ymin&&n.y<=this._ymax)y=n.x<=this._xmin?this._xmin:this._xmax,v=(y-r.x)/(n.x-r.x),g=r.y+v*(n.y-r.y);else{g=n.y<=this._ymin?this._ymin:this._ymax,y=n.x<=this._xmin?this._xmin:this._xmax;const T=(y-r.x)/(n.x-r.x),x=(g-r.y)/(n.y-r.y);T<x?(v=T,g=r.y+T*(n.y-r.y)):(v=x,y=r.x+x*(n.x-r.x))}return this._r=v,new V(y,g)}_pushLine(){this._line&&(this._type===Y.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===Y.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===Y.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(r,n,y){this._type!==Y.Polygon?y&&(r=Math.round((r-(this._xmin+this._margin))*this._finalRatio),n=Math.round((n-(this._ymin+this._margin))*this._finalRatio),this._line.push(new V(r,n))):(y||(r<this._xmin&&(r=this._xmin),r>this._xmax&&(r=this._xmax),n<this._ymin&&(n=this._ymin),n>this._ymax&&(n=this._ymax)),r=Math.round((r-(this._xmin+this._margin))*this._finalRatio),n=Math.round((n-(this._ymin+this._margin))*this._finalRatio),this._line.push(new V(r,n)),this._isH=!1,this._isV=!1)}_lineTo(r,n,y){let g,v;if(this._type!==Y.Polygon)if(y){if(r=Math.round((r-(this._xmin+this._margin))*this._finalRatio),n=Math.round((n-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(g=this._line[this._line.length-1],g.equals(r,n)))return;this._line.push(new V(r,n))}else this._line&&this._line.length>0&&this._pushLine();else if(y||(r<this._xmin&&(r=this._xmin),r>this._xmax&&(r=this._xmax),n<this._ymin&&(n=this._ymin),n>this._ymax&&(n=this._ymax)),r=Math.round((r-(this._xmin+this._margin))*this._finalRatio),n=Math.round((n-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){g=this._line[this._line.length-1];const T=g.x===r,x=g.y===n;if(T&&x)return;this._isH&&T||this._isV&&x?(g.x=r,g.y=n,v=this._line[this._line.length-2],v.x===r&&v.y===n?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(v=this._line[this._line.length-2],this._isH=v.x===r,this._isV=v.y===n)):(this._isH=v.x===r,this._isV=v.y===n)):(this._line.push(new V(r,n)),this._isH=T,this._isV=x)}else this._line.push(new V(r,n))}}class tt{setExtent(r){this._ratio=4096===r?1:4096/r}get validateTessellation(){return this._ratio<1}reset(r){this._lines=[],this._line=null}moveTo(r,n){this._line&&this._lines.push(this._line),this._line=[];const y=this._ratio;this._line.push(new V(r*y,n*y))}lineTo(r,n){const y=this._ratio;this._line.push(new V(r*y,n*y))}close(){const r=this._line;r&&!r[0].isEqual(r[r.length-1])&&r.push(r[0])}result(){return this._line&&this._lines.push(this._line),0===this._lines.length?null:this._lines}}!function(c){c[c.sideLeft=0]="sideLeft",c[c.sideRight=1]="sideRight",c[c.sideTop=2]="sideTop",c[c.sideBottom=3]="sideBottom"}(k||(k={}));class z{static simplify(r,n,y){if(!y)return;const g=-n,v=r+n,T=-n,x=r+n,I=[],P=[],it=y.length;for(let J=0;J<it;++J){const Q=y[J];if(!Q||Q.length<2)continue;let L,B=Q[0];const A=Q.length;for(let U=1;U<A;++U)L=Q[U],B.x===L.x&&(B.x<=g&&(B.y>L.y?(I.push(J),I.push(U),I.push(k.sideLeft),I.push(-1)):(P.push(J),P.push(U),P.push(k.sideLeft),P.push(-1))),B.x>=v&&(B.y<L.y?(I.push(J),I.push(U),I.push(k.sideRight),I.push(-1)):(P.push(J),P.push(U),P.push(k.sideRight),P.push(-1)))),B.y===L.y&&(B.y<=T&&(B.x<L.x?(I.push(J),I.push(U),I.push(k.sideTop),I.push(-1)):(P.push(J),P.push(U),P.push(k.sideTop),P.push(-1))),B.y>=x&&(B.x>L.x?(I.push(J),I.push(U),I.push(k.sideBottom),I.push(-1)):(P.push(J),P.push(U),P.push(k.sideBottom),P.push(-1)))),B=L}if(0===I.length||0===P.length)return;z.fillParent(y,P,I),z.fillParent(y,I,P);const $=[];z.calcDeltas($,P,I),z.calcDeltas($,I,P),z.addDeltas($,y)}static fillParent(r,n,y){const g=y.length,v=n.length;for(let T=0;T<v;T+=4){const x=n[T],I=n[T+1],P=n[T+2],it=r[x][I-1],$=r[x][I];let J=8092,Q=-1;for(let L=0;L<g;L+=4){if(y[L+2]!==P)continue;const B=y[L],A=y[L+1],U=r[B][A-1],X=r[B][A];switch(P){case k.sideLeft:case k.sideRight:if(d(it.y,U.y,X.y)&&d($.y,U.y,X.y)){const D=Math.abs(X.y-U.y);D<J&&(J=D,Q=L)}break;case k.sideTop:case k.sideBottom:if(d(it.x,U.x,X.x)&&d($.x,U.x,X.x)){const D=Math.abs(X.x-U.x);D<J&&(J=D,Q=L)}}}n[T+3]=Q}}static calcDeltas(r,n,y){const g=n.length;for(let v=0;v<g;v+=4){const x=z.calcDelta(v,n,y,[]);r.push(n[v]),r.push(n[v+1]),r.push(n[v+2]),r.push(x)}}static calcDelta(r,n,y,g){const v=n[r+3];if(-1===v)return 0;const T=g.length;return T>1&&g[T-2]===v?0:(g.push(v),z.calcDelta(v,y,n,g)+1)}static addDeltas(r,n){const y=r.length;let g=0;for(let v=0;v<y;v+=4){const T=r[v+3];T>g&&(g=T)}for(let v=0;v<y;v+=4){const T=n[r[v]],x=r[v+1],I=g-r[v+3];switch(r[v+2]){case k.sideLeft:T[x-1].x-=I,T[x].x-=I,1===x&&(T[T.length-1].x-=I),x===T.length-1&&(T[0].x-=I);break;case k.sideRight:T[x-1].x+=I,T[x].x+=I,1===x&&(T[T.length-1].x+=I),x===T.length-1&&(T[0].x+=I);break;case k.sideTop:T[x-1].y-=I,T[x].y-=I,1===x&&(T[T.length-1].y-=I),x===T.length-1&&(T[0].y-=I);break;case k.sideBottom:T[x-1].y+=I,T[x].y+=I,1===x&&(T[T.length-1].y+=I),x===T.length-1&&(T[0].y+=I)}}}}const d=(c,r,n)=>c>=r&&c<=n||c>=n&&c<=r},33820:(ut,st,p)=>{p.d(st,{L:()=>Y,v:()=>C});const C=15.5,Y=1024},26128:(ut,st,p)=>{p.d(st,{DQ:()=>c,FM:()=>k,KU:()=>it,Of:()=>$,Or:()=>r,Px:()=>Q,RD:()=>V,Wg:()=>B,Z0:()=>J,k3:()=>y,nF:()=>z,pK:()=>L,s5:()=>n,sX:()=>v,yF:()=>H});var C=p(54746),Y=p(80247);const k=Number.POSITIVE_INFINITY,V=Math.PI,H=2*V,N=128/V,tt=256/360,z=V/180,d=1/Math.LN2;function c(A,U){return(A%=U)>=0?A:A+U}function r(A){return c(A*N,256)}function n(A){return c(A*tt,256)}function y(A){return Math.log(A)*d}function v(A,U,X){return A*(1-X)+U*X}const x=8,I=14,P=16;function it(A){return x+Math.max((A-I)*P,0)}function $(A,U,X){let D,f,b,w=0;for(const E of X){D=E.length;for(let O=1;O<D;++O)f=E[O-1],b=E[O],f.y>U!=b.y>U&&((b.x-f.x)*(U-f.y)-(b.y-f.y)*(A-f.x)>0?w++:w--)}return 0!==w}function J(A,U,X,D){let f,b,w,E;const O=D*D;for(const j of X){const G=j.length;if(!(G<2)){f=j[0].x,b=j[0].y;for(let q=1;q<G;++q){if(w=j[q].x,E=j[q].y,(0,C.Hu)(A,U,f,b,w,E)<O)return!0;f=w,b=E}}}return!1}function Q(A,U,X,D,f,b,w){const E=Math.max(D,Math.min(U,b))-U,O=Math.max(f,Math.min(X,w))-X;return E*E+O*O<=A*A}function L(A,U){if(0===U||Number.isNaN(U))return A;const X=[],D=new Y.E9(0,0),f=new Y.E9(0,0),b=new Y.E9(0,0);for(let w=0;w<A.length;w++){const E=A[w],O=[];for(let j=0;j<E.length;j++){const G=E[j-1],q=E[j],lt=E[j+1];0===j?D.setCoords(0,0):D.assignSub(q,G).normalize().rightPerpendicular(),j===E.length-1?f.setCoords(0,0):f.assignSub(lt,q).normalize().rightPerpendicular(),b.assignAdd(D,f).normalize();const nt=b.x*f.x+b.y*f.y;0!==nt&&b.scale(1/nt),O.push(Y.E9.add(q,b.scale(U)))}X.push(O)}return X}function B(A,U,X,D){const f=new Y.E9(A[0],A[1]);if(f.scale(D),"viewport"===U){const b=-X*(Math.PI/180),w=Math.cos(b),E=Math.sin(b);f.rotate(w,E)}return f}},46117:(ut,st,p)=>{p.d(st,{Z:()=>C});class C{constructor(k=0,V=0,H=0,N=0){this.x=k,this.y=V,this.width=H,this.height=N}get isEmpty(){return this.width<=0||this.height<=0}union(k){this.x=Math.min(this.x,k.x),this.y=Math.min(this.y,k.y),this.width=Math.max(this.width,k.width),this.height=Math.max(this.height,k.height)}}},75747:(ut,st,p)=>{p.d(st,{Z:()=>tt});var C=p(14007),Y=p(43101),k=p(92311),V=p(46356),H=p(87546);const N=(z,d)=>z.key.level-d.key.level!=0?z.key.level-d.key.level:z.key.row-d.key.row!=0?z.key.row-d.key.row:z.key.col-d.key.col;class tt extends k.Z{constructor(d){super(),this._tileInfoView=d}renderChildren(d){this.sortChildren(N),this.setStencilReference(d),super.renderChildren(d)}createRenderParams(d){const{state:c}=d,r=super.createRenderParams(d);return r.requiredLevel=this._tileInfoView.getClosestInfoForScale(c.scale).level,r.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(c.scale),r}prepareRenderPasses(d){const c=super.prepareRenderPasses(d);return c.push(d.registerRenderPass({name:"stencil",brushes:[V.Z],drawPhase:Y.jx.DEBUG|Y.jx.MAP|Y.jx.HIGHLIGHT|Y.jx.LABEL,target:()=>this.getStencilTarget()})),(0,C.Z)("esri-tiles-debug")&&c.push(d.registerRenderPass({name:"tileInfo",brushes:[H.Z],drawPhase:Y.jx.DEBUG,target:()=>this.children})),c}getStencilTarget(){return this.children}setStencilReference(d){let c=1;for(const r of this.children)r.stencilRef=c++}}},83124:(ut,st,p)=>{p.d(st,{y:()=>J});var g,C=p(50484),Y=p(83944),k=p(18626),V=p(57964),H=p(77675),N=p(80543),c=(p(14007),p(4703),p(65311),p(10141)),r=p(85338),n=p(30640),y=p(38954);let v=g=class extends y.Z{constructor(Q){super(Q),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new g({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}};(0,C._)([(0,N.Cb)({type:[Number,String],json:{write:!0}})],v.prototype,"left",void 0),(0,C._)([(0,N.Cb)({type:[Number,String],json:{write:!0}})],v.prototype,"right",void 0),(0,C._)([(0,N.Cb)({type:[Number,String],json:{write:!0}})],v.prototype,"top",void 0),(0,C._)([(0,N.Cb)({type:[Number,String],json:{write:!0}})],v.prototype,"bottom",void 0),v=g=(0,C._)([(0,c.j)("esri.views.layers.support.ClipRect")],v);const T=v;var x=p(87265);let I=class extends y.Z{constructor(Q){super(Q),this.type="path",this.path=[]}commitVersionProperties(){this.commitProperty("path")}};(0,C._)([(0,N.Cb)({type:[[[Number]]],json:{write:!0}})],I.prototype,"path",void 0),I=(0,C._)([(0,c.j)("esri.views.layers.support.Path")],I);const P=I;var it=p(64579);const $=Y.Z.ofType({key:"type",base:null,typeMap:{rect:T,path:P,geometry:x.Z}}),J=Q=>{let L=class extends Q{constructor(){super(...arguments),this.attached=!1,this.clips=new $,this.highlightOptions=null,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1,this._visibleAtCurrentScale=!0}initialize(){const B=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&B&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new V.Z("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new r.W),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([(0,H.YP)(()=>this.suspended,U=>{this.container&&(this.container.visible=!U)},H.tX),(0,H.YP)(()=>this.updateSuspended,U=>{this.view&&!U&&this.updateRequested&&this.view.requestUpdate()},H.tX),(0,H.YP)(()=>this.layer?.opacity??1,U=>{this.container&&(this.container.opacity=U)},H.tX),(0,H.YP)(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",U=>{this.container&&(this.container.blendMode=U)},H.tX),(0,H.YP)(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,U=>{this.container&&(this.container.effect=U)},H.tX),(0,H.YP)(()=>this.highlightOptions,U=>this.container.highlightOptions=U,H.tX),(0,H.on)(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)},H.tX),(0,H.YP)(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:U,scaleRange:X})=>{const D=(0,it.GB)(X,U);D!==this._visibleAtCurrentScale&&(this._visibleAtCurrentScale=D)},H.tX)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(U=>{U===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach(),this.updateRequested=!1}get spatialReferenceSupported(){const B=this.view?.spatialReference;return null==B||this.supportsSpatialReference(B)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating)}get visibleAtCurrentScale(){return this._visibleAtCurrentScale}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(B){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",B),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(B))):this.updateRequested=!1}hitTest(B,A){return Promise.resolve(null)}supportsSpatialReference(B){return!0}canResume(){return!!this.spatialReferenceSupported&&!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const B=super.getSuspendInfo(),A=!this.spatialReferenceSupported;return A&&(B.spatialReferenceNotSupported=A),B}addAttachHandles(B){this.addHandles(B,"attach")}};return(0,C._)([(0,N.Cb)()],L.prototype,"attached",void 0),(0,C._)([(0,N.Cb)({type:$,set(B){const A=(0,k.Z)(B,this._get("clips"),$);this._set("clips",A)}})],L.prototype,"clips",void 0),(0,C._)([(0,N.Cb)()],L.prototype,"container",void 0),(0,C._)([(0,N.Cb)({type:n.Z})],L.prototype,"highlightOptions",void 0),(0,C._)([(0,N.Cb)()],L.prototype,"moving",void 0),(0,C._)([(0,N.Cb)({readOnly:!0})],L.prototype,"spatialReferenceSupported",null),(0,C._)([(0,N.Cb)({readOnly:!0})],L.prototype,"updateParameters",void 0),(0,C._)([(0,N.Cb)()],L.prototype,"updateRequested",void 0),(0,C._)([(0,N.Cb)()],L.prototype,"updating",null),(0,C._)([(0,N.Cb)()],L.prototype,"view",void 0),(0,C._)([(0,N.Cb)()],L.prototype,"_visibleAtCurrentScale",void 0),(0,C._)([(0,N.Cb)({readOnly:!0})],L.prototype,"visibleAtCurrentScale",null),L=(0,C._)([(0,c.j)("esri.views.2d.layers.LayerView2D")],L),L}},11073:(ut,st,p)=>{p.r(st),p.d(st,{default:()=>ze});var C=p(15861),Y=p(50484),k=p(34222),V=p(4703),H=p(51172),N=p(79412),tt=p(80543),d=(p(14007),p(10141)),c=p(657),r=p(44107),n=p(45425),y=p(33721),g=p(17866),v=p(6785),T=p(36885),x=p(46117);class I{constructor(t,e){this._width=0,this._height=0,this._free=[],this._width=t,this._height=e,this._free.push(new x.Z(0,0,t,e))}get width(){return this._width}get height(){return this._height}allocate(t,e){if(t>this._width||e>this._height)return new x.Z;let s=null,i=-1;for(let o=0;o<this._free.length;++o){const a=this._free[o];t<=a.width&&e<=a.height&&(null===s||a.y<=s.y&&a.x<=s.x)&&(s=a,i=o)}return null===s?new x.Z:(this._free.splice(i,1),s.width<s.height?(s.width>t&&this._free.push(new x.Z(s.x+t,s.y,s.width-t,e)),s.height>e&&this._free.push(new x.Z(s.x,s.y+e,s.width,s.height-e))):(s.width>t&&this._free.push(new x.Z(s.x+t,s.y,s.width-t,s.height)),s.height>e&&this._free.push(new x.Z(s.x,s.y+e,t,s.height-e))),new x.Z(s.x,s.y,t,e))}release(t){for(let e=0;e<this._free.length;++e){const s=this._free[e];if(s.y===t.y&&s.height===t.height&&s.x+s.width===t.x)s.width+=t.width;else if(s.x===t.x&&s.width===t.width&&s.y+s.height===t.y)s.height+=t.height;else if(t.y===s.y&&t.height===s.height&&t.x+t.width===s.x)s.x=t.x,s.width+=t.width;else{if(t.x!==s.x||t.width!==s.width||t.y+t.height!==s.y)continue;s.y=t.y,s.height+=t.height}this._free.splice(e,1),this.release(t)}this._free.push(t)}}var P=p(39237),it=p(17091),$=p(22784);class J{constructor(t,e,s){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=e,this._glyphSource=s,this._binPack=new I(t-4,e-4),this._glyphData.push(new Uint8Array(t*e)),this._dirties.push(!0),this._textures.push(void 0)}getGlyphItems(t,e){const s=[],i=this._glyphSource,o=new Set;for(const u of e){const _=Math.floor(.00390625*u);o.add(_)}const l=[];return o.forEach(u=>{const _=t+u;if(this._rangePromises.has(_))l.push(this._rangePromises.get(_));else{const m=i.getRange(t,u).then(()=>{this._rangePromises.delete(_)},()=>{this._rangePromises.delete(_)});this._rangePromises.set(_,m),l.push(m)}}),Promise.all(l).then(()=>{let u=this._glyphIndex[t];u||(u={},this._glyphIndex[t]=u);for(const _ of e){const m=u[_];if(m){s[_]={sdf:!0,rect:m.rect,metrics:m.metrics,page:m.page,code:_};continue}const R=i.getGlyph(t,_);if(!R?.metrics)continue;const M=R.metrics;let S;if(0===M.width)S=new x.Z(0,0,0,0);else{const W=M.width+6,K=M.height+6;let Z=W%4?4-W%4:4,et=K%4?4-K%4:4;1===Z&&(Z=5),1===et&&(et=5),S=this._binPack.allocate(W+Z,K+et),S.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new I(this.width-4,this.height-4),S=this._binPack.allocate(W+Z,K+et));const rt=this._glyphData[this._currentPage],ht=R.bitmap;let yt,at;if(ht)for(let ct=0;ct<K;ct++){yt=W*ct,at=this.width*(S.y+ct+1)+S.x;for(let pt=0;pt<W;pt++)rt[at+pt+1]=ht.at(yt+pt)}}u[_]={rect:S,metrics:M,tileIDs:null,page:this._currentPage},s[_]={sdf:!0,rect:S,metrics:M,page:this._currentPage,code:_},this._dirties[this._currentPage]=!0}return s})}removeGlyphs(t){for(const e in this._glyphIndex){const s=this._glyphIndex[e];if(!s)continue;let i;for(const o in s)if(i=s[o],i.tileIDs.delete(t),0===i.tileIDs.size){const a=this._glyphData[i.page],l=i.rect;let u,_;for(let m=0;m<l.height;m++)for(u=this.width*(l.y+m)+l.x,_=0;_<l.width;_++)a[u+_]=0;delete s[o],this._dirties[i.page]=!0}}}bind(t,e,s,i=0){if(!this._textures[s]){const a=new $.X;a.pixelFormat=P.VI.ALPHA,a.wrapMode=P.e8.CLAMP_TO_EDGE,a.width=this.width,a.height=this.height,this._textures[s]=new it.x(t,a,new Uint8Array(this.width*this.height))}const o=this._textures[s];o.setSamplingMode(e),this._dirties[s]&&o.setData(this._glyphData[s]),t.bindTexture(o,i),this._dirties[s]=!1}destroy(){this.dispose()}dispose(){this._glyphData.length=0,this._binPack=null;for(const t of this._textures)t&&t.dispose();this._textures.length=0}}var Q=p(66476),L=p(40485);class B{constructor(t){if(this._metrics=[],!t)return void(this._allBitmaps=null);const e=new Map;let s=0;for(;t.next();)switch(t.tag()){case 1:{const a=t.getMessage();for(;a.next();)switch(a.tag()){case 3:{const l=a.getMessage();let u,_,m,R,M,S,F;for(;l.next();)switch(l.tag()){case 1:u=l.getUInt32();break;case 2:_=l.getBytes();break;case 3:m=l.getUInt32();break;case 4:R=l.getUInt32();break;case 5:M=l.getSInt32();break;case 6:S=l.getSInt32();break;case 7:F=l.getUInt32();break;default:l.skip()}if(l.release(),u){const W=_?.length??0;this._metrics[u]={width:m,height:R,left:M,top:S,advance:F,startOffset:s,length:W},e.set(u,_),s+=W}break}default:a.skip()}a.release();break}default:t.skip()}const i=new Uint8Array(s),o=this._metrics;for(const[a,l]of e){const{startOffset:u,length:_}=o[a];if(l)for(let m=0;m<_;++m)i[u+m]=l[m]}this._allBitmaps=i}getMetrics(t){return this._metrics[t]}getBitmap(t){if(!this._allBitmaps)return;const e=this._metrics[t];if(void 0===e)return;const{startOffset:s,length:i}=e;return 0!==i?new X(this._allBitmaps,s,i):void 0}}class A{constructor(){this._ranges=[]}get ranges(){return this._ranges}getRange(t){return this._ranges[t]}addRange(t,e){this._ranges[t]=e}}class U{constructor(t){this._glyphInfo={},this._baseURL=t}getRange(t,e){const s=this._getFontStack(t);if(s.getRange(e))return Promise.resolve();const i=256*e,o=i+255;if(this._baseURL){const a=this._baseURL.replace("{fontstack}",t).replace("{range}",i+"-"+o);return(0,Q.Z)(a,{responseType:"array-buffer"}).then(l=>{s.addRange(e,new B(new L.Z(new Uint8Array(l.data),new DataView(l.data))))}).catch(()=>{s.addRange(e,new B)})}return s.addRange(e,new B),Promise.resolve()}getGlyph(t,e){const s=this._getFontStack(t);if(!s)return;const i=Math.floor(e/256),o=s.getRange(i);return o?{metrics:o.getMetrics(e),bitmap:o.getBitmap(e)}:void 0}_getFontStack(t){let e=this._glyphInfo[t];return e||(e=this._glyphInfo[t]=new A),e}}class X{constructor(t,e,s){this._array=t,this._start=e,this.length=s}at(t){return 0<=t&&t<this.length?this._array[this._start+t]:void 0}}var D=p(52793);class b{constructor(t,e,s=0){this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,e<=0&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=t,this._pageHeight=e,s>0&&(this._maxItemSize=s),this._binPack=new I(t-4,e-4)}destroy(){this.dispose()}dispose(){this._binPack=null,this._mosaicsData.length=0,this._mosaicRects={};for(const t of this._textures)t&&t.dispose();this._textures.length=0}getWidth(t){return t>=this._size.length?-1:this._size[t][0]}getHeight(t){return t>=this._size.length?-1:this._size[t][1]}getPageSize(t){return t>=this._size.length?null:this._size[t]}setSpriteSource(t){if(this.dispose(),this.pixelRatio=t.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new I(this._pageWidth-4,this._pageHeight-4);const e=Math.floor(this._pageWidth),s=Math.floor(this._pageHeight),i=new Uint32Array(e*s);this._mosaicsData[0]=i,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=t}getSpriteItem(t,e=!1){let s,i,o=this._mosaicRects[t];if(o)return o;if(!this._sprites||"loaded"!==this._sprites.loadStatus||(t&&t.startsWith("dasharray-")?([s,i]=this._rasterizeDash(t),e=!0):s=this._sprites.getSpriteInfo(t),!s?.width||!s.height||s.width<0||s.height<0))return null;const a=s.width,l=s.height,[u,_,m]=this._allocateImage(a,l);return u.width<=0?null:(this._copy(u,s,_,m,e,i),o={type:"sprite",rect:u,width:a,height:l,sdf:s.sdf,simplePattern:!1,rasterizationScale:s.pixelRatio,page:_},this._mosaicRects[t]=o,o)}getSpriteItems(t){const e={};for(const s of t)e[s.name]=this.getSpriteItem(s.name,s.repeat);return e}getMosaicItemPosition(t,e){const s=this.getSpriteItem(t,e),i=s?.rect;return i?(i.width=s.width,i.height=s.height,{tl:[i.x+2,i.y+2],br:[i.x+2+s.width,i.y+2+s.height],page:s.page}):null}bind(t,e,s=0,i=0){if(s>=this._size.length||s>=this._mosaicsData.length)return;if(!this._textures[s]){const a=new $.X;a.wrapMode=P.e8.CLAMP_TO_EDGE,a.width=this._size[s][0],a.height=this._size[s][1],this._textures[s]=new it.x(t,a,new Uint8Array(this._mosaicsData[s].buffer))}const o=this._textures[s];o.setSamplingMode(e),this._dirties[s]&&o.setData(new Uint8Array(this._mosaicsData[s].buffer)),t.bindTexture(o,i),this._dirties[s]=!1}static _copyBits(t,e,s,i,o,a,l,u,_,m,R){let M=i*e+s,S=u*a+l;if(R){S-=a;for(let F=-1;F<=m;F++,M=((F+m)%m+i)*e+s,S+=a)for(let W=-1;W<=_;W++)o[S+W]=t[M+(W+_)%_]}else for(let F=0;F<m;F++){for(let W=0;W<_;W++)o[S+W]=t[M+W];M+=e,S+=a}}_copy(t,e,s,i,o,a){if(!this._sprites||"loaded"!==this._sprites.loadStatus||s>=this._mosaicsData.length)return;const l=new Uint32Array(a?a.buffer:this._sprites.image.buffer);b._copyBits(l,a?e.width:this._sprites.width,e.x,e.y,this._mosaicsData[s],i[0],t.x+2,t.y+2,e.width,e.height,o),this._dirties[s]=!0}_allocateImage(t,e){t+=2,e+=2;const s=Math.max(t,e);if(this._maxItemSize&&this._maxItemSize<s){const l=new x.Z(0,0,t,e);return this._mosaicsData.push(new Uint32Array(t*e)),this._dirties.push(!0),this._size.push([t,e]),this._textures.push(void 0),[l,this._mosaicsData.length-1,[t,e]]}let i=t%4?4-t%4:4,o=e%4?4-e%4:4;1===i&&(i=5),1===o&&(o=5);const a=this._binPack.allocate(t+i,e+o);return a.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new I(this._pageWidth-4,this._pageHeight-4),this._allocateImage(t,e)):[a,this._currentPage,[this._pageWidth,this._pageHeight]]}_rasterizeDash(t){const s=t.match(/\[(.*?)\]/);if(!s)return null;const i=s[1].split(",").map(Number),o=t.slice(t.lastIndexOf("-")+1),[a,l,u]=(0,D.m)(i,o);return[{x:0,y:0,width:l,height:u,sdf:!0,pixelRatio:1},new Uint8Array(a.buffer)]}}var w=p(54529);class E{constructor(t,e,s,i){this._layer=t,this._styleRepository=e,this.devicePixelRatio=s,this._sourceDataMaxLOD=i,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null,this._spriteSourceAbortController=null,this._startOptionsInputSignal=null,this._inputSignalEventListener=null}destroy(){this._connection?.close(),this._connection=null,this._styleRepository=null,this._layer=null,this._spriteMosaic?.destroy(),this._spriteMosaic=null,this._glyphMosaic=null,this._spriteSourceAbortController=(0,H.IM)(this._spriteSourceAbortController),this._spriteSourcePromise=null,this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener),this._startOptionsInputSignal=null,this._inputSignalEventListener=null}get spriteMosaic(){return this._spriteSourcePromise.then(()=>this._spriteMosaic)}get glyphMosaic(){return this._glyphMosaic}start(t){var e=this;return(0,C.Z)(function*(){e._requestSprite(t);const s=e._layer.currentStyleInfo.glyphsUrl,i=new U(s?(0,v.fl)(s,{...e._layer.customParameters,token:e._layer.apiKey}):null);e._glyphMosaic=new J(1024,1024,i),e._broadcastPromise=(0,T.bA)("WorkerTileHandler",{client:e,schedule:t.schedule,signal:t.signal}).then(o=>{if(e._layer&&(e._connection?.close(),e._connection=o,e._layer&&!e._connection.closed)){const a=o.broadcast("setStyle",{style:e._layer.currentStyleInfo.style,sourceDataMaxLOD:e._sourceDataMaxLOD},t);Promise.all(a).catch(l=>(0,N.H9)(l))}})})()}_requestSprite(t){this._spriteSourceAbortController?.abort();const e=new AbortController;this._spriteSourceAbortController=e;const s=t?.signal;this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener),this._startOptionsInputSignal=null,s&&(this._inputSignalEventListener=function O(h){return()=>h.abort()}(e),s.addEventListener("abort",this._inputSignalEventListener,{once:!0}));const{signal:i}=e,o={...t,signal:i};this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,o),this._spriteSourcePromise.then(a=>{(0,N.r9)(i),this._spriteMosaic=new b(1024,1024,250),this._spriteMosaic.setSpriteSource(a)})}updateStyle(t){var e=this;return(0,C.Z)(function*(){return yield e._broadcastPromise,e._broadcastPromise=Promise.all(e._connection.broadcast("updateStyle",t)),e._broadcastPromise})()}setSpriteSource(t){const e=new b(1024,1024,250);return e.setSpriteSource(t),this._spriteMosaic=e,this._spriteSourcePromise=Promise.resolve(t),this._spriteSourceAbortController=null,e}setStyle(t,e,s){var i=this;return(0,C.Z)(function*(){yield i._broadcastPromise,i._styleRepository=t,i._sourceDataMaxLOD=s,i._requestSprite();const o=new U(i._layer.currentStyleInfo.glyphsUrl?(0,v.fl)(i._layer.currentStyleInfo.glyphsUrl,{...i._layer.customParameters,token:i._layer.apiKey}):null);return i._glyphMosaic=new J(1024,1024,o),i._broadcastPromise=Promise.all(i._connection.broadcast("setStyle",{style:e,sourceDataMaxLOD:i._sourceDataMaxLOD})),i._broadcastPromise})()}fetchTileData(t,e){var s=this;return(0,C.Z)(function*(){const i=yield s._getRefKeys(t,e);return s._getSourcesData(Object.keys(s._layer.sourceNameToSource),i,e)})()}fetchTilePBFs(t){var e=this;return(0,C.Z)(function*(){const s=Object.keys(e._layer.sourceNameToSource),i={},o=yield e._getRefKeys(t,i),a=[],l=[];for(let u=0;u<o.length;u++)if(null==o[u].value||null==s[u])l.push(null);else{const _=o[u].value,m=e._getTilePayload(_,s[u],i);m.then(R=>{a.push({...R,key:_})}),l.push(m)}return Promise.all(l).then(()=>a)})()}parseTileData(t,e){var s=this;return(0,C.Z)(function*(){const i=t&&t.data;if(!i)return null;const{sourceName2DataAndRefKey:o,transferList:a}=i;return 0===Object.keys(o).length?null:s._broadcastPromise.then(()=>s._connection.invoke("createTileAndParse",{key:t.key.id,sourceName2DataAndRefKey:o,styleLayerUIDs:t.styleLayerUIDs},{...e,transferList:a}))})()}getSprites(t){var e=this;return(0,C.Z)(function*(){return yield e._spriteSourcePromise,e._spriteMosaic.getSpriteItems(t)})()}getGlyphs(t){return this._glyphMosaic.getGlyphItems(t.font,t.codePoints)}_getTilePayload(t,e,s){var i=this;return(0,C.Z)(function*(){const o=w.Z.pool.acquire(t.id),a=i._layer.sourceNameToSource[e],{level:l,row:u,col:_}=o;w.Z.pool.release(o);try{return{protobuff:yield a.requestTile(l,u,_,s),sourceName:e}}catch(m){if((0,N.D_)(m))throw m;return{protobuff:null,sourceName:e}}})()}_getRefKeys(t,e){var s=this;return(0,C.Z)(function*(){const i=s._layer.sourceNameToSource,o=new Array;for(const a in i){const l=i[a].getRefKey(t,e);o.push(l)}return(0,N.as)(o)})()}_getSourcesData(t,e,s){const i=[];for(let o=0;o<e.length;o++)if(null==e[o].value||null==t[o])i.push(null);else{const l=this._getTilePayload(e[o].value,t[o],s);i.push(l)}return(0,N.as)(i).then(o=>{const a={},l=[];for(let u=0;u<o.length;u++){const _=o[u].value;_&&_.protobuff&&_.protobuff.byteLength>0&&(a[_.sourceName]={refKey:e[u].value.id,protobuff:_.protobuff},l.push(_.protobuff))}return{sourceName2DataAndRefKey:a,transferList:l}})}}var j=p(52540),G=p(22879);const nt=(h,t)=>h+1/(1<<2*t);class dt{constructor(t,e){this._tiles=new Map,this._tileCache=new j.z(40,s=>s.dispose()),this._viewSize=[0,0],this._visibleTiles=new Map,this.acquireTile=t.acquireTile,this.releaseTile=t.releaseTile,this.tileInfoView=t.tileInfoView,this._container=e}destroy(){for(const[t,e]of this._tiles)e.dispose();this._tiles=null,this._tileCache.clear(),this._tileCache=null}update(t){this._updateCacheSize(t);const e=this.tileInfoView,s=e.getTileCoverage(t.state,0,!0,"smallest");if(!s)return!0;const{spans:i,lodInfo:o}=s,{level:a}=o,l=this._tiles,u=new Set,_=new Set;for(const{row:R,colFrom:M,colTo:S}of i)for(let F=M;F<=S;F++){const W=w.Z.getId(a,R,o.normalizeCol(F),o.getWorldForColumn(F)),K=this._getOrAcquireTile(W);u.add(W),K.processed()?this._addToContainer(K):_.add(new w.Z(W))}for(const[R,M]of l)M.isCoverage=u.has(R);for(const R of _)this._findPlaceholdersForMissingTiles(R,u);let m=!1;for(const[R,M]of l)M.neededForCoverage=u.has(R),M.neededForCoverage||M.isHoldingForFade&&e.intersects(s,M.key)&&u.add(R),M.isFading&&(m=!0);for(const[R,M]of this._tiles)u.has(R)||this._releaseTile(R);return G.Z.pool.release(s),!m}clear(){this._tiles.clear(),this._tileCache.clear(),this._visibleTiles.clear()}clearCache(){this._tileCache.clear()}getIntersectingTiles(t,e,s,i,o){const a=[0,0],l=[0,0];i.toMap(a,t-s,e+s),i.toMap(l,t+s,e-s);const u=Math.min(a[0],l[0]),_=Math.min(a[1],l[1]),m=Math.max(a[0],l[0]),R=Math.max(a[1],l[1]),M=(0,n.al)(u,_,m,R),S=(0,n.Ue)(),F=[];for(const[W,K]of this._visibleTiles)this.tileInfoView.getTileBounds(S,K.key),(0,n.kK)(M,S)&&F.push(K);if(null!=o&&o.length>0){const W=new Set(F.map(Z=>Z.id)),K=o.filter(Z=>!W.has(Z.tileKey.id)).map(Z=>this._visibleTiles.get(Z.tileKey.id)).filter(Z=>void 0!==Z);F.push(...K)}return F}_findPlaceholdersForMissingTiles(t,e){const s=[];for(const[o,a]of this._tiles)this._addPlaceholderChild(s,a,t,e);const i=s.reduce(nt,0);Math.abs(1-i)<1e-6||this._addPlaceholderParent(t.id,e)}_addPlaceholderChild(t,e,s,i){e.key.level<=s.level||!e.hasData()||function Pt(h,t){const e=t.level-h.level;return h.row===t.row>>e&&h.col===t.col>>e&&h.world===t.world}(s,e.key)&&(this._addToContainer(e),i.add(e.id),t.push(e.key.level-s.level))}_addPlaceholderParent(t,e){const s=this._tiles;let i=t;for(;;){if(i=gt(i),!i||e.has(i))return;const o=s.get(i);if(o?.hasData())return this._addToContainer(o),void e.add(o.id)}}_getOrAcquireTile(t){let e=this._tiles.get(t);return e||(e=this._tileCache.pop(t),e||(e=this.acquireTile(new w.Z(t))),this._tiles.set(t,e),e)}_releaseTile(t){const e=this._tiles.get(t);this.releaseTile(e),this._removeFromContainer(e),this._tiles.delete(t),e.hasData()?this._tileCache.put(t,e,1):e.dispose()}_addToContainer(t){let e;const s=[],i=this._container;if(i.contains(t))return;const o=this._visibleTiles;for(const[a,l]of o)this._canConnectDirectly(t,l)&&s.push(l),null==e&&this._canConnectDirectly(l,t)&&(e=l);if(null!=e){for(const a of s)e.childrenTiles.delete(a),t.childrenTiles.add(a),a.parentTile=t;e.childrenTiles.add(t),t.parentTile=e}else for(const a of s)t.childrenTiles.add(a),a.parentTile=t;o.set(t.id,t),i.addChild(t)}_removeFromContainer(t){if(this._visibleTiles.delete(t.id),this._container.removeChild(t),null!=t.parentTile){t.parentTile.childrenTiles.delete(t);for(const e of t.childrenTiles)null!=t.parentTile&&t.parentTile.childrenTiles.add(e)}for(const e of t.childrenTiles)e.parentTile=t.parentTile;t.parentTile=null,t.childrenTiles.clear()}_canConnectDirectly(t,e){const s=t.key;let{level:i,row:o,col:a,world:l}=e.key;const u=this._visibleTiles;for(;i>0;){if(i--,o>>=1,a>>=1,s.level===i&&s.row===o&&s.col===a&&s.world===l)return!0;if(u.has(`${i}/${o}/${a}/${l}`))return!1}return!1}_updateCacheSize(t){const e=t.state.size;if(e[0]===this._viewSize[0]&&e[1]===this._viewSize[1])return;const s=Math.ceil(e[0]/512)+1,i=Math.ceil(e[1]/512)+1;this._viewSize[0]=e[0],this._viewSize[1]=e[1],this._tileCache.maxSize=5*s*i}}function gt(h){const[t,e,s,i]=h.split("/"),o=parseInt(t,10);return 0===o?null:`${o-1}/${parseInt(e,10)>>1}/${parseInt(s,10)>>1}/${parseInt(i,10)}`}var bt=p(92899),mt=p(44406),At=p(40271),qt=p(6777),Et=p(87766),Ot=(p(40394),p(26128));class te{constructor(t,e){this.sourceTile=e,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t}}class ee{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}function Ut(h,t,e,s,i,o){const a=e-i;if(a>=0)return(t>>a)+(s-(o<<a))*(h>>a);const l=-a;return t-(o-(s<<l))*(h>>l)<<l}class zt{constructor(t,e,s){this._rows=Math.ceil(e/s),this._columns=Math.ceil(t/s),this._cellSize=s,this.cells=new Array(this._rows);for(let i=0;i<this._rows;i++){this.cells[i]=new Array(this._columns);for(let o=0;o<this._columns;o++)this.cells[i][o]=[]}}getCell(t,e){const s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._rows-1),i=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._columns-1);return this.cells[s]&&this.cells[s][i]||null}getCellSpan(t,e,s,i){return[Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(e/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function re(h,t,e,s,i){const o=h.layerData.get(i);if(o.type===g.al.SYMBOL){for(const a of s){const l=a.unique;let u;if(a.selectedForRendering){const _=l.parts[0],m=_.startOpacity,R=_.targetOpacity;h.allSymbolsFadingOut=h.allSymbolsFadingOut&&0===R;const M=e?Math.floor(127*m)|R<<7:R?255:0;u=M<<24|M<<16|M<<8|M}else u=0;for(const[_,m]of a.iconVertexRanges)for(let R=_;R<_+m;R+=4)o.iconOpacity[R/4]=u;if(a.selectedForRendering){const _=l.parts[1],m=_.startOpacity,R=_.targetOpacity;h.allSymbolsFadingOut=h.allSymbolsFadingOut&&0===R;const M=e?Math.floor(127*m)|R<<7:R?255:0;u=M<<24|M<<16|M<<8|M}else u=0;for(const[_,m]of a.textVertexRanges)for(let R=_;R<_+m;R+=4)o.textOpacity[R/4]=u}o.lastOpacityUpdate=t,o.opacityChanged=!0}}function ne(h,t,e,s){const i=h.colliders;let o,a,l,u;for(const _ of i)if(h.unique.show&&h.unique.parts[_.partIndex].show&&(o=_.xScreen-s[0]+_.dxScreen,a=_.yScreen-s[1]+_.dyScreen,l=o+_.width,u=a+_.height,(0,Ot.Px)(e,t.x,t.y,o,a,l,u)))return!0;return!1}var _t=p(39853),xt=p(46682);class St{constructor(t,e){this.layerUIDs=[],this.isDestroyed=!1,this._data=t;let s=1;const i=new Uint32Array(t);this.layerUIDs=[];const o=i[s++];for(let a=0;a<o;a++)this.layerUIDs[a]=i[s++];this.bufferDataOffset=s,e&&(this.layer=e.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return null==this._data}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(t){null!=this._data&&(this.doPrepareForRendering(t,this._data,this.bufferDataOffset),this._data=null)}}class oe extends St{constructor(t,e){super(t,e),this.type=g.al.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const s=new Uint32Array(t);let i=this.bufferDataOffset;this.lineIndexStart=s[i++],this.lineIndexCount=s[i++];const o=s[i++];if(o>0){this.patternMap=new Map;for(let a=0;a<o;a++){const l=s[i++],u=s[i++],_=s[i++];this.patternMap.set(l,[u,_])}}this.bufferDataOffset=i}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=(0,H.M2)(this.vao)}doPrepareForRendering(t,e,s){const i=new Uint32Array(e),o=new Int32Array(i.buffer),a=i[s++],l=_t.f.createVertex(t,P.l1.STATIC_DRAW,new Int32Array(o.buffer,4*s,a));s+=a;const u=i[s++],_=_t.f.createIndex(t,P.l1.STATIC_DRAW,new Uint32Array(i.buffer,4*s,u));s+=u;const m=this.layer.lineMaterial;this.vao=new xt.U(t,m.getAttributeLocations(),m.getLayoutInfo(),{geometry:l},_)}}class ae extends St{constructor(t,e){super(t,e),this.type=g.al.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const s=new Uint32Array(t);let i=this.bufferDataOffset;this.fillIndexStart=s[i++],this.fillIndexCount=s[i++],this.outlineIndexStart=s[i++],this.outlineIndexCount=s[i++];const o=s[i++];if(o>0){this.patternMap=new Map;for(let a=0;a<o;a++){const l=s[i++],u=s[i++],_=s[i++];this.patternMap.set(l,[u,_])}}this.bufferDataOffset=i}get memoryUsed(){return(this.data?.byteLength??0)+(this.fillVAO?.usedMemory??0)+(this.outlineVAO?.usedMemory??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=(0,H.M2)(this.fillVAO),this.outlineVAO=(0,H.M2)(this.outlineVAO)}doPrepareForRendering(t,e,s){const i=new Uint32Array(e),o=new Int32Array(i.buffer),a=i[s++],l=_t.f.createVertex(t,P.l1.STATIC_DRAW,new Int32Array(o.buffer,4*s,a));s+=a;const u=i[s++],_=_t.f.createIndex(t,P.l1.STATIC_DRAW,new Uint32Array(i.buffer,4*s,u));s+=u;const m=i[s++],R=_t.f.createVertex(t,P.l1.STATIC_DRAW,new Int32Array(o.buffer,4*s,m));s+=m;const M=i[s++],S=_t.f.createIndex(t,P.l1.STATIC_DRAW,new Uint32Array(i.buffer,4*s,M));s+=M;const F=this.layer,W=F.fillMaterial,K=F.outlineMaterial;this.fillVAO=new xt.U(t,W.getAttributeLocations(),W.getLayoutInfo(),{geometry:l},_),this.outlineVAO=new xt.U(t,K.getAttributeLocations(),K.getLayoutInfo(),{geometry:R},S)}}class le extends St{constructor(t,e,s){super(t,e),this.type=g.al.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const i=new Uint32Array(t),o=new Int32Array(t),a=new Float32Array(t);let l=this.bufferDataOffset;this.isIconSDF=!!i[l++];const u=i[l++],_=i[l++],m=i[l++],R=new w.Z(u,_,m,0),M=i[l++];for(let K=0;K<M;K++){const Z=i[l++],et=i[l++],rt=i[l++];this.iconPerPageElementsMap.set(Z,[et,rt])}const S=i[l++];for(let K=0;K<S;K++){const Z=i[l++],et=i[l++],rt=i[l++];this.glyphPerPageElementsMap.set(Z,[et,rt])}const F=i[l++],W=i[l++];this.iconOpacity=new Int32Array(F),this.textOpacity=new Int32Array(W),l=function se(h,t,e,s,i,o,a){const l=t[s++];for(let u=0;u<l;u++){const _=new te(o,a);_.xTile=t[s++],_.yTile=t[s++],_.hash=t[s++],_.priority=t[s++],_.featureIndex=t[s++];const m=t[s++];for(let S=0;S<m;S++){const F=t[s++],W=t[s++],K=t[s++],Z=t[s++],et=!!t[s++],rt=t[s++],ht=e[s++],yt=e[s++],at=t[s++],ct=t[s++];_.colliders.push({xTile:F,yTile:W,dxPixels:K,dyPixels:Z,hard:et,partIndex:rt,width:at,height:ct,minLod:ht,maxLod:yt})}const R=h[s++];for(let S=0;S<R;S++)_.textVertexRanges.push([h[s++],h[s++]]);const M=h[s++];for(let S=0;S<M;S++)_.iconVertexRanges.push([h[s++],h[s++]]);i.push(_)}return s}(i,o,a,l,this.symbols,s,R),this.bufferDataOffset=l}get memoryUsed(){return(this.data?.byteLength??0)+(this.iconVAO?.usedMemory??0)+(this.textVAO?.usedMemory??0)+(0,At.Xw)(this.iconOpacity)+(0,At.Xw)(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let t=0;for(const[e,s]of this.iconPerPageElementsMap)t+=s[1];for(const[e,s]of this.glyphPerPageElementsMap)t+=s[1];return t/3}doDestroy(){this.iconVAO=(0,H.M2)(this.iconVAO),this.textVAO=(0,H.M2)(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const t=this.iconOpacity,e=this.iconVAO.vertexBuffers.opacity;t.length>0&&t.byteLength===e.usedMemory&&e.setSubData(t,0,0,t.length);const s=this.textOpacity,i=this.textVAO.vertexBuffers.opacity;s.length>0&&s.byteLength===i.usedMemory&&i.setSubData(s,0,0,s.length)}doPrepareForRendering(t,e,s){const i=new Uint32Array(e),o=new Int32Array(i.buffer),a=i[s++],l=_t.f.createVertex(t,P.l1.STATIC_DRAW,new Int32Array(o.buffer,4*s,a));s+=a;const u=i[s++],_=_t.f.createIndex(t,P.l1.STATIC_DRAW,new Uint32Array(i.buffer,4*s,u));s+=u;const m=i[s++],R=_t.f.createVertex(t,P.l1.STATIC_DRAW,new Int32Array(o.buffer,4*s,m));s+=m;const M=i[s++],S=_t.f.createIndex(t,P.l1.STATIC_DRAW,new Uint32Array(i.buffer,4*s,M));s+=M;const F=_t.f.createVertex(t,P.l1.STATIC_DRAW,this.iconOpacity.buffer),W=_t.f.createVertex(t,P.l1.STATIC_DRAW,this.textOpacity.buffer),K=this.layer,Z=K.iconMaterial,et=K.textMaterial;this.iconVAO=new xt.U(t,Z.getAttributeLocations(),Z.getLayoutInfo(),{geometry:l,opacity:F},_),this.textVAO=new xt.U(t,et.getAttributeLocations(),et.getLayoutInfo(),{geometry:R,opacity:W},S)}}class he extends St{constructor(t,e){super(t,e),this.type=g.al.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const s=new Uint32Array(t);let i=this.bufferDataOffset;this.circleIndexStart=s[i++],this.circleIndexCount=s[i++],this.bufferDataOffset=i}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=(0,H.M2)(this.vao)}doPrepareForRendering(t,e,s){const i=new Uint32Array(e),o=new Int32Array(i.buffer),a=i[s++],l=_t.f.createVertex(t,P.l1.STATIC_DRAW,new Int32Array(o.buffer,4*s,a));s+=a;const u=i[s++],_=_t.f.createIndex(t,P.l1.STATIC_DRAW,new Uint32Array(i.buffer,4*s,u));s+=u;const m=this.layer.circleMaterial;this.vao=new xt.U(t,m.getAttributeLocations(),m.getLayoutInfo(),{geometry:l},_)}}var vt=p(9655),Bt=p(13305);class Dt extends Bt.I{constructor(t,e,s,i,o,a,l,u=null){super(t,e,s,i,o,a,4096,4096),this.styleRepository=l,this._memCache=u,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this.featureIndex=null,this.triangleCount=0,this._processed=!1,this._referenced=1,this.id=t.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<vt.v7}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<vt.v7)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(t){this.changeDataImpl(t),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(t){let e=!1;for(const s of t){const i=this.layerData.get(s);i&&(this._memoryUsedByLayerData-=i.memoryUsed,i.type===g.al.SYMBOL&&this.symbols.delete(s)&&(e=!0),i.destroy(),this.layerData.delete(s))}this._memCache?.updateSize(this.key.id,this,this._memoryUsedByLayerData),e&&(this.featureIndex?.clear(),this.emit("symbols-changed")),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}dispose(){"unloaded"!==this.status&&(this.featureIndex=null,Vt.delete(this),Dt._destroyRenderBuckets(this.layerData),this.layerData.clear(),this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return 0==--this._referenced&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get usedMemory(){return this._memoryUsedByLayerData+256}changeDataImpl(t){this.featureIndex?.clear();let e=!1;if(t){const{bucketsWithData:s,emptyBuckets:i}=t,o=this._createRenderBuckets(s);if(i&&i.byteLength>0){const a=new Uint32Array(i);for(const l of a)this._deleteLayerData(l)}for(const[a,l]of o)this._deleteLayerData(a),l.type===g.al.SYMBOL&&(this.symbols.set(a,l.symbols),e=!0),this._memoryUsedByLayerData+=l.memoryUsed,this.layerData.set(a,l);this._memCache?.updateSize(this.key.id,this,this.usedMemory)}this._hasSymbolBuckets=!1;for(const[s,i]of this.layerData)i.type===g.al.SYMBOL&&(this._hasSymbolBuckets=!0);e&&this.emit("symbols-changed")}attachWithContext(t){this.stage={context:t,trashDisplayObject(e){e.processDetach()},untrashDisplayObject:()=>!1}}setTransform(t){super.setTransform(t);const e=this.resolution/(t.resolution*t.pixelRatio),s=this.width/this.rangeX*e,i=this.height/this.rangeY*e,o=[0,0];t.toScreen(o,[this.x,this.y]);const a=this.transforms.tileUnitsToPixels;(0,bt.yR)(a),(0,bt.Iu)(a,a,o),(0,bt.U1)(a,a,Math.PI*t.rotation/180),(0,bt.bA)(a,a,[s,i,1])}_createTransforms(){return{displayViewScreenMat3:(0,mt.Ue)(),tileMat3:(0,mt.Ue)(),tileUnitsToPixels:(0,mt.Ue)()}}static _destroyRenderBuckets(t){if(!t)return;const e=new Set;for(const s of t.values())e.has(s)||(s.destroy(),e.add(s));t.clear()}_createRenderBuckets(t){const e=new Map,s=new Map;for(const i of t){const o=this._deserializeBucket(i,s);for(const a of o.layerUIDs)e.set(a,o)}return e}_deserializeBucket(t,e){let s=e.get(t);if(s)return s;switch(new Uint32Array(t)[0]){case g.al.FILL:s=new ae(t,this.styleRepository);break;case g.al.LINE:s=new oe(t,this.styleRepository);break;case g.al.SYMBOL:s=new le(t,this.styleRepository,this);break;case g.al.CIRCLE:s=new he(t,this.styleRepository)}return e.set(t,s),s}_deleteLayerData(t){if(!this.layerData.has(t))return;const e=this.layerData.get(t);this._memoryUsedByLayerData-=e.memoryUsed,e.destroy(),this.layerData.delete(t)}}const Vt=new Map;var Ft=p(30220),ce=p(45974),ot=p(59078);function ue(h,t,e,s,i,o){const{iconRotationAlignment:a,textRotationAlignment:l,iconTranslate:u,iconTranslateAnchor:_,textTranslate:m,textTranslateAnchor:R}=s;let M=0;for(const S of h.colliders){const[F,W]=0===S.partIndex?u:m,K=0===S.partIndex?_:R,Z=S.minLod<=o&&o<=S.maxLod;M+=Z?0:1,S.enabled=Z,S.xScreen=S.xTile*i[0]+S.yTile*i[3]+i[6],S.yScreen=S.xTile*i[1]+S.yTile*i[4]+i[7],K===ot.fD.MAP?(S.xScreen+=e*F-t*W,S.yScreen+=t*F+e*W):(S.xScreen+=F,S.yScreen+=W),ot.aF.VIEWPORT===(0===S.partIndex?a:l)?(S.dxScreen=S.dxPixels,S.dyScreen=S.dyPixels):(S.dxScreen=e*(S.dxPixels+S.width/2)-t*(S.dyPixels+S.height/2)-S.width/2,S.dyScreen=t*(S.dxPixels+S.width/2)+e*(S.dyPixels+S.height/2)-S.height/2)}h.colliders.length>0&&M===h.colliders.length&&(h.unique.show=!1)}class de{constructor(t,e,s,i,o,a){this._symbols=t,this._styleRepository=i,this._zoom=o,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new zt(e,s,vt.cn),this._si=Math.sin(Math.PI*a/180),this._co=Math.cos(Math.PI*a/180);for(const l of t)for(const u of l.symbols)this._allNeededMatrices.has(u.tile)||this._allNeededMatrices.set(u.tile,(0,mt.d9)(u.tile.transforms.tileUnitsToPixels))}work(t){const e=this._gridIndex;function s(o){const a=o.xScreen+o.dxScreen,l=o.yScreen+o.dyScreen,u=a+o.width,_=l+o.height,[m,R,M,S]=e.getCellSpan(a,l,u,_);for(let F=R;F<=S;F++)for(let W=m;W<=M;W++){const K=e.cells[F][W];for(const Z of K){const et=Z.xScreen+Z.dxScreen,rt=Z.yScreen+Z.dyScreen;if(!(u<et||a>et+Z.width||_<rt||l>rt+Z.height))return!0}}return!1}const i=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const o=this._symbols[this._currentLayerCursor],a=this._getProperties(o.styleLayerUID);for(;this._currentSymbolCursor<o.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-i>t)return!1;const l=o.symbols[this._currentSymbolCursor];if(!l.unique.show)continue;ue(l,this._si,this._co,a,this._allNeededMatrices.get(l.tile),this._zoom);const u=l.unique;if(!u.show)continue;const{iconAllowOverlap:_,iconIgnorePlacement:m,textAllowOverlap:R,textIgnorePlacement:M}=a;for(const S of l.colliders){if(!S.enabled)continue;const F=u.parts[S.partIndex];F.show&&!(S.partIndex?R:_)&&s(S)&&(S.hard?u.show=!1:F.show=!1)}if(u.show)for(const S of l.colliders){if(!S.enabled||(S.partIndex?M:m)||!u.parts[S.partIndex].show)continue;const F=S.xScreen+S.dxScreen,W=S.yScreen+S.dyScreen,K=F+S.width,Z=W+S.height,[et,rt,ht,yt]=this._gridIndex.getCellSpan(F,W,K,Z);for(let at=rt;at<=yt;at++)for(let ct=et;ct<=ht;ct++)this._gridIndex.cells[at][ct].push(S)}}}return!0}_getProperties(t){const e=this._styleProps.get(t);if(e)return e;const s=this._zoom,i=this._styleRepository.getStyleLayerByUID(t),o=i.getLayoutValue("symbol-placement",s)!==ot.R.POINT;let a=i.getLayoutValue("icon-rotation-alignment",s);a===ot.aF.AUTO&&(a=o?ot.aF.MAP:ot.aF.VIEWPORT);let l=i.getLayoutValue("text-rotation-alignment",s);l===ot.aF.AUTO&&(l=o?ot.aF.MAP:ot.aF.VIEWPORT);const u=i.getPaintValue("icon-translate",s),_=i.getPaintValue("icon-translate-anchor",s),m=i.getPaintValue("text-translate",s),R=i.getPaintValue("text-translate-anchor",s),M={iconAllowOverlap:i.getLayoutValue("icon-allow-overlap",s),iconIgnorePlacement:i.getLayoutValue("icon-ignore-placement",s),textAllowOverlap:i.getLayoutValue("text-allow-overlap",s),textIgnorePlacement:i.getLayoutValue("text-ignore-placement",s),iconRotationAlignment:a,textRotationAlignment:l,iconTranslateAnchor:_,iconTranslate:u,textTranslateAnchor:R,textTranslate:m};return this._styleProps.set(t,M),M}}function _e(h,t){if(h.priority-t.priority)return h.priority-t.priority;const e=h.tile.key,s=t.tile.key;return e.world-s.world?e.world-s.world:e.level-s.level?e.level-s.level:e.row-s.row?e.row-s.row:e.col-s.col?e.col-s.col:h.xTile-t.xTile?h.xTile-t.xTile:h.yTile-t.yTile}class ye{get running(){return this._running}constructor(t,e,s,i,o,a){this._visibleTiles=t,this._symbolRepository=e,this._createCollisionJob=s,this._assignTileSymbolsOpacity=i,this._symbolLayerSorter=o,this._isLayerVisible=a,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}setScreenSize(t,e){this._screenWidth===t&&this._screenHeight===e||this.restart(),this._screenWidth=t,this._screenHeight=e}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(t){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const e=performance.now();if(!this._selectionJob.work(t)||(this._selectionJobCompleted=!0,0===(t=Math.max(0,t-(performance.now()-e)))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const e=performance.now();if(!this._collisionJob.work(t)||(this._collisionJobCompleted=!0,0===(t=Math.max(0,t-(performance.now()-e)))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const e=performance.now();if(!this._opacityJob.work(t)||(this._opacityJobCompleted=!0,0===(t=Math.max(0,t-(performance.now()-e)))))return!1}return this._running=!1,!0}_createSelectionJob(){const t=this._symbolRepository.uniqueSymbols;for(let u=0;u<t.length;u++){const _=t[u];for(let m=0;m<_.uniqueSymbols.length;m++){const R=_.uniqueSymbols[m];for(const M of R.tileSymbols)M.selectedForRendering=!1}}const e=[];let s=0,i=0;const o=this._isLayerVisible,l=this._symbolLayerSorter;return{work:function a(u){let _;const m=performance.now();for(;i<t.length;i++,s=0){const R=t[i],M=R.styleLayerUID;if(!o(M)){e[i]||(e[i]={styleLayerUID:M,symbols:[]});continue}e[i]=e[i]||{styleLayerUID:M,symbols:[]};const S=e[i];for(;s<R.uniqueSymbols.length;s++){if(_=R.uniqueSymbols[s],s%100==99&&performance.now()-m>u)return!1;let F=null,W=!1,K=!1;for(const Z of _.tileSymbols)if(!K||!W){const et=Z.tile;(!F||et.isCoverage||et.neededForCoverage&&!W)&&(F=Z,(et.neededForCoverage||et.isCoverage)&&(K=!0),et.isCoverage&&(W=!0))}if(F.selectedForRendering=!0,K){S.symbols.push(F),_.show=!0;for(const Z of _.parts)Z.show=!0}else _.show=!1}}for(const R of e)R.symbols.sort(_e);return!0},get sortedSymbols(){return e.sort(l)}}}_createOpacityJob(){const t=this._assignTileSymbolsOpacity,e=this._visibleTiles;let s=0;function i(o,a){const l=o.symbols;for(const[u,_]of l)fe(_,a);t(o,a);for(const u of o.childrenTiles)i(u,a)}return{work(o){const a=performance.now();for(;s<e.length;s++){if(performance.now()-a>o)return!1;const l=e[s];null==l.parentTile&&i(l,performance.now())}return!0}}}}function fe(h,t){for(const e of h){const s=e.unique;for(const i of s.parts)i.startOpacity+=(t-i.startTime)/vt.v7*(i.targetOpacity>.5?1:-1),i.startOpacity=Math.min(Math.max(i.startOpacity,0),1),i.startTime=t,i.targetOpacity=s.show&&i.show?1:0}}class ve{constructor(t,e,s){this.tileCoordRange=t,this._visibleTiles=e,this._createUnique=s,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){return null==this._uniqueSymbolLayerArray&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}get uniqueSymbolsReferences(){return this._uniqueSymbolsReferences}add(t,e){this._uniqueSymbolLayerArray=null;let s=this._tiles.get(t.id);s||(s={symbols:new Map},this._tiles.set(t.id,s));const i=new Map;if(e)for(const l of e)s.symbols.has(l)&&(i.set(l,s.symbols.get(l)),s.symbols.delete(l));else for(const[l,u]of t.layerData)s.symbols.has(l)&&(i.set(l,s.symbols.get(l)),s.symbols.delete(l));this._removeSymbols(i);const o=t.symbols,a=new Map;for(const[l,u]of o){let _=u.length;if(_>=32){let m=this.tileCoordRange;do{m/=2,_/=4}while(_>8&&m>64);const R=new zt(this.tileCoordRange,this.tileCoordRange,m);a.set(l,{flat:u,index:R}),s.symbols.set(l,{flat:u,index:R});for(const M of u)R.getCell(M.xTile,M.yTile).push(M)}else a.set(l,{flat:u}),s.symbols.set(l,{flat:u})}this._addSymbols(t.key,o)}deleteStyleLayers(t){this._uniqueSymbolLayerArray=null;for(const[e,s]of this._tiles){const i=new Map;for(const o of t)s.symbols.has(o)&&(i.set(o,s.symbols.get(o)),s.symbols.delete(o));this._removeSymbols(i),0===s.symbols.size&&this._tiles.delete(e)}}removeTile(t){this._uniqueSymbolLayerArray=null;const e=this._tiles.get(t.id);if(!e)return;const s=new Map;for(const[i,o]of t.symbols)e.symbols.has(i)&&(s.set(i,e.symbols.get(i)),e.symbols.delete(i));this._removeSymbols(s),0===e.symbols.size&&this._tiles.delete(t.id)}querySymbols(t,e,s,i){const o=[],a=this.uniqueSymbols;for(const l of a){const u=l.styleLayerUID,_=l.uniqueSymbols;for(const m of _){const R=m.tileSymbols.find(M=>M.selectedForRendering);R&&ne(R,t,e*(window.devicePixelRatio||1),s)&&o.push({vtlSymbol:R,styleLayerUID:u,tileKey:R.tile.key})}}return o}_removeSymbols(t){for(const[e,{flat:s}]of t)for(const i of s){const o=i.unique,a=o.tileSymbols,l=a.length-1;for(let u=0;u<l;u++)if(a[u]===i){a[u]=a[l];break}if(a.length=l,0===l){const u=this._uniqueSymbolsReferences.get(e);u.delete(o),0===u.size&&this._uniqueSymbolsReferences.delete(e)}i.unique=null}}_addSymbols(t,e){if(0===e.size)return;const s=this._visibleTiles;for(const i of s)i.parentTile||i.key.world!==t.world||i.key.level===t.level&&!i.key.equals(t)||this._matchSymbols(i,t,e);for(const[i,o]of e)for(const a of o)if(null==a.unique){const l=this._createUnique();a.unique=l,l.tileSymbols.push(a);let u=this._uniqueSymbolsReferences.get(i);u||(u=new Set,this._uniqueSymbolsReferences.set(i,u)),u.add(l)}}_matchSymbols(t,e,s){if(t.key.level>e.level){const o=t.key.level-e.level;if(t.key.row>>o!==e.row||t.key.col>>o!==e.col)return}if(e.level>t.key.level){const o=e.level-t.key.level;if(e.row>>o!==t.key.row||e.col>>o!==t.key.col)return}if(e.equals(t.key)){for(const o of t.childrenTiles)this._matchSymbols(o,e,s);return}const i=new Map;for(const[o,a]of s){const l=[];for(const R of a){const M=Ut(this.tileCoordRange,R.xTile,e.level,e.col,t.key.level,t.key.col),S=Ut(this.tileCoordRange,R.yTile,e.level,e.row,t.key.level,t.key.row);M>=0&&M<this.tileCoordRange&&S>=0&&S<this.tileCoordRange&&l.push({symbol:R,xTransformed:M,yTransformed:S})}const u=[],_=20+(t.key.level<e.level?1:1<<t.key.level-e.level),m=this._tiles.get(t.id).symbols.get(o);if(m){const R=m.flat;for(const M of l){let S,F=!1;const W=M.xTransformed,K=M.yTransformed;S=null!=m.index?m.index.getCell(W,K):R;const Z=M.symbol,et=Z.hash;for(const rt of S)if(et===rt.hash&&Math.abs(W-rt.xTile)<=_&&Math.abs(K-rt.yTile)<=_){const ht=rt.unique;Z.unique=ht,ht.tileSymbols.push(Z),F=!0;break}F||u.push(Z)}}u.length>0&&i.set(o,u)}for(const o of t.childrenTiles)this._matchSymbols(o,e,i)}_createUniqueSymbolLayerArray(){const t=this._uniqueSymbolsReferences,e=new Array(t.size);let s,i=0;for(const[o,a]of t){const l=new Array(a.size);s=0;for(const u of a)l[s++]=u;e[i]={styleLayerUID:o,uniqueSymbols:l},i++}return e}}class Se{constructor(t,e){this.styleRepository=t,this._tileToHandle=new Map,this._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]},this._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]},this._offsetFromScreenCenter=[0,0],this._completed=!1,this._fading=(0,ce.t)(!1),this._symbolRepository=new ve(4096,e,()=>new ee),this._symbolDeclutterer=new ye(e,this._symbolRepository,(s,i,o)=>this._createCollisionJob(s,i,o),(s,i)=>{s.allSymbolsFadingOut=!0,s.lastOpacityUpdate=i,function ie(h,t,e){for(const[s,i]of h.symbols)re(h,t,e,i,s)}(s,i,!0),s.decluttered=!0,s.requestRender()},(s,i)=>this.styleRepository.getStyleLayerByUID(s.styleLayerUID).z-this.styleRepository.getStyleLayerByUID(i.styleLayerUID).z,s=>{const i=this.styleRepository.getStyleLayerByUID(s);if(this._zoom+1e-6<i.minzoom||this._zoom-1e-6>=i.maxzoom)return!1;const o=i.getLayoutProperty("visibility");return!o||o.getValue()!==ot.EE.NONE})}get symbolRepository(){return this._symbolRepository}_createCollisionJob(t,e,s){return this.updateDecluttererViewState(),new de(t,e,s,this.styleRepository,this._zoom,this._viewState.rotation)}get fading(){return this._fading.value}get decluttererOffset(){return this._offsetFromScreenCenter}addTile(t){t.decluttered=!1,this._tileToHandle.set(t,t.on("symbols-changed",()=>{this._symbolRepository.add(t),this.restartDeclutter()})),this._symbolRepository.add(t),this.restartDeclutter()}removeTile(t){const e=this._tileToHandle.get(t);e&&(this._symbolRepository.removeTile(t),this.restartDeclutter(),e.remove(),this._tileToHandle.delete(t))}update(t,e){this._zoom=t,this._viewState={scale:e.scale,rotation:e.rotation,center:[e.center[0],e.center[1]],size:[e.size[0],e.size[1]]};const s=[0,0];e.toScreen(s,e.center);const i=[0,0];return e.toScreen(i,this._declutterViewState.center),this._offsetFromScreenCenter[0]=s[0]-i[0],this._offsetFromScreenCenter[1]=s[1]-i[1],this._continueDeclutter(),this._completed}restartDeclutter(){this._completed=!1,this._symbolDeclutterer.restart(),this._notifyUnstable()}clear(){this._completed=!1,this._symbolRepository=null,this._symbolDeclutterer.restart(),this._tileToHandle.forEach(t=>t.remove()),this._tileToHandle.clear()}get stale(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}deleteStyleLayers(t){this._symbolRepository.deleteStyleLayers(t)}_continueDeclutter(){this._completed&&!this.stale||(this._symbolDeclutterer.running||(this.updateDecluttererViewState(),this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),this._completed=this._symbolDeclutterer.continue(vt.JM),this._completed&&this._scheduleNotifyStable())}_scheduleNotifyStable(){null!=this._stableNotificationHandle&&clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=setTimeout(()=>{this._stableNotificationHandle=null,this._fading.value=!1},1.5*vt.v7)}_notifyUnstable(){null!=this._stableNotificationHandle&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null),this._fading.value=!0}updateDecluttererViewState(){this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._offsetFromScreenCenter[0]=0,this._offsetFromScreenCenter[1]=0}}var wt=p(43101);class we extends Bt.I{_createTransforms(){return{displayViewScreenMat3:(0,mt.Ue)(),tileMat3:(0,mt.Ue)()}}}var Me=p(75747);const Mt=1e-6;function Ht(h,t){if(h){const e=h.getLayoutProperty("visibility");if(!e||e.getValue()!==ot.EE.NONE&&(void 0===h.minzoom||h.minzoom<t+Mt)&&(void 0===h.maxzoom||h.maxzoom>=t-Mt))return!0}return!1}class Ie extends Me.Z{constructor(t){super(t),this._backgroundTiles=[],this._computeDisplayInfoView(t)}destroy(){this.removeAllChildren(),this._spriteMosaic?.dispose(),this._spriteMosaic=null,this._glyphMosaic?.dispose(),this._glyphMosaic=null,null!=this._symbolFader&&(this._symbolFader.clear(),this._symbolFader=null),this._styleRepository=null,this._backgroundTiles=[]}get fading(){return this._symbolFader?.fading??!1}get symbolFader(){return this._symbolFader}get symbolRepository(){return this._symbolFader?.symbolRepository}setStyleResources(t,e,s,i){this._spriteMosaic=t,this._glyphMosaic=e,this._styleRepository=s,this._tileInfoView=i,this._computeDisplayInfoView(i),null==this._symbolFader&&(this._symbolFader=new Se(this._styleRepository,this.children)),this._symbolFader.styleRepository=s}setSpriteMosaic(t){this._spriteMosaic?.dispose(),this._spriteMosaic=t}deleteStyleLayers(t){null!=this._symbolFader&&this._symbolFader.deleteStyleLayers(t)}createRenderParams(t){return{...super.createRenderParams(t),renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos}}doRender(t){!this.visible||t.drawPhase!==wt.jx.MAP&&t.drawPhase!==wt.jx.DEBUG||void 0===this._spriteMosaic||super.doRender(t)}addChild(t){return super.addChild(t),null!=this._symbolFader?this._symbolFader.addTile(t):t.decluttered=!0,this.requestRender(),t}removeChild(t){return null!=this._symbolFader&&this._symbolFader.removeTile(t),this.requestRender(),super.removeChild(t)}renderChildren(t){const{drawPhase:e}=t;e!==wt.jx.DEBUG?this._doRender(t):super.renderChildren(t)}removeAllChildren(){for(let t=0;t<this.children.length;t++){const e=this.children[t];null!=this._symbolFader&&this._symbolFader.removeTile(e),e.dispose()}super.removeAllChildren()}getStencilTarget(){return this.children.filter(t=>t.neededForCoverage&&t.hasData())}restartDeclutter(){null!=this._symbolFader&&this._symbolFader.restartDeclutter()}_doRender(t){const{context:e,state:s}=t,i=this._styleRepository;if(!i)return;const o=i.layers,a=this._displayInfo.scaleToZoom(s.scale);i.backgroundBucketIds.length>0&&(t.renderPass="background",this._renderBackgroundLayers(t,i.backgroundBucketIds,a)),super.renderChildren(t),t.drawPhase===wt.jx.MAP&&this._fade(a,s);const l=this.children.filter(u=>u.visible&&u.hasData());if(!l||0===l.length)return e.bindVAO(),e.setStencilTestEnabled(!0),void e.setBlendingEnabled(!0);for(const u of l)u.triangleCount=0;e.setStencilWriteMask(0),e.setColorMask(!0,!0,!0,!0),e.setStencilOp(P.xS.KEEP,P.xS.KEEP,P.xS.REPLACE),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setDepthTestEnabled(!0),e.setDepthWriteEnabled(!0),e.setDepthFunction(P.wb.LEQUAL),e.setClearDepth(1),e.clear(e.gl.DEPTH_BUFFER_BIT),t.renderPass="opaque";for(let u=o.length-1;u>=0;u--)this._renderStyleLayer(o[u],t,l);e.setDepthWriteEnabled(!1),e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(P.zi.ONE,P.zi.ONE_MINUS_SRC_ALPHA,P.zi.ONE,P.zi.ONE_MINUS_SRC_ALPHA),t.renderPass="translucent";for(let u=0;u<o.length;u++)this._renderStyleLayer(o[u],t,l);e.bindVAO(),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!0);for(const u of l)u.debugInfo.display.triangleCount=u.triangleCount}_fade(t,e){null!=this._symbolFader&&(this._symbolFader.update(t,e)||this.requestRender())}_renderStyleLayer(t,e,s){const{displayLevel:i,painter:o,renderPass:a}=e;if(void 0===t)return;const l=t.getLayoutProperty("visibility");if(l&&l.getValue()===ot.EE.NONE)return;let u;switch(t.type){case ot.fR.BACKGROUND:return;case ot.fR.FILL:if("opaque"!==a&&"translucent"!==e.renderPass)return;u="vtlFill";break;case ot.fR.LINE:if("translucent"!==a)return;u="vtlLine";break;case ot.fR.CIRCLE:if("translucent"!==a)return;u="vtlCircle";break;case ot.fR.SYMBOL:if("translucent"!==a)return;u="vtlSymbol"}if(s=s.filter(t.type===ot.fR.SYMBOL?m=>m.decluttered:m=>m.neededForCoverage),"vtlSymbol"!==u&&(0===s.length||void 0!==t.minzoom&&t.minzoom>=i+Mt||void 0!==t.maxzoom&&t.maxzoom<i-Mt))return;const _=t.uid;e.styleLayerUID=_,e.styleLayer=t;for(const m of s)if(m.layerData.has(_)){o.renderObjects(e,s,u);break}}_renderBackgroundLayers(t,e,s){const{context:i,painter:o,state:a}=t,l=this._styleRepository;let u=!1;for(const rt of e)if(l.getLayerById(rt).type===ot.fR.BACKGROUND&&Ht(l.getLayerById(rt),s)){u=!0;break}if(!u)return;const _=this._tileInfoView,m=_.getTileCoverage(t.state,0,!0,"smallest"),{spans:R,lodInfo:M}=m,{level:S}=M,F=(0,n.Ue)(),W=[];if(this._renderPasses){const rt=this._renderPasses[0];null!=this._clippingInfos&&(rt.brushes[0].prepareState(t),rt.brushes[0].drawMany(t,this._clippingInfos))}const K=this._backgroundTiles;let Z,et=0;for(const{row:rt,colFrom:ht,colTo:yt}of R)for(let at=ht;at<=yt;at++){if(et<K.length)Z=K[et],Z.key.set(S,rt,M.normalizeCol(at),M.getWorldForColumn(at)),_.getTileBounds(F,Z.key,!1),Z.x=F[0],Z.y=F[3],Z.resolution=_.getTileResolution(S);else{const ct=new w.Z(S,rt,M.normalizeCol(at),M.getWorldForColumn(at)),pt=_.getTileBounds((0,n.Ue)(),ct),Tt=_.getTileResolution(S);Z=new we(ct,Tt,pt[0],pt[3],512,512,4096,4096),K.push(Z)}Z.setTransform(a),W.push(Z),et++}i.setStencilWriteMask(0),i.setColorMask(!0,!0,!0,!0),i.setStencilOp(P.xS.KEEP,P.xS.KEEP,P.xS.REPLACE),i.setStencilFunction(P.wb.EQUAL,0,255),i.setStencilTestEnabled(!0);for(const rt of e){const ht=l.getLayerById(rt);ht.type===ot.fR.BACKGROUND&&Ht(ht,s)&&(t.styleLayerUID=ht.uid,t.styleLayer=ht,o.renderObjects(t,W,"vtlBackground"))}G.Z.pool.release(m)}_computeDisplayInfoView(t){let e=t.tileInfo.lods[0].scale;const s=Math.max(25,t.tileInfo.lods.length),i=[];for(let o=0;o<=s;o++)i.push(e),e/=2;this._displayInfo=Ft.Z.create({scales:i,size:512,spatialReference:t.spatialReference,numLODs:s})}}var Wt=p(35458),Te=p(8611),Re=p(26540),jt=p(71088),Zt=p(14481),Pe=p(1884);const Le=(h,t)=>{const e=h.vtlSymbol.sourceTile,s=t.vtlSymbol.sourceTile;return e.level!==s.level?e.level-s.level:e.row!==s.row?e.row-s.row:e.col!==s.col?e.col-s.col:h.styleLayerUID-t.styleLayerUID};class Ct{constructor(t,e,s,i,o){this.tileKey=t,this._index=null,this._styleRepository=null,this._tileHandler=null,this._tileKeyToPBF=new Map,this._tileLayerData=e,this._styleRepository=s,this._tileHandler=i,this._parentLayer=o}static create(t,e,s,i,o){return new Ct(t,e,s,i,o)}clear(){this._index?.clear(),this._tileKeyToPBF.clear()}queryAttributes(t,e,s,i,o){var a=this;return(0,C.Z)(function*(){if(0===a._tileLayerData.size||!a._styleRepository||!a._tileHandler)return[];null===a._index&&(a._index=new Re.Q(100,Ae),yield a._indexLayers());const l=[];return a._queryIndex(l,t,e,s,a.tileKey.level,i),o&&o?.length>0&&(yield a._getSymbolsAttributes(l,o)),l})()}_indexLayers(){var t=this;return(0,C.Z)(function*(){const e=t.tileKey,s=t._styleRepository.layers,i=yield t._getTilePayload(e);for(const[o,a]of t._tileLayerData){const l=s[o],u=i.find(R=>R.sourceName===l.source);if(!u)continue;const{protobuff:_,key:m}=u;if(a.type!==g.al.SYMBOL){const R=1<<e.level-m.level;t._indexLayer(l,_,e.level,R,e.row-m.row*R,e.col-m.col*R)}}})()}_indexLayer(t,e,s,i,o,a){const l=t.sourceLayer,u=t.getFeatureFilter(),_=s,m=s+1,R=(0,Ot.KU)(_),M=new L.Z(new Uint8Array(e),new DataView(e));for(;M.next();)switch(M.tag()){case 3:{const S=M.getMessage(),F=new Zt.Z(S);if(S.release(),F.name!==l)continue;const W=F.getData(),K=F.extent/i,Z=K*a-R,et=K*o-R,rt=Z+K+2*R,ht=et+K+2*R,yt=K/512,at=4096/K,ct=K*a,pt=K*o;for(;W.nextTag(2);){const Tt=W.getMessage(),Rt=new jt.Z(Tt,F);if(Tt.release(),u&&!u.filter(Rt,s))continue;const Qt=Rt.values||{},Jt=Qt._minzoom,$t=Qt._maxzoom;if(Jt&&Jt>=10*m||$t&&$t<=10*_)continue;const ft=t.getFeatureInflatedBounds(Rt,_,F.extent,yt);null==ft||ft[0]>rt||ft[1]>ht||ft[2]<Z||ft[3]<et||(ft[0]=(ft[0]-ct)*at,ft[1]=(ft[1]-pt)*at,ft[2]=(ft[2]-ct)*at,ft[3]=(ft[3]-pt)*at,this._index.insert(new Pe.$L(t,Rt,ft,at,ct,pt)))}break}default:M.skip()}}_getSymbolsAttributes(t,e){var s=this;return(0,C.Z)(function*(){if(!e||0===e.length)return t;const i=[];e.sort(Le);let o=e[0].styleLayerUID,a=0;for(let m=0;m<e.length;m++)o!==e[m].styleLayerUID&&(i.push({from:a,to:m,styleLayerUID:o,sourceTileKey:e[m].vtlSymbol.sourceTile}),a=m,o=e[m].styleLayerUID);i.push({from:a,to:e.length,styleLayerUID:o,sourceTileKey:e[e.length-1].vtlSymbol.sourceTile});const l=s._styleRepository.layers;let u,_=null;for(const m of i){const R=yield s._getTilePayload(m.sourceTileKey);u=l[m.styleLayerUID],_=!!u&&R.find(M=>M.sourceName===u.source),_&&s._addSymbolsAttributes(t,e.slice(m.from,m.to).map(M=>M.vtlSymbol),o,_)}return t})()}_addSymbolsAttributes(t,e,s,i){const o=this._styleRepository.layers,a=i.key,l=this.tileKey,u=1<<l.level-a.level;this._getSymbolAttributes(i.protobuff,e,s,u,l.row-a.row*u,l.col-a.col*u).forEach(R=>{const{attributes:M,tilePoint:S}=R;t.push({layerId:o[s].id,layerIndex:s,graphic:new Wt.Z({attributes:M,origin:{type:"vector-tile",layerId:o[s].id,layerIndex:s,layer:this._parentLayer}}),tilePoint:S})})}_getSymbolAttributes(t,e,s,i,o,a){const l=[],u=this._styleRepository.layers;let _=0;e.sort((R,M)=>R.featureIndex-M.featureIndex);const m=new L.Z(new Uint8Array(t),new DataView(t));for(;m.next();)switch(m.tag()){case 3:{const R=m.getMessage(),M=new Zt.Z(R);if(R.release(),M.name!==u[s].sourceLayer)continue;const S=M.getData(),F=M.extent/i,W=4096/F,K=F*a,Z=F*o;let et=0;for(;S.nextTag(2);){const rt=S.getMessage();if(et++===e[_].featureIndex){const ht=new jt.Z(rt,M),yt=ht.values,at=ht.getGeometry();l.push({attributes:yt,tilePoint:null!=at?[W*(at[0][0].x-K),W*(at[0][0].y-Z)]:null}),_++}if(rt.release(),_===e.length)return l}break}default:m.skip()}return l}_queryIndex(t,e,s,i,o,a){const l=8*i*(window.devicePixelRatio||1);return this._index?.search({minX:e-l,minY:s-l,maxX:e+l,maxY:s+l},u=>{const{layer:_,feature:m}=u;_.isIntersectingFeature(e,s,i,m,o,a,u)&&t.push({layerId:_.id,layerIndex:_.uid,tilePoint:null,graphic:new Wt.Z({attributes:m.values,origin:{type:"vector-tile",layerId:u.layer.id,layerIndex:u.layer.uid,layer:this._parentLayer}})})}),t}_getTilePayload(t){var e=this;return(0,C.Z)(function*(){return(0,Te.s1)(e._tileKeyToPBF,t.id,()=>e._tileHandler.fetchTilePBFs(t)).then(s=>s)})()}}const Ae=h=>({minX:h.bounds[0],minY:h.bounds[1],maxX:h.bounds[2],maxY:h.bounds[3]});var Nt=p(14433),Ee=p(83124);class Yt extends qt.Z{constructor(){super(...arguments),this._fullCacheLodInfos=null,this._levelByScale={}}getTileParentId(t){const e=w.Z.pool.acquire(t),s=0===e.level?null:w.Z.getId(e.level-1,e.row>>1,e.col>>1,e.world);return w.Z.pool.release(e),s}getTileCoverage(t,e,s=!0,i){const o=super.getTileCoverage(t,e,s,i);if(!o)return o;const a=1<<o.lodInfo.level;return o.spans=o.spans.filter(l=>l.row>=0&&l.row<a),o}scaleToLevel(t){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[t])return this._levelByScale[t];{const e=this._fullCacheLodInfos;if(t>e[0].scale)return e[0].level;let s,i;for(let o=0;o<e.length-1;o++)if(i=e[o+1],t>i.scale)return s=e[o],s.level+(s.scale-t)/(s.scale-i.scale);return e[e.length-1].level}}_initializeFullCacheLODs(t){let e;e=0===t[0].level?t.map(s=>({level:s.level,resolution:s.resolution,scale:s.scale})):Ft.Z.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(o=>({level:o.level,resolution:o.resolution,scale:o.scale}));for(let s=0;s<e.length;s++)this._levelByScale[e[s].scale]=e[s].level;this._fullCacheLodInfos=e}}var Oe=p(50145);let It=class extends((0,Ee.y)(Oe.Z)){constructor(){super(...arguments),this._styleChanges=[],this._fetchQueue=null,this._parseQueue=null,this._tileHandlerPromise=null,this._isTileHandlerReady=!1}get fading(){return this._vectorTileContainer?.fading??!1}hitTest(h,t){var e=this;return(0,C.Z)(function*(){const s=e._tileHandlerPromise,i=e._vectorTileContainer?.symbolFader;if(!s||!e._isTileHandlerReady||!i)return;yield s;let o=null;const a=e._vectorTileContainer?.symbolRepository;a&&(o=a.querySymbols(t,2,i.decluttererOffset,{}));const u=e._tileManager.getIntersectingTiles(t.x,t.y,2,e.view.state,o);if((!u||0===u.length)&&0===o?.length)return null;h=h.clone().normalize();const _=[],m=[];for(const R of u)_.push(e._queryTile(m,h,2,e.view.state.rotation,R,o?.filter(M=>M.tileKey.id===R.id)));return yield Promise.all(_),m})()}update(h){if(this._tileHandlerPromise&&this._isTileHandlerReady)return h.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),void(this._tileHandler.devicePixelRatio=h.pixelRatio)):void(this._styleChanges.length>0?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=h.state,this._parseQueue.state=h.state,this._tileManager.update(h)||this.requestUpdate(),this._parseQueue.resume(),this._fetchQueue.resume()))}attach(){const{style:h}=this.layer.currentStyleInfo;this._styleRepository=new Nt.Z(h),this._tileInfoView=new Yt(this.layer.tileInfo,this.layer.fullExtent),this._vectorTileContainer=new Ie(this._tileInfoView),this._tileHandler=new E(this.layer,this._styleRepository,window.devicePixelRatio||1,this.layer.tileInfo.lods.length-1),this.container.addChild(this._vectorTileContainer),this._start(),this.addAttachHandles([this.layer.on("paint-change",t=>{if(t.isDataDriven)this._styleChanges.push({type:g.Fr.PAINTER_CHANGED,data:t}),this.requestUpdate();else{const e=this._styleRepository,s=e.getLayerById(t.layer);if(!s)return;const i=s.type===ot.fR.SYMBOL;e.setPaintProperties(t.layer,t.paint),i&&this._vectorTileContainer?.restartDeclutter(),this._vectorTileContainer?.requestRender()}}),this.layer.on("layout-change",t=>{const e=this._styleRepository,s=e.getLayerById(t.layer);if(!s)return;const i=(0,c.Hg)(s.layout,t.layout);if(null!=i){if((0,c.uD)(i,"visibility")&&1===function Ue(h){if(null==h)return 0;switch(h.type){case"partial":return Object.keys(h.diff).length;case"complete":return Math.max(Object.keys(h.oldValue).length,Object.keys(h.newValue).length);case"collection":return Object.keys(h.added).length+Object.keys(h.changed).length+Object.keys(h.removed).length}}(i))return e.setLayoutProperties(t.layer,t.layout),s.type===ot.fR.SYMBOL&&this._vectorTileContainer?.restartDeclutter(),void this._vectorTileContainer?.requestRender();this._styleChanges.push({type:g.Fr.LAYOUT_CHANGED,data:t}),this.requestUpdate()}}),this.layer.on("style-layer-visibility-change",t=>{const e=this._styleRepository,s=e.getLayerById(t.layer);s&&(e.setStyleLayerVisibility(t.layer,t.visibility),s.type===ot.fR.SYMBOL&&this._vectorTileContainer?.restartDeclutter(),this._vectorTileContainer?.requestRender())}),this.layer.on("style-layer-change",t=>{this._styleChanges.push({type:g.Fr.LAYER_CHANGED,data:t}),this.requestUpdate()}),this.layer.on("delete-style-layer",t=>{this._styleChanges.push({type:g.Fr.LAYER_REMOVED,data:t}),this.requestUpdate()}),this.layer.on("load-style",()=>this._loadStyle()),this.layer.on("spriteSource-change",t=>{this._styleChanges.push({type:g.Fr.SPRITES_CHANGED,data:t});const e=this._styleRepository.layers;for(const s of e)switch(s.type){case ot.fR.SYMBOL:s.getLayoutProperty("icon-image")&&this._styleChanges.push({type:g.Fr.LAYOUT_CHANGED,data:{layer:s.id,layout:s.layout}});break;case ot.fR.LINE:s.getPaintProperty("line-pattern")&&this._styleChanges.push({type:g.Fr.PAINTER_CHANGED,data:{layer:s.id,paint:s.paint,isDataDriven:s.isPainterDataDriven()}});break;case ot.fR.FILL:s.getLayoutProperty("fill-pattern")&&this._styleChanges.push({type:g.Fr.PAINTER_CHANGED,data:{layer:s.id,paint:s.paint,isDataDriven:s.isPainterDataDriven()}})}this.requestUpdate()})])}detach(){this._stop(),this.container.removeAllChildren(),this._vectorTileContainer=(0,H.SC)(this._vectorTileContainer),this._tileHandler=(0,H.SC)(this._tileHandler)}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(h){return(0,y.fS)(this.layer.tileInfo?.spatialReference,h)}canResume(){let h=super.canResume();const{currentStyleInfo:t}=this.layer;if(h&&t?.layerDefinition){const e=this.view.scale,{minScale:s,maxScale:i}=t.layerDefinition;t?.layerDefinition&&(s&&s<e&&(h=!1),i&&i>e&&(h=!1))}return h}isUpdating(){return this.fading}acquireTile(h){const t=this._createVectorTile(h);return this._updatingHandles.addPromise(this._fetchQueue.push(t.key).then(e=>this._parseQueue.push({key:t.key,data:e})).then(e=>{t.once("attach",()=>this.requestUpdate()),t.setData(e),this.requestUpdate()}).catch(e=>{(0,N.D_)(e)||V.Z.getLogger(this).error(e)})),t}releaseTile(h){const t=h.key.id;this._fetchQueue.abort(t),this._parseQueue.abort(t),this.requestUpdate()}_start(){if(this._stop(),this._tileManager=new dt({acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView},this._vectorTileContainer),!this.layer.currentStyleInfo)return;const h=new AbortController,t=this._tileHandler.start({signal:h.signal}).then(()=>{this._fetchQueue=new Et.Z({tileInfoView:this._tileInfoView,process:(e,s)=>this._getTileData(e,s),concurrency:15}),this._parseQueue=new Et.Z({tileInfoView:this._tileInfoView,process:(e,s)=>this._parseTileData(e,s),concurrency:8}),this.requestUpdate(),this._isTileHandlerReady=!0});this._tileHandler.spriteMosaic.then(e=>{this._vectorTileContainer.setStyleResources(e,this._tileHandler.glyphMosaic,this._styleRepository,this._tileInfoView),this.requestUpdate()}),this._tileHandlerAbortController=h,this._tileHandlerPromise=t}_stop(){if(!this._tileHandlerAbortController||!this._vectorTileContainer)return;const h=this._tileHandlerAbortController;h&&h.abort(),this._tileHandlerPromise=null,this._isTileHandlerReady=!1,this._fetchQueue=(0,H.SC)(this._fetchQueue),this._parseQueue=(0,H.SC)(this._parseQueue),this._tileManager=(0,H.SC)(this._tileManager),this._vectorTileContainer.removeAllChildren()}_getTileData(h,t){var e=this;return(0,C.Z)(function*(){return e._tileHandler.fetchTileData(h,t)})()}_parseTileData(h,t){var e=this;return(0,C.Z)(function*(){return e._tileHandler.parseTileData(h,t)})()}_applyStyleChanges(){var h=this;return(0,C.Z)(function*(){h._isTileHandlerReady=!1,h._fetchQueue.pause(),h._parseQueue.pause(),h._fetchQueue.clear(),h._parseQueue.clear(),h._tileManager.clearCache();const t=h._styleChanges;try{yield h._tileHandler.updateStyle(t)}catch(a){V.Z.getLogger(h).error("error applying vector-tiles style update",a.message),h._fetchQueue.resume(),h._parseQueue.resume(),h._isTileHandlerReady=!0}const e=h._styleRepository,s=new Set;t.forEach(a=>{if(a.type!==g.Fr.LAYER_REMOVED)return;const u=e.getLayerById(a.data.layer);u&&s.add(u.uid)});const i=new Set;t.forEach(a=>{let l;switch(a.type){case g.Fr.PAINTER_CHANGED:e.setPaintProperties(a.data.layer,a.data.paint),l=a.data.layer;break;case g.Fr.LAYOUT_CHANGED:e.setLayoutProperties(a.data.layer,a.data.layout),l=a.data.layer;break;case g.Fr.LAYER_REMOVED:return void e.deleteStyleLayer(a.data.layer);case g.Fr.LAYER_CHANGED:e.setStyleLayer(a.data.layer,a.data.index),l=a.data.layer.id;break;case g.Fr.SPRITES_CHANGED:h._vectorTileContainer.setSpriteMosaic(h._tileHandler.setSpriteSource(a.data.spriteSource))}if(l){const u=e.getLayerById(l);u&&i.add(u.uid)}});const o=h._vectorTileContainer.children;if(s.size>0){const a=Array.from(s);h._vectorTileContainer.deleteStyleLayers(a);for(const l of o)l.deleteLayerData(a)}if(h._fetchQueue.resume(),h._parseQueue.resume(),i.size>0){const a=Array.from(i),l=[];for(const u of o){const _=h._updatingHandles.addPromise(h._fetchQueue.push(u.key).then(m=>h._parseQueue.push({key:u.key,data:m,styleLayerUIDs:a})).then(m=>u.setData(m)));l.push(_)}yield Promise.all(l)}h._styleChanges=[],h._isTileHandlerReady=!0,h.requestUpdate()})()}_loadStyle(){var h=this;return(0,C.Z)(function*(){const{style:t}=h.layer.currentStyleInfo,e=(0,k.d9)(t);h._isTileHandlerReady=!1,h._fetchQueue.pause(),h._parseQueue.pause(),h._fetchQueue.clear(),h._parseQueue.clear(),h._styleRepository=new Nt.Z(e),h._vectorTileContainer.destroy(),h._tileManager.clear(),h._tileHandlerAbortController.abort(),h._tileHandlerAbortController=new AbortController;const{signal:s}=h._tileHandlerAbortController;try{h._tileHandlerPromise=h._tileHandler.setStyle(h._styleRepository,e,h.layer.tileInfo.lods.length-1),yield h._tileHandlerPromise}catch(a){if(!(0,N.D_)(a))throw a}if(s.aborted)return h._fetchQueue.resume(),h._parseQueue.resume(),h._isTileHandlerReady=!0,void h.requestUpdate();const i=yield h._tileHandler.spriteMosaic,o=h._vectorTileContainer;h._tileInfoView=new Yt(h.layer.tileInfo,h.layer.fullExtent),o.setStyleResources(i,h._tileHandler.glyphMosaic,h._styleRepository,h._tileInfoView),h._tileManager=new dt({acquireTile:a=>h.acquireTile(a),releaseTile:a=>h.releaseTile(a),tileInfoView:h._tileInfoView},h._vectorTileContainer),h._fetchQueue.resume(),h._parseQueue.resume(),h._isTileHandlerReady=!0,h.requestUpdate()})()}_createVectorTile(h){const t=this._tileInfoView.getTileBounds((0,n.Ue)(),h),e=this._tileInfoView.getTileResolution(h.level);return new Dt(h,e,t[0],t[3],512,512,this._styleRepository)}_queryTile(h,t,e,s,i,o){var a=this;return(0,C.Z)(function*(){if(0===i.layerData.size)return;const l=a._ensureTileIndex(i),u=a._tileInfoView.getTileBounds((0,n.Ue)(),i.key,!0),_=(t.x-u[0])/(u[2]-u[0])*4096,m=4096*(1-(t.y-u[1])/(u[3]-u[1])),R=yield l.queryAttributes(_,m,e,s,o);for(const M of R)M.graphic.geometry=a._tileToMapPoint(M.tilePoint,i.transforms.tileUnitsToPixels),h.push({type:"graphic",layer:a.layer,graphic:M.graphic,mapPoint:t.clone()});h.sort((M,S)=>S.graphic.origin.layerIndex-M.graphic.origin.layerIndex)})()}_tileToMapPoint(h,t){if(!h)return null;const i=this.view.state,o=[0,0];return i.toMap(o,[h[0]*t[0]+h[1]*t[3]+t[6],h[0]*t[1]+h[1]*t[4]+t[7]]),new r.Z({x:o[0],y:o[1],spatialReference:i.spatialReference})}_ensureTileIndex(h){let t=h.featureIndex;return t||(t=Ct.create(h.key,h.layerData,this._styleRepository,this._tileHandler,this.layer),h.featureIndex=t),t}};(0,Y._)([(0,tt.Cb)()],It.prototype,"_isTileHandlerReady",void 0),It=(0,Y._)([(0,d.j)("esri.views.2d.layers.VectorTileLayerView2D")],It);const ze=It},50145:(ut,st,p)=>{p.d(st,{Z:()=>v});var C=p(50484),Y=p(73514),k=p(88278),V=p(84373),H=p(4703),N=p(51172),tt=p(47868),z=p(80543),r=(p(14007),p(65311),p(10141)),n=p(90110),y=p(64579);let g=class extends((0,V.IG)((0,tt.v)(k.Z.EventedMixin(Y.Z)))){constructor(T){super(T),this._updatingHandles=new n.R,this.layer=null,this.parent=null}initialize(){this.when().catch(T=>{if("layerview:create-error"!==T.name){const x=this.layer&&this.layer.id||"no id",I=this.layer?.title||"no title";H.Z.getLogger(this).error("#resolve()",`Failed to resolve layer view (layer title: '${I}', id: '${x}')`,T)}})}destroy(){this._updatingHandles=(0,N.SC)(this._updatingHandles)}get fullOpacity(){return(this.layer?.opacity??1)*(this.parent?.fullOpacity??1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this._updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){return!0===this.layer?.visible}set visible(T){this._overrideIfSome("visible",T)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){const T=this.view.timeExtent,x=this.layer?.visibilityTimeExtent;return!T||!x||!T.intersection(x).isEmpty}canResume(){const T=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&this.layer?.loaded&&!this.parent?.suspended&&this.view?.ready&&(0,y.Cy)(T)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){const T=this.parent?.suspended?this.parent.suspendInfo:{};return this.view?.ready||(T.viewNotReady=!0),this.layer&&this.layer.loaded||(T.layerNotLoaded=!0),(0,y.Cy)(this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null)&&this.visibleAtCurrentScale||(T.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(T.outsideVisibilityTimeExtent=!0),this.visible||(T.layerInvisible=!0),T}isUpdating(){return!1}};(0,C._)([(0,z.Cb)()],g.prototype,"view",void 0),(0,C._)([(0,z.Cb)()],g.prototype,"fullOpacity",null),(0,C._)([(0,z.Cb)()],g.prototype,"layer",void 0),(0,C._)([(0,z.Cb)()],g.prototype,"parent",void 0),(0,C._)([(0,z.Cb)({readOnly:!0})],g.prototype,"suspended",null),(0,C._)([(0,z.Cb)({readOnly:!0})],g.prototype,"suspendInfo",null),(0,C._)([(0,z.Cb)({readOnly:!0})],g.prototype,"legendEnabled",null),(0,C._)([(0,z.Cb)({type:Boolean,readOnly:!0})],g.prototype,"updating",null),(0,C._)([(0,z.Cb)({readOnly:!0})],g.prototype,"updatingProgress",null),(0,C._)([(0,z.Cb)()],g.prototype,"updateSuspended",null),(0,C._)([(0,z.Cb)()],g.prototype,"visible",null),(0,C._)([(0,z.Cb)({readOnly:!0})],g.prototype,"visibleAtCurrentScale",null),(0,C._)([(0,z.Cb)({readOnly:!0})],g.prototype,"visibleAtCurrentTimeExtent",null),g=(0,C._)([(0,r.j)("esri.views.layers.LayerView")],g);const v=g},38954:(ut,st,p)=>{p.d(st,{Z:()=>d});var C=p(50484),Y=p(89317),k=p(80543),tt=(p(14007),p(4703),p(65311),p(10141));let z=class extends Y.wq{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}};(0,C._)([(0,k.Cb)({readOnly:!0})],z.prototype,"version",null),z=(0,C._)([(0,tt.j)("esri.views.layers.support.ClipArea")],z);const d=z},87265:(ut,st,p)=>{p.d(st,{Z:()=>T});var y,C=p(50484),k=(p(2189),p(80543)),tt=(p(14007),p(4703),p(65311),p(10141)),z=p(32184),d=p(40637),c=p(38954),r=p(26894),n=p(5391);const g={base:z.Z,key:"type",typeMap:{extent:r.Z,polygon:n.Z}};let v=y=class extends c.Z{constructor(x){super(x),this.type="geometry",this.geometry=null}clone(){return new y({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};(0,C._)([(0,k.Cb)({types:g,json:{read:d.im,write:!0}})],v.prototype,"geometry",void 0),v=y=(0,C._)([(0,tt.j)("esri.views.layers.support.Geometry")],v);const T=v},64579:(ut,st,p)=>{function C(d){return d&&"function"==typeof d.highlight}function V(d,c){if(c&&d){const{minScale:r,maxScale:n}=d;if(function H(d,c){return null!=d&&d>0||null!=c&&c>0}(r,n))return function k(d,c,r){return null==d||d>=r&&(0===c||d<=c)}(c,r,n)}return!0}function N(d){return!d?.minScale||!d.maxScale||d.minScale>=d.maxScale}p.d(st,{Cy:()=>N,GB:()=>V,tl:()=>C})}}]);