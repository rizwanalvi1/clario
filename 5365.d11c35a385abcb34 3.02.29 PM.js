"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[5365,4523],{38519:(yt,V,a)=>{function h(){return[1,0,0,0,1,0,0,0,1]}function C(g,I,w,G,J,R,x,q,W){return[g,I,w,G,J,R,x,q,W]}a.d(V,{Ue:()=>h,Wd:()=>U,al:()=>C});const U=[1,0,0,0,1,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:U,clone:function $(g){return[g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],g[8]]},create:h,createView:function v(g,I){return new Float64Array(g,I,9)},fromValues:C},Symbol.toStringTag,{value:"Module"}))},41666:(yt,V,a)=>{function h(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function $(g){return[g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],g[8],g[9],g[10],g[11],g[12],g[13],g[14],g[15]]}a.d(V,{Ue:()=>h,Wd:()=>U,d9:()=>$});const U=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:U,clone:$,create:h,createView:function v(g,I){return new Float64Array(g,I,16)},fromValues:function C(g,I,w,G,J,R,x,q,W,F,H,K,nt,at,A,O){return[g,I,w,G,J,R,x,q,W,F,H,K,nt,at,A,O]}},Symbol.toStringTag,{value:"Module"}))},686:(yt,V,a)=>{function h(){return[0,0,0,1]}function $(g){return[g[0],g[1],g[2],g[3]]}a.d(V,{Ue:()=>h,Wd:()=>U,d9:()=>$});const U=[0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:U,clone:$,create:h,createView:function v(g,I){return new Float64Array(g,I,4)},fromValues:function C(g,I,w,G){return[g,I,w,G]}},Symbol.toStringTag,{value:"Module"}))},36510:(yt,V,a)=>{a.d(V,{Bh:()=>w,I6:()=>vt,Jp:()=>G,Kx:()=>K,Su:()=>at,t8:()=>Z,yY:()=>I});var h=a(38519),$=a(686),C=a(73145),v=a(89612),U=a(43548),B=a(5710);function I(t,o,u){u*=.5;const d=Math.sin(u);return t[0]=d*o[0],t[1]=d*o[1],t[2]=d*o[2],t[3]=Math.cos(u),t}function w(t,o){const u=2*Math.acos(o[3]),d=Math.sin(u/2);return d>(0,v.bn)()?(t[0]=o[0]/d,t[1]=o[1]/d,t[2]=o[2]/d):(t[0]=1,t[1]=0,t[2]=0),u}function G(t,o,u){const d=o[0],_=o[1],y=o[2],E=o[3],b=u[0],L=u[1],T=u[2],rt=u[3];return t[0]=d*rt+E*b+_*T-y*L,t[1]=_*rt+E*L+y*b-d*T,t[2]=y*rt+E*T+d*L-_*b,t[3]=E*rt-d*b-_*L-y*T,t}function W(t,o,u,d){const _=o[0],y=o[1],E=o[2],b=o[3];let L,T,rt,Rt,n,r=u[0],e=u[1],l=u[2],c=u[3];return T=_*r+y*e+E*l+b*c,T<0&&(T=-T,r=-r,e=-e,l=-l,c=-c),1-T>(0,v.bn)()?(L=Math.acos(T),rt=Math.sin(L),Rt=Math.sin((1-d)*L)/rt,n=Math.sin(d*L)/rt):(Rt=1-d,n=d),t[0]=Rt*_+n*r,t[1]=Rt*y+n*e,t[2]=Rt*E+n*l,t[3]=Rt*b+n*c,t}function K(t,o){return t[0]=-o[0],t[1]=-o[1],t[2]=-o[2],t[3]=o[3],t}function nt(t,o){const u=o[0]+o[4]+o[8];let d;if(u>0)d=Math.sqrt(u+1),t[3]=.5*d,d=.5/d,t[0]=(o[5]-o[7])*d,t[1]=(o[6]-o[2])*d,t[2]=(o[1]-o[3])*d;else{let _=0;o[4]>o[0]&&(_=1),o[8]>o[3*_+_]&&(_=2);const y=(_+1)%3,E=(_+2)%3;d=Math.sqrt(o[3*_+_]-o[3*y+y]-o[3*E+E]+1),t[_]=.5*d,d=.5/d,t[3]=(o[3*y+E]-o[3*E+y])*d,t[y]=(o[3*y+_]+o[3*_+y])*d,t[E]=(o[3*E+_]+o[3*_+E])*d}return t}function at(t,o,u,d){const _=.5*Math.PI/180;o*=_,u*=_,d*=_;const y=Math.sin(o),E=Math.cos(o),b=Math.sin(u),L=Math.cos(u),T=Math.sin(d),rt=Math.cos(d);return t[0]=y*L*rt-E*b*T,t[1]=E*b*rt+y*L*T,t[2]=E*L*T-y*b*rt,t[3]=E*L*rt+y*b*T,t}const O=B.c,Z=B.s,Y=B.f,pt=G,et=B.b,ft=B.g,ot=B.l,D=B.i,z=D,Q=B.j,ut=Q,ht=B.n,vt=B.a,Ot=B.e,dt=(0,C.Ue)(),Ft=(0,C.al)(1,0,0),ct=(0,C.al)(0,1,0),It=(0,$.Ue)(),bt=(0,$.Ue)(),i=(0,h.Ue)();Object.freeze(Object.defineProperty({__proto__:null,add:Y,calculateW:function q(t,o){const u=o[0],d=o[1],_=o[2];return t[0]=u,t[1]=d,t[2]=_,t[3]=Math.sqrt(Math.abs(1-u*u-d*d-_*_)),t},conjugate:K,copy:O,dot:ft,equals:Ot,exactEquals:vt,fromEuler:at,fromMat3:nt,getAxisAngle:w,identity:function g(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},invert:function H(t,o){const u=o[0],d=o[1],_=o[2],y=o[3],E=u*u+d*d+_*_+y*y,b=E?1/E:0;return t[0]=-u*b,t[1]=-d*b,t[2]=-_*b,t[3]=y*b,t},len:z,length:D,lerp:ot,mul:pt,multiply:G,normalize:ht,random:function F(t){const o=v.FD,u=o(),d=o(),_=o(),y=Math.sqrt(1-u),E=Math.sqrt(u);return t[0]=y*Math.sin(2*Math.PI*d),t[1]=y*Math.cos(2*Math.PI*d),t[2]=E*Math.sin(2*Math.PI*_),t[3]=E*Math.cos(2*Math.PI*_),t},rotateX:function J(t,o,u){u*=.5;const d=o[0],_=o[1],y=o[2],E=o[3],b=Math.sin(u),L=Math.cos(u);return t[0]=d*L+E*b,t[1]=_*L+y*b,t[2]=y*L-_*b,t[3]=E*L-d*b,t},rotateY:function R(t,o,u){u*=.5;const d=o[0],_=o[1],y=o[2],E=o[3],b=Math.sin(u),L=Math.cos(u);return t[0]=d*L-y*b,t[1]=_*L+E*b,t[2]=y*L+d*b,t[3]=E*L-_*b,t},rotateZ:function x(t,o,u){u*=.5;const d=o[0],_=o[1],y=o[2],E=o[3],b=Math.sin(u),L=Math.cos(u);return t[0]=d*L+_*b,t[1]=_*L-d*b,t[2]=y*L+E*b,t[3]=E*L-y*b,t},rotationTo:function Mt(t,o,u){const d=(0,U.m)(o,u);return d<-.999999?((0,U.b)(dt,Ft,o),(0,U.H)(dt)<1e-6&&(0,U.b)(dt,ct,o),(0,U.n)(dt,dt),I(t,dt,Math.PI),t):d>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):((0,U.b)(dt,o,u),t[0]=dt[0],t[1]=dt[1],t[2]=dt[2],t[3]=1+d,ht(t,t))},scale:et,set:Z,setAxes:function Ut(t,o,u,d){const _=i;return _[0]=u[0],_[3]=u[1],_[6]=u[2],_[1]=d[0],_[4]=d[1],_[7]=d[2],_[2]=-o[0],_[5]=-o[1],_[8]=-o[2],ht(t,nt(t,_))},setAxisAngle:I,slerp:W,sqlerp:function At(t,o,u,d,_,y){return W(It,o,_,y),W(bt,u,d,y),W(t,It,bt,2*y*(1-y)),t},sqrLen:ut,squaredLength:Q,str:function A(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}},Symbol.toStringTag,{value:"Module"}))},16996:(yt,V,a)=>{a.d(V,{Z:()=>J});var h=a(50484),$=a(25387),C=a(89317),v=a(80543),I=(a(14007),a(4703),a(65311),a(21070)),w=a(10141);let G=class extends((0,$.J)(C.wq)){constructor(R){super(R),this.type="georeferenced",this.origin=null}};(0,h._)([(0,I.J)({georeferenced:"georeferenced"},{readOnly:!0})],G.prototype,"type",void 0),(0,h._)([(0,v.Cb)({type:[Number],nonNullable:!1,json:{write:!0}})],G.prototype,"origin",void 0),G=(0,h._)([(0,w.j)("esri.geometry.support.MeshGeoreferencedVertexSpace")],G);const J=G},81255:(yt,V,a)=>{a.d(V,{Z:()=>R});var h=a(50484),$=a(25387),C=a(89317),v=a(80543),I=(a(14007),a(4703),a(65311),a(21070)),w=a(10141),G=a(73145);let J=class extends((0,$.J)(C.wq)){constructor(x){super(x),this.type="local",this.origin=(0,G.Ue)()}};(0,h._)([(0,I.J)({local:"local"},{readOnly:!0})],J.prototype,"type",void 0),(0,h._)([(0,v.Cb)({type:[Number],nonNullable:!0,json:{write:!0}})],J.prototype,"origin",void 0),J=(0,h._)([(0,w.j)("esri.geometry.support.MeshLocalVertexSpace")],J);const R=J},74291:(yt,V,a)=>{a.d(V,{Z:()=>H});var q,h=a(50484),$=a(89317),C=a(80543),g=(a(14007),a(4703),a(65311),a(10141)),I=a(39061),w=a(41666),G=a(36510),J=a(686),R=a(73145),x=a(52217);let W=q=class extends $.wq{constructor(K){super(K),this.translation=(0,R.Ue)(),this.rotationAxis=(0,R.nI)(x.up),this.rotationAngle=0,this.scale=(0,R.al)(1,1,1)}get rotation(){return(0,x.uT)(this.rotationAxis,this.rotationAngle)}set rotation(K){this.rotationAxis=(0,R.d9)((0,x.ZZ)(K)),this.rotationAngle=(0,x.EU)(K)}get localMatrix(){const K=(0,w.Ue)();return(0,G.yY)(F,(0,x.ZZ)(this.rotation),(0,x.WH)(this.rotation)),(0,I.Iw)(K,F,this.translation,this.scale),K}get localMatrixInverse(){return(0,I.U_)((0,w.Ue)(),this.localMatrix)}equals(K){return this===K||null!=K&&(0,I.I6)(this.localMatrix,K.localMatrix)}clone(){const K={translation:(0,R.d9)(this.translation),rotationAxis:(0,R.d9)(this.rotationAxis),rotationAngle:this.rotationAngle,scale:(0,R.d9)(this.scale)};return new q(K)}};(0,h._)([(0,C.Cb)({type:[Number],nonNullable:!0,json:{write:!0}})],W.prototype,"translation",void 0),(0,h._)([(0,C.Cb)({type:[Number],nonNullable:!0,json:{write:!0}})],W.prototype,"rotationAxis",void 0),(0,h._)([(0,C.Cb)({type:Number,nonNullable:!0,json:{write:!0}})],W.prototype,"rotationAngle",void 0),(0,h._)([(0,C.Cb)({type:[Number],nonNullable:!0,json:{write:!0}})],W.prototype,"scale",void 0),(0,h._)([(0,C.Cb)()],W.prototype,"rotation",null),(0,h._)([(0,C.Cb)()],W.prototype,"localMatrix",null),(0,h._)([(0,C.Cb)()],W.prototype,"localMatrixInverse",null),W=q=(0,h._)([(0,g.j)("esri.geometry.support.MeshTransform")],W);const F=(0,J.Ue)(),H=W},52217:(yt,V,a)=>{a.d(V,{EU:()=>nt,Ue:()=>I,WH:()=>at,ZZ:()=>K,q_:()=>W,qw:()=>H,uT:()=>x,up:()=>O});var h=a(55117),$=a(39061),C=a(36510),v=a(686),U=a(43548),B=a(73145);function I(D=O){return[D[0],D[1],D[2],D[3]]}function x(D,z,Q=I()){return(0,U.c)(Q,D),Q[3]=z,Q}function W(D,z=I()){const Q=(0,$.j6)(Z,D);return A(z,(0,h.BV)((0,C.Bh)(z,Q))),z}function F(D,z,Q=I()){return(0,C.yY)(Z,D,at(D)),(0,C.yY)(Y,z,at(z)),(0,C.Jp)(Z,Y,Z),A(Q,(0,h.BV)((0,C.Bh)(Q,Z)))}function H(D,z,Q,ut=I()){return x(B.E9,D,et),x(B.IO,z,ft),x(B.eG,Q,ot),F(et,ft,et),F(et,ot,ut),ut}function K(D){return D}function nt(D){return D[3]}function at(D){return(0,h.Vl)(D[3])}function A(D,z){return D[3]=z,D}a(23515);const O=[0,0,1,0],Z=(0,v.Ue)(),Y=(0,v.Ue)(),et=(I(),I()),ft=I(),ot=I()},47689:(yt,V,a)=>{a.d(V,{CP:()=>B,JG:()=>q,LL:()=>g,NZ:()=>I,fV:()=>W,vj:()=>K,yT:()=>at,zE:()=>nt});var h=a(15861),$=a(66476),C=a(57678),v=a(79412),U=a(11642);class B{constructor(O,Z,Y){this.assetName=O,this.assetMimeType=Z,this.parts=Y}equals(O){return this===O||this.assetName===O.assetName&&this.assetMimeType===O.assetMimeType&&(0,C.fS)(this.parts,O.parts,(Z,Y)=>Z.equals(Y))}isOnService(O){return this.parts.every(Z=>Z.isOnService(O))}makeHash(){let O="";for(const Z of this.parts)O+=Z.partHash;return O}toBlob(O){var Z=this;return(0,h.Z)(function*(){const{parts:Y}=Z;if(1===Y.length)return Y[0].toBlob(O);const pt=yield Promise.all(Y.map(et=>et.toBlob(O)));return(0,v.k_)(O),new Blob(pt)})()}}class g{constructor(O,Z){this.partUrl=O,this.partHash=Z}equals(O){return this===O||this.partUrl===O.partUrl&&this.partHash===O.partHash}isOnService(O){return this.partUrl.startsWith(`${O.path}/assets/`)}toBlob(O){var Z=this;return(0,h.Z)(function*(){const{data:Y}=yield(0,$.Z)(Z.partUrl,{responseType:"blob"});return(0,v.k_)(O),Y})()}}function I(A){return function R(A){return!!A&&(Array.isArray(A)?A.some(x):x(A))}(A?.source)}function w(A){return!!Array.isArray(A)&&A.every(O=>O instanceof B)}const G=/^(model\/gltf\+json)|(model\/gltf-binary)$/,J=/\.(gltf|glb)/i;function x(A){if(A instanceof File){const{type:O,name:Z}=A;return G.test(O)||J.test(Z)}return G.test(A.assetMimeType)||J.test(A.assetName)}function q(A,O){if(!A)return!1;const{source:Z}=A;return function F(A,O){return Array.isArray(A)?A.length>0&&A.every(Y=>H(Y,O)):H(A,O)}(Z,O)}function W(A,O){if(A===O)return!0;const{source:Z}=A,{source:Y}=O;if(Z===Y)return!0;if(w(Z)&&w(Y)){if(Z.length!==Y.length)return!1;const pt=(ot,D)=>ot.assetName<D.assetName?-1:ot.assetName>D.assetName?1:0,et=[...Z].sort(pt),ft=[...Y].sort(pt);for(let ot=0;ot<et.length;++ot)if(!et[ot].equals(ft[ot]))return!1;return!0}return!1}function H(A,O){return A instanceof B&&A.isOnService(O)}function K(A,O){return A instanceof File?(0,U.dm)(A,O):(0,U.S0)(A.assetMimeType,O)??(0,U.Ow)(A.assetName,O)}function nt(A){return Array.isArray(A)?A:[A]}function at(A){return!!A.original}},52592:(yt,V,a)=>{a.d(V,{G7:()=>R,QK:()=>G,rU:()=>J,vI:()=>W,zZ:()=>w});var h=a(93300),$=a(4703),C=a(43548),v=a(44107),U=a(16996),B=a(81255);function g(){return $.Z.getLogger("esri.geometry.Mesh")}function w(F){return null!=F.origin}function G(F){return w(F.vertexSpace)}function J(F,H){if(!w(F))return null;const[K,nt,at]=F.origin;return new v.Z({x:K,y:nt,z:at,spatialReference:H})}function R(F,H){const{x:K,y:nt,z:at,spatialReference:A}=F,O=[K,nt,at??0];return void 0!==H?.geographic&&((0,h.x9)(g(),"option: geographic",{replacement:"Use the `vertexSpace` option instead.",version:"4.29",warnOnce:!0}),H.vertexSpace&&g().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")),"local"===(H?.vertexSpace??function q(F){return null==F?void 0:F?"local":"georeferenced"}(H?.geographic)??function x(F){return F.isGeographic||F.isWebMercator?"local":"georeferenced"}(A))?new B.Z({origin:O}):new U.Z({origin:O})}function W(F,H){return F.type===H.type&&(F.origin===H.origin||null!=F.origin&&null!=H.origin&&(0,C.e)(F.origin,H.origin))}},85559:(yt,V,a)=>{a.d(V,{g:()=>h});const h={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},52334:(yt,V,a)=>{a.r(V),a.d(V,{applyEdits:()=>A,checkEditingCapabilities:()=>Ft,isFeatureIdentifierArrayWithGlobalId:()=>at,isFeatureIdentifierArrayWithObjectId:()=>K,isFeatureIdentifierWithGlobalId:()=>nt,isFeatureIdentifierWithObjectId:()=>H,normalizeCollections:()=>Mt,normalizeEdits:()=>dt,normalizeGeometries:()=>vt,shallowCloneFeature:()=>ct,uploadAssets:()=>Ut});var h=a(15861),$=a(35458),C=a(83944),v=a(57964),U=a(34222),B=a(4703),g=a(79412),I=a(6785),w=a(19986),G=a(93566),J=a(33721),R=a(92344),x=a(85295),q=a(11642),W=a(85971);function F(i){return null!=i?.applyEdits}function H(i){return"object"==typeof i&&null!=i&&"objectId"in i&&!!i.objectId}function K(i){return i.every(H)}function nt(i){return"object"==typeof i&&null!=i&&"globalId"in i&&!!i.globalId}function at(i){return i.every(nt)}function A(i,p,t){return O.apply(this,arguments)}function O(){return O=(0,h.Z)(function*(i,p,t,o={}){let u;const _=o.gdbVersion??("gdbVersion"in i?i.gdbVersion:null);(0,R.lQ)(i)&&i.url?u=(0,R.jF)(i.url,i.layerId,_,"original-and-current-features"===o.returnServiceEditsOption):(u=(0,g.hh)(),u.promise.then(E=>{(E.addedFeatures.length||E.updatedFeatures.length||E.deletedFeatures.length||E.addedAttachments.length||E.updatedAttachments.length||E.deletedAttachments.length)&&i.emit("edits",E)}),i.emit("apply-edits",{result:u.promise}));try{const{results:y,edits:E}=yield function Z(i,p,t,o){return Y.apply(this,arguments)}(i,p,t,o),b=T=>T.filter(rt=>!rt.error).map(U.d9),L={edits:E,addedFeatures:b(y.addFeatureResults),updatedFeatures:b(y.updateFeatureResults),deletedFeatures:b(y.deleteFeatureResults),addedAttachments:b(y.addAttachmentResults),updatedAttachments:b(y.updateAttachmentResults),deletedAttachments:b(y.deleteAttachmentResults),exceededTransferLimit:!1,historicMoment:y.editMoment?new Date(y.editMoment):null,globalIdToObjectId:o.globalIdToObjectId};return y.editedFeatureResults?.length&&(L.editedFeatures=y.editedFeatureResults),u.resolve(L),y}catch(y){throw u.reject(y),y}}),O.apply(this,arguments)}function Y(){return Y=(0,h.Z)(function*(i,p,t,o){if(yield i.load(),!F(p))throw new v.Z(`${i.type}-layer:no-editing-support`,"Layer source does not support applyEdits capability",{layer:i});if(!(0,W.ln)(i))throw new v.Z(`${i.type}-layer:editing-disabled`,"Editing is disabled for layer",{layer:i});const{edits:u,options:d}=yield function pt(i,p,t){return et.apply(this,arguments)}(i,t,o);return u.addFeatures?.length||u.updateFeatures?.length||u.deleteFeatures?.length||u.addAttachments?.length||u.updateAttachments?.length||u.deleteAttachments?.length?{edits:u,results:yield p.applyEdits(u,d)}:{edits:u,results:{addFeatureResults:[],updateFeatureResults:[],deleteFeatureResults:[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}}),Y.apply(this,arguments)}function et(){return et=(0,h.Z)(function*(i,p,t){const o=(0,W.S1)(i),_=null!=i.infoFor3D;if(Ft(p,o,t,!(!p||!(p.addFeatures||p.updateFeatures||p.deleteFeatures)),!(!p||!(p.addAttachments||p.updateAttachments||p.deleteAttachments)),`${i.type}-layer`),!o.data.isVersioned&&t?.gdbVersion)throw new v.Z(`${i.type}-layer:invalid-parameter`,"'gdbVersion' is applicable only if the layer supports versioned data. See: 'capabilities.data.isVersioned'");if(!o.editing.supportsRollbackOnFailure&&t?.rollbackOnFailureEnabled)throw new v.Z(`${i.type}-layer:invalid-parameter`,"This layer does not support 'rollbackOnFailureEnabled' parameter. See: 'capabilities.editing.supportsRollbackOnFailure'");const y={...t};if(null!=y.rollbackOnFailureEnabled||o.editing.supportsRollbackOnFailure||(y.rollbackOnFailureEnabled=!0),y.rollbackOnFailureEnabled||"original-and-current-features"!==y.returnServiceEditsOption||(!1===y.rollbackOnFailureEnabled&&B.Z.getLogger("esri.layers.graphics.editingSupport").warn(`${i.type}-layer:invalid-parameter`,"'original-and-current-features' is valid for 'returnServiceEditsOption' only when 'rollBackOnFailure' is true, but 'rollBackOnFailure' was set to false. 'rollBackOnFailure' has been overwritten and set to true."),y.rollbackOnFailureEnabled=!0),!o.editing.supportsReturnServiceEditsInSourceSpatialReference&&y.returnServiceEditsInSourceSR)throw new v.Z(`${i.type}-layer:invalid-parameter`,"This layer does not support 'returnServiceEditsInSourceSR' parameter. See: 'capabilities.editing.supportsReturnServiceEditsInSourceSpatialReference'");if(y.returnServiceEditsInSourceSR&&"original-and-current-features"!==y.returnServiceEditsOption)throw new v.Z(`${i.type}-layer:invalid-parameter`,"'returnServiceEditsInSourceSR' is valid only when 'returnServiceEditsOption' is set to 'original-and-current-features'");const E=dt(p,o,`${i.type}-layer`),b=t?.globalIdUsed||_,L=i.fields.filter(T=>"big-integer"===T.type||"oid"===T.type&&(T.length||0)>=8);if(b){const{globalIdField:T}=i;if(null==T)throw new v.Z(`${i.type}-layer:invalid-parameter`,"Layer does not specify a global id field.");E.addFeatures.forEach(rt=>function ht(i,p){const{attributes:t}=i;null==t[p]&&(t[p]=(0,w.zS)())}(rt,T))}return E.addFeatures.forEach(T=>function D(i,p,t,o){ft(i,p,t,o),ot(i,p)}(T,i,b,L)),E.updateFeatures.forEach(T=>function Q(i,p,t,o){ft(i,p,t,o),ot(i,p);const u=(0,W.S1)(p);if("geometry"in i&&null!=i.geometry&&!u?.editing.supportsGeometryUpdate)throw new v.Z(`${p.type}-layer:unsupported-operation`,"Layer does not support geometry updates.")}(T,i,b,L)),E.deleteFeatures.forEach(T=>function z(i,p,t,o){ft(i,p,t,o)}(T,i,b,L)),E.addAttachments.forEach(T=>ut(T,i)),E.updateAttachments.forEach(T=>ut(T,i)),_&&(yield function At(i,p){return It.apply(this,arguments)}(E,i)),{edits:yield vt(E),options:y}}),et.apply(this,arguments)}function ft(i,p,t,o){if(t){if("attributes"in i&&!i.attributes[p.globalIdField])throw new v.Z(`${p.type}-layer:invalid-parameter`,`Feature should have '${p.globalIdField}' when 'globalIdUsed' is true`);if(!("attributes"in i)&&!i.globalId)throw new v.Z(`${p.type}-layer:invalid-parameter`,"`'globalId' of the feature should be passed when 'globalIdUsed' is true")}if(o.length&&"attributes"in i)for(const u of o){const d=i.attributes[u.name];if(void 0!==d&&!(0,x.d2)(u,d))throw new v.Z(`${p.type}-layer:invalid-parameter`,`Big-integer field '${u.name}' of the feature must be less than ${Number.MAX_SAFE_INTEGER}`,{feature:i})}if("geometry"in i&&null!=i.geometry){if(i.geometry.hasZ&&!1===p.capabilities?.data.supportsZ)throw new v.Z(`${p.type}-layer:z-unsupported`,"Layer does not support z values while feature has z values.");if(i.geometry.hasM&&!1===p.capabilities?.data.supportsM)throw new v.Z(`${p.type}-layer:m-unsupported`,"Layer does not support m values while feature has m values.")}}function ot(i,p){if("geometry"in i&&"mesh"===i.geometry?.type&&null!=p.infoFor3D&&null!=p.spatialReference){const{geometry:t}=i,{spatialReference:o,vertexSpace:u}=t,d=p.spatialReference,_="local"===u.type,y=(0,J.sT)(d),E=(0,J.fS)(d,o),b=E||(0,J.oR)(d)&&((0,J.oR)(o)||(0,J.sS)(o));if(!(_&&y&&b||!_&&!y&&E))throw new v.Z(`${p.type}-layer:mesh-unsupported`,`Uploading a mesh with a ${u.type} vertex space and a spatial reference wkid:${o.wkid} to a layer with a spatial reference wkid:${d.wkid} is not supported.`)}}function ut(i,p){const{feature:t,attachment:o}=i;if(!t||"attributes"in t&&!t.attributes[p.globalIdField])throw new v.Z(`${p.type}-layer:invalid-parameter`,"Attachment should have reference to a feature with 'globalId'");if(!("attributes"in t)&&!t.globalId)throw new v.Z(`${p.type}-layer:invalid-parameter`,"Attachment should have reference to 'globalId' of the parent feature");if(!o.globalId)throw new v.Z(`${p.type}-layer:invalid-parameter`,"Attachment should have 'globalId'");if(!o.data&&!o.uploadId)throw new v.Z(`${p.type}-layer:invalid-parameter`,"Attachment should have 'data' or 'uploadId'");if(!(o.data instanceof File&&o.data.name||o.name))throw new v.Z(`${p.type}-layer:invalid-parameter`,"'name' is required when attachment is specified as Base64 encoded string using 'data'");if(!p.capabilities?.editing.supportsUploadWithItemId&&o.uploadId)throw new v.Z(`${p.type}-layer:invalid-parameter`,"This layer does not support 'uploadId' parameter. See: 'capabilities.editing.supportsUploadWithItemId'");if("string"==typeof o.data){const u=(0,I.sJ)(o.data);if(u&&!u.isBase64)throw new v.Z(`${p.type}-layer:invalid-parameter`,"Attachment 'data' should be a Blob, File or Base64 encoded string")}}function vt(i){return Ot.apply(this,arguments)}function Ot(){return(Ot=(0,h.Z)(function*(i){const p=i.addFeatures??[],t=i.updateFeatures??[],o=p.concat(t).map(y=>y.geometry),u=yield(0,G.aX)(o),d=p.length,_=t.length;return u.slice(0,d).forEach((y,E)=>p[E].geometry=y),u.slice(d,d+_).forEach((y,E)=>t[E].geometry=y),i})).apply(this,arguments)}function Mt(i){return{addFeatures:Array.from(i?.addFeatures??[]),updateFeatures:Array.from(i?.updateFeatures??[]),deleteFeatures:i&&C.Z.isCollection(i.deleteFeatures)?i.deleteFeatures.toArray():i.deleteFeatures||[],addAttachments:i.addAttachments||[],updateAttachments:i.updateAttachments||[],deleteAttachments:i.deleteAttachments||[]}}function dt(i,p,t){const o=Mt(i);if(o.addFeatures?.length&&!p.operations.supportsAdd)throw new v.Z(`${t}:unsupported-operation`,"Layer does not support adding features.");if(o.updateFeatures?.length&&!p.operations.supportsUpdate)throw new v.Z(`${t}:unsupported-operation`,"Layer does not support updating features.");if(o.deleteFeatures?.length&&!p.operations.supportsDelete)throw new v.Z(`${t}:unsupported-operation`,"Layer does not support deleting features.");return o.addFeatures=o.addFeatures.map(ct),o.updateFeatures=o.updateFeatures.map(ct),o.addAssetFeatures=[],o}function Ft(i,p,t,o,u,d){if(!i||!o&&!u)throw new v.Z(`${d}:missing-parameters`,"'addFeatures', 'updateFeatures', 'deleteFeatures', 'addAttachments', 'updateAttachments' or 'deleteAttachments' parameter is required");if(!p.editing.supportsGlobalId&&t?.globalIdUsed)throw new v.Z(`${d}:invalid-parameter`,"This layer does not support 'globalIdUsed' parameter. See: 'capabilities.editing.supportsGlobalId'");if(!p.editing.supportsGlobalId&&u)throw new v.Z(`${d}:invalid-parameter`,"'addAttachments', 'updateAttachments' and 'deleteAttachments' are applicable only if the layer supports global ids. See: 'capabilities.editing.supportsGlobalId'");if(!t?.globalIdUsed&&u)throw new v.Z(`${d}:invalid-parameter`,"When 'addAttachments', 'updateAttachments' or 'deleteAttachments' is specified, globalIdUsed should be set to true")}function ct(i){const p=new $.Z;return i.attributes||(i.attributes={}),p.geometry=i.geometry,p.attributes=i.attributes,p}function It(){return(It=(0,h.Z)(function*(i,p){if(null==p.infoFor3D)return;const{infoFor3D:t}=p,o=(0,q.S0)("model/gltf-binary",t.supportedFormats)??(0,q.Ow)("glb",t.supportedFormats);if(!o||!t.editFormats.includes(o))throw new v.Z(`${p.type}-layer:binary-gltf-asset-not-supported`,"3DObjectFeatureLayer requires binary glTF (.glb) support for updating mesh geometry.");i.addAssetFeatures??=[];const{addAssetFeatures:u}=i;for(const d of i.addFeatures??[])bt(d)&&u.push(d);for(const d of i.updateFeatures??[])bt(d)&&u.push(d)})).apply(this,arguments)}function bt(i){return"mesh"===i?.geometry?.type}function Ut(i,p,t,o){if(!F(p))throw new v.Z(`${i.type}-layer:no-editing-support`,"Layer source does not support applyEdits capability",{layer:i});if(!p.uploadAssets)throw new v.Z(`${i.type}-layer:no-asset-upload-support`,"Layer source does not support uploadAssets capability",{layer:i});return p.uploadAssets(t,o)}},95365:(yt,V,a)=>{a.r(V),a.d(V,{default:()=>Rt});var h=a(15861),$=a(50484),C=a(11931),U=(a(2189),a(66476)),B=a(34411),g=a(57678),I=a(57964),w=a(14007),G=a(84303),J=a(67016),R=a(4703),x=a(71763),q=a(79412),W=a(77675),F=a(6785),H=a(19986),K=a(80543),nt=a(10141),at=a(26894),A=a(16996),O=a(52592),Z=a(47689),Y=a(35458),pt=a(49602),et=a(83821),ft=a(40637),ot=a(74291),D=a(33721),z=a(52334);function Q(n,r,e){return ut.apply(this,arguments)}function ut(){return(ut=(0,h.Z)(function*(n,r,e){const{geometry:l}=r,c={...r.attributes};if(null!=e&&"mesh"===l?.type){const{transformFieldRoles:M}=e,{origin:P,spatialReference:S,vertexSpace:X}=l,N=l.transform??new ot.Z,k="local"===X.type,tt=n.spatialReference,mt=tt.isGeographic,Pt=(0,D.fS)(tt,S),Dt=(0,et.isEqualBaseGCS)(S,tt)&&(0,et.canProjectWithoutEngine)(S,tt);if(!(k&&mt&&Dt||!k&&!mt&&Pt))return null;const st=(0,et.projectWithoutEngine)(P,S,tt);if(null==st)return null;if(c[M.originX]=st.x,c[M.originY]=st.y,c[M.originZ]=st.z??0,null!=N){const{translation:it,scale:St,rotation:lt}=N,gt=k?1:(0,pt.r6)(S)/(0,pt.r6)(tt);c[M.translationX]=it[0]*gt,c[M.translationY]=it[2]*gt,c[M.translationZ]=-it[1]*gt,c[M.scaleX]=St[0],c[M.scaleY]=St[2],c[M.scaleZ]=St[1],c[M.rotationX]=lt[0],c[M.rotationY]=lt[2],c[M.rotationZ]=-lt[1],c[M.rotationDeg]=lt[3]}return{attributes:c}}return null==l?{attributes:c}:"mesh"===l.type||"extent"===l.type?null:{geometry:l.toJSON(),attributes:c}})).apply(this,arguments)}function vt(){return(vt=(0,h.Z)(function*(n,r){const e=yield Promise.all((r.addAttachments??[]).map(M=>Ot(n,M))),l=yield Promise.all((r.updateAttachments??[]).map(M=>Ot(n,M))),c=r.deleteAttachments??[];return e.length||l.length||c.length?{adds:e,updates:l,deletes:[...c]}:null})).apply(this,arguments)}function Ot(n,r){return Mt.apply(this,arguments)}function Mt(){return(Mt=(0,h.Z)(function*(n,r){const{feature:e,attachment:l}=r,{globalId:c,name:M,contentType:P,data:S,uploadId:X}=l,N={globalId:c};if(e&&("attributes"in e?N.parentGlobalId=e.attributes?.[n.globalIdField]:e.globalId&&(N.parentGlobalId=e.globalId)),X)N.uploadId=X;else if(S){const k=yield(0,F.IR)(S);k&&(N.contentType=k.mediaType,N.data=k.data),S instanceof File&&(N.name=S.name)}return M&&(N.name=M),P&&(N.contentType=P),N})).apply(this,arguments)}function ct(n){const r=!0===n.success?null:n.error||{code:void 0,description:void 0};return{objectId:n.objectId,globalId:n.globalId,error:r?new I.Z("feature-layer-source:edit-failure",r.description,{code:r.code}):null}}function At(n,r){return new Y.Z({attributes:n.attributes,geometry:(0,ft.im)({...n.geometry,spatialReference:r})})}function It(n,r){return{adds:n?.adds?.map(e=>At(e,r))||[],updates:n?.updates?.map(e=>({original:At(e[0],r),current:At(e[1],r)}))||[],deletes:n?.deletes?.map(e=>At(e,r))||[],spatialReference:r}}var Ut=a(60324),i=a(59211),p=a(89713),t=a(78818),o=a(11642),u=a(46708),d=a(18101),_=a(91866),y=a(93604),E=a(43814);const b=new G.X({originalAndCurrentFeatures:"original-and-current-features",none:"none"}),L=new G.X({Started:"published",Publishing:"publishing",Stopped:"unavailable"});let T=class extends J.Z{constructor(n){var r;super(n),r=this,this.type="feature-layer",this.supportedSourceTypes=new Set(["Feature Layer","Oriented Imagery Layer","Table","Catalog Layer"]),this.refresh=(0,q.Ds)((0,h.Z)(function*(){yield r.load();const e=r.sourceJSON.editingInfo?.lastEditDate;if(null==e)return{dataChanged:!0,updates:{}};try{yield r._fetchService(null)}catch{return{dataChanged:!0,updates:{}}}const l=e!==r.sourceJSON.editingInfo?.lastEditDate;return{dataChanged:l,updates:l?{editingInfo:r.sourceJSON.editingInfo,extent:r.sourceJSON.extent}:null}})),this._ongoingAssetUploads=new Map}load(n){const e=this._fetchService(this.layer.sourceJSON,{...n}).then(()=>this.layer.setUserPrivileges(this.sourceJSON.serviceItemId,n)).then(()=>this._ensureLatestMetadata(n));return this.addResolvingPromise(e),Promise.resolve(this)}initialize(){this.addHandles([(0,W.YP)(()=>{const n=this.layer;return n&&"lastEditsEventDate"in n?n.lastEditsEventDate:null},n=>this._handleLastEditsEventChange(n))])}destroy(){this._removeEditInterceptor()}get queryTask(){const{capabilities:n,parsedUrl:r,gdbVersion:e,spatialReference:l,fieldsIndex:c}=this.layer,M="infoFor3D"in this.layer?this.layer.infoFor3D:null,P="dynamicDataSource"in this.layer?this.layer.dynamicDataSource:null,S=(0,w.Z)("featurelayer-pbf")&&n?.query.supportsFormatPBF&&null==M;return new i.Z({url:r.path,pbfSupported:S,fieldsIndex:c,infoFor3D:M,dynamicDataSource:P,gdbVersion:e,sourceSpatialReference:l,queryAttachmentsSupported:n?.operations?.supportsQueryAttachments??!1})}addAttachment(n,r){var e=this;return(0,h.Z)(function*(){yield e.load();const{layer:l}=e;yield(0,t.nU)(l,"editing");const c=n.attributes[l.objectIdField],M=l.parsedUrl.path+"/"+c+"/addAttachment",P=e._getLayerRequestOptions(),S=e._getFormDataForAttachment(r,P.query);try{return ct((yield(0,U.Z)(M,{body:S})).data.addAttachmentResult)}catch(X){throw e._createAttachmentErrorResult(c,X)}})()}updateAttachment(n,r,e){var l=this;return(0,h.Z)(function*(){yield l.load();const{layer:c}=l;yield(0,t.nU)(c,"editing");const M=n.attributes[c.objectIdField],P=c.parsedUrl.path+"/"+M+"/updateAttachment",S=l._getLayerRequestOptions({query:{attachmentId:r}}),X=l._getFormDataForAttachment(e,S.query);try{return ct((yield(0,U.Z)(P,{body:X})).data.updateAttachmentResult)}catch(N){throw l._createAttachmentErrorResult(M,N)}})()}applyEdits(n,r){var e=this;return(0,h.Z)(function*(){yield e.load();const{layer:l}=e;yield(0,t.nU)(l,"editing");const c="infoFor3D"in l?l.infoFor3D:null,M=null!=c,P=M||(r?.globalIdUsed??!1),S=M?yield e._uploadMeshesAndGetAssetMapEditsJSON(n):null,X=n.addFeatures?.map(Et=>Q(e.layer,Et,c))??[],N=(yield Promise.all(X)).filter(g.pC),k=n.updateFeatures?.map(Et=>Q(e.layer,Et,c))??[],tt=(yield Promise.all(k)).filter(g.pC),mt=function dt(n,r,e){if(!r||0===r.length)return[];if(e&&(0,z.isFeatureIdentifierArrayWithGlobalId)(r))return r.map(c=>c.globalId);if((0,z.isFeatureIdentifierArrayWithObjectId)(r))return r.map(c=>c.objectId);const l=e?n.globalIdField:n.objectIdField;return l?r.map(c=>c.getAttribute(l)):[]}(e.layer,n.deleteFeatures,P);(0,d.P)(N,tt,l.spatialReference);const Pt=yield function ht(n,r){return vt.apply(this,arguments)}(e.layer,n),Dt=l.capabilities.editing.supportsAsyncApplyEdits&&M,st=r?.gdbVersion||l.gdbVersion,it={gdbVersion:st,rollbackOnFailure:r?.rollbackOnFailureEnabled,useGlobalIds:P,returnEditMoment:r?.returnEditMoment,usePreviousEditMoment:r?.usePreviousEditMoment,async:Dt};yield(0,y.Px)(e.layer.url,st,!0);const St=(0,y.JV)(e.layer.url,st||null);if(yield(0,y.r9)(l.url,st,l.historicMoment))throw new I.Z("feature-layer-source:historic-version","Editing a historic version is not allowed");r?.returnServiceEditsOption?(it.edits=JSON.stringify([{id:l.layerId,adds:N.length?N:null,updates:tt.length?tt:null,deletes:mt.length?mt:null,attachments:Pt,assetMaps:S}]),it.returnServiceEditsOption=b.toJSON(r?.returnServiceEditsOption),it.returnServiceEditsInSourceSR=r?.returnServiceEditsInSourceSR):(it.adds=N.length?JSON.stringify(N):null,it.updates=tt.length?JSON.stringify(tt):null,it.deletes=mt.length?P?JSON.stringify(mt):mt.join(","):null,it.attachments=Pt&&JSON.stringify(Pt),it.assetMaps=null!=S?JSON.stringify(S):void 0);const lt=e._getLayerRequestOptions({method:"post",query:it});St&&(lt.authMode="immediate",lt.query.returnEditMoment=!0,lt.query.sessionId=y.U8);const gt=r?.returnServiceEditsOption?l.url:l.parsedUrl.path;let _t;try{_t=Dt?yield e._asyncApplyEdits(gt+"/applyEdits",lt):yield(0,U.Z)(gt+"/applyEdits",lt)}catch(Et){if(!function bt(n){const r=n.details.raw,l=+r.extendedCode;return 500==+r.code&&(-2147217144===l||-2147467261===l)}(Et))throw Et;lt.authMode="immediate",_t=Dt?yield e._asyncApplyEdits(gt+"/applyEdits",lt):yield(0,U.Z)(gt+"/applyEdits",lt)}return e._createEditsResult(_t)})()}deleteAttachments(n,r){var e=this;return(0,h.Z)(function*(){yield e.load();const{layer:l}=e;yield(0,t.nU)(l,"editing");const c=n.attributes[l.objectIdField],M=l.parsedUrl.path+"/"+c+"/deleteAttachments";try{return(yield(0,U.Z)(M,e._getLayerRequestOptions({query:{attachmentIds:r.join(",")},method:"post"}))).data.deleteAttachmentResults.map(ct)}catch(P){throw e._createAttachmentErrorResult(c,P)}})()}fetchRecomputedExtents(n={}){var r=this;return this.load({signal:n.signal}).then((0,h.Z)(function*(){const l=r._getLayerRequestOptions({...n,query:{returnUpdates:!0}}),{layerId:c,url:M}=r.layer,{data:P}=yield(0,U.Z)(`${M}/${c}`,l),{id:S,extent:X,fullExtent:N,timeExtent:k}=P,tt=X||N;return{id:S,fullExtent:tt&&at.Z.fromJSON(tt),timeExtent:k&&B.Z.fromJSON({start:k[0],end:k[1]})}}))}queryAttachments(n,r={}){var e=this;return(0,h.Z)(function*(){yield e.load();const l=e._getLayerRequestOptions(r);return e.queryTask.executeAttachmentQuery(n,l)})()}queryFeatures(n,r){var e=this;return(0,h.Z)(function*(){yield e.load();const l=yield e.queryTask.execute(n,{...r,query:e._createRequestQueryOptions(r)});return n.outStatistics?.length&&l.features.length&&l.features.forEach(c=>{const M=c.attributes;n.outStatistics?.forEach(({outStatisticFieldName:P})=>{if(P){const S=P.toLowerCase();S&&S in M&&P!==S&&(M[P]=M[S],delete M[S])}})}),l})()}queryFeaturesJSON(n,r){var e=this;return(0,h.Z)(function*(){return yield e.load(),e.queryTask.executeJSON(n,{...r,query:e._createRequestQueryOptions(r)})})()}queryObjectIds(n,r){var e=this;return(0,h.Z)(function*(){return yield e.load(),e.queryTask.executeForIds(n,{...r,query:e._createRequestQueryOptions(r)})})()}queryFeatureCount(n,r){var e=this;return(0,h.Z)(function*(){return yield e.load(),e.queryTask.executeForCount(n,{...r,query:e._createRequestQueryOptions(r)})})()}queryExtent(n,r){var e=this;return(0,h.Z)(function*(){return yield e.load(),e.queryTask.executeForExtent(n,{...r,query:e._createRequestQueryOptions(r)})})()}queryRelatedFeatures(n,r){var e=this;return(0,h.Z)(function*(){return yield e.load(),e.queryTask.executeRelationshipQuery(n,{...r,query:e._createRequestQueryOptions(r)})})()}queryRelatedFeaturesCount(n,r){var e=this;return(0,h.Z)(function*(){return yield e.load(),e.queryTask.executeRelationshipQueryForCount(n,{...r,query:e._createRequestQueryOptions(r)})})()}queryTopFeatures(n,r){var e=this;return(0,h.Z)(function*(){return yield e.load(),e.queryTask.executeTopFeaturesQuery(n,{...r,query:e._createRequestQueryOptions(r)})})()}queryTopObjectIds(n,r){var e=this;return(0,h.Z)(function*(){return yield e.load(),e.queryTask.executeForTopIds(n,{...r,query:e._createRequestQueryOptions(r)})})()}queryTopExtents(n,r){var e=this;return(0,h.Z)(function*(){return yield e.load(),e.queryTask.executeForTopExtents(n,{...r,query:e._createRequestQueryOptions(r)})})()}queryTopCount(n,r){var e=this;return(0,h.Z)(function*(){return yield e.load(),e.queryTask.executeForTopCount(n,{...r,query:e._createRequestQueryOptions(r)})})()}fetchPublishingStatus(){var n=this;return(0,h.Z)(function*(){if(!(0,p.M8)(n.layer.url))return"unavailable";const r=(0,F.v_)(n.layer.url,"status"),e=yield(0,U.Z)(r,{query:{f:"json"}});return L.fromJSON(e.data.status)})()}uploadAssets(n,r){var e=this;return(0,h.Z)(function*(){const{uploadAssets:l}=yield Promise.all([a.e(8592),a.e(6139)]).then(a.bind(a,46139));return l(n,{layer:e.layer,ongoingUploads:e._ongoingAssetUploads},r)})()}_handleLastEditsEventChange(n){const r=this.layer;if(null==n||!("capabilities"in r)||!("effectiveCapabilities"in r)||r.capabilities?.operations?.supportsEditing||!r.effectiveCapabilities?.operations?.supportsEditing)return;const e=r.url;null!=e&&("layerId"in r&&(0,F.v_)(e,r.layerId.toString()),this._getOrCreateEditInterceptor(e).before=l=>{const c=l.requestOptions.method??"auto";if("auto"===c||"head"===c){const M=l.requestOptions.query??{};M._ts=n.getTime(),l.requestOptions.query=M}})}_getOrCreateEditInterceptor(n){return null==this._editInterceptor&&(this._editInterceptor={urls:n},C.default.request.internalInterceptors.push(this._editInterceptor)),this._editInterceptor}_removeEditInterceptor(){null!=this._editInterceptor&&((0,g.Od)(C.default.request.internalInterceptors,this._editInterceptor),this._editInterceptor=null)}_asyncApplyEdits(n,r){return(0,h.Z)(function*(){const e=(yield(0,U.Z)(n,r)).data.statusUrl;for(;;){const l=(yield(0,U.Z)(e,{query:{f:"json"},responseType:"json"})).data;switch(l.status){case"Completed":return(0,U.Z)(l.resultUrl,{query:{f:"json"},responseType:"json"});case"CompletedWithErrors":throw new I.Z("async-applyEdits-failed","asynchronous applyEdits call failed.");case"Failed ImportChanges":case"InProgress":case"Pending":case"ExportAttachments":case"ExportChanges":case"ExportingData":case"ExportingSnapshot":case"ImportAttachments":case"ProvisioningReplica":case"UnRegisteringReplica":break;default:throw new I.Z("async-applyEdits-failed","asynchronous applyEdits call failed (undefined response status)")}yield(0,q.e4)(rt)}})()}_createRequestQueryOptions(n){const r={...this.layer.customParameters,token:this.layer.apiKey,...n?.query};return this.layer.datesInUnknownTimezone&&(r.timeReferenceUnknownClient=!0),r}_fetchService(n,r){var e=this;return(0,h.Z)(function*(){if(!n){const c={};(0,w.Z)("featurelayer-advanced-symbols")&&(c.returnAdvancedSymbols=!0),r?.cacheBust&&(c._ts=Date.now());const{data:M}=yield(0,U.Z)(e.layer.parsedUrl.path,e._getLayerRequestOptions({query:c,signal:r?.signal}));n=M}e.sourceJSON=yield e._patchServiceJSON(n,r?.signal);const l=n.type;if(!e.supportedSourceTypes.has(l))throw new I.Z("feature-layer-source:unsupported-type",`Source type "${l}" is not supported`)})()}_patchServiceJSON(n,r){var e=this;return(0,h.Z)(function*(){if("Table"!==n.type&&n.geometryType&&!n?.drawingInfo?.renderer&&!n.defaultSymbol){const l=(0,Ut.bU)(n.geometryType).renderer;(0,x.RB)("drawingInfo.renderer",l,n)}if("esriGeometryMultiPatch"===n.geometryType&&n.infoFor3D&&(n.geometryType="mesh"),null==n.extent)try{const{data:l}=yield(0,U.Z)(e.layer.url,e._getLayerRequestOptions({signal:r}));l.spatialReference&&(n.extent={xmin:0,ymin:0,xmax:0,ymax:0,spatialReference:l.spatialReference})}catch(l){(0,q.r9)(l)}return n})()}_ensureLatestMetadata(n){var r=this;return(0,h.Z)(function*(){if(r.layer.userHasUpdateItemPrivileges&&r.sourceJSON.cacheMaxAge>0)return r._fetchService(null,{...n,cacheBust:!0})})()}_uploadMeshesAndGetAssetMapEditsJSON(n){var r=this;return(0,h.Z)(function*(){const{addAssetFeatures:e}=n;if(!e?.length||(yield r._areAllAssetsAlreadyMapped(e)))return null;const l=n.addFeatures.filter(P=>P.geometry);if(e.length!==l.length+n.updateFeatures.length)throw new I.Z("feature-layer-source:unsupported-mesh-edits","Mixing attribute only edits with mesh geometry edits is not currently supported");const c=new Array,M=new Map;for(const P of e){const{geometry:S}=P,{vertexSpace:X}=S;if((0,O.zZ)(X))c.push(S);else{const N=S.anchor,{convertMeshVertexSpace:k}=yield Promise.all([a.e(1716),a.e(1317),a.e(4550)]).then(a.bind(a,28417)),tt=yield k(S,new A.Z({origin:[N.x,N.y,N.z??0]}));M.set(tt,S),P.geometry=tt,c.push(tt)}}yield r.uploadAssets(c);for(const[P,S]of M)S.addExternalSources(P.metadata.externalSources.items);return{adds:r._getAssetMapEditsJSON(e),updates:[],deletes:[]}})()}_getAssetMapEditsJSON(n){const r=new Array,e=this.layer.globalIdField,l=this.layer.parsedUrl;for(const c of n){const M=c.geometry,{metadata:P}=M,S=P.getExternalSourcesOnService(l),X=c.getAttribute(e);if(0===S.length){R.Z.getLogger(this).error(`Skipping feature ${X}. The mesh it is associated with has not been uploaded to the service and cannot be mapped to it.`);continue}const{source:N}=S.find(Z.yT)??S[0];for(const k of N)1===k.parts.length?r.push({globalId:(0,H.zS)(),parentGlobalId:X,assetName:k.assetName,assetHash:k.parts[0].partHash,flags:[]}):R.Z.getLogger(this).error(`Skipping asset ${k.assetName}. It does not have exactly one part, so we cannot map it to a feature.`)}return r}_createEditsResult(n){const r=n.data,{layerId:e}=this.layer,l=[];let c=null;if(Array.isArray(r))for(const P of r)l.push({id:P.id,editedFeatures:P.editedFeatures}),P.id===e&&(c={addResults:P.addResults??[],updateResults:P.updateResults??[],deleteResults:P.deleteResults??[],attachments:P.attachments,editMoment:P.editMoment});else c=r;const M=function Ft(n){const r=n?.assetMaps;if(r){for(const c of r.addResults)c.success||R.Z.getLogger("esri.layers.graphics.sources.support.sourceUtils").error(`Failed to map asset to feature with globalId ${c.globalId}.`);for(const c of r.updateResults)c.success||R.Z.getLogger("esri.layers.graphics.sources.support.sourceUtils").error(`Failed to map asset to feature with globalId ${c.globalId}.`)}const e=n?.attachments,l={addFeatureResults:n?.addResults?.map(ct)??[],updateFeatureResults:n?.updateResults?.map(ct)??[],deleteFeatureResults:n?.deleteResults?.map(ct)??[],addAttachmentResults:e?.addResults?e.addResults.map(ct):[],updateAttachmentResults:e?.updateResults?e.updateResults.map(ct):[],deleteAttachmentResults:e?.deleteResults?e.deleteResults.map(ct):[]};return n?.editMoment&&(l.editMoment=n.editMoment),l}(c);if(l.length>0){M.editedFeatureResults=[];for(const P of l){const{editedFeatures:S}=P,X=S?.spatialReference?new E.Z(S.spatialReference):null;M.editedFeatureResults.push({layerId:P.id,editedFeatures:It(S,X)})}}return M}_createAttachmentErrorResult(n,r){return{objectId:n,globalId:null,error:new I.Z("feature-layer-source:attachment-failure",r.details.messages?.[0]||r.message,{code:r.details.httpStatus||r.details.messageCode})}}_getFormDataForAttachment(n,r){const e=n instanceof FormData?n:n&&n.elements?new FormData(n):null;if(e)for(const l in r){const c=r[l];null!=c&&(e.set?e.set(l,c):e.append(l,c))}return e}_getLayerRequestOptions(n={}){const{layer:r,layer:{parsedUrl:e,gdbVersion:l}}=this;return{...n,query:{gdbVersion:l,layer:"dynamicDataSource"in r&&r.dynamicDataSource?JSON.stringify({source:r.dynamicDataSource}):void 0,...e.query,f:"json",...this._createRequestQueryOptions(n)},responseType:"json"}}_areAllAssetsAlreadyMapped(n){var r=this;return(0,h.Z)(function*(){const{layer:e}=r,{globalIdField:l,parsedUrl:c}=e,M="infoFor3D"in e?e.infoFor3D:null;if(null==M||null==l)return!1;const P=(0,o.$6)(M);if(null==P)return!1;const S=(0,F.v_)(c.path,`../${P.id}`),X=new Array;for(const st of n){if(!(st.geometry.metadata.getExternalSourcesOnService(c).length>0))return!1;X.push(st)}const N=X.map(st=>st.getAttribute(l)).filter(g.pC);if(0===N.length)return!1;const{assetMapFieldRoles:{parentGlobalId:k,assetHash:tt}}=M,mt=new _.Z({where:`${k} IN (${N.map(st=>`'${st}'`)})`,outFields:[tt,k],returnGeometry:!1}),Pt=yield(0,u.e)(S,mt),{features:Dt}=Pt;return 0!==Dt.length&&!X.some(st=>{const it=st.getAttribute(l);if(!it)return!0;const{metadata:St}=st.geometry,lt=Dt.filter(_t=>_t.getAttribute(k)===it);if(0===lt.length)return!0;const gt=lt.map(_t=>_t.getAttribute(tt));return St.getExternalSourcesOnService(c).flatMap(({source:_t})=>_t.flatMap(Et=>Et.parts.map(Tt=>Tt.partHash))).some(_t=>gt.every(Et=>_t!==Et))})})()}};(0,$._)([(0,K.Cb)()],T.prototype,"type",void 0),(0,$._)([(0,K.Cb)({constructOnly:!0})],T.prototype,"layer",void 0),(0,$._)([(0,K.Cb)({constructOnly:!0})],T.prototype,"supportedSourceTypes",void 0),(0,$._)([(0,K.Cb)({readOnly:!0})],T.prototype,"queryTask",null),T=(0,$._)([(0,nt.j)("esri.layers.graphics.sources.FeatureLayerSource")],T);const rt=1e3,Rt=T},60324:(yt,V,a)=>{a.d(V,{Dm:()=>I,Hq:()=>G,MS:()=>J,bU:()=>U});var h=a(14007),$=a(34222),C=a(85559),v=a(19579);function U(R){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===R||"esriGeometryMultipoint"===R?v.I4:"esriGeometryPolyline"===R?v.ET:v.lF}}}const B=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let g=1;function I(R,x){if((0,h.Z)("esri-csp-restrictions"))return()=>({[x]:null,...R});try{let q=`this${w(x)} = null;`;for(const F in R)q+=`this${w(F)} = ${JSON.stringify(R[F])};`;const W=new Function(`\n      return class AttributesClass$${g++} {\n        constructor() {\n          ${q};\n        }\n      }\n    `)();return()=>new W}catch{return()=>({[x]:null,...R})}}function w(R){return B.test(R)?`.${R}`:`["${R}"]`}function G(R={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,$.d9)(R)}}]}function J(R,x){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:R},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:x,supportsDelete:x,supportsEditing:x,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:x,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:C.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:x,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}}}]);