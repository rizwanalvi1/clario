"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[9050,318],{39050:(x,U,e)=>{e.r(U),e.d(U,{default:()=>Z});var f=e(15861),i=e(50484),W=e(11931),C=e(66476),g=(e(71950),e(3233)),T=e(79412),S=e(6785),c=e(80543),j=(e(14007),e(4703),e(65311),e(62185)),K=e(10141),B=e(26894),o=e(33721),a=e(95060),u=e(19855),h=e(80099),D=e(70509),I=e(25836),P=e(29717),v=e(56956),O=e(85601),G=e(66637),M=e(41391),l=e(35451),s=e(89481);const t=["atom","xml"],r={base:O.Z,key:"type",typeMap:{"simple-line":G.Z},errorContext:"symbol"},d={base:O.Z,key:"type",typeMap:{"picture-marker":M.Z,"simple-marker":l.Z},errorContext:"symbol"},n={base:O.Z,key:"type",typeMap:{"simple-fill":s.Z},errorContext:"symbol"};let E=class extends((0,u.h7)((0,I.Q)((0,h.q)((0,D.I)((0,P.M)((0,g.R)(a.Z))))))){constructor(..._){super(..._),this.description=null,this.fullExtent=null,this.legendEnabled=!0,this.lineSymbol=null,this.pointSymbol=null,this.polygonSymbol=null,this.operationalLayerType="GeoRSS",this.url=null,this.type="geo-rss"}normalizeCtorArgs(_,y){return"string"==typeof _?{url:_,...y}:_}readFeatureCollections(_,y){return y.featureCollection.layers.forEach(p=>{const b=p.layerDefinition.drawingInfo.renderer.symbol;b&&"esriSFS"===b.type&&b.outline?.style.includes("esriSFS")&&(b.outline.style="esriSLSSolid")}),y.featureCollection.layers}get hasPoints(){return this._hasGeometry("esriGeometryPoint")}get hasPolylines(){return this._hasGeometry("esriGeometryPolyline")}get hasPolygons(){return this._hasGeometry("esriGeometryPolygon")}get title(){const _=this._get("title");return _&&"defaults"!==this.originOf("title")?_:this.url?(0,S.vt)(this.url,t)||"GeoRSS":_}set title(_){this._set("title",_)}load(_){const y=null!=_?_.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service","Feature Service","Feature Collection","Scene Service"]},_).catch(T.r9).then(()=>this._fetchService(y)).then(p=>{this.read(p,{origin:"service"})})),Promise.resolve(this)}hasDataChanged(){var _=this;return(0,f.Z)(function*(){const y=yield _._fetchService();return _.read(y,{origin:"service",ignoreDefaults:!0}),!0})()}_fetchService(_){var y=this;return(0,f.Z)(function*(){const p=y.spatialReference,{data:b}=yield(0,C.Z)(W.default.geoRSSServiceUrl,{query:{url:y.url,refresh:!!y.loaded||void 0,outSR:(0,o.oR)(p)?void 0:p.wkid??JSON.stringify(p)},signal:_});return b})()}_hasGeometry(_){return this.featureCollections?.some(y=>y.featureSet?.geometryType===_&&y.featureSet.features?.length>0)??!1}};(0,i._)([(0,c.Cb)()],E.prototype,"description",void 0),(0,i._)([(0,c.Cb)()],E.prototype,"featureCollections",void 0),(0,i._)([(0,j.r)("service","featureCollections",["featureCollection.layers"])],E.prototype,"readFeatureCollections",null),(0,i._)([(0,c.Cb)({type:B.Z,json:{name:"lookAtExtent"}})],E.prototype,"fullExtent",void 0),(0,i._)([(0,c.Cb)(v.id)],E.prototype,"id",void 0),(0,i._)([(0,c.Cb)(v.rn)],E.prototype,"legendEnabled",void 0),(0,i._)([(0,c.Cb)({types:r,json:{write:!0}})],E.prototype,"lineSymbol",void 0),(0,i._)([(0,c.Cb)({type:["show","hide"]})],E.prototype,"listMode",void 0),(0,i._)([(0,c.Cb)({types:d,json:{write:!0}})],E.prototype,"pointSymbol",void 0),(0,i._)([(0,c.Cb)({types:n,json:{write:!0}})],E.prototype,"polygonSymbol",void 0),(0,i._)([(0,c.Cb)({type:["GeoRSS"]})],E.prototype,"operationalLayerType",void 0),(0,i._)([(0,c.Cb)(v.HQ)],E.prototype,"url",void 0),(0,i._)([(0,c.Cb)({json:{origins:{service:{read:{source:"name",reader:_=>_||void 0}}}}})],E.prototype,"title",null),(0,i._)([(0,c.Cb)({readOnly:!0,json:{read:!1},value:"geo-rss"})],E.prototype,"type",void 0),E=(0,i._)([(0,K.j)("esri.layers.GeoRSSLayer")],E);const Z=E},70509:(x,U,e)=>{e.d(U,{I:()=>v});var f=e(15861),i=e(50484),W=e(11931),C=e(26152),A=e(66476),g=e(37636),T=e(57964),S=e(4703),c=e(51172),m=e(79412),R=e(6785),L=e(80543),B=(e(14007),e(65311),e(62185)),o=e(10141),a=e(7547),u=e(85971),h=e(61018),D=e(27835),I=e(57437),P=e(50318);const v=G=>{let M=class extends G{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,c.SC)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(l){l!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",l))}readPortalItem(l,s,t){if(s.itemId)return new D.default({id:s.itemId,portal:t?.portal})}writePortalItem(l,s){l?.id&&(s.itemId=l.id)}loadFromPortal(l,s){var t=this;return(0,f.Z)(function*(){if(t.portalItem?.id)try{const{load:r}=yield Promise.all([e.e(2772),e.e(8592),e.e(6964)]).then(e.bind(e,36964));return(0,m.k_)(s),yield r({instance:t,supportedTypes:l.supportedTypes,validateItem:l.validateItem,supportsData:l.supportsData,layerModuleTypeMap:l.layerModuleTypeMap},s)}catch(r){throw(0,m.D_)(r)||S.Z.getLogger(t).warn(`Failed to load layer (${t.title}, ${t.id}) portal item (${t.portalItem.id})\n  ${r}`),r}})()}finishLoadEditablePortalLayer(l){var s=this;return(0,f.Z)(function*(){s._set("userHasEditingPrivileges",yield s._fetchUserHasEditingPrivileges(l).catch(t=>((0,m.r9)(t),!0)))})()}setUserPrivileges(l,s){var t=this;return(0,f.Z)(function*(){if(!W.default.userPrivilegesApplied)return t.finishLoadEditablePortalLayer(s);if(t.url)try{const{features:{edit:r,fullEdit:d},content:{updateItem:n}}=yield t._fetchUserPrivileges(l,s);t._set("userHasEditingPrivileges",r),t._set("userHasFullEditingPrivileges",d),t._set("userHasUpdateItemPrivileges",n)}catch(r){(0,m.r9)(r)}})()}_fetchUserPrivileges(l,s){var t=this;return(0,f.Z)(function*(){let r=t.portalItem;if(!l||!r||!r.loaded||r.sourceUrl)return t._fetchFallbackUserPrivileges(s);const d=l===r.id;if(d&&r.portal.user)return(0,P.Ss)(r);let n,E;if(d)n=r.portal.url;else try{n=yield(0,u.oP)(t.url,s)}catch(p){(0,m.r9)(p)}if(!n||!(0,R.Zo)(n,r.portal.url))return t._fetchFallbackUserPrivileges(s);try{const p=null!=s?s.signal:null;E=yield C.id?.getCredential(`${n}/sharing`,{prompt:!1,signal:p})}catch(p){(0,m.r9)(p)}if(!E)return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}};try{if(d?yield r.reload():(r=new D.default({id:l,portal:{url:n}}),yield r.load(s)),r.portal.user)return(0,P.Ss)(r)}catch(p){(0,m.r9)(p)}return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}}})()}_fetchFallbackUserPrivileges(l){var s=this;return(0,f.Z)(function*(){let t=!0;try{t=yield s._fetchUserHasEditingPrivileges(l)}catch(r){(0,m.r9)(r)}return{features:{edit:t,fullEdit:!1},content:{updateItem:!1}}})()}_fetchUserHasEditingPrivileges(l){var s=this;return(0,f.Z)(function*(){const t=s.url?C.id?.findCredential(s.url):null;if(!t)return!0;const r=O.credential===t?O.user:yield s._fetchEditingUser(l);return O.credential=t,O.user=r,null==r?.privileges||r.privileges.includes("features:user:edit")})()}_fetchEditingUser(l){var s=this;return(0,f.Z)(function*(){const t=s.portalItem?.portal?.user;if(t)return t;const r=C.id?.findServerInfo(s.url??"");if(!r?.owningSystemUrl)return null;const d=`${r.owningSystemUrl}/sharing/rest`,n=h.Z.getDefault();if(n&&n.loaded&&(0,R.Fv)(n.restUrl)===(0,R.Fv)(d))return n.user;const E=`${d}/community/self`,Z=null!=l?l.signal:null,_=yield(0,g.q6)((0,A.Z)(E,{authMode:"no-prompt",query:{f:"json"},signal:Z}));return _.ok?I.Z.fromJSON(_.value.data):null})()}read(l,s){s&&(s.layer=this),super.read(l,s)}write(l,s){const t=s?.portal,r=this.portalItem?.id&&(this.portalItem.portal||h.Z.getDefault());return t&&r&&!(0,R.tm)(r.restUrl,t.restUrl)?(s.messages&&s.messages.push(new T.Z("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(l,{...s,layer:this})}};return(0,i._)([(0,L.Cb)({type:D.default})],M.prototype,"portalItem",null),(0,i._)([(0,B.r)("web-document","portalItem",["itemId"])],M.prototype,"readPortalItem",null),(0,i._)([(0,a.c)("web-document","portalItem",{itemId:{type:String}})],M.prototype,"writePortalItem",null),(0,i._)([(0,L.Cb)({clonable:!1})],M.prototype,"resourceReferences",void 0),(0,i._)([(0,L.Cb)({type:Boolean,readOnly:!0})],M.prototype,"userHasEditingPrivileges",void 0),(0,i._)([(0,L.Cb)({type:Boolean,readOnly:!0})],M.prototype,"userHasFullEditingPrivileges",void 0),(0,i._)([(0,L.Cb)({type:Boolean,readOnly:!0})],M.prototype,"userHasUpdateItemPrivileges",void 0),M=(0,i._)([(0,o.j)("esri.layers.mixins.PortalLayer")],M),M},O={credential:null,user:null}},25836:(x,U,e)=>{e.d(U,{Q:()=>s});var f=e(15861),i=e(50484),C=(e(14007),e(4703)),A=e(79412),g=e(80543),T=e(73018),c=(e(65311),e(10141)),m=e(76215),R=e(83944),B=(e(37636),e(57964),e(12926),e(43571));const o=new R.Z,a=new WeakMap;function I(t,r){return Number.isFinite(t)&&Number.isFinite(r)?r<=0?t:I(r,t%r):0}let P=0,v=0;function O(){const t=Date.now();let r=!1;for(const d of o){const n=d.deref();n?n.refreshInterval&&t-(a.get(n)??0)+5>=6e4*n.refreshInterval&&(a.set(n,t),n.refresh(t)):r=!0}if(r)for(let d=o.length-1;d>=0;d--)o.at(d).deref()||o.removeAt(d)}(0,B.EH)(()=>{const t=Date.now();let r=0;for(const d of o){const n=d.deref();n&&(r=I(Math.round(6e4*n.refreshInterval),r),n.refreshInterval?a.get(n)||a.set(n,t):a.delete(n))}if(r!==v){if(v=r,clearInterval(P),0===v)return void(P=0);P=setInterval(O,v)}});const s=t=>{let r=class extends t{constructor(...d){super(...d),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=(0,A.Ds)(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||function u(t){(function D(t){return null!=t&&"object"==typeof t&&"refreshInterval"in t&&"refresh"in t})(t)&&o.push(new WeakRef(t))}(this)},()=>{})}destroy(){!function h(t){const r=o.find(d=>d.deref()===t);r&&o.remove(r)}(this)}castRefreshInterval(d){return d>=.1?d:d<=0?0:.1}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(d=Date.now()){(0,A.R8)(this._debounceHasDataChanged()).then(n=>{n&&this._set("refreshTimestamp",d),this.emit("refresh",{dataChanged:n})},n=>{C.Z.getLogger(this).error(n),this.emit("refresh",{dataChanged:!1,error:n})})}hasDataChanged(){return(0,f.Z)(function*(){return!0})()}get test(){}};return(0,i._)([(0,g.Cb)({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:m.C}}}}})],r.prototype,"refreshInterval",void 0),(0,i._)([(0,T.p)("refreshInterval")],r.prototype,"castRefreshInterval",null),(0,i._)([(0,g.Cb)({readOnly:!0})],r.prototype,"refreshTimestamp",void 0),(0,i._)([(0,g.Cb)({readOnly:!0})],r.prototype,"refreshParameters",null),r=(0,i._)([(0,c.j)("esri.layers.mixins.RefreshableLayer")],r),r}},50318:(x,U,e)=>{e.d(U,{$o:()=>L,Fj:()=>c,IW:()=>R,Ss:()=>B,_$:()=>S,ck:()=>m,hz:()=>K,qj:()=>T});var f=e(15861),i=e(83821),W=e(43814),C=e(48230);function g(){return(g=(0,f.Z)(function*(o){const a=o.spatialReference;if(a.isWGS84)return o.clone();if(a.isWebMercator)return(0,C.Sx)(o);const u=W.Z.WGS84;return yield(0,i.initializeProjection)(a,u),(0,i.project)(o,u)})).apply(this,arguments)}function T(o,a){if(!S(o,a)){const u=o.typeKeywords;u?u.push(a):o.typeKeywords=[a]}}function S(o,a){return!!o.typeKeywords?.includes(a)}function c(o){return S(o,K.HOSTED_SERVICE)}function m(o,a){const u=o.typeKeywords;if(u){const h=u.indexOf(a);h>-1&&u.splice(h,1)}}function R(o,a,u){u?T(o,a):m(o,a)}function L(o){return j.apply(this,arguments)}function j(){return j=(0,f.Z)(function*(o){const a=o.clone().normalize();let u;if(a.length>1)for(const h of a)u?h.width>u.width&&(u=h):u=h;else u=a[0];return function A(o){return g.apply(this,arguments)}(u)}),j.apply(this,arguments)}const K={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function B(o){const{portal:a,isOrgItem:u,itemControl:h}=o,D=a.user?.privileges;let I=!D||D.includes("features:user:edit"),P=!!u&&!!D?.includes("features:user:fullEdit");const v="update"===h||"admin"===h;return v?P=I=!0:P&&(I=!0),{features:{edit:I,fullEdit:P},content:{updateItem:v}}}}}]);