"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[7157],{50532:(A,w,g)=>{var z,x,o;function M(o){return o&&"esri.renderers.visualVariables.SizeVariable"===o.declaredClass}function U(o){return null!=o&&!isNaN(o)&&isFinite(o)}function D(o){return o.valueExpression?z.Expression:o.field&&"string"==typeof o.field?z.Field:z.Unknown}function v(o,y){return(y||D(o))===z.Unknown?x.Constant:o.stops?x.Stops:null!=o.minSize&&null!=o.maxSize&&null!=o.minDataValue&&null!=o.maxDataValue?x.ClampedLinear:"unknown"===(o.valueUnit||"unknown")?null!=o.minSize&&null!=o.minDataValue?o.minSize&&o.minDataValue?x.Proportional:x.Additive:x.Identity:x.RealWorldSize}g.d(w,{PS:()=>D,QW:()=>v,RY:()=>z,hL:()=>x,iY:()=>M,qh:()=>U}),(o=z||(z={})).Unknown="unknown",o.Expression="expression",o.Field="field",function(o){o.Unknown="unknown",o.Stops="stops",o.ClampedLinear="clamped-linear",o.Proportional="proportional",o.Additive="additive",o.Constant="constant",o.Identity="identity",o.RealWorldSize="real-world-size"}(x||(x={}))},37157:(A,w,g)=>{g.r(w),g.d(w,{getAllSizes:()=>J,getColor:()=>P,getOpacity:()=>N,getRotationAngle:()=>O,getSize:()=>R,getSizeForValue:()=>I,getSizeFromNumberOrVariable:()=>V,getSizeRangeAtScale:()=>Q,getVisualVariableValues:()=>H,viewScaleRE:()=>W});var z=g(66599),x=g(35458),M=g(480),U=g(4703),D=g(44526),v=g(50532);const o=()=>U.Z.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),y=t=>o().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${t}`),_=()=>o().error("Use of arcade expressions requires an arcade context"),F=new x.Z,C=Math.PI,W=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function P(t,a,n){const e="visualVariables"in t&&t.visualVariables?t.visualVariables.find(u=>"color"===u.type):t;if(!e)return;if("esri.renderers.visualVariables.ColorVariable"!==e.declaredClass)return void y("ColorVariable");const r="number"==typeof a,i=r?null:a,s=i?.attributes;let c=r?a:null;const l=e.field,{ipData:f,hasExpression:m}=e.cache;let d=e.cache.compiledFunc;if(!l&&!m){const u=e.stops;return u&&u[0]&&u[0].color}if("number"!=typeof c)if(m){if(null==n?.arcade)return void _();const p=n.arcade.arcadeUtils,S=p.getViewInfo({viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference}),E=p.createExecContext(i,S,n.timeZone);if(!d){const L=p.createSyntaxTree(e.valueExpression);d=p.createFunction(L),e.cache.compiledFunc=d}c=p.executeFunction(d,E)}else s&&(c=s[l]);const h=e.normalizationField,b=null!=s&&null!=h?parseFloat(s[h]):void 0;if(null!=c&&(!h||r||!isNaN(b)&&0!==b)){isNaN(b)||r||(c/=b);const u=k(c,f);if(u){const p=u[0],S=u[1],E=p===S?e.stops[p].color:z.Z.blendColors(e.stops[p].color,e.stops[S].color,u[2],n?.color);return new z.Z(E)}}}function N(t,a,n){const e="visualVariables"in t&&t.visualVariables?t.visualVariables.find(u=>"opacity"===u.type):t;if(!e)return;if("esri.renderers.visualVariables.OpacityVariable"!==e.declaredClass)return void y("OpacityVariable");const r="number"==typeof a,i=r?null:a,s=i?.attributes;let c=r?a:null;const l=e.field,{ipData:f,hasExpression:m}=e.cache;let d=e.cache.compiledFunc;if(!l&&!m){const u=e.stops;return u&&u[0]&&u[0].opacity}if("number"!=typeof c)if(m){if(null==n?.arcade)return void _();const p=n.arcade.arcadeUtils,S=p.getViewInfo({viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference}),E=p.createExecContext(i,S,n.timeZone);if(!d){const L=p.createSyntaxTree(e.valueExpression);d=p.createFunction(L),e.cache.compiledFunc=d}c=p.executeFunction(d,E)}else s&&(c=s[l]);const h=e.normalizationField,b=null!=s&&null!=h?parseFloat(s[h]):void 0;if(null!=c&&(!h||r||!isNaN(b)&&0!==b)){isNaN(b)||r||(c/=b);const u=k(c,f);if(u){const p=u[0],S=u[1];if(p===S)return e.stops[p].opacity;{const E=e.stops[p].opacity;return E+(e.stops[S].opacity-E)*u[2]}}}}function O(t,a,n){const e="visualVariables"in t&&t.visualVariables?t.visualVariables.find(b=>"rotation"===b.type):t;if(!e)return;if("esri.renderers.visualVariables.RotationVariable"!==e.declaredClass)return void y("RotationVariable");const r=e.axis||"heading",i="heading"===r&&"arithmetic"===e.rotationType?90:0,s="heading"===r&&"arithmetic"===e.rotationType?-1:1,c="number"==typeof a?null:a,l=c?.attributes,f=e.field,{hasExpression:m}=e.cache;let d=e.cache.compiledFunc,h=0;if(!f&&!m)return h;if(m){if(null==n?.arcade)return void _();const u=n.arcade.arcadeUtils,p=u.getViewInfo({viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference}),S=u.createExecContext(c,p,n.timeZone);if(!d){const E=u.createSyntaxTree(e.valueExpression);d=u.createFunction(E),e.cache.compiledFunc=d}h=u.executeFunction(d,S)}else l&&(h=l[f]||0);return h="number"!=typeof h||isNaN(h)?null:i+s*h,h}function R(t,a,n){const e="visualVariables"in t&&t.visualVariables?t.visualVariables.find(i=>"size"===i.type):t;if(!e)return;if("esri.renderers.visualVariables.SizeVariable"!==e.declaredClass)return void y("SizeVariable");const r=I(function B(t,a,n){const e="number"==typeof a,r=e?null:a,i=r?.attributes;let s=e?a:null;const{isScaleDriven:c}=t.cache;let l=t.cache.compiledFunc;if(c){const m=n?.scale,d=n?.view;s=null==m||"3d"===d?function Z(t){let a=null,n=null;const e=t.stops;return e?(a=e[0].value,n=e[e.length-1].value):(a=t.minDataValue||0,n=t.maxDataValue||0),(a+n)/2}(t):m}else if(!e)switch(t.inputValueType){case v.RY.Expression:{if(null==n?.arcade)return void _();const d=n.arcade.arcadeUtils,h=d.getViewInfo({viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference}),b=d.createExecContext(r,h,n.timeZone);if(!l){const u=d.createSyntaxTree(t.valueExpression);l=d.createFunction(u),t.cache.compiledFunc=l}s=d.executeFunction(l,b);break}case v.RY.Field:i&&(s=i[t.field]);break;case v.RY.Unknown:s=null}if(!(0,v.qh)(s))return null;if(e||!t.normalizationField)return s;const f=i?parseFloat(i[t.normalizationField]):null;return(0,v.qh)(f)&&0!==f?s/f:null}(e,a,n),e,a,n,e.cache.ipData);return null==r||isNaN(r)?0:r}function V(t,a,n){return null==t?null:(0,v.iY)(t)?R(t,a,n):(0,v.qh)(t)?t:null}function T(t,a,n){return(0,v.qh)(n)&&t>n?n:(0,v.qh)(a)&&t<a?a:t}function I(t,a,n,e,r){switch(a.transformationType){case v.hL.Additive:return function j(t,a,n,e){return t+((V(a.minSize,n,e)||a.minDataValue)??0)}(t,a,n,e);case v.hL.Constant:return function q(t,a,n){const e=t.stops;let r=e?.length&&e[0].size;return null==r&&(r=t.minSize),V(r,a,n)}(a,n,e);case v.hL.ClampedLinear:return function K(t,a,n,e){const r=(t-a.minDataValue)/(a.maxDataValue-a.minDataValue),i=V(a.minSize,n,e),s=V(a.maxSize,n,e),c=e?.shape;if(t<=a.minDataValue)return i;if(t>=a.maxDataValue)return s;if(null==i||null==s)return null;if("area"===a.scaleBy&&c){const l="circle"===c,f=l?C*(i/2)**2:i*i,m=f+r*((l?C*(s/2)**2:s*s)-f);return l?2*Math.sqrt(m/C):Math.sqrt(m)}return i+r*(s-i)}(t,a,n,e);case v.hL.Proportional:return function Y(t,a,n,e){const r=e?.shape,i=t/a.minDataValue,s=V(a.minSize,n,e),c=V(a.maxSize,n,e);let l=null;return l="circle"===r?2*Math.sqrt(i*(s/2)**2):"square"===r||"diamond"===r||"image"===r?Math.sqrt(i*s**2):i*s,T(l,s,c)}(t,a,n,e);case v.hL.Stops:return function $(t,a,n,e,r){const[i,s,c]=k(t,r);if(i===s)return V(a.stops?.[i].size,n,e);{const l=V(a.stops?.[i].size,n,e);return l+(V(a.stops?.[s].size,n,e)-l)*c}}(t,a,n,e,r);case v.hL.RealWorldSize:return function G(t,a,n,e){const r=(e?.resolution??1)*D.a[a.valueUnit],i=V(a.minSize,n,e),s=V(a.maxSize,n,e),{valueRepresentation:c}=a;let l=null;return l="area"===c?2*Math.sqrt(t/C)/r:"radius"===c||"distance"===c?2*t/r:t/r,T(l,i,s)}(t,a,n,e);case v.hL.Identity:return t;case v.hL.Unknown:return null}}function Q(t,a,n){const{isScaleDriven:e}=t.cache;if(!(e&&"3d"===n||a))return null;const r={scale:a,view:n};let i=V(t.minSize,F,r),s=V(t.maxSize,F,r);if(null!=i||null!=s){if(i>s){const c=s;s=i,i=c}return{minSize:i,maxSize:s}}}function H(t,a,n){if(!t.visualVariables)return;const e=[],r=[],i=[],s=[],c=[];for(const l of t.visualVariables)switch(l.type){case"color":r.push(l);break;case"opacity":i.push(l);break;case"rotation":c.push(l);break;case"size":s.push(l)}return r.forEach(l=>{const f=P(l,a,n);e.push({variable:l,value:f})}),i.forEach(l=>{const f=N(l,a,n);e.push({variable:l,value:f})}),c.forEach(l=>{const f=O(l,a,n);e.push({variable:l,value:f})}),s.forEach(l=>{const f=R(l,a,n);e.push({variable:l,value:f})}),e.filter(l=>null!=l.value)}function k(t,a){if(!a)return;let n=0,e=a.length-1;return a.some((r,i)=>t<r?(e=i,!0):(n=i,!1)),[n,e,(t-a[n])/(a[e]-a[n])]}function J(t,a,n){const e=["proportional","proportional","proportional"];for(const r of t){const i=r.useSymbolValue?"symbol-value":R(r,a,n);switch(r.axis){case"width":e[0]=i;break;case"depth":e[1]=i;break;case"height":e[2]=i;break;case"width-and-depth":e[0]=i,e[1]=i;break;case"all":case void 0:case null:e[0]=i,e[1]=i,e[2]=i;break;default:(0,M.Bg)(r.axis)}}return e}}}]);