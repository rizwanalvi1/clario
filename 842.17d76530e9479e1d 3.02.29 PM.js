"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[842,318],{3233:(H,R,e)=>{e.d(R,{R:()=>d,w:()=>p});var h=e(50484),O=e(73514),C=e(44469),U=e(34222),c=e(60301);class S{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(c.v8),this._values=new Map,this.multipleOriginsSupported=!0}clone(r){const t=new S,s=this._originStores[c.s3.DEFAULTS];s&&s.forEach((i,u)=>{t.set(u,(0,U.d9)(i),c.s3.DEFAULTS)});for(let i=c.s3.SERVICE;i<c.v8;i++){const u=this._originStores[i];u&&u.forEach((g,E)=>{r&&r.has(E)||t.set(E,(0,U.d9)(g),i)})}return t}get(r,t){const s=void 0===t?this._values:this._originStores[t];return s?s.get(r):void 0}keys(r){const t=null==r?this._values:this._originStores[r];return t?[...t.keys()]:[]}set(r,t,s=c.s3.USER){let i=this._originStores[s];if(i||(i=new Map,this._originStores[s]=i),i.set(r,t),!this._values.has(r)||this._propertyOriginMap.get(r)<=s){const u=this._values.get(r);return this._values.set(r,t),this._propertyOriginMap.set(r,s),u!==t}return!1}delete(r,t=c.s3.USER){const s=this._originStores[t];if(!s)return;const i=s.get(r);if(s.delete(r),this._values.has(r)&&this._propertyOriginMap.get(r)===t){this._values.delete(r);for(let u=t-1;u>=0;u--){const g=this._originStores[u];if(g&&g.has(r)){this._values.set(r,g.get(r)),this._propertyOriginMap.set(r,u);break}}}return i}has(r,t){const s=void 0===t?this._values:this._originStores[t];return!!s&&s.has(r)}revert(r,t){for(;t>0&&!this.has(r,t);)--t;const s=this._originStores[t],i=s?.get(r),u=this._values.get(r);return this._values.set(r,i),this._propertyOriginMap.set(r,t),u!==i}originOf(r){return this._propertyOriginMap.get(r)||c.s3.DEFAULTS}forEach(r){this._values.forEach(r)}}var j=e(68090),I=e(49301),D=e(10141);const y=f=>{let r=class extends f{constructor(...t){super(...t);const s=(0,I.vw)(this),i=s.store,u=new S;s.store=u,(0,C.M)(s,i,u)}read(t,s){(0,j.i)(this,t,s)}getAtOrigin(t,s){const i=m(this),u=(0,c.M9)(s);if("string"==typeof t)return i.get(t,u);const g={};return t.forEach(E=>{g[E]=i.get(E,u)}),g}originOf(t){return(0,c.x3)(this.originIdOf(t))}originIdOf(t){return m(this).originOf(t)}revert(t,s){const i=m(this),u=(0,c.M9)(s),g=(0,I.vw)(this);let E;E="string"==typeof t?"*"===t?i.keys(u):[t]:t,E.forEach(_=>{g.invalidate(_),i.revert(_,u),g.commit(_)})}};return r=(0,h._)([(0,D.j)("esri.core.ReadOnlyMultiOriginJSONSupport")],r),r};function m(f){return(0,I.vw)(f).store}let v=class extends(y(O.Z)){};v=(0,h._)([(0,D.j)("esri.core.ReadOnlyMultiOriginJSONSupport")],v);var A=e(37718),P=e(82206);const L=f=>{let r=class extends f{constructor(...t){super(...t)}clear(t,s="user"){return n(this).delete(t,(0,c.M9)(s))}write(t,s){return(0,P.c)(this,t=t||{},s),t}setAtOrigin(t,s,i){(0,I.vw)(this).setAtOrigin(t,s,(0,c.M9)(i))}removeOrigin(t){const s=n(this),i=(0,c.M9)(t),u=s.keys(i);for(const g of u)s.originOf(g)===i&&s.set(g,s.get(g,i),c.s3.USER)}updateOrigin(t,s){const i=n(this),u=(0,c.M9)(s),g=(0,A.U2)(this,t);for(let E=u+1;E<c.v8;++E)i.delete(t,E);i.set(t,g,u)}toJSON(t){return this.write({},t)}};return r=(0,h._)([(0,D.j)("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],r),r.prototype.toJSON.isDefaultToJSON=!0,r};function n(f){return(0,I.vw)(f).store}const d=f=>{let r=class extends(L(y(f))){constructor(...t){super(...t)}};return r=(0,h._)([(0,D.j)("esri.core.MultiOriginJSONSupport")],r),r};let p=class extends(d(O.Z)){};p=(0,h._)([(0,D.j)("esri.core.MultiOriginJSONSupport")],p)},60842:(H,R,e)=>{e.r(R),e.d(R,{default:()=>A});var h=e(50484),O=e(57964),C=e(3233),U=e(66679),c=e(80543),D=(e(14007),e(4703),e(65311),e(10141)),y=e(95060),m=e(70509);let v=class extends((0,m.I)((0,C.R)(y.Z))){constructor(P){super(P),this.resourceInfo=null,this.persistenceEnabled=!0,this.type="unsupported"}initialize(){this.addResolvingPromise(new Promise((P,L)=>{(0,U.Os)(()=>{const n=this.resourceInfo&&(this.resourceInfo.layerType||this.resourceInfo.type);let d="Unsupported layer type";n&&(d+=" "+n),L(new O.Z("layer:unsupported-layer-type",d,{layerType:n}))})}))}read(P,L){const n={resourceInfo:P};null!=P.id&&(n.id=P.id),null!=P.title&&(n.title=P.title),super.read(n,L)}write(P,L){return Object.assign(P||{},this.resourceInfo,{id:this.id})}};(0,h._)([(0,c.Cb)({readOnly:!0})],v.prototype,"resourceInfo",void 0),(0,h._)([(0,c.Cb)({type:["show","hide"]})],v.prototype,"listMode",void 0),(0,h._)([(0,c.Cb)({type:Boolean,readOnly:!1})],v.prototype,"persistenceEnabled",void 0),(0,h._)([(0,c.Cb)({json:{read:!1},readOnly:!0,value:"unsupported"})],v.prototype,"type",void 0),v=(0,h._)([(0,D.j)("esri.layers.UnsupportedLayer")],v);const A=v},70509:(H,R,e)=>{e.d(R,{I:()=>i});var h=e(15861),O=e(50484),C=e(11931),U=e(26152),c=e(66476),S=e(37636),j=e(57964),I=e(4703),D=e(51172),y=e(79412),m=e(6785),v=e(80543),L=(e(14007),e(65311),e(62185)),n=e(10141),d=e(7547),p=e(85971),f=e(61018),r=e(27835),t=e(57437),s=e(50318);const i=g=>{let E=class extends g{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,D.SC)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(_){_!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",_))}readPortalItem(_,o,l){if(o.itemId)return new r.default({id:o.itemId,portal:l?.portal})}writePortalItem(_,o){_?.id&&(o.itemId=_.id)}loadFromPortal(_,o){var l=this;return(0,h.Z)(function*(){if(l.portalItem?.id)try{const{load:a}=yield Promise.all([e.e(2772),e.e(8592),e.e(6964)]).then(e.bind(e,36964));return(0,y.k_)(o),yield a({instance:l,supportedTypes:_.supportedTypes,validateItem:_.validateItem,supportsData:_.supportsData,layerModuleTypeMap:_.layerModuleTypeMap},o)}catch(a){throw(0,y.D_)(a)||I.Z.getLogger(l).warn(`Failed to load layer (${l.title}, ${l.id}) portal item (${l.portalItem.id})\n  ${a}`),a}})()}finishLoadEditablePortalLayer(_){var o=this;return(0,h.Z)(function*(){o._set("userHasEditingPrivileges",yield o._fetchUserHasEditingPrivileges(_).catch(l=>((0,y.r9)(l),!0)))})()}setUserPrivileges(_,o){var l=this;return(0,h.Z)(function*(){if(!C.default.userPrivilegesApplied)return l.finishLoadEditablePortalLayer(o);if(l.url)try{const{features:{edit:a,fullEdit:T},content:{updateItem:M}}=yield l._fetchUserPrivileges(_,o);l._set("userHasEditingPrivileges",a),l._set("userHasFullEditingPrivileges",T),l._set("userHasUpdateItemPrivileges",M)}catch(a){(0,y.r9)(a)}})()}_fetchUserPrivileges(_,o){var l=this;return(0,h.Z)(function*(){let a=l.portalItem;if(!_||!a||!a.loaded||a.sourceUrl)return l._fetchFallbackUserPrivileges(o);const T=_===a.id;if(T&&a.portal.user)return(0,s.Ss)(a);let M,K;if(T)M=a.portal.url;else try{M=yield(0,p.oP)(l.url,o)}catch(B){(0,y.r9)(B)}if(!M||!(0,m.Zo)(M,a.portal.url))return l._fetchFallbackUserPrivileges(o);try{const B=null!=o?o.signal:null;K=yield U.id?.getCredential(`${M}/sharing`,{prompt:!1,signal:B})}catch(B){(0,y.r9)(B)}if(!K)return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}};try{if(T?yield a.reload():(a=new r.default({id:_,portal:{url:M}}),yield a.load(o)),a.portal.user)return(0,s.Ss)(a)}catch(B){(0,y.r9)(B)}return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}}})()}_fetchFallbackUserPrivileges(_){var o=this;return(0,h.Z)(function*(){let l=!0;try{l=yield o._fetchUserHasEditingPrivileges(_)}catch(a){(0,y.r9)(a)}return{features:{edit:l,fullEdit:!1},content:{updateItem:!1}}})()}_fetchUserHasEditingPrivileges(_){var o=this;return(0,h.Z)(function*(){const l=o.url?U.id?.findCredential(o.url):null;if(!l)return!0;const a=u.credential===l?u.user:yield o._fetchEditingUser(_);return u.credential=l,u.user=a,null==a?.privileges||a.privileges.includes("features:user:edit")})()}_fetchEditingUser(_){var o=this;return(0,h.Z)(function*(){const l=o.portalItem?.portal?.user;if(l)return l;const a=U.id?.findServerInfo(o.url??"");if(!a?.owningSystemUrl)return null;const T=`${a.owningSystemUrl}/sharing/rest`,M=f.Z.getDefault();if(M&&M.loaded&&(0,m.Fv)(M.restUrl)===(0,m.Fv)(T))return M.user;const K=`${T}/community/self`,Z=null!=_?_.signal:null,W=yield(0,S.q6)((0,c.Z)(K,{authMode:"no-prompt",query:{f:"json"},signal:Z}));return W.ok?t.Z.fromJSON(W.value.data):null})()}read(_,o){o&&(o.layer=this),super.read(_,o)}write(_,o){const l=o?.portal,a=this.portalItem?.id&&(this.portalItem.portal||f.Z.getDefault());return l&&a&&!(0,m.tm)(a.restUrl,l.restUrl)?(o.messages&&o.messages.push(new j.Z("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(_,{...o,layer:this})}};return(0,O._)([(0,v.Cb)({type:r.default})],E.prototype,"portalItem",null),(0,O._)([(0,L.r)("web-document","portalItem",["itemId"])],E.prototype,"readPortalItem",null),(0,O._)([(0,d.c)("web-document","portalItem",{itemId:{type:String}})],E.prototype,"writePortalItem",null),(0,O._)([(0,v.Cb)({clonable:!1})],E.prototype,"resourceReferences",void 0),(0,O._)([(0,v.Cb)({type:Boolean,readOnly:!0})],E.prototype,"userHasEditingPrivileges",void 0),(0,O._)([(0,v.Cb)({type:Boolean,readOnly:!0})],E.prototype,"userHasFullEditingPrivileges",void 0),(0,O._)([(0,v.Cb)({type:Boolean,readOnly:!0})],E.prototype,"userHasUpdateItemPrivileges",void 0),E=(0,O._)([(0,n.j)("esri.layers.mixins.PortalLayer")],E),E},u={credential:null,user:null}},50318:(H,R,e)=>{e.d(R,{$o:()=>v,Fj:()=>D,IW:()=>m,Ss:()=>L,_$:()=>I,ck:()=>y,hz:()=>P,qj:()=>j});var h=e(15861),O=e(83821),C=e(43814),U=e(48230);function S(){return(S=(0,h.Z)(function*(n){const d=n.spatialReference;if(d.isWGS84)return n.clone();if(d.isWebMercator)return(0,U.Sx)(n);const p=C.Z.WGS84;return yield(0,O.initializeProjection)(d,p),(0,O.project)(n,p)})).apply(this,arguments)}function j(n,d){if(!I(n,d)){const p=n.typeKeywords;p?p.push(d):n.typeKeywords=[d]}}function I(n,d){return!!n.typeKeywords?.includes(d)}function D(n){return I(n,P.HOSTED_SERVICE)}function y(n,d){const p=n.typeKeywords;if(p){const f=p.indexOf(d);f>-1&&p.splice(f,1)}}function m(n,d,p){p?j(n,d):y(n,d)}function v(n){return A.apply(this,arguments)}function A(){return A=(0,h.Z)(function*(n){const d=n.clone().normalize();let p;if(d.length>1)for(const f of d)p?f.width>p.width&&(p=f):p=f;else p=d[0];return function c(n){return S.apply(this,arguments)}(p)}),A.apply(this,arguments)}const P={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function L(n){const{portal:d,isOrgItem:p,itemControl:f}=n,r=d.user?.privileges;let t=!r||r.includes("features:user:edit"),s=!!p&&!!r?.includes("features:user:fullEdit");const i="update"===f||"admin"===f;return i?s=t=!0:s&&(t=!0),{features:{edit:t,fullEdit:s},content:{updateItem:i}}}}}]);