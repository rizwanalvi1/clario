"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[2334,4523],{52334:(te,$,i)=>{i.r($),i.d($,{applyEdits:()=>p,checkEditingCapabilities:()=>x,isFeatureIdentifierArrayWithGlobalId:()=>a,isFeatureIdentifierArrayWithObjectId:()=>A,isFeatureIdentifierWithGlobalId:()=>s,isFeatureIdentifierWithObjectId:()=>F,normalizeCollections:()=>X,normalizeEdits:()=>z,normalizeGeometries:()=>q,shallowCloneFeature:()=>H,uploadAssets:()=>ne});var w=i(15861),C=i(35458),U=i(83944),d=i(57964),B=i(34222),Z=i(4703),K=i(79412),W=i(6785),P=i(19986),M=i(93566),O=i(33721),T=i(92344),_=i(85295),g=i(11642),E=i(85971);function v(e){return null!=e?.applyEdits}function F(e){return"object"==typeof e&&null!=e&&"objectId"in e&&!!e.objectId}function A(e){return e.every(F)}function s(e){return"object"==typeof e&&null!=e&&"globalId"in e&&!!e.globalId}function a(e){return e.every(s)}function p(e,t,n){return h.apply(this,arguments)}function h(){return h=(0,w.Z)(function*(e,t,n,r={}){let o;const S=r.gdbVersion??("gdbVersion"in e?e.gdbVersion:null);(0,T.lQ)(e)&&e.url?o=(0,T.jF)(e.url,e.layerId,S,"original-and-current-features"===r.returnServiceEditsOption):(o=(0,K.hh)(),o.promise.then(c=>{(c.addedFeatures.length||c.updatedFeatures.length||c.deletedFeatures.length||c.addedAttachments.length||c.updatedAttachments.length||c.deletedAttachments.length)&&e.emit("edits",c)}),e.emit("apply-edits",{result:o.promise}));try{const{results:l,edits:c}=yield function f(e,t,n,r){return b.apply(this,arguments)}(e,t,n,r),R=y=>y.filter(ae=>!ae.error).map(B.d9),N={edits:c,addedFeatures:R(l.addFeatureResults),updatedFeatures:R(l.updateFeatureResults),deletedFeatures:R(l.deleteFeatureResults),addedAttachments:R(l.addAttachmentResults),updatedAttachments:R(l.updateAttachmentResults),deletedAttachments:R(l.deleteAttachmentResults),exceededTransferLimit:!1,historicMoment:l.editMoment?new Date(l.editMoment):null,globalIdToObjectId:r.globalIdToObjectId};return l.editedFeatureResults?.length&&(N.editedFeatures=l.editedFeatureResults),o.resolve(N),l}catch(l){throw o.reject(l),l}}),h.apply(this,arguments)}function b(){return b=(0,w.Z)(function*(e,t,n,r){if(yield e.load(),!v(t))throw new d.Z(`${e.type}-layer:no-editing-support`,"Layer source does not support applyEdits capability",{layer:e});if(!(0,E.ln)(e))throw new d.Z(`${e.type}-layer:editing-disabled`,"Editing is disabled for layer",{layer:e});const{edits:o,options:u}=yield function I(e,t,n){return D.apply(this,arguments)}(e,n,r);return o.addFeatures?.length||o.updateFeatures?.length||o.deleteFeatures?.length||o.addAttachments?.length||o.updateAttachments?.length||o.deleteAttachments?.length?{edits:o,results:yield t.applyEdits(o,u)}:{edits:o,results:{addFeatureResults:[],updateFeatureResults:[],deleteFeatureResults:[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}}),b.apply(this,arguments)}function D(){return D=(0,w.Z)(function*(e,t,n){const r=(0,E.S1)(e),S=null!=e.infoFor3D;if(x(t,r,n,!(!t||!(t.addFeatures||t.updateFeatures||t.deleteFeatures)),!(!t||!(t.addAttachments||t.updateAttachments||t.deleteAttachments)),`${e.type}-layer`),!r.data.isVersioned&&n?.gdbVersion)throw new d.Z(`${e.type}-layer:invalid-parameter`,"'gdbVersion' is applicable only if the layer supports versioned data. See: 'capabilities.data.isVersioned'");if(!r.editing.supportsRollbackOnFailure&&n?.rollbackOnFailureEnabled)throw new d.Z(`${e.type}-layer:invalid-parameter`,"This layer does not support 'rollbackOnFailureEnabled' parameter. See: 'capabilities.editing.supportsRollbackOnFailure'");const l={...n};if(null!=l.rollbackOnFailureEnabled||r.editing.supportsRollbackOnFailure||(l.rollbackOnFailureEnabled=!0),l.rollbackOnFailureEnabled||"original-and-current-features"!==l.returnServiceEditsOption||(!1===l.rollbackOnFailureEnabled&&Z.Z.getLogger("esri.layers.graphics.editingSupport").warn(`${e.type}-layer:invalid-parameter`,"'original-and-current-features' is valid for 'returnServiceEditsOption' only when 'rollBackOnFailure' is true, but 'rollBackOnFailure' was set to false. 'rollBackOnFailure' has been overwritten and set to true."),l.rollbackOnFailureEnabled=!0),!r.editing.supportsReturnServiceEditsInSourceSpatialReference&&l.returnServiceEditsInSourceSR)throw new d.Z(`${e.type}-layer:invalid-parameter`,"This layer does not support 'returnServiceEditsInSourceSR' parameter. See: 'capabilities.editing.supportsReturnServiceEditsInSourceSpatialReference'");if(l.returnServiceEditsInSourceSR&&"original-and-current-features"!==l.returnServiceEditsOption)throw new d.Z(`${e.type}-layer:invalid-parameter`,"'returnServiceEditsInSourceSR' is valid only when 'returnServiceEditsOption' is set to 'original-and-current-features'");const c=z(t,r,`${e.type}-layer`),R=n?.globalIdUsed||S,N=e.fields.filter(y=>"big-integer"===y.type||"oid"===y.type&&(y.length||0)>=8);if(R){const{globalIdField:y}=e;if(null==y)throw new d.Z(`${e.type}-layer:invalid-parameter`,"Layer does not specify a global id field.");c.addFeatures.forEach(ae=>function re(e,t){const{attributes:n}=e;null==n[t]&&(n[t]=(0,P.zS)())}(ae,y))}return c.addFeatures.forEach(y=>function k(e,t,n,r){L(e,t,n,r),V(e,t)}(y,e,R,N)),c.updateFeatures.forEach(y=>function G(e,t,n,r){L(e,t,n,r),V(e,t);const o=(0,E.S1)(t);if("geometry"in e&&null!=e.geometry&&!o?.editing.supportsGeometryUpdate)throw new d.Z(`${t.type}-layer:unsupported-operation`,"Layer does not support geometry updates.")}(y,e,R,N)),c.deleteFeatures.forEach(y=>function Q(e,t,n,r){L(e,t,n,r)}(y,e,R,N)),c.addAttachments.forEach(y=>Y(y,e)),c.updateAttachments.forEach(y=>Y(y,e)),S&&(yield function ee(e,t){return J.apply(this,arguments)}(c,e)),{edits:yield q(c),options:l}}),D.apply(this,arguments)}function L(e,t,n,r){if(n){if("attributes"in e&&!e.attributes[t.globalIdField])throw new d.Z(`${t.type}-layer:invalid-parameter`,`Feature should have '${t.globalIdField}' when 'globalIdUsed' is true`);if(!("attributes"in e)&&!e.globalId)throw new d.Z(`${t.type}-layer:invalid-parameter`,"`'globalId' of the feature should be passed when 'globalIdUsed' is true")}if(r.length&&"attributes"in e)for(const o of r){const u=e.attributes[o.name];if(void 0!==u&&!(0,_.d2)(o,u))throw new d.Z(`${t.type}-layer:invalid-parameter`,`Big-integer field '${o.name}' of the feature must be less than ${Number.MAX_SAFE_INTEGER}`,{feature:e})}if("geometry"in e&&null!=e.geometry){if(e.geometry.hasZ&&!1===t.capabilities?.data.supportsZ)throw new d.Z(`${t.type}-layer:z-unsupported`,"Layer does not support z values while feature has z values.");if(e.geometry.hasM&&!1===t.capabilities?.data.supportsM)throw new d.Z(`${t.type}-layer:m-unsupported`,"Layer does not support m values while feature has m values.")}}function V(e,t){if("geometry"in e&&"mesh"===e.geometry?.type&&null!=t.infoFor3D&&null!=t.spatialReference){const{geometry:n}=e,{spatialReference:r,vertexSpace:o}=n,u=t.spatialReference,S="local"===o.type,l=(0,O.sT)(u),c=(0,O.fS)(u,r),R=c||(0,O.oR)(u)&&((0,O.oR)(r)||(0,O.sS)(r));if(!(S&&l&&R||!S&&!l&&c))throw new d.Z(`${t.type}-layer:mesh-unsupported`,`Uploading a mesh with a ${o.type} vertex space and a spatial reference wkid:${r.wkid} to a layer with a spatial reference wkid:${u.wkid} is not supported.`)}}function Y(e,t){const{feature:n,attachment:r}=e;if(!n||"attributes"in n&&!n.attributes[t.globalIdField])throw new d.Z(`${t.type}-layer:invalid-parameter`,"Attachment should have reference to a feature with 'globalId'");if(!("attributes"in n)&&!n.globalId)throw new d.Z(`${t.type}-layer:invalid-parameter`,"Attachment should have reference to 'globalId' of the parent feature");if(!r.globalId)throw new d.Z(`${t.type}-layer:invalid-parameter`,"Attachment should have 'globalId'");if(!r.data&&!r.uploadId)throw new d.Z(`${t.type}-layer:invalid-parameter`,"Attachment should have 'data' or 'uploadId'");if(!(r.data instanceof File&&r.data.name||r.name))throw new d.Z(`${t.type}-layer:invalid-parameter`,"'name' is required when attachment is specified as Base64 encoded string using 'data'");if(!t.capabilities?.editing.supportsUploadWithItemId&&r.uploadId)throw new d.Z(`${t.type}-layer:invalid-parameter`,"This layer does not support 'uploadId' parameter. See: 'capabilities.editing.supportsUploadWithItemId'");if("string"==typeof r.data){const o=(0,W.sJ)(r.data);if(o&&!o.isBase64)throw new d.Z(`${t.type}-layer:invalid-parameter`,"Attachment 'data' should be a Blob, File or Base64 encoded string")}}function q(e){return m.apply(this,arguments)}function m(){return(m=(0,w.Z)(function*(e){const t=e.addFeatures??[],n=e.updateFeatures??[],r=t.concat(n).map(l=>l.geometry),o=yield(0,M.aX)(r),u=t.length,S=n.length;return o.slice(0,u).forEach((l,c)=>t[c].geometry=l),o.slice(u,u+S).forEach((l,c)=>n[c].geometry=l),e})).apply(this,arguments)}function X(e){return{addFeatures:Array.from(e?.addFeatures??[]),updateFeatures:Array.from(e?.updateFeatures??[]),deleteFeatures:e&&U.Z.isCollection(e.deleteFeatures)?e.deleteFeatures.toArray():e.deleteFeatures||[],addAttachments:e.addAttachments||[],updateAttachments:e.updateAttachments||[],deleteAttachments:e.deleteAttachments||[]}}function z(e,t,n){const r=X(e);if(r.addFeatures?.length&&!t.operations.supportsAdd)throw new d.Z(`${n}:unsupported-operation`,"Layer does not support adding features.");if(r.updateFeatures?.length&&!t.operations.supportsUpdate)throw new d.Z(`${n}:unsupported-operation`,"Layer does not support updating features.");if(r.deleteFeatures?.length&&!t.operations.supportsDelete)throw new d.Z(`${n}:unsupported-operation`,"Layer does not support deleting features.");return r.addFeatures=r.addFeatures.map(H),r.updateFeatures=r.updateFeatures.map(H),r.addAssetFeatures=[],r}function x(e,t,n,r,o,u){if(!e||!r&&!o)throw new d.Z(`${u}:missing-parameters`,"'addFeatures', 'updateFeatures', 'deleteFeatures', 'addAttachments', 'updateAttachments' or 'deleteAttachments' parameter is required");if(!t.editing.supportsGlobalId&&n?.globalIdUsed)throw new d.Z(`${u}:invalid-parameter`,"This layer does not support 'globalIdUsed' parameter. See: 'capabilities.editing.supportsGlobalId'");if(!t.editing.supportsGlobalId&&o)throw new d.Z(`${u}:invalid-parameter`,"'addAttachments', 'updateAttachments' and 'deleteAttachments' are applicable only if the layer supports global ids. See: 'capabilities.editing.supportsGlobalId'");if(!n?.globalIdUsed&&o)throw new d.Z(`${u}:invalid-parameter`,"When 'addAttachments', 'updateAttachments' or 'deleteAttachments' is specified, globalIdUsed should be set to true")}function H(e){const t=new C.Z;return e.attributes||(e.attributes={}),t.geometry=e.geometry,t.attributes=e.attributes,t}function J(){return(J=(0,w.Z)(function*(e,t){if(null==t.infoFor3D)return;const{infoFor3D:n}=t,r=(0,g.S0)("model/gltf-binary",n.supportedFormats)??(0,g.Ow)("glb",n.supportedFormats);if(!r||!n.editFormats.includes(r))throw new d.Z(`${t.type}-layer:binary-gltf-asset-not-supported`,"3DObjectFeatureLayer requires binary glTF (.glb) support for updating mesh geometry.");e.addAssetFeatures??=[];const{addAssetFeatures:o}=e;for(const u of e.addFeatures??[])j(u)&&o.push(u);for(const u of e.updateFeatures??[])j(u)&&o.push(u)})).apply(this,arguments)}function j(e){return"mesh"===e?.geometry?.type}function ne(e,t,n,r){if(!v(t))throw new d.Z(`${e.type}-layer:no-editing-support`,"Layer source does not support applyEdits capability",{layer:e});if(!t.uploadAssets)throw new d.Z(`${e.type}-layer:no-asset-upload-support`,"Layer source does not support uploadAssets capability",{layer:e});return t.uploadAssets(n,r)}},92344:(te,$,i)=>{i.d($,{jF:()=>_,lQ:()=>v,o1:()=>s});var w=i(50484),C=i(88278),U=i(34222),d=i(79412),B=i(80543),W=(i(14007),i(4703),i(10141)),P=i(93604);const M=new C.Z.EventEmitter;function _(a,p,h=null,f=!1){const b=(0,d.hh)();return M.emit("apply-edits",{serviceUrl:a,layerId:p,gdbVersion:h,mayReceiveServiceEdits:f=null==p||f,result:b.promise}),b}const E=Symbol();function v(a){return null!=a&&"object"==typeof a&&E in a}function F(a){return null!=a&&"object"==typeof a&&"gdbVersion"in a}function A(a,p,h){const f=new URL(a).host,b=P.Jp.get(f),I=D=>!D||D===b;return I(p)&&I(h)||p===h}const s=a=>{var p;let h=class extends a{constructor(...f){super(...f),this[p]=!0,this._applyEditsHandler=b=>{const{serviceUrl:I,layerId:D,gdbVersion:L,mayReceiveServiceEdits:V,result:k}=b,Q=I===this.url,G=null!=D&&null!=this.layerId&&D===this.layerId,Y=F(this),re=F(this)&&A(I,L,this.gdbVersion);if(!Q||Y&&!re||!G&&!V)return;const q=k.then(m=>{if(this.lastEditsEventDate=new Date,G&&(m.addedFeatures.length||m.updatedFeatures.length||m.deletedFeatures.length||m.addedAttachments.length||m.updatedAttachments.length||m.deletedAttachments.length))return this.emit("edits",(0,U.d9)(m)),m;const X=m.editedFeatures?.find(({layerId:x})=>x===this.layerId);if(X){const{adds:x,updates:H,deletes:ee}=X.editedFeatures,J={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:x?x.map(({attributes:j})=>({objectId:this.objectIdField&&j[this.objectIdField],globalId:this.globalIdField&&j[this.globalIdField]})):[],deletedFeatures:ee?ee.map(({attributes:j})=>({objectId:this.objectIdField&&j[this.objectIdField],globalId:this.globalIdField&&j[this.globalIdField]})):[],updatedFeatures:H?H.map(({current:{attributes:j}})=>({objectId:this.objectIdField&&j[this.objectIdField],globalId:this.globalIdField&&j[this.globalIdField]})):[],editedFeatures:(0,U.d9)(m.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,U.d9)(m.historicMoment)};return this.emit("edits",J),J}const z={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:(0,U.d9)(m.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,U.d9)(m.historicMoment)};return"historicMoment"in this&&this._shouldUpdateHistoricMoment(I,L,z.historicMoment)&&this.emit("edits",z),z}).then(m=>("historicMoment"in this&&this._shouldUpdateHistoricMoment(I,L,m.historicMoment)&&(this.historicMoment=m.historicMoment),m));this.emit("apply-edits",{result:q})},this._updateMomentHandler=b=>{const{serviceUrl:I,gdbVersion:D,moment:L}=b,V=I===this.url,k=F(this),Q=F(this)&&A(I,D,this.gdbVersion),G=F(this)&&!A(I,this.gdbVersion,null);V&&k&&Q&&G&&"historicMoment"in this&&this.historicMoment!==L&&(this.historicMoment=L)},this.when().then(()=>{this.addHandles(function O(a){return M.on("apply-edits",new WeakRef(a))}(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(function T(a){return M.on("update-moment",new WeakRef(a))}(this._updateMomentHandler))},()=>{})}_shouldUpdateHistoricMoment(f,b,I){return"historicMoment"in this&&this.historicMoment!==I&&(0,P.JV)(f,b)}};return p=E,(0,w._)([(0,B.Cb)()],h.prototype,"lastEditsEventDate",void 0),h=(0,w._)([(0,W.j)("esri.layers.mixins.EditBusLayer")],h),h}},11642:(te,$,i)=>{i.d($,{$6:()=>A,$z:()=>U,F7:()=>C,Ow:()=>K,S0:()=>Z,d1:()=>W,dm:()=>P});const w=[["binary","application/octet-stream","bin",""]];function C(s,a){return null!=_(a.name,s?.supportedFormats??[])}function U(s,a){if(!s)return!1;const p=P(a,s.supportedFormats??[]);return null!=p&&s.editFormats.includes(p)}function Z(s,a){return g(function T(s,a){const p=s.toLowerCase();return M(a).find(h=>E(h)===p)}(s,a))}function K(s,a){return g(_(s,a))}function W(s,a){return E(function O(s,a){return M(a).find(p=>g(p)===s)}(s,a))}function P(s,a){return K(s.name,a)??Z(s.type,a)}function M(s){return[...w,...s]}function _(s,a){const p=s.toLowerCase();return M(a).find(h=>function v(s){return s?.[2].split(",").map(a=>a.toLowerCase())??[]}(h).some(f=>p.endsWith(f)))}function g(s){return s?.[0]}function E(s){return s?.[1].toLowerCase()}function A(s){return s.tables?.find(a=>"assetMaps"===a.role)}},93604:(te,$,i)=>{i.d($,{JV:()=>T,Jp:()=>B,Px:()=>M,U8:()=>d,r9:()=>W});var w=i(15861),C=i(66476);const d=(0,i(19986).dG)(),B=new Map,Z=new Map;function W(_,g,E){return P.apply(this,arguments)}function P(){return(P=(0,w.Z)(function*(_,g,E){if(!_||!E)return!1;if(!g)return!0;const v=new URL(_).host;let F=B.get(v);if(!F){const A=_.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");F=(yield(0,C.Z)(A,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return F===g})).apply(this,arguments)}function M(_,g){return O.apply(this,arguments)}function O(){return(O=(0,w.Z)(function*(_,g,E=!1){if(!_||!g)return!0;const v=_.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),F=Z.get(v)?.entries();if(F)for(const[A,s]of F)if(s.name===g){const a=!s.stack?.hasForwardEdits();if(!a&&E){const[{deleteForwardEdits:p},{default:h}]=yield Promise.all([i.e(1015).then(i.bind(i,51015)),i.e(560).then(i.bind(i,80560))]),f=yield p(v,A,new h({sessionId:d,moment:s.moment}));return f.success&&s.stack?.clearForwardEdits(),f.success}return a}return!0})).apply(this,arguments)}function T(_,g){if(!_)return!1;const E=_.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),v=Z.get(E)?.entries();if(v)for(const[F,A]of v)if(A.name===g)return"edit"===A.lockType;return!1}}}]);