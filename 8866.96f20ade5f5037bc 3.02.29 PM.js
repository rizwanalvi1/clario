"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[8866,5251,2046],{60084:(z,w,r)=>{r.d(w,{D:()=>i});var c=r(26496);function i(P){P?.writtenProperties&&P.writtenProperties.forEach(({target:m,propName:g,newOrigin:_})=>{(0,c.l)(m)&&_&&m.originOf(g)!==_&&m.updateOrigin(g,_)})}},26496:(z,w,r)=>{function c(i){return i&&"getAtOrigin"in i&&"originOf"in i}r.d(w,{l:()=>c})},38866:(z,w,r)=>{r.d(w,{xp:()=>H,Vt:()=>V});var c=r(15861),i=r(50484),P=r(66476),m=r(57964),g=r(4703),_=r(79412),x=r(6785),u=r(80543),S=(r(14007),r(65311),r(62185)),D=r(10141),Z=r(7547),d=r(60084),f=r(26894),O=r(69063),y=r(43814),b=r(89713),M=r(56956),o=r(7741);var C=r(61018),l=r(27835),T=r(453),B=r(89055),j=r(88911),A=r(46018);const V=v=>{let h=class extends v{constructor(){var n;super(...arguments),n=this,this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=(0,_.Ds)(function(){var e=(0,c.Z)(function*(t,s,a){switch(t){case H.SAVE:return n._save(s);case H.SAVE_AS:return n._saveAs(a,s)}});return function(t,s,a){return e.apply(this,arguments)}}())}readSpatialReference(n,e){return N(e)}readFullExtent(n,e,t){if(null!=n&&"object"==typeof n){const K=null==n.spatialReference?{...n,spatialReference:N(e)}:n;return f.Z.fromJSON(K,t)}const s=e.store,a=N(e);return null==a||null==s?.extent||!Array.isArray(s.extent)||s.extent.some(K=>K<L)?null:new f.Z({xmin:s.extent[0],ymin:s.extent[1],xmax:s.extent[2],ymax:s.extent[3],spatialReference:a})}parseVersionString(n){const e={major:Number.NaN,minor:Number.NaN,versionString:n},t=n.split(".");return t.length>=2&&(e.major=parseInt(t[0],10),e.minor=parseInt(t[1],10)),e}readVersion(n,e){const t=e.store,s=null!=t.version?t.version.toString():"";return this.parseVersionString(s)}readTitlePortalItem(n){return"item-title"!==this.sublayerTitleMode?void 0:n}readTitleService(n,e){const t=this.portalItem?.title;if("item-title"===this.sublayerTitleMode)return this.url?(0,b.a7)(this.url,e.name):e.name;let s=e.name;if(!s&&this.url){const a=(0,b.Qc)(this.url);null!=a&&(s=a.title)}return"item-title-and-service-name"===this.sublayerTitleMode&&t&&(s=t+" - "+s),(0,b.ld)(s)}set url(n){if(null==n)return void this._set("url",n);const e=(0,b.XG)({layer:this,url:n,nonStandardUrlAllowed:!1,logger:g.Z.getLogger(this)});this._set("url",e.url),null!=e.layerId&&this._set("layerId",e.layerId)}writeUrl(n,e,t,s){(0,b.wH)(this,n,"layers",e,s)}get parsedUrl(){const n=this._get("url"),e=(0,x.mN)(n);return e&&null!=this.layerId&&(e.path=`${e.path}/layers/${this.layerId}`),e}_fetchIndexAndUpdateExtent(n,e){var t=this;return(0,c.Z)(function*(){t.indexInfo=(0,o.T)(t.parsedUrl?.path??"",t.rootNode,n,t.customParameters,t.apiKey,g.Z.getLogger(t),e),null==t.fullExtent||t.fullExtent.hasZ||t._updateExtent(yield t.indexInfo)})()}_updateExtent(n){if("page"===n?.type){const e=n.rootIndex%n.pageSize,t=n.rootPage?.nodes?.[e];if(null==t?.obb?.center||null==t.obb.halfSize)throw new m.Z("sceneservice:invalid-node-page","Invalid node page.");if(t.obb.center[0]<L||null==this.fullExtent||this.fullExtent.hasZ)return;const s=t.obb.halfSize,a=t.obb.center[2],K=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]);this.fullExtent.zmin=a-K,this.fullExtent.zmax=a+K}else if("node"===n?.type){const e=n.rootNode?.mbs;if(!Array.isArray(e)||4!==e.length||e[0]<L)return;const t=e[2],s=e[3],{fullExtent:a}=this;a&&(a.zmin=t-s,a.zmax=t+s)}}_fetchService(n){var e=this;return(0,c.Z)(function*(){if(null==e.url)throw new m.Z("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==e.layerId&&/SceneServer\/*$/i.test(e.url)){const t=yield e._fetchFirstLayerId(n);null!=t&&(e.layerId=t)}return e._fetchServiceLayer(n)})()}_fetchFirstLayerId(n){var e=this;return(0,c.Z)(function*(){const t=yield(0,P.Z)(e.url??"",{query:{f:"json",...e.customParameters,token:e.apiKey},responseType:"json",signal:n});if(t.data&&Array.isArray(t.data.layers)&&t.data.layers.length>0)return t.data.layers[0].id})()}_fetchServiceLayer(n){var e=this;return(0,c.Z)(function*(){const t=yield(0,P.Z)(e.parsedUrl?.path??"",{query:{f:"json",...e.customParameters,token:e.apiKey},responseType:"json",signal:n});t.ssl&&e.url&&(e.url=e.url.replace(/^http:/i,"https:"));let s=!1;if(t.data.layerType&&"Voxel"===t.data.layerType&&(s=!0),s)return e._fetchVoxelServiceLayer();const a=t.data;e.read(a,e._getServiceContext()),e.validateLayer(a)})()}_fetchVoxelServiceLayer(n){var e=this;return(0,c.Z)(function*(){const t=(yield(0,P.Z)(e.parsedUrl?.path+"/layer",{query:{f:"json",...e.customParameters,token:e.apiKey},responseType:"json",signal:n})).data;e.read(t,e._getServiceContext()),e.validateLayer(t)})()}_getServiceContext(){return{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl}}_ensureLoadBeforeSave(){var n=this;return(0,c.Z)(function*(){yield n.load(),"beforeSave"in n&&"function"==typeof n.beforeSave&&(yield n.beforeSave())})()}validateLayer(n){}_saveAs(n,e){var t=this;return(0,c.Z)(function*(){const s={...Y,...e};let a=l.default.from(n);if(!a)throw new m.Z("sceneservice:portal-item-required","_saveAs() requires a portal item to save to");(0,j.w)(a),a.id&&(a=a.clone(),a.id=null);const K=a.portal||C.Z.getDefault();yield t._ensureLoadBeforeSave(),a.type=J,a.portal=K;const F=(0,T.Y)(a,"portal-item",!0),G={layers:[t.write({},F)]};return yield Promise.all(F.resources.pendingOperations??[]),yield t._validateAgainstJSONSchema(G,F,s),t.url&&(a.url=t.url),a.title||(a.title=t.title),W(a,s,$.newItem),yield K.signIn(),yield K.user?.addItem({item:a,folder:s?.folder,data:G}),yield(0,B.H)(t.resourceReferences,F),t.portalItem=a,(0,d.D)(F),F.portalItem=a,a})()}_save(n){var e=this;return(0,c.Z)(function*(){const t={...Y,...n};if(!e.portalItem)throw new m.Z("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if((0,j.w)(e.portalItem),e.portalItem.type!==J)throw new m.Z("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${J}"`);yield e._ensureLoadBeforeSave();const s=(0,T.Y)(e.portalItem,"portal-item",!0),a={layers:[e.write({},s)]};return yield Promise.all(s.resources.pendingOperations??[]),yield e._validateAgainstJSONSchema(a,s,t),e.url&&(e.portalItem.url=e.url),e.portalItem.title||(e.portalItem.title=e.title),W(e.portalItem,t,$.existingItem),yield(0,B.b)(e.portalItem,a,e.resourceReferences,s),(0,d.D)(s),e.portalItem})()}_validateAgainstJSONSchema(n,e,t){var s=this;return(0,c.Z)(function*(){const a=t?.validationOptions;(0,A.z)(e,{errorName:"sceneservice:save"},{ignoreUnsupported:a?.ignoreUnsupported,supplementalUnsupportedErrors:["scenemodification:unsupported"]});const K=a?.enabled,F=null;if(K&&F){const G=(yield F()).validate(n,t.portalItemLayerType);if(!G.length)return;const Q=`Layer item did not validate:\n${G.join("\n")}`;if(g.Z.getLogger(s).error(`_validateAgainstJSONSchema(): ${Q}`),"throw"===a.failPolicy){const X=G.map(k=>new m.Z("sceneservice:schema-validation",k));throw new m.Z("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{validationErrors:X})}}})()}};return(0,i._)([(0,u.Cb)(M.id)],h.prototype,"id",void 0),(0,i._)([(0,u.Cb)({type:y.Z})],h.prototype,"spatialReference",void 0),(0,i._)([(0,S.r)("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],h.prototype,"readSpatialReference",null),(0,i._)([(0,u.Cb)({type:f.Z})],h.prototype,"fullExtent",void 0),(0,i._)([(0,S.r)("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],h.prototype,"readFullExtent",null),(0,i._)([(0,u.Cb)({readOnly:!0,type:O.Z})],h.prototype,"heightModelInfo",void 0),(0,i._)([(0,u.Cb)({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],h.prototype,"minScale",void 0),(0,i._)([(0,u.Cb)({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],h.prototype,"maxScale",void 0),(0,i._)([(0,u.Cb)({readOnly:!0})],h.prototype,"version",void 0),(0,i._)([(0,S.r)("version",["store.version"])],h.prototype,"readVersion",null),(0,i._)([(0,u.Cb)({type:String,json:{read:{source:"copyrightText"}}})],h.prototype,"copyright",void 0),(0,i._)([(0,u.Cb)({type:String,json:{read:!1}})],h.prototype,"sublayerTitleMode",void 0),(0,i._)([(0,u.Cb)({type:String})],h.prototype,"title",void 0),(0,i._)([(0,S.r)("portal-item","title")],h.prototype,"readTitlePortalItem",null),(0,i._)([(0,S.r)("service","title",["name"])],h.prototype,"readTitleService",null),(0,i._)([(0,u.Cb)({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],h.prototype,"layerId",void 0),(0,i._)([(0,u.Cb)(M.HQ)],h.prototype,"url",null),(0,i._)([(0,Z.c)("url")],h.prototype,"writeUrl",null),(0,i._)([(0,u.Cb)()],h.prototype,"parsedUrl",null),(0,i._)([(0,u.Cb)({readOnly:!0})],h.prototype,"store",void 0),(0,i._)([(0,u.Cb)({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],h.prototype,"rootNode",void 0),h=(0,i._)([(0,D.j)("esri.layers.mixins.SceneService")],h),h},L=-1e38;function N(v){if(null!=v.spatialReference)return y.Z.fromJSON(v.spatialReference);const h=v.store,n=h.indexCRS||h.geographicCRS,e=n&&parseInt(n.substring(n.lastIndexOf("/")+1,n.length),10);return null!=e?new y.Z(e):null}function W(v,h,n){v.typeKeywords||(v.typeKeywords=[]);const e=h.getTypeKeywords();for(const t of e)v.typeKeywords.push(t);v.typeKeywords&&(v.typeKeywords=v.typeKeywords.filter((t,s,a)=>a.indexOf(t)===s),n===$.newItem&&(v.typeKeywords=v.typeKeywords.filter(t=>"Hosted Service"!==t)))}var $,v;(v=$||($={}))[v.existingItem=0]="existingItem",v[v.newItem=1]="newItem";const J="Scene Service",Y={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var H;!function(v){v[v.SAVE=0]="SAVE",v[v.SAVE_AS=1]="SAVE_AS"}(H||(H={}))},7741:(z,w,r)=>{r.d(w,{T:()=>m});var c=r(15861),i=r(66476),P=r(57964);function m(_,x,u,U,I,S,D){return g.apply(this,arguments)}function g(){return(g=(0,c.Z)(function*(_,x,u,U,I,S,D){let Z=null;if(null!=u){const y=`${_}/nodepages/`,b=y+Math.floor(u.rootIndex/u.nodesPerPage);try{return{type:"page",rootPage:(yield(0,i.Z)(b,{query:{f:"json",...U,token:I},responseType:"json",signal:D})).data,rootIndex:u.rootIndex,pageSize:u.nodesPerPage,lodMetric:u.lodSelectionMetricType,urlPrefix:y}}catch(M){S?.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",b,M),Z=M}}if(!x)return null;const d=x?.split("/").pop(),f=`${_}/nodes/`,O=f+d;try{return{type:"node",rootNode:(yield(0,i.Z)(O,{query:{f:"json",...U,token:I},responseType:"json",signal:D})).data,urlPrefix:f}}catch(y){throw new P.Z("sceneservice:root-node-missing","Root node missing.",{pageError:Z,nodeError:y,url:O})}})).apply(this,arguments)}},453:(z,w,r)=>{r.d(w,{Y:()=>m,h:()=>P});var c=r(6785),i=r(61018);function P(_,x){return{...g(_,x),readResourcePaths:[]}}function m(_,x,u){const U=(0,c.mN)(_.itemUrl);return{...g(_,x),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:U?{rootPath:U.path,writtenUrls:[]}:null,resources:u?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function g(_,x){return{origin:x,url:(0,c.mN)(_.itemUrl),portal:_.portal||i.Z.getDefault(),portalItem:_}}},5251:(z,w,r)=>{r.r(w),r.d(w,{addOrUpdateResources:()=>x,contentToBlob:()=>O,fetchResources:()=>g,getSiblingOfSameType:()=>b,getSiblingOfSameTypeI:()=>M,removeAllResources:()=>S,removeResource:()=>U,splitPrefixFileNameAndExtension:()=>d});var c=r(15861),i=r(66476),P=r(57964),m=r(6785);function g(o){return _.apply(this,arguments)}function _(){return(_=(0,c.Z)(function*(o,p={},E){yield o.load(E);const R=(0,m.v_)(o.itemUrl,"resources"),{start:C=1,num:l=10,sortOrder:T="asc",sortField:B="resource"}=p,j={query:{start:C,num:l,sortOrder:T,sortField:B,token:o.apiKey},signal:E?.signal},A=yield o.portal.request(R,j);return{total:A.total,nextStart:A.nextStart,resources:A.resources.map(({created:V,size:L,resource:N})=>({created:new Date(V),size:L,resource:o.resourceFromPath(N)}))}})).apply(this,arguments)}function x(o,p,E,R){return u.apply(this,arguments)}function u(){return(u=(0,c.Z)(function*(o,p,E,R){const C=new Map;for(const{resource:T,content:B,compress:j,access:A}of p){if(!T.hasPath())throw new P.Z(`portal-item-resource-${E}:invalid-path`,"Resource does not have a valid path");const[V,L]=Z(T.path),N=`${V}/${j??""}/${A??""}`;C.has(N)||C.set(N,{prefix:V,compress:j,access:A,files:[]}),C.get(N).files.push({fileName:L,content:B})}yield o.load(R);const l=(0,m.v_)(o.userItemUrl,"add"===E?"addResources":"updateResources");for(const{prefix:T,compress:B,access:j,files:A}of C.values())for(let L=0;L<A.length;L+=25){const N=A.slice(L,L+25),W=new FormData;T&&"."!==T&&W.append("resourcesPrefix",T),B&&W.append("compress","true"),j&&W.append("access",j);let $=0;for(const{fileName:J,content:Y}of N)W.append("file"+ ++$,Y,J);W.append("f","json"),yield o.portal.request(l,{method:"post",body:W,signal:R?.signal})}})).apply(this,arguments)}function U(o,p,E){return I.apply(this,arguments)}function I(){return(I=(0,c.Z)(function*(o,p,E){if(!p.hasPath())throw new P.Z("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield o.load(E);const R=(0,m.v_)(o.userItemUrl,"removeResources");yield o.portal.request(R,{method:"post",query:{resource:p.path},signal:E?.signal}),p.portalItem=null})).apply(this,arguments)}function S(o,p){return D.apply(this,arguments)}function D(){return(D=(0,c.Z)(function*(o,p){yield o.load(p);const E=(0,m.v_)(o.userItemUrl,"removeResources");return o.portal.request(E,{method:"post",query:{deleteAll:!0},signal:p?.signal})})).apply(this,arguments)}function Z(o){const p=o.lastIndexOf("/");return-1===p?[".",o]:[o.slice(0,p),o.slice(p+1)]}function d(o){const[p,E]=function f(o){const p=(0,m.Ml)(o);return null==p?[o,""]:[o.slice(0,o.length-p.length-1),`.${p}`]}(o),[R,C]=Z(p);return[R,C,E]}function O(o){return y.apply(this,arguments)}function y(){return(y=(0,c.Z)(function*(o){return"blob"===o.type?o.blob:"json"===o.type?new Blob([o.jsonString],{type:"application/json"}):(yield(0,i.Z)(o.url,{responseType:"blob"})).data})).apply(this,arguments)}function b(o,p){if(!o.hasPath())return null;const[E,,R]=d(o.path);return o.portalItem.resourceFromPath((0,m.v_)(E,p+R))}function M(o,p){if(!o.hasPath())return null;const[E,,R]=d(o.path);return o.portalItem.resourceFromPath((0,m.v_)(E,p+R))}},89055:(z,w,r)=>{r.d(w,{H:()=>_,b:()=>u});var c=r(15861),i=r(57964),P=r(79412),m=r(19986),g=r(5251);function _(d,f,O){return x.apply(this,arguments)}function x(){return(x=(0,c.Z)(function*(d,f,O){const y=yield I(d,f,O);yield D(y,f,O)})).apply(this,arguments)}function u(d,f,O,y,b){return U.apply(this,arguments)}function U(){return(U=(0,c.Z)(function*(d,f,O,y,b){const M=yield I(O,y,b);yield d.update({data:f}),yield D(M,y,b)})).apply(this,arguments)}function I(d,f,O){return S.apply(this,arguments)}function S(){return(S=(0,c.Z)(function*(d,f,O){if(!f?.resources)return;const y=f.portalItem===d.portalItem?new Set(d.paths):new Set;d.paths.length=0,d.portalItem=f.portalItem;const b=new Set(f.resources.toKeep.map(l=>l.resource.path)),M=new Set,o=[];b.forEach(l=>{y.delete(l),d.paths.push(l)});const p=[],E=[],R=[];for(const l of f.resources.toUpdate)if(y.delete(l.resource.path),b.has(l.resource.path)||M.has(l.resource.path)){const{resource:T,content:B,finish:j}=l,A=(0,g.getSiblingOfSameTypeI)(T,(0,m.DO)());d.paths.push(A.path),p.push({resource:A,content:yield(0,g.contentToBlob)(B),compress:l.compress}),j&&R.push(()=>j(A))}else{d.paths.push(l.resource.path),E.push({resource:l.resource,content:yield(0,g.contentToBlob)(l.content),compress:l.compress});const T=l.finish;T&&R.push(()=>T(l.resource)),M.add(l.resource.path)}for(const l of f.resources.toAdd)if(d.paths.push(l.resource.path),y.has(l.resource.path))y.delete(l.resource.path);else{p.push({resource:l.resource,content:yield(0,g.contentToBlob)(l.content),compress:l.compress});const T=l.finish;T&&R.push(()=>T(l.resource))}if(p.length||E.length){const{addOrUpdateResources:l}=yield Promise.resolve().then(r.bind(r,5251));yield l(f.portalItem,p,"add",O),yield l(f.portalItem,E,"update",O)}if(R.forEach(l=>l()),0===o.length)return y;const C=yield(0,P.UO)(o);if((0,P.k_)(O),C.length>0)throw new i.Z("save:resources","Failed to save one or more resources",{errors:C});return y})).apply(this,arguments)}function D(d,f,O){return Z.apply(this,arguments)}function Z(){return(Z=(0,c.Z)(function*(d,f,O){if(!d||!f.portalItem)return;const y=[];for(const b of d){const M=f.portalItem.resourceFromPath(b);y.push(M.portalItem.removeResource(M,O))}yield(0,P.as)(y)})).apply(this,arguments)}},88911:(z,w,r)=>{r.d(w,{w:()=>m});var c=r(11931),i=r(57964),P=r(40907);function m(g){if(c.default.apiKey&&(0,P.r)(g.portal.url))throw new i.Z("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${g.portal.url} when using an api key`)}},46018:(z,w,r)=>{r.d(w,{P:()=>P,z:()=>_});var c=r(15861),i=r(57964);function P(x){return m.apply(this,arguments)}function m(){return(m=(0,c.Z)(function*(x){const u=[];for(const U of x.allLayers)if("beforeSave"in U&&"function"==typeof U.beforeSave){const I=U.beforeSave();I&&u.push(I)}yield Promise.allSettled(u)})).apply(this,arguments)}const g=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function _(x,u,U){let I=(x.messages??[]).filter(({type:S})=>"error"===S).map(({name:S,message:D,details:Z})=>new i.Z(S,D,Z));if(x.blockedRelativeUrls&&(I=I.concat(x.blockedRelativeUrls.map(S=>new i.Z("url:unsupported",`Relative url '${S}' is not supported`)))),U){const{ignoreUnsupported:S,supplementalUnsupportedErrors:D=[],requiredPropertyChecksDisabled:Z}=U;S&&(I=I.filter(({name:d})=>!(g.has(d)||D.includes(d)))),Z&&(I=I.filter(d=>"web-document-write:property-required"!==d.name))}if(I.length>0)throw new i.Z(u.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:I})}}}]);