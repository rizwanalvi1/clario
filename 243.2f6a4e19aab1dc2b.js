"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[243],{52540:(I,M,t)=>{t.d(M,{z:()=>E});var a=t(39921);class E{constructor(p,m){this._storage=new a.WJ,this.id="",this.name="",this.size=0,this._storage.maxSize=p,this._storage.register(this),m&&this._storage.registerRemoveFunc("",m)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(p,m,f=1){this._storage.put(this,p,m,f,1)}pop(p){return this._storage.pop(this,p)}get(p){return this._storage.get(this,p)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(p){this._storage.maxSize=p}resetHitRate(){}}},39921:(I,M,t)=>{t.d(M,{WJ:()=>f,Xq:()=>m});var p,d,a=t(43029);(d=p||(p={}))[d.ALL=0]="ALL",d[d.SOME=1]="SOME";class m{constructor(s,e,i){this.name=s,this._storage=e,this.id=g+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),i&&(this._storage.registerRemoveFunc(this.id,i),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(s){return this._storage.getSize(this,s)}resetHitRate(){this._hit=this._miss=0}put(s,e,i,l=0){this._storage.put(this,s,e,i,l)}pop(s){const e=this._storage.pop(this,s);return void 0===e?++this._miss:++this._hit,e}get(s){const e=this._storage.get(this,s);return void 0===e?++this._miss:++this._hit,e}peek(s){return this._storage.peek(this,s)}updateSize(s,e,i){this._storage.updateSize(this,s,e,i)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class f{get size(){return this._size}constructor(s=10485760){this._maxSize=s,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new a.Z,this._users=new a.Z}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(s){this._users.push(s)}deregister(s){this._users.removeUnordered(s)}registerRemoveFunc(s,e){this._removeFuncs.push([s,e])}deregisterRemoveFunc(s){this._removeFuncs.filterInPlace(e=>e[0]!==s)}get maxSize(){return this._maxSize}set maxSize(s){this._maxSize=Math.max(s,-1),this._checkSize()}getSize(s,e){return this._db.get(s.id+e)?.size??0}put(s,e,i,l,h){const n=this._db.get(e=s.id+e);if(n&&(this._size-=n.size,s.size-=n.size,this._db.delete(e),n.entry!==i&&this._notifyRemove(e,n.entry,n.size,p.ALL)),l>this._maxSize)return void this._notifyRemove(e,i,l,p.ALL);if(void 0===i)return void console.warn("Refusing to cache undefined entry ");if(!l||l<0)return console.warn(`Refusing to cache entry with size ${l} for key ${e}`),void this._notifyRemove(e,i,0,p.ALL);const v=1+Math.max(h,-4)- -3;this._db.set(e,new y(i,l,v)),this._size+=l,s.size+=l,this._checkSize()}updateSize(s,e,i,l){const h=this._db.get(e=s.id+e);if(h&&h.entry===i){for(this._size-=h.size,s.size-=h.size;l>this._maxSize;){const n=this._notifyRemove(e,i,l,p.SOME);if(!(null!=n&&n>0))return void this._db.delete(e);l=n}h.size=l,this._size+=l,s.size+=l,this._checkSize()}}pop(s,e){const i=this._db.get(e=s.id+e);if(i)return this._size-=i.size,s.size-=i.size,this._db.delete(e),++this._hit,i.entry;++this._miss}get(s,e){const i=this._db.get(e=s.id+e);if(void 0!==i)return this._db.delete(e),i.lives=i.lifetime,this._db.set(e,i),++this._hit,i.entry;++this._miss}peek(s,e){const i=this._db.get(s.id+e);return i?++this._hit:++this._miss,i?.entry}get performanceInfo(){const s={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},e={},i=new Array;this._db.forEach((n,v)=>{const P=n.lifetime;i[P]=(i[P]||0)+n.size,this._users.forAll(T=>{const{id:C,name:R}=T;v.startsWith(C)&&(e[R]=(e[R]||0)+n.size)})});const l={};this._users.forAll(n=>{const v=n.name;"hitRate"in n&&"number"==typeof n.hitRate&&!isNaN(n.hitRate)&&n.hitRate>0?(e[v]=e[v]||0,l[v]=Math.round(100*n.hitRate)+"%"):l[v]="0%"});const h=Object.keys(e);h.sort((n,v)=>e[v]-e[n]),h.forEach(n=>s[n]=Math.round(e[n]/2**20)+"MB / "+l[n]);for(let n=i.length-1;n>=0;--n){const v=i[n];v&&(s["Priority "+(n+-3-1)]=Math.round(v/this._size*100)+"%")}return s}resetStats(){this._hit=this._miss=0,this._users.forAll(s=>s.resetHitRate())}clear(s){const e=s.id;this._db.forEach((i,l)=>{l.startsWith(e)&&(this._size-=i.size,this._db.delete(l),this._notifyRemove(l,i.entry,i.size,p.ALL))}),s.size=0}clearAll(){this._db.forEach((s,e)=>this._notifyRemove(e,s.entry,s.size,p.ALL)),this._users.forAll(s=>s.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(s,e,i,l){let h;return this._removeFuncs.some(n=>{if(s.startsWith(n[0])){const v=n[1](e,l,i);return"number"==typeof v&&(h=v),!0}return!1}),h}_checkSize(){this._users.forAll(s=>this._checkSizeLimits(s)),this._checkSizeLimits()}_checkSizeLimits(s){const e=s??this;if(e.maxSize<0||e.size<=e.maxSize)return;const i=s?.id;let l=!0;for(;l;){l=!1;for(const[h,n]of this._db)if(0===n.lifetime&&(!i||h.startsWith(i))){if(this._purgeItem(h,n,s),e.size<=.9*e.maxSize)return;l||=this._db.has(h)}}for(const[h,n]of this._db)if((!i||h.startsWith(i))&&(this._purgeItem(h,n,s),e.size<=.9*e.maxSize))return}_purgeItem(s,e,i=this._users.find(l=>s.startsWith(l.id))){if(this._db.delete(s),e.lives<=1){this._size-=e.size,i&&(i.size-=e.size);const l=this._notifyRemove(s,e.entry,e.size,p.SOME);null!=l&&l>0&&(this._size+=l,i&&(i.size+=l),e.lives=e.lifetime,e.size=l,this._db.set(s,e))}else--e.lives,this._db.set(s,e)}}let g=0;class y{constructor(s,e,i){this.entry=s,this.size=e,this.lifetime=i,this.lives=i}}},38519:(I,M,t)=>{function a(){return[1,0,0,0,1,0,0,0,1]}function O(g,y,d,s,e,i,l,h,n){return[g,y,d,s,e,i,l,h,n]}t.d(M,{Ue:()=>a,Wd:()=>m,al:()=>O});const m=[1,0,0,0,1,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:m,clone:function E(g){return[g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],g[8]]},create:a,createView:function p(g,y){return new Float64Array(g,y,9)},fromValues:O},Symbol.toStringTag,{value:"Module"}))},96043:(I,M,t)=>{t.d(M,{AJ:()=>g,If:()=>s,k0:()=>f,uI:()=>d,ul:()=>m,wx:()=>e});var a=t(55117),E=t(55768),O=t(5710),p=t(23515);const m=2.4;function f(i){return(0,E.Wz)(i*m)}function g(i){return(0,E.F2)(i)/m}function y(i,l,h,n){let{color:v,ratio:P}=l,{color:T,ratio:C}=h;C===P&&(1===C?P-=1e-6:C+=1e-6);const R=(0,a.uZ)((n-P)/(C-P),0,1);(0,O.l)(i,v.toArray(),T.toArray(),R)}function d(i){const h=new Uint8ClampedArray(2048);if((i=i.filter(({ratio:C})=>C>=0&&C<=1).sort((C,R)=>C.ratio-R.ratio).map(({color:C,ratio:R})=>({color:C,ratio:Math.max(R,.001)}))).length<1)return h;let n=i[0],v=i[0],P=1;const T=(0,p.Ue)();for(let C=0;C<512;C++){const R=(C+.5)/512;for(;R>v.ratio&&P<i.length;)n=v,v=i[P++];y(T,n,v,R),h.set(T,4*C)}return h}function s(i,l,h){const n=Math.sqrt(i**2+l**2)/h;return n>1?0:3/(Math.PI*h**2)*(1-n**2)**2}function e(i){return"function"==typeof i?i:i?l=>+l[i]:()=>1}},46988:(I,M,t)=>{t.d(M,{c:()=>O,f:()=>E});var a=t(72578);function E(f,g){let y;if("string"==typeof f)y=(0,a.hP)(f+`-seed(${g})`);else{let d=12;y=f^g;do{y=107*(y>>8^y)+d|0}while(0!=--d)}return(1+y/(1<<31))/2}function O(f){return Math.floor(E(f,p)*m)}const p=53290320,m=10},83124:(I,M,t)=>{t.d(M,{y:()=>k});var h,a=t(50484),E=t(83944),O=t(18626),p=t(57964),m=t(77675),f=t(80543),s=(t(14007),t(4703),t(65311),t(10141)),e=t(85338),i=t(30640),l=t(38954);let n=h=class extends l.Z{constructor(K){super(K),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new h({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}};(0,a._)([(0,f.Cb)({type:[Number,String],json:{write:!0}})],n.prototype,"left",void 0),(0,a._)([(0,f.Cb)({type:[Number,String],json:{write:!0}})],n.prototype,"right",void 0),(0,a._)([(0,f.Cb)({type:[Number,String],json:{write:!0}})],n.prototype,"top",void 0),(0,a._)([(0,f.Cb)({type:[Number,String],json:{write:!0}})],n.prototype,"bottom",void 0),n=h=(0,a._)([(0,s.j)("esri.views.layers.support.ClipRect")],n);const v=n;var P=t(87265);let T=class extends l.Z{constructor(K){super(K),this.type="path",this.path=[]}commitVersionProperties(){this.commitProperty("path")}};(0,a._)([(0,f.Cb)({type:[[[Number]]],json:{write:!0}})],T.prototype,"path",void 0),T=(0,a._)([(0,s.j)("esri.views.layers.support.Path")],T);const C=T;var R=t(64579);const j=E.Z.ofType({key:"type",base:null,typeMap:{rect:v,path:C,geometry:P.Z}}),k=K=>{let z=class extends K{constructor(){super(...arguments),this.attached=!1,this.clips=new j,this.highlightOptions=null,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1,this._visibleAtCurrentScale=!0}initialize(){const A=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&A&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new p.Z("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new e.W),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([(0,m.YP)(()=>this.suspended,D=>{this.container&&(this.container.visible=!D)},m.tX),(0,m.YP)(()=>this.updateSuspended,D=>{this.view&&!D&&this.updateRequested&&this.view.requestUpdate()},m.tX),(0,m.YP)(()=>this.layer?.opacity??1,D=>{this.container&&(this.container.opacity=D)},m.tX),(0,m.YP)(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",D=>{this.container&&(this.container.blendMode=D)},m.tX),(0,m.YP)(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,D=>{this.container&&(this.container.effect=D)},m.tX),(0,m.YP)(()=>this.highlightOptions,D=>this.container.highlightOptions=D,m.tX),(0,m.on)(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)},m.tX),(0,m.YP)(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:D,scaleRange:$})=>{const b=(0,R.GB)($,D);b!==this._visibleAtCurrentScale&&(this._visibleAtCurrentScale=b)},m.tX)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(D=>{D===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach(),this.updateRequested=!1}get spatialReferenceSupported(){const A=this.view?.spatialReference;return null==A||this.supportsSpatialReference(A)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating)}get visibleAtCurrentScale(){return this._visibleAtCurrentScale}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(A){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",A),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(A))):this.updateRequested=!1}hitTest(A,V){return Promise.resolve(null)}supportsSpatialReference(A){return!0}canResume(){return!!this.spatialReferenceSupported&&!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const A=super.getSuspendInfo(),V=!this.spatialReferenceSupported;return V&&(A.spatialReferenceNotSupported=V),A}addAttachHandles(A){this.addHandles(A,"attach")}};return(0,a._)([(0,f.Cb)()],z.prototype,"attached",void 0),(0,a._)([(0,f.Cb)({type:j,set(A){const V=(0,O.Z)(A,this._get("clips"),j);this._set("clips",V)}})],z.prototype,"clips",void 0),(0,a._)([(0,f.Cb)()],z.prototype,"container",void 0),(0,a._)([(0,f.Cb)({type:i.Z})],z.prototype,"highlightOptions",void 0),(0,a._)([(0,f.Cb)()],z.prototype,"moving",void 0),(0,a._)([(0,f.Cb)({readOnly:!0})],z.prototype,"spatialReferenceSupported",null),(0,a._)([(0,f.Cb)({readOnly:!0})],z.prototype,"updateParameters",void 0),(0,a._)([(0,f.Cb)()],z.prototype,"updateRequested",void 0),(0,a._)([(0,f.Cb)()],z.prototype,"updating",null),(0,a._)([(0,f.Cb)()],z.prototype,"view",void 0),(0,a._)([(0,f.Cb)()],z.prototype,"_visibleAtCurrentScale",void 0),(0,a._)([(0,f.Cb)({readOnly:!0})],z.prototype,"visibleAtCurrentScale",null),z=(0,a._)([(0,s.j)("esri.views.2d.layers.LayerView2D")],z),z}},95815:(I,M,t)=>{t.r(M),t.d(M,{default:()=>Tt});var a=t(15861),E=t(50484),h=(t(2189),t(35458),t(36699),t(12610),t(53722),t(82752),t(28999),t(38748),t(50923),t(42212),t(91963),t(4703)),v=(t(71950),t(83944)),T=(t(14007),t(8611)),C=t(79412),R=t(77675),j=t(80543),K=(t(65311),t(10141)),z=t(45425),A=t(5825),V=t(26230),D=t(46687),$=t(57964),at=(t(66679),t(6210),t(70794),t(11931),t(14890),t(26894)),w=(t(32184),t(12628),t(44107),t(5391),t(64222),t(48621),t(33721),t(80247),t(77442),t(99586),t(71691),t(92328),t(57876),t(16584),t(4322),t(50765),t(91522),t(76929),t(86740),t(78586),t(52153),t(25065),t(81961),t(18436),t(34949),t(40321),t(11196)),N=(t(55117),t(99657),t(93266),t(13948),t(26981),t(69411),t(11462),t(54786),t(88278),t(31043),t(43101),t(15585),t(2376),t(35208),t(39237)),q=(t(83018),t(94544),t(3380),t(17091)),lt=(t(36895),t(40176),t(87879),t(32087),t(32398),t(10264),t(34406),t(71960),t(59078),t(17866),t(59319),t(66476),t(6785),t(40485),t(23783),t(8735),t(7081),t(34317),t(75399),t(11223),t(62693),t(78426),t(20325),t(69794),t(10659),t(34501),t(23990),t(27048),t(66599),t(26372),t(98201),t(36397),t(82758),t(79484),t(89877),t(53299),t(90771),t(47403),t(37348),t(4460),t(79144),t(23991),t(43814),t(82301),t(26152),t(46266),t(37636),t(90110),t(6016),t(6777),t(54529),t(87766)),ht=t(40394),dt=t(90984),_=t(51172),ct=t(12933),vt=t(38519),ut=t(29726),mt=t(89014),yt=t(64456),ft=t(23306),tt=t(39853),pt=t(22784),gt=t(46682);const Et=[1,1],H=(0,vt.Ue)(),Pt={none:w.of.None,loop:w.of.Loop,oscillate:w.of.Oscillate};class Ct extends yt.s{constructor(r){super(),this.elementView=r,this.isWrapAround=!1,this.wrapAroundShift=0,this.perspectiveTransform=(0,mt.Ue)(),this._playHandle=null,this._vertices=new Float32Array(20),this._handles=[],this._handles.push((0,R.YP)(()=>this.elementView.element.opacity,c=>this.opacity=c,R.nn),(0,R.YP)(()=>[this.elementView.coords],()=>{this.requestRender()},R.nn),(0,R.YP)(()=>["animationOptions"in this.elementView.element&&this.elementView.element.animationOptions],()=>{this._playHandle?.remove(),this.texture=(0,_.M2)(this.texture),this.requestRender()},R.nn),(0,R.gx)(()=>this.elementView.element.loaded,()=>{const c=this.elementView.element;this.ready(),"video"===c.type&&null!=c.content&&this._handles.push((0,dt.on)(c.content,"play",()=>this.requestRender()))},R.nn)),r.element.load().catch(c=>{h.Z.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new $.Z("element-load-error","Element cannot be displayed",{element:r,error:c}))})}getMesh(r){throw new Error("Method not implemented.")}destroy(){this._playHandle?.remove(),this._handles.forEach(r=>r.remove()),this.texture=(0,_.M2)(this.texture)}get textureSize(){return Et}get dvsMat3(){return this.parent.dvsMat3}beforeRender(r){const{context:c}=r,u=this.elementView.element.content;if(null!=u){const S=u instanceof HTMLImageElement,x=u instanceof HTMLVideoElement,L=S?u.naturalWidth:x?u.videoWidth:u.width,U=S?u.naturalHeight:x?u.videoHeight:u.height;if(this._updatePerspectiveTransform(L,U),this.texture)x&&!u.paused&&(this.texture.setData(u),this.requestRender(),this.texture.generateMipmap());else{const B=new pt.X;if(B.wrapMode=N.e8.CLAMP_TO_EDGE,B.preMultiplyAlpha=!0,B.width=L,B.height=U,"getFrame"in u){const Y=F=>{this.texture?this.texture.setData(F):this.texture=new q.x(c,B,F),this.requestRender()};"animationOptions"in this.elementView.element&&(this._playHandle=(0,ft.hY)(u,function Mt(o){return o?{...o,playAnimation:o.playing,repeatType:o.repeatType?Pt[o.repeatType]:void 0}:{}}(this.elementView.element.animationOptions),null,Y))}else this.texture=new q.x(c,B,u);this.texture.generateMipmap(),x&&!u.paused&&this.requestRender()}}super.beforeRender(r)}_createTransforms(){return null}draw(r){r.drawArrays(N.MX.TRIANGLE_STRIP,0,4)}updateDrawCoords(r,c,u,S){const{coords:x,bounds:L}=this.elementView;if(null==x||null==L)return;const[U,B,Y,F]=x.rings[0],zt=this._vertices,{x:X,y:Q}=r;zt.set([B[0]-X,B[1]-Q,U[0]-X,U[1]-Q,Y[0]-X,Y[1]-Q,F[0]-X,F[1]-Q]);let J=c;if(S){const[st,,it]=L,{worldWidth:rt,xBounds:Lt}=S,[nt,ot]=Lt;st<nt&&it>nt?J=rt:it>ot&&st<ot&&(J=-rt)}this.wrapAroundShift=J,this.isWrapAround=0!==J}getVAO(r,c,u){if(null==this.elementView.coords)return null;const S=this._vertices;if(this._vao)this._geometryVbo.setData(S);else{this._geometryVbo=tt.f.createVertex(r,N.l1.DYNAMIC_DRAW,S);const x=tt.f.createVertex(r,N.l1.STATIC_DRAW,new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1]));this._vao=new gt.U(r,u,c,{geometry:this._geometryVbo,tex:x})}return this._vao}_updatePerspectiveTransform(r,c){const u=this._vertices;(0,ct.E)(H,[0,0,r,0,0,c,r,c],[u[0],u[1],u[4],u[5],u[2],u[3],u[6],u[7]]),(0,ut.t8)(this.perspectiveTransform,H[6]/H[8]*r,H[7]/H[8]*c)}}var St=t(85460),Ot=t(83124),At=t(50145);let G=class extends((0,Ot.y)(At.Z)){constructor(){super(...arguments),this._overlayContainer=null,this._fetchQueue=null,this._tileStrategy=null,this._elementReferences=new Map,this._debugGraphicsView=null,this.layer=null,this.elements=new v.Z}attach(){this.addAttachHandles([(0,R.on)(()=>this.layer.effectiveSource,"refresh",()=>{this._tileStrategy.refresh(o=>this._updateTile(o)),this.requestUpdate()}),(0,R.on)(()=>this.layer.effectiveSource,"change",({element:o})=>this._elementUpdateHandler(o))]),this._overlayContainer=new St.Z,this.container.addChild(this._overlayContainer),this._fetchQueue=new lt.Z({tileInfoView:this.view.featuresTilingScheme,concurrency:10,process:(o,r)=>this._queryElements(o,r)}),this._tileStrategy=new ht.Z({cachePolicy:"purge",resampling:!0,acquireTile:o=>this._acquireTile(o),releaseTile:o=>this._releaseTile(o),tileInfoView:this.view.featuresTilingScheme}),this.requestUpdate()}detach(){this.elements.removeAll(),this._tileStrategy.destroy(),this._fetchQueue.destroy(),this._overlayContainer.removeAllChildren(),this.container.removeAllChildren(),this._elementReferences.clear(),this._debugGraphicsView?.destroy()}supportsSpatialReference(o){return!0}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}update(o){this._tileStrategy.update(o),this._debugGraphicsView?.update(o)}hitTest(o,r){var c=this;return(0,a.Z)(function*(){const u=[],S=o.normalize(),x=[S.x,S.y];for(const{projectedElement:{normalizedCoords:L,element:U}}of c._elementReferences.values())null!=L&&(0,A.wP)(L.rings,x)&&u.push({type:"media",element:U,layer:c.layer,mapPoint:o,sourcePoint:U.toSource(o)});return u.reverse()})()}canResume(){return null!=this.layer.source&&super.canResume()}doRefresh(){var o=this;return(0,a.Z)(function*(){o._fetchQueue.reset(),o._tileStrategy.refresh(r=>o._updateTile(r))})()}_acquireTile(o){const r=new Dt(o.clone());return this._updateTile(r),r}_updateTile(o){this._updatingHandles.addPromise(this._fetchQueue.push(o.key).then(r=>{const[c,u]=o.setElements(r);this._referenceElements(o,c),this._dereferenceElements(o,u),this.requestUpdate()},r=>{(0,C.D_)(r)||h.Z.getLogger(this).error(r)}))}_releaseTile(o){this._fetchQueue.abort(o.key.id),o.elements&&this._dereferenceElements(o,o.elements),this.requestUpdate()}_queryElements(o,r){var c=this;return(0,a.Z)(function*(){const u=c.layer.effectiveSource;if(null==u)return[];c.view.featuresTilingScheme.getTileBounds(W,o,!0);const S=new at.Z({xmin:W[0],ymin:W[1],xmax:W[2],ymax:W[3],spatialReference:c.view.spatialReference});return u.queryElements(S,r)})()}_referenceElements(o,r){if(null!=this.layer.source)for(const c of r)this._referenceElement(o,c)}_referenceElement(o,r){(0,T.s1)(this._elementReferences,r.uid,()=>{const c=new D.L({element:r,spatialReference:this.view.spatialReference}),u=new Ct(c);return this._overlayContainer.addChild(u),this.elements.add(r),{tiles:new Set,projectedElement:c,overlay:u,debugGraphic:null}}).tiles.add(o)}_dereferenceElements(o,r){for(const c of r)this._dereferenceElement(o,c)}_dereferenceElement(o,r){const c=this._elementReferences.get(r.uid);c.tiles.delete(o),c.tiles.size||(this._overlayContainer.removeChild(c.overlay),c.overlay.destroy(),c.projectedElement.destroy(),this._elementReferences.delete(r.uid),this.elements.remove(r),this._debugGraphicsView?.graphics.remove(c.debugGraphic))}_elementUpdateHandler(o){let r=this._elementReferences.get(o.uid);if(r){const u=r.projectedElement.normalizedCoords;if(null==u)return this._overlayContainer.removeChild(r.overlay),r.overlay.destroy(),r.projectedElement.destroy(),this._elementReferences.delete(o.uid),this.elements.remove(o),void this._debugGraphicsView?.graphics.remove(r.debugGraphic);const S=[],x=[];for(const L of this._tileStrategy.tiles){const U=et(this.view.featuresTilingScheme,L,u);r.tiles.has(L)?U||x.push(L):U&&S.push(L)}for(const L of S)this._referenceElement(L,o);for(const L of x)this._dereferenceElement(L,o);return r=this._elementReferences.get(o.uid),void(r?.debugGraphic&&(r.debugGraphic.geometry=r.projectedElement.normalizedCoords,this._debugGraphicsView.graphicUpdateHandler({graphic:r.debugGraphic,property:"geometry"})))}const c=new D.L({element:o,spatialReference:this.view.spatialReference}).normalizedCoords;if(null!=c)for(const u of this._tileStrategy.tiles)et(this.view.featuresTilingScheme,u,c)&&this._referenceElement(u,o)}};(0,E._)([(0,j.Cb)()],G.prototype,"layer",void 0),(0,E._)([(0,j.Cb)({readOnly:!0})],G.prototype,"elements",void 0),G=(0,E._)([(0,K.j)("esri.views.2d.layers.MediaLayerView2D")],G);const W=(0,z.Ue)(),Z={xmin:0,ymin:0,xmax:0,ymax:0};function et(o,r,c){return o.getTileBounds(W,r.key,!0),Z.xmin=W[0],Z.ymin=W[1],Z.xmax=W[2],Z.ymax=W[3],(0,V.Nl)(Z,c)}class Dt{constructor(r){this.key=r,this.elements=null,this.isReady=!1,this.visible=!0}setElements(r){const c=[],u=new Set(this.elements);this.elements=r;for(const S of r)u.has(S)?u.delete(S):c.push(S);return this.isReady=!0,[c,Array.from(u)]}destroy(){}}const Tt=G},50145:(I,M,t)=>{t.d(M,{Z:()=>n});var a=t(50484),E=t(73514),O=t(88278),p=t(84373),m=t(4703),f=t(51172),g=t(47868),y=t(80543),e=(t(14007),t(65311),t(10141)),i=t(90110),l=t(64579);let h=class extends((0,p.IG)((0,g.v)(O.Z.EventedMixin(E.Z)))){constructor(v){super(v),this._updatingHandles=new i.R,this.layer=null,this.parent=null}initialize(){this.when().catch(v=>{if("layerview:create-error"!==v.name){const P=this.layer&&this.layer.id||"no id",T=this.layer?.title||"no title";m.Z.getLogger(this).error("#resolve()",`Failed to resolve layer view (layer title: '${T}', id: '${P}')`,v)}})}destroy(){this._updatingHandles=(0,f.SC)(this._updatingHandles)}get fullOpacity(){return(this.layer?.opacity??1)*(this.parent?.fullOpacity??1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this._updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){return!0===this.layer?.visible}set visible(v){this._overrideIfSome("visible",v)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){const v=this.view.timeExtent,P=this.layer?.visibilityTimeExtent;return!v||!P||!v.intersection(P).isEmpty}canResume(){const v=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&this.layer?.loaded&&!this.parent?.suspended&&this.view?.ready&&(0,l.Cy)(v)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){const v=this.parent?.suspended?this.parent.suspendInfo:{};return this.view?.ready||(v.viewNotReady=!0),this.layer&&this.layer.loaded||(v.layerNotLoaded=!0),(0,l.Cy)(this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null)&&this.visibleAtCurrentScale||(v.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(v.outsideVisibilityTimeExtent=!0),this.visible||(v.layerInvisible=!0),v}isUpdating(){return!1}};(0,a._)([(0,y.Cb)()],h.prototype,"view",void 0),(0,a._)([(0,y.Cb)()],h.prototype,"fullOpacity",null),(0,a._)([(0,y.Cb)()],h.prototype,"layer",void 0),(0,a._)([(0,y.Cb)()],h.prototype,"parent",void 0),(0,a._)([(0,y.Cb)({readOnly:!0})],h.prototype,"suspended",null),(0,a._)([(0,y.Cb)({readOnly:!0})],h.prototype,"suspendInfo",null),(0,a._)([(0,y.Cb)({readOnly:!0})],h.prototype,"legendEnabled",null),(0,a._)([(0,y.Cb)({type:Boolean,readOnly:!0})],h.prototype,"updating",null),(0,a._)([(0,y.Cb)({readOnly:!0})],h.prototype,"updatingProgress",null),(0,a._)([(0,y.Cb)()],h.prototype,"updateSuspended",null),(0,a._)([(0,y.Cb)()],h.prototype,"visible",null),(0,a._)([(0,y.Cb)({readOnly:!0})],h.prototype,"visibleAtCurrentScale",null),(0,a._)([(0,y.Cb)({readOnly:!0})],h.prototype,"visibleAtCurrentTimeExtent",null),h=(0,a._)([(0,e.j)("esri.views.layers.LayerView")],h);const n=h},38954:(I,M,t)=>{t.d(M,{Z:()=>d});var a=t(50484),E=t(89317),O=t(80543),g=(t(14007),t(4703),t(65311),t(10141));let y=class extends E.wq{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}};(0,a._)([(0,O.Cb)({readOnly:!0})],y.prototype,"version",null),y=(0,a._)([(0,g.j)("esri.views.layers.support.ClipArea")],y);const d=y},87265:(I,M,t)=>{t.d(M,{Z:()=>v});var l,a=t(50484),O=(t(2189),t(80543)),g=(t(14007),t(4703),t(65311),t(10141)),y=t(32184),d=t(40637),s=t(38954),e=t(26894),i=t(5391);const h={base:y.Z,key:"type",typeMap:{extent:e.Z,polygon:i.Z}};let n=l=class extends s.Z{constructor(P){super(P),this.type="geometry",this.geometry=null}clone(){return new l({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};(0,a._)([(0,O.Cb)({types:h,json:{read:d.im,write:!0}})],n.prototype,"geometry",void 0),n=l=(0,a._)([(0,g.j)("esri.views.layers.support.Geometry")],n);const v=n},64579:(I,M,t)=>{function a(d){return d&&"function"==typeof d.highlight}function p(d,s){if(s&&d){const{minScale:e,maxScale:i}=d;if(function m(d,s){return null!=d&&d>0||null!=s&&s>0}(e,i))return function O(d,s,e){return null==d||d>=e&&(0===s||d<=s)}(s,e,i)}return!0}function f(d){return!d?.minScale||!d.maxScale||d.minScale>=d.maxScale}t.d(M,{Cy:()=>f,GB:()=>p,tl:()=>a})}}]);