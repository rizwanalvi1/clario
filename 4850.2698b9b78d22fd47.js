"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[4850,318],{3233:(H,R,e)=>{e.d(R,{R:()=>d,w:()=>c});var f=e(50484),O=e(73514),C=e(44469),U=e(34222),p=e(60301);class S{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(p.v8),this._values=new Map,this.multipleOriginsSupported=!0}clone(r){const t=new S,s=this._originStores[p.s3.DEFAULTS];s&&s.forEach((i,u)=>{t.set(u,(0,U.d9)(i),p.s3.DEFAULTS)});for(let i=p.s3.SERVICE;i<p.v8;i++){const u=this._originStores[i];u&&u.forEach((g,E)=>{r&&r.has(E)||t.set(E,(0,U.d9)(g),i)})}return t}get(r,t){const s=void 0===t?this._values:this._originStores[t];return s?s.get(r):void 0}keys(r){const t=null==r?this._values:this._originStores[r];return t?[...t.keys()]:[]}set(r,t,s=p.s3.USER){let i=this._originStores[s];if(i||(i=new Map,this._originStores[s]=i),i.set(r,t),!this._values.has(r)||this._propertyOriginMap.get(r)<=s){const u=this._values.get(r);return this._values.set(r,t),this._propertyOriginMap.set(r,s),u!==t}return!1}delete(r,t=p.s3.USER){const s=this._originStores[t];if(!s)return;const i=s.get(r);if(s.delete(r),this._values.has(r)&&this._propertyOriginMap.get(r)===t){this._values.delete(r);for(let u=t-1;u>=0;u--){const g=this._originStores[u];if(g&&g.has(r)){this._values.set(r,g.get(r)),this._propertyOriginMap.set(r,u);break}}}return i}has(r,t){const s=void 0===t?this._values:this._originStores[t];return!!s&&s.has(r)}revert(r,t){for(;t>0&&!this.has(r,t);)--t;const s=this._originStores[t],i=s?.get(r),u=this._values.get(r);return this._values.set(r,i),this._propertyOriginMap.set(r,t),u!==i}originOf(r){return this._propertyOriginMap.get(r)||p.s3.DEFAULTS}forEach(r){this._values.forEach(r)}}var j=e(68090),M=e(49301),m=e(10141);const y=h=>{let r=class extends h{constructor(...t){super(...t);const s=(0,M.vw)(this),i=s.store,u=new S;s.store=u,(0,C.M)(s,i,u)}read(t,s){(0,j.i)(this,t,s)}getAtOrigin(t,s){const i=I(this),u=(0,p.M9)(s);if("string"==typeof t)return i.get(t,u);const g={};return t.forEach(E=>{g[E]=i.get(E,u)}),g}originOf(t){return(0,p.x3)(this.originIdOf(t))}originIdOf(t){return I(this).originOf(t)}revert(t,s){const i=I(this),u=(0,p.M9)(s),g=(0,M.vw)(this);let E;E="string"==typeof t?"*"===t?i.keys(u):[t]:t,E.forEach(a=>{g.invalidate(a),i.revert(a,u),g.commit(a)})}};return r=(0,f._)([(0,m.j)("esri.core.ReadOnlyMultiOriginJSONSupport")],r),r};function I(h){return(0,M.vw)(h).store}let v=class extends(y(O.Z)){};v=(0,f._)([(0,m.j)("esri.core.ReadOnlyMultiOriginJSONSupport")],v);var A=e(37718),D=e(82206);const L=h=>{let r=class extends h{constructor(...t){super(...t)}clear(t,s="user"){return _(this).delete(t,(0,p.M9)(s))}write(t,s){return(0,D.c)(this,t=t||{},s),t}setAtOrigin(t,s,i){(0,M.vw)(this).setAtOrigin(t,s,(0,p.M9)(i))}removeOrigin(t){const s=_(this),i=(0,p.M9)(t),u=s.keys(i);for(const g of u)s.originOf(g)===i&&s.set(g,s.get(g,i),p.s3.USER)}updateOrigin(t,s){const i=_(this),u=(0,p.M9)(s),g=(0,A.U2)(this,t);for(let E=u+1;E<p.v8;++E)i.delete(t,E);i.set(t,g,u)}toJSON(t){return this.write({},t)}};return r=(0,f._)([(0,m.j)("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],r),r.prototype.toJSON.isDefaultToJSON=!0,r};function _(h){return(0,M.vw)(h).store}const d=h=>{let r=class extends(L(y(h))){constructor(...t){super(...t)}};return r=(0,f._)([(0,m.j)("esri.core.MultiOriginJSONSupport")],r),r};let c=class extends(d(O.Z)){};c=(0,f._)([(0,m.j)("esri.core.MultiOriginJSONSupport")],c)},84850:(H,R,e)=>{e.r(R),e.d(R,{default:()=>A});var f=e(50484),O=e(57964),C=e(3233),U=e(66679),p=e(80543),m=(e(14007),e(4703),e(65311),e(10141)),y=e(95060),I=e(70509);let v=class extends((0,I.I)((0,C.R)(y.Z))){constructor(D){super(D),this.resourceInfo=null,this.type="unknown"}initialize(){this.addResolvingPromise(new Promise((D,L)=>{(0,U.Os)(()=>{const _=this.resourceInfo&&(this.resourceInfo.layerType||this.resourceInfo.type);let d="Unknown layer type";_&&(d+=" "+_),L(new O.Z("layer:unknown-layer-type",d,{layerType:_}))})}))}read(D,L){super.read({resourceInfo:D},L)}write(D,L){return null}};(0,f._)([(0,p.Cb)({readOnly:!0})],v.prototype,"resourceInfo",void 0),(0,f._)([(0,p.Cb)({type:["show","hide"]})],v.prototype,"listMode",void 0),(0,f._)([(0,p.Cb)({json:{read:!1},readOnly:!0,value:"unknown"})],v.prototype,"type",void 0),v=(0,f._)([(0,m.j)("esri.layers.UnknownLayer")],v);const A=v},70509:(H,R,e)=>{e.d(R,{I:()=>i});var f=e(15861),O=e(50484),C=e(11931),U=e(26152),p=e(66476),S=e(37636),j=e(57964),M=e(4703),m=e(51172),y=e(79412),I=e(6785),v=e(80543),L=(e(14007),e(65311),e(62185)),_=e(10141),d=e(7547),c=e(85971),h=e(61018),r=e(27835),t=e(57437),s=e(50318);const i=g=>{let E=class extends g{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,m.SC)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(a){a!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",a))}readPortalItem(a,o,n){if(o.itemId)return new r.default({id:o.itemId,portal:n?.portal})}writePortalItem(a,o){a?.id&&(o.itemId=a.id)}loadFromPortal(a,o){var n=this;return(0,f.Z)(function*(){if(n.portalItem?.id)try{const{load:l}=yield Promise.all([e.e(2772),e.e(8592),e.e(6964)]).then(e.bind(e,36964));return(0,y.k_)(o),yield l({instance:n,supportedTypes:a.supportedTypes,validateItem:a.validateItem,supportsData:a.supportsData,layerModuleTypeMap:a.layerModuleTypeMap},o)}catch(l){throw(0,y.D_)(l)||M.Z.getLogger(n).warn(`Failed to load layer (${n.title}, ${n.id}) portal item (${n.portalItem.id})\n  ${l}`),l}})()}finishLoadEditablePortalLayer(a){var o=this;return(0,f.Z)(function*(){o._set("userHasEditingPrivileges",yield o._fetchUserHasEditingPrivileges(a).catch(n=>((0,y.r9)(n),!0)))})()}setUserPrivileges(a,o){var n=this;return(0,f.Z)(function*(){if(!C.default.userPrivilegesApplied)return n.finishLoadEditablePortalLayer(o);if(n.url)try{const{features:{edit:l,fullEdit:T},content:{updateItem:P}}=yield n._fetchUserPrivileges(a,o);n._set("userHasEditingPrivileges",l),n._set("userHasFullEditingPrivileges",T),n._set("userHasUpdateItemPrivileges",P)}catch(l){(0,y.r9)(l)}})()}_fetchUserPrivileges(a,o){var n=this;return(0,f.Z)(function*(){let l=n.portalItem;if(!a||!l||!l.loaded||l.sourceUrl)return n._fetchFallbackUserPrivileges(o);const T=a===l.id;if(T&&l.portal.user)return(0,s.Ss)(l);let P,K;if(T)P=l.portal.url;else try{P=yield(0,c.oP)(n.url,o)}catch(B){(0,y.r9)(B)}if(!P||!(0,I.Zo)(P,l.portal.url))return n._fetchFallbackUserPrivileges(o);try{const B=null!=o?o.signal:null;K=yield U.id?.getCredential(`${P}/sharing`,{prompt:!1,signal:B})}catch(B){(0,y.r9)(B)}if(!K)return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}};try{if(T?yield l.reload():(l=new r.default({id:a,portal:{url:P}}),yield l.load(o)),l.portal.user)return(0,s.Ss)(l)}catch(B){(0,y.r9)(B)}return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}}})()}_fetchFallbackUserPrivileges(a){var o=this;return(0,f.Z)(function*(){let n=!0;try{n=yield o._fetchUserHasEditingPrivileges(a)}catch(l){(0,y.r9)(l)}return{features:{edit:n,fullEdit:!1},content:{updateItem:!1}}})()}_fetchUserHasEditingPrivileges(a){var o=this;return(0,f.Z)(function*(){const n=o.url?U.id?.findCredential(o.url):null;if(!n)return!0;const l=u.credential===n?u.user:yield o._fetchEditingUser(a);return u.credential=n,u.user=l,null==l?.privileges||l.privileges.includes("features:user:edit")})()}_fetchEditingUser(a){var o=this;return(0,f.Z)(function*(){const n=o.portalItem?.portal?.user;if(n)return n;const l=U.id?.findServerInfo(o.url??"");if(!l?.owningSystemUrl)return null;const T=`${l.owningSystemUrl}/sharing/rest`,P=h.Z.getDefault();if(P&&P.loaded&&(0,I.Fv)(P.restUrl)===(0,I.Fv)(T))return P.user;const K=`${T}/community/self`,Z=null!=a?a.signal:null,W=yield(0,S.q6)((0,p.Z)(K,{authMode:"no-prompt",query:{f:"json"},signal:Z}));return W.ok?t.Z.fromJSON(W.value.data):null})()}read(a,o){o&&(o.layer=this),super.read(a,o)}write(a,o){const n=o?.portal,l=this.portalItem?.id&&(this.portalItem.portal||h.Z.getDefault());return n&&l&&!(0,I.tm)(l.restUrl,n.restUrl)?(o.messages&&o.messages.push(new j.Z("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(a,{...o,layer:this})}};return(0,O._)([(0,v.Cb)({type:r.default})],E.prototype,"portalItem",null),(0,O._)([(0,L.r)("web-document","portalItem",["itemId"])],E.prototype,"readPortalItem",null),(0,O._)([(0,d.c)("web-document","portalItem",{itemId:{type:String}})],E.prototype,"writePortalItem",null),(0,O._)([(0,v.Cb)({clonable:!1})],E.prototype,"resourceReferences",void 0),(0,O._)([(0,v.Cb)({type:Boolean,readOnly:!0})],E.prototype,"userHasEditingPrivileges",void 0),(0,O._)([(0,v.Cb)({type:Boolean,readOnly:!0})],E.prototype,"userHasFullEditingPrivileges",void 0),(0,O._)([(0,v.Cb)({type:Boolean,readOnly:!0})],E.prototype,"userHasUpdateItemPrivileges",void 0),E=(0,O._)([(0,_.j)("esri.layers.mixins.PortalLayer")],E),E},u={credential:null,user:null}},50318:(H,R,e)=>{e.d(R,{$o:()=>v,Fj:()=>m,IW:()=>I,Ss:()=>L,_$:()=>M,ck:()=>y,hz:()=>D,qj:()=>j});var f=e(15861),O=e(83821),C=e(43814),U=e(48230);function S(){return(S=(0,f.Z)(function*(_){const d=_.spatialReference;if(d.isWGS84)return _.clone();if(d.isWebMercator)return(0,U.Sx)(_);const c=C.Z.WGS84;return yield(0,O.initializeProjection)(d,c),(0,O.project)(_,c)})).apply(this,arguments)}function j(_,d){if(!M(_,d)){const c=_.typeKeywords;c?c.push(d):_.typeKeywords=[d]}}function M(_,d){return!!_.typeKeywords?.includes(d)}function m(_){return M(_,D.HOSTED_SERVICE)}function y(_,d){const c=_.typeKeywords;if(c){const h=c.indexOf(d);h>-1&&c.splice(h,1)}}function I(_,d,c){c?j(_,d):y(_,d)}function v(_){return A.apply(this,arguments)}function A(){return A=(0,f.Z)(function*(_){const d=_.clone().normalize();let c;if(d.length>1)for(const h of d)c?h.width>c.width&&(c=h):c=h;else c=d[0];return function p(_){return S.apply(this,arguments)}(c)}),A.apply(this,arguments)}const D={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function L(_){const{portal:d,isOrgItem:c,itemControl:h}=_,r=d.user?.privileges;let t=!r||r.includes("features:user:edit"),s=!!c&&!!r?.includes("features:user:fullEdit");const i="update"===h||"admin"===h;return i?s=t=!0:s&&(t=!0),{features:{edit:t,fullEdit:s},content:{updateItem:i}}}}}]);