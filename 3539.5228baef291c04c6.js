"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[3539,9005],{33086:(Ie,ie,g)=>{g.r(ie),g.d(ie,{constructAssociationMetaDataFeatureSetFromUrl:()=>ot,constructFeatureSet:()=>De,constructFeatureSetFromPortalItem:()=>_t,constructFeatureSetFromRelationship:()=>ut,constructFeatureSetFromUrl:()=>Be,convertToFeatureSet:()=>ft,createFeatureSetCollectionFromMap:()=>ct,createFeatureSetCollectionFromService:()=>ht,initialiseMetaDataCache:()=>it});var R=g(15861),te=g(66476);class ee{constructor(){this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}add(s,i,u){this._layerById[i]=u,this._layerByName[s]=u}featureSetByName(s,i=!0,u=["*"]){var l=this;return(0,R.Z)(function*(){return void 0===l._layerByName[s]?null:l._layerByName[s]})()}featureSetById(s,i=!0,u=["*"]){var l=this;return(0,R.Z)(function*(){return void 0===l._layerById[s]?null:l._layerById[s]})()}castToText(s=!1){return"object, FeatureSetCollection"}}var W=g(89018),G=g(52034),Q=g(35458),K=g(94511),N=g(11375),P=g(70930),w=g(95418),b=g(58446),S=g(25677),F=g(76961),L=g(77023),p=g(80389),A=g(85904);class E{constructor(){this.field="",this.tofieldname="",this.typeofstat="MIN",this.workingexpr=null}clone(){const s=new E;return s.field=this.field,s.tofieldname=this.tofieldname,s.typeofstat=this.typeofstat,s.workingexpr=this.workingexpr,s}static parseStatField(s,i,u,l){const y=new E;y.field=s;const c=A.WhereClause.create(i,u,l),C=function x(j){if("function"===j.parseTree.type){if(0===j.parseTree.args.value.length)return{name:j.parseTree.name,expr:null};if(j.parseTree.args.value.length>1)throw new P.eS(P.f.MissingStatisticParameters);const s=A.WhereClause.create((0,L.XF)(j.parseTree.args.value[0],F.Bj.Standardised,j.parameters),j.fieldsIndex,j.timeZone);return{name:j.parseTree.name,expr:s}}return null}(c);if(null===C)throw new P.eS(P.f.UnsupportedSqlFunction,{function:""});const f=C.name.toUpperCase().trim();if("MIN"===f){if(y.typeofstat="MIN",y.workingexpr=C.expr,null===c)throw new P.eS(P.f.InvalidFunctionParameters,{function:"min"})}else if("MAX"===f){if(y.typeofstat="MAX",y.workingexpr=C.expr,null===c)throw new P.eS(P.f.InvalidFunctionParameters,{function:"max"})}else if("COUNT"===f)y.typeofstat="COUNT",y.workingexpr=C.expr;else if("STDEV"===f){if(y.typeofstat="STDDEV",y.workingexpr=C.expr,null===c)throw new P.eS(P.f.InvalidFunctionParameters,{function:"stdev"})}else if("SUM"===f){if(y.typeofstat="SUM",y.workingexpr=C.expr,null===c)throw new P.eS(P.f.InvalidFunctionParameters,{function:"sum"})}else if("MEAN"===f){if(y.typeofstat="AVG",y.workingexpr=C.expr,null===c)throw new P.eS(P.f.InvalidFunctionParameters,{function:f})}else if("AVG"===f){if(y.typeofstat="AVG",y.workingexpr=C.expr,null===c)throw new P.eS(P.f.InvalidFunctionParameters,{function:"avg"})}else{if("VAR"!==f)throw new P.eS(P.f.UnsupportedSqlFunction,{function:f});if(y.typeofstat="VAR",y.workingexpr=C.expr,null===c)throw new P.eS(P.f.InvalidFunctionParameters,{function:"var"})}return y}toStatisticsName(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":default:return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg"}}}var I=g(19799),d=g(88781),v=g(80458),m=g(81429),h=g(43814),_=g(81247),B=g(40100);function V(j){if(!j)return"COUNT";switch(j.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}class Y extends w.Z{constructor(s){super(s),this._decodedStatsfield=[],this._decodedGroupbyfield=[],this._candosimplegroupby=!0,this.phsyicalgroupbyfields=[],this.objectIdField="ROW__ID",this._internalObjectIdField="ROW__ID",this._adaptedFields=[],this.declaredClass="esri.arcade.featureset.actions.Aggregate",this._uniqueIds=1,this._maxQuery=10,this._maxProcessing=10,this._parent=s.parentfeatureset,this._config=s}isTable(){return!0}_getSet(s){var i=this;return(0,R.Z)(function*(){if(null===i._wset){const u=yield i._getFilteredSet("",null,null,null,s);return i._wset=u,i._wset}return i._wset})()}_isInFeatureSet(){return F.dj.InFeatureSet}_nextUniqueName(s){for(;1===s["T"+this._uniqueIds.toString()];)this._uniqueIds++;const i="T"+this._uniqueIds.toString();return s[i]=1,i}_convertToEsriFieldType(s){return s}_initialiseFeatureSet(){const s={};let i=!1,u=1;const l=this._parent?this._parent.getFieldsIndex():new B.Z([]);for(this.objectIdField="ROW__ID",this.globalIdField="";!1===i;){let c=!1;for(let C=0;C<this._config.groupbyfields.length;C++)if(this._config.groupbyfields[C].name.toLowerCase()===this.objectIdField.toLowerCase()){c=!0;break}if(!1===c)for(let C=0;C<this._config.statsfields.length;C++)if(this._config.statsfields[C].name.toLowerCase()===this.objectIdField.toLowerCase()){c=!0;break}!1===c?i=!0:(this.objectIdField="ROW__ID"+u.toString(),u++)}for(const c of this._config.statsfields){const C=new E;C.field=c.name,C.tofieldname=c.name,C.workingexpr=c.expression instanceof A.WhereClause?c.expression:A.WhereClause.create(c.expression,l,this.dateFieldsTimeZoneDefaultUTC),C.typeofstat=V(c.statistic),this._decodedStatsfield.push(C)}this._decodedGroupbyfield=[];for(const c of this._config.groupbyfields){const C={name:c.name,singlefield:null,tofieldname:c.name,expression:c.expression instanceof A.WhereClause?c.expression:A.WhereClause.create(c.expression,l,this.dateFieldsTimeZoneDefaultUTC),sqlType:null};this._decodedGroupbyfield.push(C)}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";for(const c of this._parent.fields)s[c.name.toUpperCase()]=1;this.types=null,this.subtypes=null,this.subtypeField=""}else this.geometryType=F.Qk.point,this.typeIdField="",this.types=null,this.subtypes=null,this.subtypeField="",this.spatialReference=new h.Z({wkid:4326});this.fields=[];const y=new E;y.field=this._nextUniqueName(s),y.tofieldname=this.objectIdField,y.workingexpr=A.WhereClause.create(this._parent.objectIdField,this._parent.getFieldsIndex(),this.dateFieldsTimeZoneDefaultUTC),y.typeofstat="MIN",this._decodedStatsfield.push(y);for(const c of this._decodedGroupbyfield){const C=new _.Z;if(c.name=this._nextUniqueName(s),C.name=c.tofieldname,C.alias=C.name,(0,L.y5)(c.expression)){const f=this._parent.getField((0,L.zR)(c.expression,F.Bj.Standardised));if(!f)throw new P.EN(P.H9.AggregationFieldNotFound);c.name=f.name,c.singlefield=f.name,this.phsyicalgroupbyfields.push(f.name),C.type=f.type,c.sqlType=f.type}else{C.type=this._convertToEsriFieldType((0,L.DT)(c.expression,this._parent.fields));const f=new _.Z;f.name=c.name,f.alias=f.name,this.phsyicalgroupbyfields.push(c.name),this._adaptedFields.push(new K.yN(f,c.expression)),this._candosimplegroupby=!1,c.sqlType=C.type}this.fields.push(C)}if(this._adaptedFields.length>0)for(const c of this._parent.fields)this._adaptedFields.push(new K.$X(c));for(let c=0;c<this._decodedStatsfield.length;c++){const C=new _.Z;let f=null;const Z=this._decodedStatsfield[c];Z.field=this._nextUniqueName(s),Z.tofieldname===this.objectIdField&&(this._internalObjectIdField=Z.field),C.name=Z.tofieldname,C.alias=C.name;const U=null!==Z.workingexpr&&(0,L.y5)(Z.workingexpr)?(0,L.zR)(Z.workingexpr,F.Bj.Standardised):"";switch(this._decodedStatsfield[c].typeofstat){case"SUM":if(""!==U){if(f=this._parent.getField(U),!f)throw new P.EN(P.H9.AggregationFieldNotFound);C.type=f.type}else C.type="double";break;case"MIN":case"MAX":if(""!==U){if(f=this._parent.getField(U),!f)throw new P.EN(P.H9.AggregationFieldNotFound);C.type=f.type}else C.type="double";break;case"COUNT":C.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==U&&(f=this._parent.getField(U),!f))throw new P.EN(P.H9.AggregationFieldNotFound);C.type="double"}this.fields.push(C)}}_canDoAggregates(){return(0,R.Z)(function*(){return!1})()}_getFeatures(s,i,u,l){var y=this;return(0,R.Z)(function*(){const c=y._maxQuery;return!0===y._checkIfNeedToExpandKnownPage(s,c)?(yield y._expandPagedSet(s,c,0,0,l),y._getFeatures(s,i,u,l)):"success"})()}_getFilteredSet(s,i,u,l,y){var c=this;return(0,R.Z)(function*(){if(""!==s)return new b.Z([],[],!0,null);let C=null;const f={ordered:!1,nowhereclause:!1};if(yield c._ensureLoaded(),null!==u)for(let U=0;U<c._decodedStatsfield.length;U++)if(!0===(0,L.hq)(u,c._decodedStatsfield[U].tofieldname)){f.nowhereclause=!0,u=null;break}if(null!==l){f.ordered=!0;for(let U=0;U<c._decodedStatsfield.length;U++)if(!0===l.scanForField(c._decodedStatsfield[U].tofieldname)){l=null,f.ordered=!1;break}if(null!==l)for(const U of c._decodedGroupbyfield)if(null===U.singlefield&&!0===l.scanForField(U.tofieldname)){l=null,f.ordered=!1;break}}if(!1!==c._candosimplegroupby&&(yield c._parent._canDoAggregates(c.phsyicalgroupbyfields,c._decodedStatsfield,"",null,null))){let U=null;u&&(U=c._reformulateWhereClauseWithoutGroupByFields(u));let H=null;l&&(H=c._reformulateOrderClauseWithoutGroupByFields(l));const re=yield c._parent._getAggregatePagesDataSourceDefinition(c.phsyicalgroupbyfields,c._decodedStatsfield,"",null,U,H,c._internalObjectIdField);return c._checkCancelled(y),C=!0===f.nowhereclause?new b.Z(re._candidates.slice(0).concat(re._known.slice(0)),[],!0===f.ordered&&re._ordered,c._clonePageDefinition(re.pagesDefinition)):new b.Z(re._candidates.slice(0),re._known.slice(0),!0===f.ordered&&re._ordered,c._clonePageDefinition(re.pagesDefinition)),C}let Z=c._parent;if(c._adaptedFields.length>0&&(Z=new K.Xx({parentfeatureset:c._parent,adaptedFields:c._adaptedFields,extraFilter:null})),!0===f.nowhereclause)C=new b.Z(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:c._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new N.Z({parentfeatureset:Z,orderbyclause:new S.Z(c.phsyicalgroupbyfields.join(",")+","+c._parent.objectIdField+" ASC")})}});else{let U=Z;if(null!==u){let H=null;u&&(H=c._reformulateWhereClauseWithoutGroupByFields(u)),U=new G.Z({parentfeatureset:U,whereclause:H})}C=new b.Z(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:c._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new N.Z({parentfeatureset:U,orderbyclause:new S.Z(c.phsyicalgroupbyfields.join(",")+","+c._parent.objectIdField+" ASC")})}})}return C})()}_reformulateWhereClauseWithoutStatsFields(s){for(const i of this._decodedStatsfield)s=(0,L.bB)(s,i.tofieldname,(0,L.zR)(i.workingexpr,F.Bj.Standardised),this._parent.getFieldsIndex());return s}_reformulateWhereClauseWithoutGroupByFields(s){for(const i of this._decodedGroupbyfield)i.tofieldname!==i.name&&(s=(0,L.bB)(s,i.tofieldname,(0,L.zR)(i.expression,F.Bj.Standardised),this._parent.getFieldsIndex()));return s}_reformulateOrderClauseWithoutGroupByFields(s){const i=[];for(const u of this._decodedGroupbyfield)u.tofieldname!==u.name&&i.push({field:u.tofieldname,newfield:u.name});return i.length>0?s.replaceFields(i):s}_clonePageDefinition(s){return null===s?null:!0===s.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:s.resultRecordCount,resultOffset:s.resultOffset,internal:s.internal}:this._parent._clonePageDefinition(s)}_refineSetBlock(s,i,u){var l=this;return(0,R.Z)(function*(){return!0===l._checkIfNeedToExpandCandidatePage(s,l._maxQuery)?(yield l._expandPagedSet(s,l._maxQuery,0,0,u),l._refineSetBlock(s,i,u)):(l._checkCancelled(u),l._refineKnowns(s,i),s)})()}_expandPagedSet(s,i,u,l,y){return this._expandPagedSetFeatureSet(s,i,u,l,y)}_getPhysicalPage(s,i,u){var l=this;return(0,R.Z)(function*(){if(!0===s.pagesDefinition.aggregatefeaturesetpagedefinition)return l._sequentialGetPhysicalItem(s,s.pagesDefinition.resultRecordCount,u,[]);const y=yield l._getAgregagtePhysicalPage(s,i,u);for(const c of y){const C={geometry:c.geometry,attributes:{}},f={};for(const Z in c.attributes)f[Z.toLowerCase()]=c.attributes[Z];for(const Z of l._decodedGroupbyfield)C.attributes[Z.tofieldname]=f[Z.name.toLowerCase()];for(const Z of l._decodedStatsfield)C.attributes[Z.tofieldname]=f[Z.field.toLowerCase()];l._featureCache[C.attributes[l.objectIdField]]=new Q.Z(C)}return y.length})()}_sequentialGetPhysicalItem(s,i,u,l){return new Promise((y,c)=>{null===s.pagesDefinition.internal.iterator&&(s.pagesDefinition.internal.iterator=s.pagesDefinition.internal.subfeatureset.iterator(u)),!0===s.pagesDefinition.internal.fullyResolved||0===i?y(l.length):this._nextAggregateItem(s,i,u,l,C=>{y(null===C?l.length:this._sequentialGetPhysicalItem(s,i-=1,u,l))},c)})}_nextAggregateItem(s,i,u,l,y,c){try{(0,W.a0)(s.pagesDefinition.internal.iterator.next()).then(C=>{if(null===C)if(null!==s.pagesDefinition.internal.workingItem){const f=this._calculateAndAppendAggregateItem(s.pagesDefinition.internal.workingItem);l.push(f),s.pagesDefinition.internal.workingItem=null,s.pagesDefinition.internal.set.push(f.attributes[this.objectIdField]),s.pagesDefinition.internal.fullyResolved=!0,y(null)}else s.pagesDefinition.internal.fullyResolved=!0,y(null);else{const f=this._generateAggregateHash(C);if(null===s.pagesDefinition.internal.workingItem)s.pagesDefinition.internal.workingItem={features:[C],id:f};else{if(f!==s.pagesDefinition.internal.workingItem.id){const Z=this._calculateAndAppendAggregateItem(s.pagesDefinition.internal.workingItem);return l.push(Z),s.pagesDefinition.internal.workingItem=null,s.pagesDefinition.internal.set.push(Z.attributes[this.objectIdField]),i-=1,s.pagesDefinition.internal.workingItem={features:[C],id:f},void y(Z)}s.pagesDefinition.internal.workingItem.features.push(C)}this._nextAggregateItem(s,i,u,l,y,c)}},c)}catch(C){c(C)}}_calculateFieldStat(s,i,u){const l=[];for(let y=0;y<s.features.length;y++)if(null!==i.workingexpr){const c=i.workingexpr.calculateValue(s.features[y]);null!==c&&l.push(c instanceof d.u||c instanceof m.n?c.toNumber():c instanceof v.H?c.toMilliseconds():c)}else l.push(null);switch(i.typeofstat){case"MIN":u.attributes[i.tofieldname]=(0,p.tj)("min",l,-1);break;case"MAX":u.attributes[i.tofieldname]=(0,p.tj)("max",l,-1);break;case"SUM":u.attributes[i.tofieldname]=(0,p.tj)("sum",l,-1);break;case"COUNT":u.attributes[i.tofieldname]=l.length;break;case"VAR":u.attributes[i.tofieldname]=(0,p.tj)("var",l,-1);break;case"STDDEV":u.attributes[i.tofieldname]=(0,p.tj)("stddev",l,-1);break;case"AVG":u.attributes[i.tofieldname]=(0,p.tj)("avg",l,-1)}return!0}_calculateAndAppendAggregateItem(s){const i={attributes:{},geometry:null};for(const l of this._decodedGroupbyfield){const y=l.singlefield?s.features[0].attributes[l.singlefield]:A.WhereClause.convertValueToStorageFormat(l.expression.calculateValue(s.features[0]),l.sqlType);i.attributes[l.tofieldname]=y}for(const l of this._decodedStatsfield)this._calculateFieldStat(s,l,i);const u=[];for(let l=0;l<this._decodedStatsfield.length;l++)u.push(this._calculateFieldStat(s,this._decodedStatsfield[l],i));return this._featureCache[i.attributes[this.objectIdField]]=new Q.Z({attributes:i.attributes,geometry:i.geometry}),i}_generateAggregateHash(s){let i="";for(const u of this._decodedGroupbyfield){const l=u.singlefield?s.attributes[u.singlefield]:u.expression.calculateValue(s);i+=null==l?":":":"+l.toString()}return(0,I.F)(i,I.M.String)}_stat(){return(0,R.Z)(function*(){return{calculated:!1}})()}getFeatureByObjectId(){return(0,R.Z)(function*(){return null})()}static registerAction(){w.Z._featuresetFunctions.groupby=function(s,i){return new Y({parentfeatureset:this,groupbyfields:s,statsfields:i})}}}var k=g(15367),M=g(92224),J=g(26152),$=g(97973),ae=g(70430),fe=g(40637),ce=g(33721),Ce=g(90373),Ae=g(57964),Le=g(14007),$e=g(79412),xe=g(11642),Ze=g(46054),Te=g(46708),Ne=g(36026),je=g(93792),T=g(91866);function O(){return O=(0,R.Z)(function*(j,s,i,u){return function se(j,s,i,u){return oe.apply(this,arguments)}(s,yield function z(j,s,i,u){return X.apply(this,arguments)}(j,s,i,u),i,u)}),O.apply(this,arguments)}function X(){return(X=(0,R.Z)(function*(j,s,i,u){const l={...u},y=function me(j,s){let i=T.Z.from(j);i.sourceSpatialReference=i.sourceSpatialReference??s?.sourceSpatialReference??null,(s?.gdbVersion||s?.dynamicDataSource)&&(i=i===j?i.clone():i,i.gdbVersion=j.gdbVersion||s.gdbVersion,i.dynamicDataSource=j.dynamicDataSource?Ze.n.from(j.dynamicDataSource):s.dynamicDataSource);const u=s?.infoFor3D;if(null!=u&&ye(j,u)){i=i===j?i.clone():i,i.formatOf3DObjects=null;const{supportedFormats:l,queryFormats:y}=u,c=(0,xe.S0)("model/gltf-binary",l)??(0,xe.Ow)("glb",l),C=(0,xe.S0)("model/gltf+json",l)??(0,xe.Ow)("gtlf",l);for(const f of y){if(f===c){i.formatOf3DObjects=f;break}f!==C||i.formatOf3DObjects||(i.formatOf3DObjects=f)}if(!i.formatOf3DObjects)throw new Ae.Z("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(null==i.outFields||!i.outFields.includes("*")){i=i===j?i.clone():i,null==i.outFields&&(i.outFields=[]);const{originX:f,originY:Z,originZ:U,translationX:H,translationY:re,translationZ:ne,scaleX:le,scaleY:_e,scaleZ:pe,rotationX:ge,rotationY:de,rotationZ:we,rotationDeg:Ee}=u.transformFieldRoles;i.outFields.push(f,Z,U,H,re,ne,le,_e,pe,ge,de,we,Ee)}}return i}(s,i),c=null!=s.outStatistics?.[0],C=(0,Le.Z)("featurelayer-pbf-statistics"),f=!c||C;let Z;if("pbf"===i?.format&&f)try{Z=yield(0,Ne.t)(j,y,l)}catch(U){if("query:parsing-pbf"!==U.name)throw U;i.format="json"}return"json"!==i?.format&&f||(Z=yield(0,Te.F)(j,y,l)),function q(j,s){if(null!=j&&null!=s)for(const i of s){const u=j.get(i.name);u&&Object.assign(i,u.toJSON())}}(i?.fieldsIndex,Z.fields),Z})).apply(this,arguments)}function oe(){return(oe=(0,R.Z)(function*(j,s,i,u){const l=i?.infoFor3D;if(!ye(j,l)||null==l||!s.assetMaps||!s.features?.length)return je.Z.fromJSON(s);const{meshFeatureSetFromJSON:y}=yield(0,$e.Hl)(Promise.all([g.e(1716),g.e(1317),g.e(1868),g.e(8777)]).then(g.bind(g,16022)),u);return y(j,l,s)})).apply(this,arguments)}function ye(j,s){return null!=s&&!0===j.returnGeometry&&"xyFootprint"!==j.multipatchOption&&!j.outStatistics}g(11931),g(65311),g(6785),g(85596);var be=g(12768),Pe=g(24859),et=(g(2189),g(4703),g(5391),g(64222),g(23991),g(82301),g(40485),g(49602),g(82921),g(61375)),He=(g(27048),g(55117),g(26894),g(46556)),Xe=(g(89047),g(91085));class Me extends w.Z{constructor(s){super(s),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",this._removeGeometry=!1,this._overrideFields=null,this.formulaCredential=null,this._pageJustIds=!1,this._requestStandardised=!1,this._useDefinitionExpression=!0,s.spatialReference&&(this.spatialReference=s.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=s.layer,this._wset=null,void 0!==s.outFields&&(this._overrideFields=s.outFields),void 0!==s.includeGeometry&&(this._removeGeometry=!1===s.includeGeometry)}_maxQueryRate(){return F.tI}end(){return this._layer}optimisePagingFeatureQueries(s){this._pageJustIds=s}get urlQueryPath(){return this._layer.parsedUrl.path||""}convertQueryToLruCacheKey(s){const i=this.urlQueryPath+","+(0,F.hd)(s.toJSON());return(0,I.F)(i,I.M.String)}loadImpl(){var s=this;return(0,R.Z)(function*(){return!0===s._layer.loaded?(s._initialiseFeatureSet(),s):(yield s._layer.load(),s._initialiseFeatureSet(),s)})()}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this.hasZ=!0===this._layer?.capabilities?.data?.supportsZ,this.hasM=!0===this._layer?.capabilities?.data?.supportsM,null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const s=[],i=[];for(const u of this.fields)if("oid"===u.type)s.push(u),i.push(u.name);else for(const l of this._overrideFields)if(l.toLowerCase()===u.name.toLowerCase()){s.push(u),i.push(u.name);break}this.fields=s,this._overrideFields=i}if(this._layer.source&&this._layer.source.sourceJSON){const s=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=F.Bj.StandardisedNoInterval,null!=s&&s>=10.61&&(this._databaseType=F.Bj.Standardised)):null!=s&&(s>=10.5&&(this._databaseType=F.Bj.StandardisedNoInterval,this._requestStandardised=!0),s>=10.61&&(this._databaseType=F.Bj.Standardised))}this.objectIdField=this._layer.objectIdField;for(const s of this.fields)"global-id"===s.type&&(this.globalIdField=s.name);"subtype-group"===this._layer.type?(this.subtypeField=this._layer.subtypeField??"",this.subtypes=this._layer.subtypes,this.types=null,this.typeIdField=null):"oriented-imagery"===this._layer.type?(this.subtypeField=null,this.subtypes=null,this.typeIdField=this._layer.typeIdField??"",this.types=this._layer.types):(this.subtypeField=this._layer.subtypeField,this.subtypes=this._layer.subtypes,this.typeIdField=this._layer.typeIdField??"",this.types=this._layer.types)}_isInFeatureSet(){return F.dj.InFeatureSet}_refineSetBlock(s){return(0,R.Z)(function*(){return s})()}_candidateIdTransform(s){return s}_getSet(s){var i=this;return(0,R.Z)(function*(){if(null===i._wset){yield i._ensureLoaded();const u=yield i._getFilteredSet("",null,null,null,s);return i._wset=u,u}return i._wset})()}_runDatabaseProbe(s){var i=this;return(0,R.Z)(function*(){yield i._ensureLoaded();const u=new T.Z;i.datesInUnknownTimezone&&(u.timeReferenceUnknownClient=!0),u.where=s.replace("OBJECTID",i._layer.objectIdField);try{return yield i._layer.queryObjectIds(u),!0}catch{return!1}})()}_canUsePagination(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)}_cacheableFeatureSetSourceKey(){return this._layer.url}pbfSupportedForQuery(s){const i=this._layer?.capabilities?.query;return!s.outStatistics&&!0===i?.supportsFormatPBF&&!0===i?.supportsQuantizationEditMode}queryPBF(s){var i=this;return(0,R.Z)(function*(){return s.quantizationParameters={mode:"edit"},(yield function D(j,s,i,u){return O.apply(this,arguments)}(i._layer.parsedUrl,s,{format:"pbf"},{})).unquantize()})()}get gdbVersion(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion||"SDE.DEFAULT":""}nativeCapabilities(){return{title:this._layer.title??"",source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}}executeQuery(s,i){s.returnZ=this.hasZ,s.returnM=this.hasM;const u="execute"===i?Te.e:"executeForCount"===i?Pe.P:et.G,l="execute"===i&&this.pbfSupportedForQuery(s);let y=null;if(this.recentlyUsedQueries){const c=this.convertQueryToLruCacheKey(s);y=this.recentlyUsedQueries.getFromCache(c),null===y&&(y=!0!==l?u(this._layer.parsedUrl.path,s):this.queryPBF(s),this.recentlyUsedQueries.addToCache(c,y),y=y.catch(C=>{throw this.recentlyUsedQueries?.removeFromCache(c),C}))}return this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:s,method:i}),null===y&&(y=!0!==l?u(this._layer.parsedUrl.path,s):this.queryPBF(s)),y}_getFilteredSet(s,i,u,l,y){var c=this;return(0,R.Z)(function*(){const C=yield c.databaseType();if(c.isTable()&&i&&null!==s&&""!==s)return new b.Z([],[],!0,null);if(c._canUsePagination())return c._getFilteredSetUsingPaging(s,i,u,l,y);let f="",Z=!1;null!==l&&c._layer.capabilities&&c._layer.capabilities.query&&!0===c._layer.capabilities.query.supportsOrderBy&&(f=l.constructClause(),Z=!0);const U=new T.Z;c.datesInUnknownTimezone&&(U.timeReferenceUnknownClient=!0),U.where=null===u?null===i?"1=1":"":(0,L.zR)(u,C),c._requestStandardised&&(U.sqlFormat="standard"),U.spatialRelationship=c._makeRelationshipEnum(s),U.outSpatialReference=c.spatialReference,U.orderByFields=""!==f?f.split(","):null,U.geometry=null===i?null:i,U.relationParameter=c._makeRelationshipParam(s);let H=yield c.executeQuery(U,"executeForIds");return null===H&&(H=[]),c._checkCancelled(y),new b.Z([],H,Z,null)})()}_expandPagedSet(s,i,u,l,y){return this._expandPagedSetFeatureSet(s,i,u,l,y)}_getFilteredSetUsingPaging(s,i,u,l,y){var c=this;return(0,R.Z)(function*(){let C="",f=!1;null!==l&&c._layer.capabilities&&c._layer.capabilities.query&&!0===c._layer.capabilities.query.supportsOrderBy&&(C=l.constructClause(),f=!0);const Z=yield c.databaseType();let U=null===u?null===i?"1=1":"":(0,L.zR)(u,Z);c._layer.definitionExpression&&c._useDefinitionExpression&&(U=""!==U?"(("+c._layer.definitionExpression+") AND ("+U+"))":c._layer.definitionExpression);let H=c._maxQueryRate();const re=c._layer.capabilities?.query.maxRecordCount;null!=re&&re<H&&(H=re);let ne=null;if(!0===c._pageJustIds)ne=new b.Z([],["GETPAGES"],f,{spatialRel:c._makeRelationshipEnum(s),relationParam:c._makeRelationshipParam(s),outFields:c._layer.objectIdField,resultRecordCount:H,resultOffset:0,geometry:null===i?null:i,where:U,orderByFields:C,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}});else{let le=!0;!0===c._removeGeometry&&(le=!1);const _e=c._overrideFields??c._fieldsIncludingObjectId(["*"]);ne=new b.Z([],["GETPAGES"],f,{spatialRel:c._makeRelationshipEnum(s),relationParam:c._makeRelationshipParam(s),outFields:_e.join(","),resultRecordCount:H,resultOffset:0,geometry:null===i?null:i,where:U,orderByFields:C,returnGeometry:le,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}return yield c._expandPagedSet(ne,H,0,1,y),ne})()}_clonePageDefinition(s){return null===s?null:!0!==s.groupbypage?{groupbypage:!1,spatialRel:s.spatialRel,relationParam:s.relationParam,outFields:s.outFields,resultRecordCount:s.resultRecordCount,resultOffset:s.resultOffset,geometry:s.geometry,where:s.where,orderByFields:s.orderByFields,returnGeometry:s.returnGeometry,returnIdsOnly:s.returnIdsOnly,internal:s.internal}:{groupbypage:!0,spatialRel:s.spatialRel,relationParam:s.relationParam,outFields:s.outFields,resultRecordCount:s.resultRecordCount,useOIDpagination:s.useOIDpagination,generatedOid:s.generatedOid,groupByFieldsForStatistics:s.groupByFieldsForStatistics,resultOffset:s.resultOffset,outStatistics:s.outStatistics,geometry:s.geometry,where:s.where,orderByFields:s.orderByFields,returnGeometry:s.returnGeometry,returnIdsOnly:s.returnIdsOnly,internal:s.internal}}_getPhysicalPage(s,i,u){var l=this;return(0,R.Z)(function*(){const y=s.pagesDefinition.internal.lastRetrieved,c=y,C=s.pagesDefinition.internal.lastPage,f=new T.Z;l._requestStandardised&&(f.sqlFormat="standard"),l.datesInUnknownTimezone&&(f.timeReferenceUnknownClient=!0),f.spatialRelationship=s.pagesDefinition.spatialRel,f.relationParameter=s.pagesDefinition.relationParam,f.outFields=s.pagesDefinition.outFields.split(","),f.num=s.pagesDefinition.resultRecordCount,f.start=s.pagesDefinition.internal.lastPage,f.geometry=s.pagesDefinition.geometry,f.where=s.pagesDefinition.where,f.orderByFields=""!==s.pagesDefinition.orderByFields?s.pagesDefinition.orderByFields.split(","):null,f.returnGeometry=s.pagesDefinition.returnGeometry,f.outSpatialReference=l.spatialReference;const Z=yield l.executeQuery(f,"execute");if(l._checkCancelled(u),s.pagesDefinition.internal.lastPage!==C)return"done";const U=l._layer.objectIdField;for(let H=0;H<Z.features.length;H++)s.pagesDefinition.internal.set[c+H]=Z.features[H].attributes[U];if(!1===l._pageJustIds)for(let H=0;H<Z.features.length;H++)l._featureCache[Z.features[H].attributes[U]]=Z.features[H];return(void 0===Z.exceededTransferLimit&&Z.features.length!==s.pagesDefinition.resultRecordCount||!1===Z.exceededTransferLimit)&&(s.pagesDefinition.internal.fullyResolved=!0),s.pagesDefinition.internal.lastRetrieved=y+Z.features.length,s.pagesDefinition.internal.lastPage+=s.pagesDefinition.resultRecordCount,"done"})()}_fieldsIncludingObjectId(s){if(null===s)return[this.objectIdField];const i=s.slice(0);if(i.includes("*"))return i;let u=!1;for(const l of i)if(l.toUpperCase()===this.objectIdField.toUpperCase()){u=!0;break}return!1===u&&i.push(this.objectIdField),i}_getFeatures(s,i,u,l){var y=this;return(0,R.Z)(function*(){const c=[];if(-1!==i&&void 0===y._featureCache[i]&&c.push(i),!0===y._checkIfNeedToExpandKnownPage(s,y._maxProcessingRate()))return yield y._expandPagedSet(s,y._maxProcessingRate(),0,0,l),y._getFeatures(s,i,u,l);let C=0;for(let H=s._lastFetchedIndex;H<s._known.length;H++){if(s._lastFetchedIndex+=1,C++,void 0===y._featureCache[s._known[H]]){let re=!1;if(null!=y._layer._mode){const ne=y._layer._mode;if(void 0!==ne._featureMap[s._known[H]]){const le=ne._featureMap[s._known[H]];null!==le&&(re=!0,y._featureCache[s._known[H]]=le)}}if(!1===re&&(s._known[H]!==i&&c.push(s._known[H]),c.length>=y._maxProcessingRate()-1))break}if(C>=u&&0===c.length)break}if(0===c.length)return"success";const f=new T.Z;y._requestStandardised&&(f.sqlFormat="standard"),y.datesInUnknownTimezone&&(f.timeReferenceUnknownClient=!0),f.objectIds=c,f.outFields=y._overrideFields??y._fieldsIncludingObjectId(["*"]),f.returnGeometry=!0,!0===y._removeGeometry&&(f.returnGeometry=!1),f.outSpatialReference=y.spatialReference;const Z=yield y.executeQuery(f,"execute");if(y._checkCancelled(l),void 0!==Z.error)throw new P.EN(P.H9.RequestFailed,{reason:Z.error});const U=y._layer.objectIdField;for(let H=0;H<Z.features.length;H++)y._featureCache[Z.features[H].attributes[U]]=Z.features[H];return"success"})()}_getDistinctPages(s,i,u,l,y,c,C,f,Z){var U=this;return(0,R.Z)(function*(){yield U._ensureLoaded();const H=yield U.databaseType();let re=u.parseTree.column;const ne=U._layer.fields??[];for(let de=0;de<ne.length;de++)if(ne[de].name.toLowerCase()===re.toLowerCase()){re=ne[de].name;break}const le=new T.Z;U._requestStandardised&&(le.sqlFormat="standard"),U.datesInUnknownTimezone&&(le.timeReferenceUnknownClient=!0);let _e=null===c?null===y?"1=1":"":(0,L.zR)(c,H);U._layer.definitionExpression&&U._useDefinitionExpression&&(_e=""!==_e?"(("+U._layer.definitionExpression+") AND ("+_e+"))":U._layer.definitionExpression),le.where=_e,le.spatialRelationship=U._makeRelationshipEnum(l),le.relationParameter=U._makeRelationshipParam(l),le.geometry=null===y?null:y,le.returnDistinctValues=!0,le.returnGeometry=!1,le.outFields=[re];const pe=yield U.executeQuery(le,"execute");if(U._checkCancelled(Z),!pe.hasOwnProperty("features"))throw new P.EN(P.H9.InvalidStatResponse);let ge=!1;for(let de=0;de<ne.length;de++)if(ne[de].name===re){"date"===ne[de].type&&(ge=!0);break}for(let de=0;de<pe.features.length;de++){if(ge){const we=pe.features[de].attributes[re];f.push(null!==we?new Date(we):we)}else f.push(pe.features[de].attributes[re]);if(f.length>=C)break}return 0===pe.features.length?f:pe.features.length===U._layer.capabilities?.query.maxRecordCount&&f.length<C?{calculated:!0,result:yield U._getDistinctPages(s+pe.features.length,i,u,l,y,c,C,f,Z)}:f})()}_distinctStat(s,i,u,l,y,c,C){var f=this;return(0,R.Z)(function*(){return{calculated:!0,result:yield f._getDistinctPages(0,s,i,u,l,y,c,[],C)}})()}isTable(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType||"esriGeometryNull"===this._layer.geometryType}_countstat(s,i,u,l){var y=this;return(0,R.Z)(function*(){const c=yield y.databaseType(),C=new T.Z;if(y._requestStandardised&&(C.sqlFormat="standard"),y.isTable()&&u&&null!==i&&""!==i)return{calculated:!0,result:0};let f=null===l?null===u?"1=1":"":(0,L.zR)(l,c);return y._layer.definitionExpression&&y._useDefinitionExpression&&(f=""!==f?"(("+y._layer.definitionExpression+") AND ("+f+"))":y._layer.definitionExpression),C.where=f,y.datesInUnknownTimezone&&(C.timeReferenceUnknownClient=!0),C.where=f,C.spatialRelationship=y._makeRelationshipEnum(i),C.relationParameter=y._makeRelationshipParam(i),C.geometry=null===u?null:u,C.returnGeometry=!1,{calculated:!0,result:yield y.executeQuery(C,"executeForCount")}})()}_stats(s,i,u,l,y,c,C){var f=this;return(0,R.Z)(function*(){yield f._ensureLoaded();const Z=f._layer.capabilities&&f._layer.capabilities.query&&!0===f._layer.capabilities.query.supportsSqlExpression,U=f._layer.capabilities&&f._layer.capabilities.query&&!0===f._layer.capabilities.query.supportsStatistics,H=f._layer.capabilities&&f._layer.capabilities.query&&!0===f._layer.capabilities.query.supportsDistinct;if("count"===s)return H?f._countstat(s,u,l,y):{calculated:!1};if(!1===U||!1===(0,L.y5)(i)&&!1===Z||!1===i.isStandardized)return""!==u||null!==y?{calculated:!1}:f._manualStat(s,i,c,C);if("distinct"===s)return!1===H?""!==u||null!==y?{calculated:!1}:f._manualStat(s,i,c,C):f._distinctStat(s,i,u,l,y,c,C);const re=yield f.databaseType();if(f.isTable()&&l&&null!==u&&""!==u)return{calculated:!0,result:null};const ne=new T.Z;f._requestStandardised&&(ne.sqlFormat="standard");let le=null===y?null===l?"1=1":"":(0,L.zR)(y,re);f._layer.definitionExpression&&f._useDefinitionExpression&&(le=""!==le?"(("+f._layer.definitionExpression+") AND ("+le+"))":f._layer.definitionExpression),ne.where=le,ne.spatialRelationship=f._makeRelationshipEnum(u),ne.relationParameter=f._makeRelationshipParam(u),ne.geometry=null===l?null:l,f.datesInUnknownTimezone&&(ne.timeReferenceUnknownClient=!0);const _e=new Xe.Z;_e.statisticType=(0,p.g3)(s),_e.onStatisticField=(0,L.zR)(i,re),_e.outStatisticFieldName="ARCADE_STAT_RESULT",ne.returnGeometry=!1;let pe="ARCADE_STAT_RESULT";ne.outStatistics=[_e];const ge=yield f.executeQuery(ne,"execute");if(!ge.hasOwnProperty("features")||0===ge.features.length)throw new P.EN(P.H9.InvalidStatResponse);let de=!1;const we=ge.fields??[];for(let Ee=0;Ee<we.length;Ee++)if("ARCADE_STAT_RESULT"===we[Ee].name.toUpperCase()){pe=we[Ee].name,"date"===we[Ee].type&&(de=!0);break}if(de){let Ee=ge.features[0].attributes[pe];return null!==Ee&&(Ee=new Date(ge.features[0].attributes[pe])),{calculated:!0,result:Ee}}return{calculated:!0,result:ge.features[0].attributes[pe]}})()}_stat(s,i,u,l,y,c,C){return this._stats(s,i,u,l,y,c,C)}_canDoAggregates(s,i){var u=this;return(0,R.Z)(function*(){yield u._ensureLoaded();let l=!1;const y=u._layer.capabilities?.query,c=!0===y?.supportsSqlExpression;if(null!=y&&!0===y.supportsStatistics&&!0===y.supportsOrderBy&&(l=!0),l)for(let C=0;C<i.length-1;C++)(!1===i[C].workingexpr?.isStandardized||!1===(0,L.y5)(i[C].workingexpr)&&!1===c)&&(l=!1);return!1!==l})()}_makeRelationshipEnum(s){if(s.includes("esriSpatialRelRelation"))return"relation";switch(s){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return s}_makeRelationshipParam(s){return s.includes("esriSpatialRelRelation")?s.split(":")[1]:""}_getAggregatePagesDataSourceDefinition(s,i,u,l,y,c,C){var f=this;return(0,R.Z)(function*(){yield f._ensureLoaded();const Z=yield f.databaseType();let U="",H=!1,re=!1;null!==c&&f._layer.capabilities&&f._layer.capabilities.query&&!0===f._layer.capabilities.query.supportsOrderBy&&(U=c.constructClause(),re=!0),f._layer.capabilities&&f._layer.capabilities.query&&!1===f._layer.capabilities.query.supportsPagination&&(re=!1,H=!0,U=f._layer.objectIdField);const ne=[];for(let ge=0;ge<i.length;ge++){const de=new Xe.Z;de.onStatisticField=null!==i[ge].workingexpr?(0,L.zR)(i[ge].workingexpr,Z):"",de.outStatisticFieldName=i[ge].field,de.statisticType=i[ge].toStatisticsName(),ne.push(de)}""===U&&(U=s.join(","));let le=f._maxQueryRate();const _e=f._layer.capabilities?.query.maxRecordCount;null!=_e&&_e<le&&(le=_e);let pe=null===y?null===l?"1=1":"":(0,L.zR)(y,Z);return f._layer.definitionExpression&&f._useDefinitionExpression&&(pe=""!==pe?"(("+f._layer.definitionExpression+") AND ("+pe+"))":f._layer.definitionExpression),new b.Z([],["GETPAGES"],re,{groupbypage:!0,spatialRel:f._makeRelationshipEnum(u),relationParam:f._makeRelationshipParam(u),outFields:["*"],useOIDpagination:H,generatedOid:C,resultRecordCount:le,resultOffset:0,groupByFieldsForStatistics:s,outStatistics:ne,geometry:null===l?null:l,where:pe,orderByFields:U,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})})()}_getAgregagtePhysicalPage(s,i,u){var l=this;return(0,R.Z)(function*(){let y=s.pagesDefinition.where;!0===s.pagesDefinition.useOIDpagination&&(y=""!==y?"("+y+") AND ("+s.pagesDefinition.generatedOid+">"+s.pagesDefinition.internal.lastMaxId.toString()+")":s.pagesDefinition.generatedOid+">"+s.pagesDefinition.internal.lastMaxId.toString());const c=s.pagesDefinition.internal.lastRetrieved,C=c,f=s.pagesDefinition.internal.lastPage,Z=new T.Z;if(l._requestStandardised&&(Z.sqlFormat="standard"),Z.where=y,Z.spatialRelationship=s.pagesDefinition.spatialRel,Z.relationParameter=s.pagesDefinition.relationParam,Z.outFields=s.pagesDefinition.outFields,Z.outStatistics=s.pagesDefinition.outStatistics,Z.geometry=s.pagesDefinition.geometry,Z.groupByFieldsForStatistics=s.pagesDefinition.groupByFieldsForStatistics,Z.num=s.pagesDefinition.resultRecordCount,Z.start=s.pagesDefinition.internal.lastPage,Z.returnGeometry=s.pagesDefinition.returnGeometry,l.datesInUnknownTimezone&&(Z.timeReferenceUnknownClient=!0),Z.orderByFields=""!==s.pagesDefinition.orderByFields?s.pagesDefinition.orderByFields.split(","):null,l.isTable()&&Z.geometry&&Z.spatialRelationship)return[];const U=yield l.executeQuery(Z,"execute");if(l._checkCancelled(u),!U.hasOwnProperty("features"))throw new P.EN(P.H9.InvalidStatResponse);const H=[];if(s.pagesDefinition.internal.lastPage!==f)return[];U.features.length>0&&void 0===U.features[0].attributes[s.pagesDefinition.generatedOid]&&(s.pagesDefinition.generatedOid=s.pagesDefinition.generatedOid.toLowerCase());for(let re=0;re<U.features.length;re++)s.pagesDefinition.internal.set[C+re]=U.features[re].attributes[s.pagesDefinition.generatedOid];for(let re=0;re<U.features.length;re++)H.push(new Q.Z({attributes:U.features[re].attributes,geometry:null}));return!0===s.pagesDefinition.useOIDpagination?0===U.features.length?s.pagesDefinition.internal.fullyResolved=!0:s.pagesDefinition.internal.lastMaxId=U.features[U.features.length-1].attributes[s.pagesDefinition.generatedOid]:(void 0===U.exceededTransferLimit&&U.features.length!==s.pagesDefinition.resultRecordCount||!1===U.exceededTransferLimit)&&(s.pagesDefinition.internal.fullyResolved=!0),s.pagesDefinition.internal.lastRetrieved=c+U.features.length,s.pagesDefinition.internal.lastPage+=s.pagesDefinition.resultRecordCount,H})()}static create(s,i,u,l,y){const c=new Ce.default({url:s,outFields:null===i?["*"]:i});return new Me({layer:c,spatialReference:u,lrucache:l,interceptor:y})}relationshipMetaData(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON?.relationships?this._layer.source.sourceJSON.relationships:[]}serviceUrl(){return(0,F.US)(this._layer.parsedUrl.path)}queryAttachments(s,i,u,l,y){var c=this;return(0,R.Z)(function*(){const f=c._layer;if(function C(Z){const U=Z.capabilities;return U?.data.supportsAttachment&&U?.operations.supportsQueryAttachments}(f)){const Z={objectIds:[s],returnMetadata:y};(i&&i>0||u&&u>0)&&(Z.size=[i&&i>0?i:0,u&&u>0?u:i+1]),l&&l.length>0&&(Z.attachmentTypes=l),c.featureSetQueryInterceptor&&c.featureSetQueryInterceptor.preLayerQueryCallback({layer:f,query:Z,method:"attachments"});const U=yield f.queryAttachments(new be.Z(Z)),H=[];return U&&U[s]&&U[s].forEach(re=>{const ne=c._layer.parsedUrl.path+"/"+s.toString()+"/attachments/"+re.id.toString();let le=null;y&&re.exifInfo&&(le=ae.Z.convertJsonToArcade(re.exifInfo,"system",!0)),H.push(new $.Z(re.id,re.name,re.contentType,re.size,ne,le,re.keywords??null))}),H}return[]})()}queryRelatedFeatures(s){var i=this;return(0,R.Z)(function*(){const u={f:"json",relationshipId:s.relationshipId.toString(),definitionExpression:s.where,outFields:s.outFields?.join(","),returnGeometry:s.returnGeometry.toString()};null!=s.resultOffset&&(u.resultOffset=s.resultOffset.toString()),null!=s.resultRecordCount&&(u.resultRecordCount=s.resultRecordCount.toString()),s.orderByFields&&(u.orderByFields=s.orderByFields.join(",")),s.objectIds&&s.objectIds.length>0&&(u.objectIds=s.objectIds.join(",")),s.outSpatialReference&&(u.outSR=(0,ce.B9)(s.outSpatialReference)),i.featureSetQueryInterceptor&&i.featureSetQueryInterceptor.preRequestCallback({layer:i._layer,queryPayload:u,method:"relatedrecords",url:i._layer.parsedUrl.path+"/queryRelatedRecords"});const l=yield(0,te.Z)(i._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:u});if(l.data){const y={},c=l.data;if(c?.relatedRecordGroups){const C=c.spatialReference;for(const f of c.relatedRecordGroups){const Z=f.objectId,U=[];for(const H of f.relatedRecords){H.geometry&&(H.geometry.spatialReference=C);const re=new Q.Z({geometry:H.geometry?(0,fe.im)(H.geometry):null,attributes:H.attributes});U.push(re)}y[Z]={features:U,exceededTransferLimit:!0===c.exceededTransferLimit}}}return y}throw new P.EN(P.H9.InvalidRequest)})()}getFeatureByObjectId(s,i){var u=this;return(0,R.Z)(function*(){const l=new T.Z;l.outFields=i,l.returnGeometry=!1,l.outSpatialReference=u.spatialReference,l.where=u.objectIdField+"="+s.toString(),u.datesInUnknownTimezone&&(l.timeReferenceUnknownClient=!0),u.featureSetQueryInterceptor&&u.featureSetQueryInterceptor.preLayerQueryCallback({layer:u._layer,query:l,method:"execute"});const y=yield(0,Te.e)(u._layer.parsedUrl.path,l);return 1===y.features.length?y.features[0]:null})()}getIdentityUser(){var s=this;return(0,R.Z)(function*(){yield s.load();const i=J.id?.findCredential(s._layer.url);return i?i.userId:null})()}getOwningSystemUrl(){var s=this;return(0,R.Z)(function*(){yield s.load();const i=J.id?.findServerInfo(s._layer.url);if(i)return i.owningSystemUrl;let u=s._layer.url;const l=u.toLowerCase().indexOf("/rest/services");if(u=l>-1?u.substring(0,l):u,u){u+="/rest/info";try{const y=yield(0,te.Z)(u,{query:{f:"json"}});let c="";return y.data?.owningSystemUrl&&(c=y.data.owningSystemUrl),c}catch{return""}}return""})()}getDataSourceFeatureSet(){const s=new Me({layer:this._layer,spatialReference:this.spatialReference??void 0,outFields:this._overrideFields??void 0,includeGeometry:!this._removeGeometry,lrucache:this.recentlyUsedQueries??void 0,interceptor:this.featureSetQueryInterceptor??void 0});return s._useDefinitionExpression=!1,s}get preferredTimeZone(){return this._layer.preferredTimeZone??null}get dateFieldsTimeZone(){return this._layer.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._layer.datesInUnknownTimezone??!1}get editFieldsInfo(){return this._layer.editFieldsInfo??null}get timeInfo(){return this._layer.timeInfo??null}getFeatureSetInfo(){var s=this;return(0,R.Z)(function*(){if(s.fsetInfo)return s.fsetInfo;let i=null,u=s._layer.serviceItemId??null;const l=s._layer.parsedUrl.path;if(l){const c=yield(0,te.Z)(l,{responseType:"json",query:{f:"json"}});i=c?.data?.name??null,u=c?.data?.serviceItemId??null}const y=s._layer.title&&null!==(s._layer.parent??null);return s.featureSetInfo={layerId:s._layer.layerId,layerName:""===i?null:i,itemId:""===u?null:u,serviceLayerUrl:""===l?null:l,webMapLayerId:y?s._layer.id??null:null,webMapLayerTitle:y?s._layer.title??null:null,className:null,objectClassId:null},s.fsetInfo})()}}var tt=g(54339);class rt extends w.Z{constructor(s){super(s),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",this._findObjectId=-1,this._requestStandardised=!1,this._removeGeometry=!1,this._overrideFields=null,this.featureObjectId=null,s.spatialReference&&(this.spatialReference=s.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=s.layer,this._wset=null,this._findObjectId=s.objectId,this.featureObjectId=s.objectId,this.relationship=s.relationship,this._relatedLayer=s.relatedLayer,void 0!==s.outFields&&(this._overrideFields=s.outFields),void 0!==s.includeGeometry&&(this._removeGeometry=!1===s.includeGeometry)}_maxQueryRate(){return F.tI}end(){return this._layer}optimisePagingFeatureQueries(){}loadImpl(){var s=this;return(0,R.Z)(function*(){return yield Promise.all([s._layer.load(),s._relatedLayer?.load()]),s._initialiseFeatureSet(),s})()}nativeCapabilities(){return this._relatedLayer.nativeCapabilities()}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._relatedLayer.geometryType,this.fields=this._relatedLayer.fields.slice(0),this.hasZ=this._relatedLayer.hasZ,this.hasM=this._relatedLayer.hasM,null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const i=[],u=[];for(const l of this.fields)if("oid"===l.type)i.push(l),u.push(l.name);else for(const y of this._overrideFields)if(y.toLowerCase()===l.name.toLowerCase()){i.push(l),u.push(l.name);break}this.fields=i,this._overrideFields=u}const s=this._layer.nativeCapabilities();s&&(this._databaseType=s.databaseType,this._requestStandardised=s.requestStandardised),this.objectIdField=this._relatedLayer.objectIdField,this.globalIdField=this._relatedLayer.globalIdField,this.hasM=this._relatedLayer.supportsM,this.hasZ=this._relatedLayer.supportsZ,this.typeIdField=this._relatedLayer.typeIdField,this.types=this._relatedLayer.types,this.subtypeField=this._relatedLayer.subtypeField,this.subtypes=this._relatedLayer.subtypes}databaseType(){var s=this;return(0,R.Z)(function*(){return yield s._relatedLayer.databaseType(),s._databaseType=s._relatedLayer._databaseType,s._databaseType})()}isTable(){return this._relatedLayer.isTable()}_isInFeatureSet(){return F.dj.InFeatureSet}_candidateIdTransform(s){return s}_getSet(s){var i=this;return(0,R.Z)(function*(){if(null===i._wset){yield i._ensureLoaded();const u=yield i._getFilteredSet("",null,null,null,s);return i._wset=u,u}return i._wset})()}_changeFeature(s){const i={};for(const u of this.fields)i[u.name]=s.attributes[u.name];return new Q.Z({geometry:!0===this._removeGeometry?null:s.geometry,attributes:i})}_getFilteredSet(s,i,u,l,y){var c=this;return(0,R.Z)(function*(){if(yield c.databaseType(),c.isTable()&&i&&null!==s&&""!==s)return new b.Z([],[],!0,null);const C=c._layer.nativeCapabilities();if(!1===C.canQueryRelated)return new b.Z([],[],!0,null);if(C.capabilities?.queryRelated.supportsPagination)return c._getFilteredSetUsingPaging(s,i,u,l,y);let f="",Z=!1;null!==l&&!0===C.capabilities?.queryRelated.supportsOrderBy&&(f=l.constructClause(),Z=!0);const U=new He.default;U.objectIds=[c._findObjectId];const H=null!==c._overrideFields?c._overrideFields:c._fieldsIncludingObjectId(c._relatedLayer.fields?c._relatedLayer.fields.map(de=>de.name):["*"]);U.outFields=H,U.relationshipId=c.relationship.id,U.where="1=1";let re=!0;!0===c._removeGeometry&&(re=!1),U.returnGeometry=re,c._requestStandardised&&(U.sqlFormat="standard"),U.outSpatialReference=c.spatialReference,U.orderByFields=""!==f?f.split(","):null;const ne=yield C.source.queryRelatedFeatures(U);c._checkCancelled(y);const le=ne[c._findObjectId]?ne[c._findObjectId].features:[],_e=[];for(let de=0;de<le.length;de++)c._featureCache[le[de].attributes[c._relatedLayer.objectIdField]]=le[de],_e.push(le[de].attributes[c._relatedLayer.objectIdField]);const pe=i&&null!==s&&""!==s,ge=null!=u;return new b.Z(pe||ge?_e:[],pe||ge?[]:_e,Z,null)})()}_fieldsIncludingObjectId(s){if(null===s)return[this.objectIdField];const i=s.slice(0);if(i.includes("*"))return i;let u=!1;for(const l of i)if(l.toUpperCase()===this.objectIdField.toUpperCase()){u=!0;break}return!1===u&&i.push(this.objectIdField),i}_getFilteredSetUsingPaging(s,i,u,l,y){var c=this;return(0,R.Z)(function*(){let C="",f=!1;const Z=c._layer.nativeCapabilities();null!==l&&!0===Z.capabilities?.queryRelated.supportsOrderBy&&(C=l.constructClause(),f=!0),yield c.databaseType();let H=c._maxQueryRate();const re=Z.capabilities?.query.maxRecordCount;null!=re&&re<H&&(H=re);const ne=i&&null!==s&&""!==s,le=null!=u;let _e=null,pe=!0;!0===c._removeGeometry&&(pe=!1);const ge=null!==c._overrideFields?c._overrideFields:c._fieldsIncludingObjectId(c._relatedLayer.fields?c._relatedLayer.fields.map(de=>de.name):["*"]);return _e=new b.Z(ne||le?["GETPAGES"]:[],ne||le?[]:["GETPAGES"],f,{outFields:ge.join(","),resultRecordCount:H,resultOffset:0,objectIds:[c._findObjectId],where:"1=1",orderByFields:C,returnGeometry:pe,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}),yield c._expandPagedSet(_e,H,0,0,y),_e})()}_expandPagedSet(s,i,u,l,y){return this._expandPagedSetFeatureSet(s,i,u,l,y)}_clonePageDefinition(s){return null===s?null:!0!==s.groupbypage?{groupbypage:!1,outFields:s.outFields,resultRecordCount:s.resultRecordCount,resultOffset:s.resultOffset,where:s.where,objectIds:s.objectIds,orderByFields:s.orderByFields,returnGeometry:s.returnGeometry,returnIdsOnly:s.returnIdsOnly,internal:s.internal}:{groupbypage:!0,outFields:s.outFields,resultRecordCount:s.resultRecordCount,useOIDpagination:s.useOIDpagination,generatedOid:s.generatedOid,groupByFieldsForStatistics:s.groupByFieldsForStatistics,resultOffset:s.resultOffset,outStatistics:s.outStatistics,geometry:s.geometry,where:s.where,objectIds:s.objectIds,orderByFields:s.orderByFields,returnGeometry:s.returnGeometry,returnIdsOnly:s.returnIdsOnly,internal:s.internal}}_getPhysicalPage(s,i,u){var l=this;return(0,R.Z)(function*(){const y=s.pagesDefinition.internal.lastRetrieved,c=y,C=s.pagesDefinition.internal.lastPage,f=l._layer.nativeCapabilities(),Z=new He.default;!0===l._requestStandardised&&(Z.sqlFormat="standard"),Z.relationshipId=l.relationship.id,Z.objectIds=s.pagesDefinition.objectIds,Z.resultOffset=s.pagesDefinition.internal.lastPage,Z.resultRecordCount=s.pagesDefinition.resultRecordCount,Z.outFields=s.pagesDefinition.outFields.split(","),Z.where=s.pagesDefinition.where,Z.orderByFields=""!==s.pagesDefinition.orderByFields?s.pagesDefinition.orderByFields.split(","):null,Z.returnGeometry=s.pagesDefinition.returnGeometry,Z.outSpatialReference=l.spatialReference;const U=yield f.source.queryRelatedFeatures(Z);if(l._checkCancelled(u),s.pagesDefinition.internal.lastPage!==C)return 0;const H=U[l._findObjectId]?U[l._findObjectId].features:[];for(let ne=0;ne<H.length;ne++)s.pagesDefinition.internal.set[c+ne]=H[ne].attributes[l._relatedLayer.objectIdField];for(let ne=0;ne<H.length;ne++)l._featureCache[H[ne].attributes[l._relatedLayer.objectIdField]]=H[ne];return H.length!==s.pagesDefinition.resultRecordCount&&(!U[l._findObjectId]||!1===U[l._findObjectId].exceededTransferLimit)&&(s.pagesDefinition.internal.fullyResolved=!0),s.pagesDefinition.internal.lastRetrieved=y+H.length,s.pagesDefinition.internal.lastPage+=s.pagesDefinition.resultRecordCount,H.length})()}_getFeatures(s,i,u,l){var y=this;return(0,R.Z)(function*(){const c=[];-1!==i&&void 0===y._featureCache[i]&&c.push(i);const C=y._maxQueryRate();if(!0===y._checkIfNeedToExpandKnownPage(s,C))return yield y._expandPagedSet(s,C,0,0,l),y._getFeatures(s,i,u,l);let f=0;for(let Z=s._lastFetchedIndex;Z<s._known.length&&(f++,f<=u&&(s._lastFetchedIndex+=1),!("GETPAGES"!==s._known[Z]&&void 0===y._featureCache[s._known[Z]]&&(s._known[Z]!==i&&c.push(s._known[Z]),c.length>u)))&&!(f>=u&&0===c.length);Z++);if(0===c.length)return"success";throw new P.EN(P.H9.MissingFeatures)})()}_refineSetBlock(s,i,u){return(0,R.Z)(function*(){return s})()}_stat(s,i,u,l,y,c,C){return(0,R.Z)(function*(){return{calculated:!1}})()}get gdbVersion(){return this._relatedLayer.gdbVersion}_canDoAggregates(s,i,u,l,y){return(0,R.Z)(function*(){return!1})()}relationshipMetaData(){return this._relatedLayer.relationshipMetaData()}serviceUrl(){return this._relatedLayer.serviceUrl()}queryAttachments(s,i,u,l,y){return this._relatedLayer.queryAttachments(s,i,u,l,y)}getFeatureByObjectId(s,i){return this._relatedLayer.getFeatureByObjectId(s,i)}getOwningSystemUrl(){return this._relatedLayer.getOwningSystemUrl()}getIdentityUser(){return this._relatedLayer.getIdentityUser()}getDataSourceFeatureSet(){return this._relatedLayer}get preferredTimeZone(){return this._relatedLayer?.preferredTimeZone??null}get dateFieldsTimeZone(){return this._relatedLayer?.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._relatedLayer?.datesInUnknownTimezone}get editFieldsInfo(){return this._relatedLayer?.editFieldsInfo??null}get timeInfo(){return this._relatedLayer?.timeInfo??null}getFeatureSetInfo(){var s=this;return(0,R.Z)(function*(){return s.fsetInfo??s._layer.featureSetInfo})()}}var he=g(19104),Ye=g(67016),nt=g(95060),st=g(27835);function it(){null===he.Z.applicationCache&&(he.Z.applicationCache=new he.Z)}function Re(j,s,i){return Ue.apply(this,arguments)}function Ue(){return(Ue=(0,R.Z)(function*(j,s,i){if(he.Z.applicationCache){const u=he.Z.applicationCache.getLayerInfo(j);if(u){const c=yield u;return new Ce.default({url:j,outFields:s,sourceJSON:c})}const l=new Ce.default({url:j,outFields:s}),y=(0,R.Z)(function*(){return yield l.load(),l.sourceJSON})();if(he.Z.applicationCache){he.Z.applicationCache.setLayerInfo(j,y);try{return yield y,l}catch(c){throw he.Z.applicationCache.clearLayerInfo(j),c}}return yield y,l}if(null!=i){const u=i.getCachedLayerMetadata(j);if(u){const c=yield u;return new Ce.default({url:j,outFields:s,sourceJSON:c})}const l=new Ce.default({url:j,outFields:s}),y=(0,R.Z)(function*(){return yield l.load(),l.sourceJSON})();i.setCachedLayerMetadata(j,y);try{return yield y,l}catch(c){throw i.removeCachedLayerMetadata(j,y),c}}return new Ce.default({url:j,outFields:s})})).apply(this,arguments)}function Be(j,s,i,u,l){return We.apply(this,arguments)}function We(){return(We=(0,R.Z)(function*(j,s,i,u,l,y=null){return De(yield Re(j,["*"],l),s,i,u,l,y)})).apply(this,arguments)}function De(j,s=null,i=null,u=!0,l=null,y=null){if("catalog-footprint"===j.type)return De(j.parent,s,i,u,l,y);if("subtype-sublayer"===j.type){const c=De(j.parent,s,i,u,l,y);return c.filter(A.WhereClause.create(j.parent.subtypeField+"="+j.subtypeCode.toString(),j.parent.fieldsIndex,c.dateFieldsTimeZoneDefaultUTC))}if((0,F.FJ)(j)){const c={layer:j,spatialReference:s,outFields:i,includeGeometry:u,lrucache:l,interceptor:y};return j.url||!j.source?new Me(c):new tt.Z(c)}throw new Error(`Unsupported layer type: ${j.type}`)}function Ge(){return(Ge=(0,R.Z)(function*(j){if(null!==he.Z.applicationCache){const i=he.Z.applicationCache.getLayerInfo(j);if(null!==i)return i}const s=(0,R.Z)(function*(){const i=yield(0,te.Z)(j,{responseType:"json",query:{f:"json"}});return i.data?i.data:null})();if(null!==he.Z.applicationCache){he.Z.applicationCache.setLayerInfo(j,s);try{return yield s}catch(i){throw he.Z.applicationCache.clearLayerInfo(j),i}}return s})).apply(this,arguments)}function ze(){return(ze=(0,R.Z)(function*(j,s){const i="QUERYDATAELEMTS:"+s.toString()+":"+j;if(null!==he.Z.applicationCache){const l=he.Z.applicationCache.getLayerInfo(i);if(null!==l)return l}const u=(0,R.Z)(function*(){const l=yield(0,te.Z)(j+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([s.toString()]),f:"json"}});if(l.data){const y=l.data;if(y.layerDataElements?.[0])return y.layerDataElements[0]}throw new P.EN(P.H9.DataElementsNotFound)})();if(null!==he.Z.applicationCache){he.Z.applicationCache.setLayerInfo(i,u);try{return yield u}catch(l){throw he.Z.applicationCache.clearLayerInfo(i),l}}return u})).apply(this,arguments)}function qe(j,s){return ke.apply(this,arguments)}function ke(){return(ke=(0,R.Z)(function*(j,s){if(null!==he.Z.applicationCache){const u=he.Z.applicationCache.getLayerInfo(j);if(null!==u)return u}if(null!=s){const u=s.getCachedServiceMetadata(j);if(null!=u)return u}const i=(0,R.Z)(function*(){const u=yield(0,te.Z)(j,{responseType:"json",query:{f:"json"}});if(u.data){const l=u.data;return l.layers||(l.layers=[]),l.tables||(l.tables=[]),l}return{layers:[],tables:[]}})();if(null!==he.Z.applicationCache){he.Z.applicationCache.setLayerInfo(j,i);try{return yield i}catch(u){throw he.Z.applicationCache.clearLayerInfo(j),u}}if(null!=s){s.setCachedServiceMetadata(j,i);try{return yield i}catch(u){throw s.removeCachedServiceMetadata(j,i),u}}return i})).apply(this,arguments)}function ot(j,s){return Ke.apply(this,arguments)}function Ke(){return Ke=(0,R.Z)(function*(j,s){const i={metadata:null,networkId:-1,unVersion:3,terminals:[],queryelem:null,layerNameLkp:{},lkp:null},u=yield qe(j,null);if(i.metadata=u,void 0!==u.controllerDatasetLayers?.utilityNetworkLayerId&&null!==u.controllerDatasetLayers.utilityNetworkLayerId){if(u.layers)for(const c of u.layers)i.layerNameLkp[c.id]=c.name;if(u.tables)for(const c of u.tables)i.layerNameLkp[c.id]=c.name;const l=u.controllerDatasetLayers.utilityNetworkLayerId;i.networkId=l;const y=yield function lt(j,s){return ze.apply(this,arguments)}(j,l);if(y){i.queryelem=y,i.queryelem?.dataElement&&void 0!==i.queryelem.dataElement.schemaGeneration&&(i.unVersion=i.queryelem.dataElement.schemaGeneration),i.lkp={},i.queryelem.dataElement.domainNetworks||(i.queryelem.dataElement.domainNetworks=[]);for(const C of i.queryelem.dataElement.domainNetworks){for(const f of C.edgeSources??[]){const Z={layerId:f.layerId,sourceId:f.sourceId,className:i.layerNameLkp[f.layerId]??null};Z.className&&(i.lkp[Z.className]=Z)}for(const f of C.junctionSources??[]){const Z={layerId:f.layerId,sourceId:f.sourceId,className:i.layerNameLkp[f.layerId]??null};Z.className&&(i.lkp[Z.className]=Z)}}if(i.queryelem.dataElement.terminalConfigurations)for(const C of i.queryelem.dataElement.terminalConfigurations)for(const f of C.terminals)i.terminals.push({terminalId:f.terminalId,terminalName:f.terminalName});const c=yield function at(j){return Ge.apply(this,arguments)}(j+"/"+l);if(void 0!==c.systemLayers?.associationsTableId&&null!==c.systemLayers.associationsTableId){const C=[];i.unVersion>=4&&(C.push("STATUS"),C.push("PERCENTALONG"));let f=yield Be(j+"/"+c.systemLayers.associationsTableId.toString(),s,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID",...C],!1,null,null);return yield f.load(),i.unVersion>=4&&(f=f.filter(A.WhereClause.create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62, 63)",f.getFieldsIndex(),f.dateFieldsTimeZoneDefaultUTC)),yield f.load()),{lkp:i.lkp,associations:f,unVersion:i.unVersion,terminals:i.terminals}}return{associations:null,unVersion:i.unVersion,lkp:null,terminals:[]}}return{associations:null,unVersion:i.unVersion,lkp:null,terminals:[]}}return{associations:null,unVersion:i.unVersion,lkp:null,terminals:[]}}),Ke.apply(this,arguments)}function ut(j,s,i){return Ve.apply(this,arguments)}function Ve(){return(Ve=(0,R.Z)(function*(j,s,i,u=null,l=null,y=!0,c=null,C=null){let f=j.serviceUrl();if(!f)return null;f="/"===f.charAt(f.length-1)?f+s.relatedTableId.toString():f+"/"+s.relatedTableId.toString();const Z=yield Be(f,u,l,y,c,C);return new rt({layer:j,relatedLayer:Z,relationship:s,objectId:i,spatialReference:u,outFields:l,includeGeometry:y,lrucache:c,interceptor:C})})).apply(this,arguments)}G.Z.registerAction(),Y.registerAction(),N.Z.registerAction(),k.Z.registerAction(),M.Z.registerAction();class dt extends ee{constructor(s,i=null,u=null,l=null){super(),this._map=s,this._overridespref=i,this._lrucache=u,this._interceptor=l,this._instantLayers=[]}_makeAndAddFeatureSet(s,i=!0,u=null){const l=De(s,this._overridespref,null===u?["*"]:u,i,this._lrucache,this._interceptor);return this._instantLayers.push({featureset:l,opitem:s,includeGeometry:i,outFields:JSON.stringify(u)}),l}featureSetByName(s,i=!0,u=null){var l=this;return(0,R.Z)(function*(){if(Ye.Z.isLoadable(l._map)&&!l._map.loaded)return yield l._map.load(),l.featureSetByName(s,i,u);null===u&&(u=["*"]),u=(u=u.slice(0)).sort();const y=JSON.stringify(u);for(let C=0;C<l._instantLayers.length;C++){const f=l._instantLayers[C];if(f.opitem.title===s&&f.includeGeometry===i&&f.outFields===y)return l._instantLayers[C].featureset}const c=l._map.allLayers.find(C=>(0,F.yJ)(C)&&C.title===s);if(null!=c)return l._makeAndAddFeatureSet(c,i,u);if(l._map.tables){const C=l._map.tables.find(f=>f.title===s);if(null!=C){if(C instanceof Ce.default)return l._makeAndAddFeatureSet(C,i,u);if(null==C._materializedTable){const f=C.outFields?C:{...C,outFields:["*"]};C._materializedTable=new Ce.default(f)}return yield C._materializedTable.load(),l._makeAndAddFeatureSet(C._materializedTable,i,u)}}return null})()}featureSetById(s,i=!0,u=["*"]){var l=this;return(0,R.Z)(function*(){if(Ye.Z.isLoadable(l._map)&&!l._map.loaded)return yield l._map.load(),l.featureSetById(s,i,u);null===u&&(u=["*"]),u=(u=u.slice(0)).sort();const y=JSON.stringify(u);for(let C=0;C<l._instantLayers.length;C++){const f=l._instantLayers[C];if(f.opitem.id===s&&f.includeGeometry===i&&f.outFields===y)return l._instantLayers[C].featureset}const c=l._map.allLayers.find(C=>(0,F.yJ)(C)&&C.id===s);if(c)return l._makeAndAddFeatureSet(c,i,u);if(l._map.tables){const C=l._map.tables.find(f=>f.id===s);if(null!=C){if(C instanceof Ce.default)return l._makeAndAddFeatureSet(C,i,u);if(null==C._materializedTable){const f={...C,outFields:["*"]};C._materializedTable=new Ce.default(f)}return yield C._materializedTable.load(),l._makeAndAddFeatureSet(C._materializedTable,i,u)}}return null})()}}class Qe extends ee{constructor(s,i=null,u=null,l=null){super(),this._url=s,this._overridespref=i,this._lrucache=u,this._interceptor=l,this.metadata=null,this._instantLayers=[]}get url(){return this._url}_makeAndAddFeatureSet(s,i=!0,u=null){const l=De(s,this._overridespref,null===u?["*"]:u,i,this._lrucache);return this._instantLayers.push({featureset:l,opitem:s,includeGeometry:i,outFields:JSON.stringify(u)}),l}_loadMetaData(){var s=this;return(0,R.Z)(function*(){const i=yield qe(s._url,s._lrucache);return s.metadata=i,i})()}load(){return this._loadMetaData()}clone(){return new Qe(this._url,this._overridespref,this._lrucache,this._interceptor)}featureSetByName(s,i=!0,u=null){var l=this;return(0,R.Z)(function*(){null===u&&(u=["*"]),u=(u=u.slice(0)).sort();const y=JSON.stringify(u);for(let f=0;f<l._instantLayers.length;f++){const Z=l._instantLayers[f];if(Z.opitem.title===s&&Z.includeGeometry===i&&Z.outFields===y)return l._instantLayers[f].featureset}const c=yield l._loadMetaData();let C=null;for(const f of c.layers??[])f.name===s&&(C=f);if(!C)for(const f of c.tables??[])f.name===s&&(C=f);if(C){const f=yield Re(l._url+"/"+C.id,["*"],l._lrucache);return l._makeAndAddFeatureSet(f,i,u)}return null})()}featureSetById(s,i=!0,u=["*"]){var l=this;return(0,R.Z)(function*(){null===u&&(u=["*"]),u=(u=u.slice(0)).sort();const y=JSON.stringify(u);s=null!=s?s.toString():"";for(let f=0;f<l._instantLayers.length;f++){const Z=l._instantLayers[f];if(Z.opitem.id===s&&Z.includeGeometry===i&&Z.outFields===y)return l._instantLayers[f].featureset}const c=yield l._loadMetaData();let C=null;for(const f of c.layers??[])null!=f.id&&f.id.toString()===s&&(C=f);if(!C)for(const f of c.tables??[])null!=f.id&&f.id.toString()===s&&(C=f);if(C){const f=yield Re(l._url+"/"+C.id,["*"],l._lrucache);return l._makeAndAddFeatureSet(f,i,u)}return null})()}}function ct(j,s,i=null,u=null){return new dt(j,s,i,u)}function ht(j,s,i=null,u=null){return new Qe(j,s,i,u)}function ft(j,s,i,u,l){if(null===j)return null;if((0,W.u)(j)){switch(s){case"datasource":return j.getDataSourceFeatureSet();case"parent":return j;case"root":return j.getRootFeatureSet()}return null}if(j instanceof nt.Z&&(0,F.FJ)(j)){const y=j;switch(s){case"datasource":return De(y,l,y.outFields,!0,i,u).getDataSourceFeatureSet();case"parent":case"root":return De(y,l,y.outFields,!0,i,u)}return null}if((0,W.$)(j)){switch(s){case"datasource":return De(j.parent,l,j.parent.outFields,!0,i,u).getDataSourceFeatureSet();case"parent":case"root":return De(j,l,j.parent.outFields,!0,i,u)}return null}return null}function _t(j,s,i,u,l,y,c){return Je.apply(this,arguments)}function Je(){return(Je=(0,R.Z)(function*(j,s,i,u,l,y,c,C=null){if(he.Z.applicationCache){const Z=he.Z.applicationCache.getLayerInfo(j+":"+y.url);if(Z){const U=yield Z;return De(yield Re((0,F.US)(U.url??"")+"/"+s,["*"],c),i,u,l,c,C)}}if(null!=c){const Z=c.getCachedPortalItem(y.url,j);if(null!=Z){const U=yield Z;return De(yield Re((0,F.US)(U.url??"")+"/"+s,["*"],c),i,u,l,c,C)}}const f=new st.default({id:j,portal:y}).load();he.Z.applicationCache?he.Z.applicationCache.setLayerInfo(j+":"+y.url,f):c?.setCachedPortalItem(y.url,j,f);try{const Z=yield f;return De(yield Re((0,F.US)(Z.url??"")+"/"+s,["*"],c),i,u,l,c,C)}catch(Z){throw he.Z.applicationCache&&he.Z.applicationCache.clearLayerInfo(j+":"+y.url),c?.removeCachedPortalItem(y.url,j,f),Z}})).apply(this,arguments)}},94511:(Ie,ie,g)=>{g.d(ie,{$X:()=>F,QP:()=>L,TO:()=>p,Xx:()=>x,yN:()=>A});var R=g(15861),te=g(35458),ee=g(25137),W=g(70930),G=g(95418),Q=g(58446),K=g(76961),N=g(77023),P=g(51172),w=g(85904),b=g(43814);class S{constructor(I){this.field=I,this.sqlRewritable=!1}postInitialization(I,d){}}class F extends S{constructor(I){super(I),this.sqlRewritable=!0}extractValue(I){return I.attributes[this.field.name]}rewriteSql(I){return{rewritten:this.sqlRewritable,where:I}}}class L extends S{constructor(I,d,v){super((0,K.JW)(I)),this.originalField=I,this.sqlRewritable=!0,this.field.name=d,this.field.alias=v}rewriteSql(I,d){return{rewritten:this.sqlRewritable,where:(0,N.bB)(I,this.field.name,this.originalField.name,d.getFieldsIndex())}}extractValue(I){return I.attributes[this.originalField.name]}}let p=(()=>{class E extends S{constructor(d,v,m){super(d),this.codefield=v,this.lkp=m,this.reverseLkp={};for(const h in m)this.reverseLkp[m[h]]=h;this.sqlRewritable=!0}rewriteSql(d,v){const m=this.evaluateNodeToWhereClause(d.parseTree,K.Bj.Standardised,this.field.name,this.codefield instanceof w.WhereClause?(0,N.zR)(this.codefield,K.Bj.Standardised):this.codefield,d.parameters);return m.includes(E.BADNESS)?{rewritten:!1,where:d}:{rewritten:this.sqlRewritable,where:w.WhereClause.create(m,v._parent.getFieldsIndex(),v.dateFieldsTimeZoneDefaultUTC)}}evaluateNodeToWhereClause(d,v,m=null,h=null,_){let B,V,Y,k;switch(d.type){case"interval":return(0,N.TE)(this.evaluateNodeToWhereClause(d.value,v,m,h,_),d.qualifier,d.op);case"case-expression":{let M=" CASE ";"simple"===d.format&&(M+=this.evaluateNodeToWhereClause(d.operand,v,m,E.BADNESS,_));for(let J=0;J<d.clauses.length;J++)M+=" WHEN "+this.evaluateNodeToWhereClause(d.clauses[J].operand,v,m,E.BADNESS,_)+" THEN "+this.evaluateNodeToWhereClause(d.clauses[J].value,v,m,E.BADNESS,_);return null!==d.else&&(M+=" ELSE "+this.evaluateNodeToWhereClause(d.else,v,m,E.BADNESS,_)),M+=" END ",M}case"parameter":{const M=_[d.value.toLowerCase()];if("string"==typeof M)return"'"+M.toString().replaceAll("'","''")+"'";if((0,K.J_)(M)||(0,K.T4)(M))return(0,N.vn)(M,v);if((0,K._U)(M))return(0,N.wF)(M,v);if((0,K.NP)(M))return(0,N.mA)(M,v);if((0,K.$A)(M))return(0,N.av)(M,v);if(Array.isArray(M)){const J=[];for(let $=0;$<M.length;$++)"string"==typeof M[$]?J.push("'"+M[$].toString().replaceAll("'","''")+"'"):(0,K.J_)(M[$])||(0,K.T4)(M[$])?J.push((0,N.vn)(M[$],v)):(0,K._U)(M[$])?J.push((0,N.wF)(M[$],v)):(0,K.NP)(M[$])?J.push((0,N.mA)(M[$],v)):(0,K.$A)(M[$])?J.push((0,N.av)(M[$],v)):J.push(M[$].toString());return J}return M.toString()}case"expression-list":V=[];for(const M of d.value)V.push(this.evaluateNodeToWhereClause(M,v,m,h,_));return V;case"unary-expression":return" ( NOT "+this.evaluateNodeToWhereClause(d.expr,v,m,E.BADNESS,_)+" ) ";case"binary-expression":switch(d.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(d.left,v,m,h,_)+" AND "+this.evaluateNodeToWhereClause(d.right,v,m,h,_)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(d.left,v,m,h,_)+" OR "+this.evaluateNodeToWhereClause(d.right,v,m,h,_)+") ";case"IS":if("null"!==d.right.type)throw new W.eS(W.f.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(d.left,v,m,h,_)+" IS NULL )";case"ISNOT":if("null"!==d.right.type)throw new W.eS(W.f.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(d.left,v,m,h,_)+" IS NOT NULL )";case"IN":if(B=[],"expression-list"===d.right.type){if("column-reference"===d.left.type&&d.left.column.toUpperCase()===this.field.name.toUpperCase()){const M=[];let J=!0;for(const $ of d.right.value){if("string"!==$.type){J=!1;break}if(void 0===this.lkp[$.value]){J=!1;break}M.push(this.lkp[$.value].toString())}if(J)return" ("+this.evaluateNodeToWhereClause(d.left,v,m,h,_)+" IN ("+M.join(",")+")) "}return B=this.evaluateNodeToWhereClause(d.right,v,m,h,_)," ("+this.evaluateNodeToWhereClause(d.left,v,m,h,_)+" IN ("+B.join(",")+")) "}return k=this.evaluateNodeToWhereClause(d.right,v,m,h,_),Array.isArray(k)?" ("+this.evaluateNodeToWhereClause(d.left,v,m,h,_)+" IN ("+k.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(d.left,v,m,h,_)+" IN ("+k+")) ";case"NOT IN":if(B=[],"expression-list"===d.right.type){if("column-reference"===d.left.type&&d.left.column.toUpperCase()===this.field.name.toUpperCase()){const M=[];let J=!0;for(const $ of d.right.value){if("string"!==$.type){J=!1;break}if(void 0===this.lkp[$.value]){J=!1;break}M.push(this.lkp[$.value].toString())}if(J)return" ("+this.evaluateNodeToWhereClause(d.left,v,m,h,_)+" NOT IN ("+M.join(",")+")) "}return B=this.evaluateNodeToWhereClause(d.right,v,m,h,_)," ("+this.evaluateNodeToWhereClause(d.left,v,m,h,_)+" NOT IN ("+B.join(",")+")) "}return k=this.evaluateNodeToWhereClause(d.right,v,m,h,_),Array.isArray(k)?" ("+this.evaluateNodeToWhereClause(d.left,v,m,h,_)+" NOT IN ("+k.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(d.left,v,m,h,_)+" NOT IN ("+k+")) ";case"BETWEEN":return Y=this.evaluateNodeToWhereClause(d.right,v,m,E.BADNESS,_)," ("+this.evaluateNodeToWhereClause(d.left,v,m,E.BADNESS,_)+" BETWEEN "+Y[0]+" AND "+Y[1]+" ) ";case"NOTBETWEEN":return Y=this.evaluateNodeToWhereClause(d.right,v,m,E.BADNESS,_)," ("+this.evaluateNodeToWhereClause(d.left,v,m,E.BADNESS,_)+" NOT BETWEEN "+Y[0]+" AND "+Y[1]+" ) ";case"LIKE":return""!==d.escape?" ("+this.evaluateNodeToWhereClause(d.left,v,m,E.BADNESS,_)+" LIKE "+this.evaluateNodeToWhereClause(d.right,v,m,E.BADNESS,_)+" ESCAPE '"+d.escape+"') ":" ("+this.evaluateNodeToWhereClause(d.left,v,m,E.BADNESS,_)+" LIKE "+this.evaluateNodeToWhereClause(d.right,v,m,E.BADNESS,_)+") ";case"NOT LIKE":return""!==d.escape?" ("+this.evaluateNodeToWhereClause(d.left,v,m,E.BADNESS,_)+" NOT LIKE "+this.evaluateNodeToWhereClause(d.right,v,m,E.BADNESS,_)+" ESCAPE '"+d.escape+"') ":" ("+this.evaluateNodeToWhereClause(d.left,v,m,E.BADNESS,_)+" NOT LIKE "+this.evaluateNodeToWhereClause(d.right,v,m,E.BADNESS,_)+") ";case"<>":case"=":if("column-reference"===d.left.type&&"string"===d.right.type){if(d.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[d.right.value.toString()])return" ("+h+" "+d.operator+" "+this.lkp[d.right.value.toString()].toString()+") "}else if("column-reference"===d.right.type&&"string"===d.left.type&&d.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[d.right.value.toString()].toString()+" "+d.operator+" "+h+") ";return" ("+this.evaluateNodeToWhereClause(d.left,v,m,E.BADNESS,_)+" "+d.operator+" "+this.evaluateNodeToWhereClause(d.right,v,m,E.BADNESS,_)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":case"||":return" ("+this.evaluateNodeToWhereClause(d.left,v,m,E.BADNESS,_)+" "+d.operator+" "+this.evaluateNodeToWhereClause(d.right,v,m,E.BADNESS,_)+") "}case"null":return"null";case"boolean":return!0===d.value?"1":"0";case"string":return"'"+d.value.toString().replaceAll("'","''")+"'";case"timestamp":return`timestamp '${d.value}'`;case"date":return`date '${d.value}'`;case"time":return`time '${d.value}'`;case"number":return d.value.toString();case"current-time":return(0,N.vR)("date"===d.mode,v);case"column-reference":return m&&m.toLowerCase()===d.column.toLowerCase()?"("+h+")":d.column;case"data-type":return d.value;case"function":{const M=this.evaluateNodeToWhereClause(d.args,v,m,E.BADNESS,_);return(0,N.fz)(d.name,M,v)}}throw new W.eS(W.f.UnsupportedSyntax,{node:d.type})}extractValue(d){return this.codefield instanceof w.WhereClause?this.reverseLkp[w.WhereClause.convertValueToStorageFormat(this.codefield.calculateValueCompiled(d))]:this.reverseLkp[d.attributes[this.codefield]]}}return E.BADNESS="_!!!_BAD_LKP_!!!!",E})();class A extends S{constructor(I,d){super(I),this._sql=d}rewriteSql(I,d){return{rewritten:!0,where:(0,N.bB)(I,this.field.name,(0,N.zR)(this._sql,K.Bj.Standardised),d.getFieldsIndex())}}extractValue(I){return w.WhereClause.convertValueToStorageFormat(this._sql.calculateValueCompiled(I),this.field.type)}}class x extends G.Z{static findField(I,d){for(const v of I)if(v.name.toLowerCase()===d.toString().toLowerCase())return v;return null}constructor(I){super(I),this._calcFunc=null,this.declaredClass="esri.arcade.featureset.actions.Adapted",this.adaptedFields=[],this._extraFilter=null,this._extraFilter=I.extraFilter,this._parent=I.parentfeatureset,this._maxProcessing=30,this.adaptedFields=I.adaptedFields}_initialiseFeatureSet(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new b.Z({wkid:4326}),this.objectIdField="",this.globalIdField="",this.geometryType=K.Qk.point,this.typeIdField="",this.types=null,this.subtypeField=null,this.subtypes=null),this.fields=[];for(const I of this.adaptedFields)I.postInitialization(this,this._parent),this.fields.push(I.field)}_getSet(I){var d=this;return(0,R.Z)(function*(){if(null===d._wset){yield d._ensureLoaded();let v=null;return v=d._extraFilter?yield d._getFilteredSet("",null,null,null,I):yield d._parent?._getSet(I),d._checkCancelled(I),(0,P.O3)(v),d._wset=new Q.Z(v._candidates.slice(0),v._known.slice(0),v._ordered,d._clonePageDefinition(v.pagesDefinition)),d._wset}return d._wset})()}_isInFeatureSet(I){return this._parent._isInFeatureSet(I)}_getFeatures(I,d,v,m){var h=this;return(0,R.Z)(function*(){const _=[];-1!==d&&void 0===h._featureCache[d]&&_.push(d);const B=h._maxQueryRate();if(!0===h._checkIfNeedToExpandKnownPage(I,B))return yield h._expandPagedSet(I,B,0,0,m),h._getFeatures(I,d,v,m);let V=0;for(let M=I._lastFetchedIndex;M<I._known.length&&(V++,V<=v&&(I._lastFetchedIndex+=1),!(void 0===h._featureCache[I._known[M]]&&(I._known[M]!==d&&_.push(I._known[M]),_.length>=B)));M++);if(0===_.length)return"success";I=new Q.Z([],_,I._ordered,null);const Y=Math.min(_.length,v);yield h._parent?._getFeatures(I,-1,Y,m),h._checkCancelled(m);const k=[];for(let M=0;M<Y;M++){const J=h._parent?._featureFromCache(_[M]);void 0!==J&&k.push({geometry:J.geometry,attributes:J.attributes,id:_[M]})}for(const M of k){const J=[];for(const $ of h.adaptedFields)J[$.field.name]=$.extractValue(M);h._featureCache[M.id]=new te.Z({attributes:J,geometry:(0,ee.r1)(M.geometry)})}return"success"})()}_fetchAndRefineFeatures(){return(0,R.Z)(function*(){throw new W.EN(W.H9.NeverReach)})()}_getFilteredSet(I,d,v,m,h){var _=this;return(0,R.Z)(function*(){let B=!1;const V=_._reformulateWithoutAdaptions(v);B=V.cannot,v=V.where;let Y=!1;if(null!==m){Y=!0;const J=[];for(const $ of _.adaptedFields)if(!($ instanceof F)&&!0===m.scanForField($.field.name)){if(!($ instanceof L)){m=null,Y=!1;break}J.push({field:$.field.name,newfield:$.originalField.name})}m&&J.length>0&&(m=m.replaceFields(J))}null!==v?null!==_._extraFilter&&(v=(0,N.$e)(_._extraFilter,v)):v=_._extraFilter,yield _._ensureLoaded();const k=yield _._parent._getFilteredSet(I,d,v,m,h);let M;return _._checkCancelled(h),M=!0===B?new Q.Z(k._candidates.slice(0).concat(k._known.slice(0)),[],!0===Y&&k._ordered,_._clonePageDefinition(k.pagesDefinition)):new Q.Z(k._candidates.slice(0),k._known.slice(0),!0===Y&&k._ordered,_._clonePageDefinition(k.pagesDefinition)),M})()}_reformulateWithoutAdaptions(I){const d={cannot:!1,where:I};if(null!==I)for(const v of this.adaptedFields)if(!0===(0,N.hq)(I,v.field.name)){const m=v.rewriteSql(I,this);if(!0!==m.rewritten){d.cannot=!0,d.where=null;break}d.where=m.where}return d}_stat(I,d,v,m,h,_,B){var V=this;return(0,R.Z)(function*(){let Y=!1,k=V._reformulateWithoutAdaptions(d);if(Y=k.cannot,d=k.where,k=V._reformulateWithoutAdaptions(h),Y=Y||k.cannot,null!==(h=k.where)?null!==V._extraFilter&&(h=(0,N.$e)(V._extraFilter,h)):h=V._extraFilter,!0===Y)return null===h&&""===v&&null===m?V._manualStat(I,d,_,B):{calculated:!1};const M=yield V._parent._stat(I,d,v,m,h,_,B);return!1===M.calculated?null===h&&""===v&&null===m?V._manualStat(I,d,_,B):{calculated:!1}:M})()}_canDoAggregates(I,d,v,m,h){var _=this;return(0,R.Z)(function*(){if(null===_._parent)return!1;for(let Y=0;Y<I.length;Y++)for(const k of _.adaptedFields)if(I[Y].toLowerCase()===k.field.name.toLowerCase()&&!(k instanceof F))return!1;const B=[];for(let Y=0;Y<d.length;Y++){const k=d[Y];if(null!==k.workingexpr){const M=_._reformulateWithoutAdaptions(k.workingexpr);if(M.cannot)return!1;const J=k.clone();J.workingexpr=M.where,B.push(J)}else B.push(k)}const V=_._reformulateWithoutAdaptions(h);return!V.cannot&&(null!==(h=V.where)?null!==_._extraFilter&&(h=(0,N.$e)(_._extraFilter,h)):h=_._extraFilter,_._parent._canDoAggregates(I,B,v,m,h))})()}_getAggregatePagesDataSourceDefinition(I,d,v,m,h,_,B){var V=this;return(0,R.Z)(function*(){if(null===V._parent)throw new W.EN(W.H9.NeverReach);const Y=[];for(let M=0;M<d.length;M++){const J=d[M];if(null!==J.workingexpr){const $=V._reformulateWithoutAdaptions(J.workingexpr);if($.cannot)throw new W.EN(W.H9.NeverReach);const ae=J.clone();ae.workingexpr=$.where,Y.push(ae)}else Y.push(J)}const k=V._reformulateWithoutAdaptions(h);if(k.cannot)throw new W.EN(W.H9.NeverReach);return null!==(h=k.where)?null!==V._extraFilter&&(h=(0,N.$e)(V._extraFilter,h)):h=V._extraFilter,V._parent._getAggregatePagesDataSourceDefinition(I,Y,v,m,h,_,B)})()}}},52034:(Ie,ie,g)=>{g.d(ie,{Z:()=>w});var R=g(15861),te=g(70930),ee=g(95418),W=g(58446),G=g(76961),Q=g(77023),K=g(79412),N=g(85904),P=g(43814);class w extends ee.Z{constructor(S){super(S),this.declaredClass="esri.arcade.featureset.actions.AttributeFilter",this._maxProcessing=1e3,this._parent=S.parentfeatureset,S.whereclause instanceof N.WhereClause?(this._whereclause=S.whereclause,this._whereClauseFunction=null):(this._whereClauseFunction=S.whereclause,this._whereclause=null)}_initialiseFeatureSet(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types,this.subtypeField=this._parent.subtypeField,this.subtypes=this._parent.subtypes):(this.fields=[],this.typeIdField="",this.subtypeField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new P.Z({wkid:4326}),this.geometryType=G.Qk.point)}_getSet(S){var F=this;return(0,R.Z)(function*(){if(null===F._wset){yield F._ensureLoaded();const L=yield F._parent._getFilteredSet("",null,F._whereclause,null,S);return F._checkCancelled(S),F._wset=null!==F._whereClauseFunction?new W.Z(L._candidates.slice(0).concat(L._known.slice(0)),[],L._ordered,F._clonePageDefinition(L.pagesDefinition)):new W.Z(L._candidates.slice(0),L._known.slice(0),L._ordered,F._clonePageDefinition(L.pagesDefinition)),F._wset}return F._wset})()}_isInFeatureSet(S){let F=this._parent?._isInFeatureSet(S);return F===G.dj.NotInFeatureSet?F:(F=this._idstates[S],void 0===F?G.dj.Unknown:F)}_getFeature(S,F,L){return this._parent._getFeature(S,F,L)}_getFeatures(S,F,L,p){return this._parent._getFeatures(S,F,L,p)}_featureFromCache(S){return this._parent._featureFromCache(S)}executeWhereClause(S){return this._whereclause?.testFeature(S)??!1}executeWhereClauseDeferred(S){var F=this;return(0,R.Z)(function*(){if(null!==F._whereClauseFunction){const L=F._whereClauseFunction(S);return(0,K.y8)(L),L}return F.executeWhereClause(S)})()}_fetchAndRefineFeatures(S,F,L){var p=this;return(0,R.Z)(function*(){const A=new W.Z([],S,!1,null),x=Math.min(F,S.length);if(yield p._parent?._getFeatures(A,-1,x,L),p._checkCancelled(L),null==p._whereClauseFunction){for(let I=0;I<x;I++){const d=p._parent?._featureFromCache(S[I]);p._idstates[S[I]]=!0===p.executeWhereClause(d)?G.dj.InFeatureSet:G.dj.NotInFeatureSet}return"success"}const E=[];for(let I=0;I<x;I++){const d=p._parent?._featureFromCache(S[I]);E.push(yield p.executeWhereClauseDeferred(d))}for(let I=0;I<F;I++)p._idstates[S[I]]=!0===E[I]?G.dj.InFeatureSet:G.dj.NotInFeatureSet;return"success"})()}_getFilteredSet(S,F,L,p,A){var x=this;return(0,R.Z)(function*(){null!==x._whereClauseFunction||(null!==L?null!==x._whereclause&&(L=(0,Q.$e)(x._whereclause,L)):L=x._whereclause),yield x._ensureLoaded();const E=yield x._parent._getFilteredSet(S,F,L,p,A);let I;return x._checkCancelled(A),I=null!==x._whereClauseFunction?new W.Z(E._candidates.slice(0).concat(E._known.slice(0)),[],E._ordered,x._clonePageDefinition(E.pagesDefinition)):new W.Z(E._candidates.slice(0),E._known.slice(0),E._ordered,x._clonePageDefinition(E.pagesDefinition)),I})()}_stat(S,F,L,p,A,x,E){var I=this;return(0,R.Z)(function*(){if(null!==I._whereClauseFunction)return null===A&&""===L&&null===p?I._manualStat(S,F,x,E):{calculated:!1};let d=I._whereclause;null!==A&&null!==I._whereclause&&(d=(0,Q.$e)(I._whereclause,A));const v=yield I._parent._stat(S,F,L,p,d,x,E);return!1===v.calculated?null===A&&""===L&&null===p?I._manualStat(S,F,x,E):{calculated:!1}:v})()}_canDoAggregates(S,F,L,p,A){var x=this;return(0,R.Z)(function*(){return null===x._whereClauseFunction&&(null!==A?null!==x._whereclause&&(A=(0,Q.$e)(x._whereclause,A)):A=x._whereclause,null!==x._parent&&x._parent._canDoAggregates(S,F,L,p,A))})()}_getAggregatePagesDataSourceDefinition(S,F,L,p,A,x,E){var I=this;return(0,R.Z)(function*(){if(null===I._parent)throw new te.EN(te.H9.NeverReach);return null!==A?null!==I._whereclause&&(A=(0,Q.$e)(I._whereclause,A)):A=I._whereclause,I._parent._getAggregatePagesDataSourceDefinition(S,F,L,p,A,x,E)})()}static registerAction(){ee.Z._featuresetFunctions.filter=function(S){if("function"==typeof S)return new w({parentfeatureset:this,whereclause:S});let F=null;return S instanceof N.WhereClause&&(F=S),new w({parentfeatureset:this,whereclause:F})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},11375:(Ie,ie,g)=>{g.d(ie,{Z:()=>K});var R=g(15861),te=g(89018),ee=g(70930),W=g(95418),G=g(58446),Q=g(25677);class K extends W.Z{constructor(P){super(P),this._orderbyclause=null,this.declaredClass="esri.arcade.featureset.actions.OrderBy",this._maxProcessing=100,this._orderbyclause=P.orderbyclause,this._parent=P.parentfeatureset}_getSet(P){var w=this;return(0,R.Z)(function*(){if(null===w._wset){yield w._ensureLoaded();const b=yield w._getFilteredSet("",null,null,w._orderbyclause,P);return w._checkCancelled(P),w._wset=b,w._wset}return w._wset})()}manualOrderSet(P,w){var b=this;return(0,R.Z)(function*(){const S=yield b.getIdColumnDictionary(P,[],-1,w);b._orderbyclause?.order(S);const F=new G.Z([],[],!0,null);for(let L=0;L<S.length;L++)F._known.push(S[L].id);return F})()}getIdColumnDictionary(P,w,b,S){var F=this;return(0,R.Z)(function*(){if(b<P._known.length-1){const L=F._maxQueryRate();if("GETPAGES"===P._known[b+1])return yield(0,te.a0)(F._parent._expandPagedSet(P,L,0,0,S)),F.getIdColumnDictionary(P,w,b,S);let p=b+1;const A=[];for(;p<P._known.length&&"GETPAGES"!==P._known[p];)A.push(P._known[p]),p++;b+=A.length;const x=yield(0,te.a0)(F._parent._getFeatureBatch(A,S));F._checkCancelled(S);for(const E of x)w.push({id:E.attributes[F.objectIdField],feature:E});return F.getIdColumnDictionary(P,w,b,S)}return P._candidates.length>0?(yield(0,te.a0)(F._refineSetBlock(P,F._maxProcessingRate(),S)),F._checkCancelled(S),F.getIdColumnDictionary(P,w,b,S)):w})()}_isInFeatureSet(P){return this._parent._isInFeatureSet(P)}_getFeatures(P,w,b,S){return this._parent._getFeatures(P,w,b,S)}_featureFromCache(P){if(void 0===this._featureCache[P]){const w=this._parent._featureFromCache(P);return void 0===w?void 0:null===w?null:(this._featureCache[P]=w,w)}return this._featureCache[P]}_fetchAndRefineFeatures(){return(0,R.Z)(function*(){throw new ee.EN(ee.H9.NeverReach)})()}_getFilteredSet(P,w,b,S,F){var L=this;return(0,R.Z)(function*(){yield L._ensureLoaded();const p=yield L._parent._getFilteredSet(P,w,b,null===S?L._orderbyclause:S,F);L._checkCancelled(F);const A=new G.Z(p._candidates.slice(0),p._known.slice(0),p._ordered,L._clonePageDefinition(p.pagesDefinition));let x=!0;if(p._candidates.length>0&&(x=!1),!1===A._ordered){let E=yield L.manualOrderSet(A,F);return!1===x&&(null===w&&null===b||(E=new G.Z(E._candidates.slice(0).concat(E._known.slice(0)),[],E._ordered,L._clonePageDefinition(E.pagesDefinition)))),E}return A})()}static registerAction(){W.Z._featuresetFunctions.orderBy=function(P){return""===P?this:new K({parentfeatureset:this,orderbyclause:new Q.Z(P)})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},92224:(Ie,ie,g)=>{g.d(ie,{Z:()=>Q});var R=g(15861),te=g(70930),ee=g(95418),W=g(58446),G=g(76961);class Q extends ee.Z{constructor(N){super(N),this._topnum=0,this.declaredClass="esri.arcade.featureset.actions.Top",this._countedin=0,this._maxProcessing=100,this._topnum=N.topnum,this._parent=N.parentfeatureset}_getSet(N){var P=this;return(0,R.Z)(function*(){if(null===P._wset){yield P._ensureLoaded();const w=yield P._parent._getSet(N);return P._wset=new W.Z(w._candidates.slice(0),w._known.slice(0),!1,P._clonePageDefinition(w.pagesDefinition)),P._setKnownLength(P._wset)>P._topnum&&(P._wset._known=P._wset._known.slice(0,P._topnum)),P._setKnownLength(P._wset)>=P._topnum&&(P._wset._candidates=[]),P._wset}return P._wset})()}_setKnownLength(N){return N._known.length>0&&"GETPAGES"===N._known[N._known.length-1]?N._known.length-1:N._known.length}_isInFeatureSet(N){const P=this._parent._isInFeatureSet(N);if(P===G.dj.NotInFeatureSet)return P;const w=this._idstates[N];return w===G.dj.InFeatureSet||w===G.dj.NotInFeatureSet?w:P===G.dj.InFeatureSet&&void 0===w?this._countedin<this._topnum?(this._idstates[N]=G.dj.InFeatureSet,this._countedin++,G.dj.InFeatureSet):(this._idstates[N]=G.dj.NotInFeatureSet,G.dj.NotInFeatureSet):G.dj.Unknown}_expandPagedSet(N,P,w,b,S){var F=this;return(0,R.Z)(function*(){if(null===F._parent)throw new te.EN(te.H9.NotImplemented);if(P>F._topnum&&(P=F._topnum),F._countedin>=F._topnum&&N.pagesDefinition.internal.set.length<=N.pagesDefinition.resultOffset){let p=N._known.length;return p>0&&"GETPAGES"===N._known[p-1]&&(N._known.length=p-1),p=N._candidates.length,p>0&&"GETPAGES"===N._candidates[p-1]&&(N._candidates.length=p-1),"success"}const L=yield F._parent._expandPagedSet(N,P,w,b,S);return F._setKnownLength(N)>F._topnum&&(N._known.length=F._topnum),F._setKnownLength(N)>=F._topnum&&(N._candidates.length=0),L})()}_getFeatures(N,P,w,b){var S=this;return(0,R.Z)(function*(){const F=[],L=S._maxQueryRate();if(!0===S._checkIfNeedToExpandKnownPage(N,L))return yield S._expandPagedSet(N,L,0,0,b),S._getFeatures(N,P,w,b);-1!==P&&void 0===S._featureCache[P]&&F.push(P);let p=0;for(let E=N._lastFetchedIndex;E<N._known.length&&(p++,p<=w&&(N._lastFetchedIndex+=1),!(void 0===S._featureCache[N._known[E]]&&(N._known[E]!==P&&F.push(N._known[E]),F.length>L)));E++);if(0===F.length)return"success";const A=new W.Z([],F,!1,null),x=Math.min(F.length,w);yield S._parent._getFeatures(A,-1,x,b);for(let E=0;E<x;E++){const I=S._parent._featureFromCache(F[E]);void 0!==I&&(S._featureCache[F[E]]=I)}return"success"})()}_getFilteredSet(N,P,w,b,S){var F=this;return(0,R.Z)(function*(){yield F._ensureLoaded();const L=yield F._getSet(S);return new W.Z(L._candidates.slice(0).concat(L._known.slice(0)),[],!1,F._clonePageDefinition(L.pagesDefinition))})()}_refineKnowns(N,P){let w=0,b=null;const S=[];for(let F=0;F<N._candidates.length;F++){const L=this._isInFeatureSet(N._candidates[F]);if(L===G.dj.InFeatureSet){if(N._known.push(N._candidates[F]),w+=1,null===b?b={start:F,end:F}:b.end===F-1?b.end=F:(S.push(b),b={start:F,end:F}),N._known.length>=this._topnum)break}else if(L===G.dj.NotInFeatureSet)null===b?b={start:F,end:F}:b.end===F-1?b.end=F:(S.push(b),b={start:F,end:F}),w+=1;else if(L===G.dj.Unknown)break;if(w>=P)break}null!==b&&S.push(b);for(let F=S.length-1;F>=0;F--)N._candidates.splice(S[F].start,S[F].end-S[F].start+1);this._setKnownLength(N)>this._topnum&&(N._known=N._known.slice(0,this._topnum)),this._setKnownLength(N)>=this._topnum&&(N._candidates=[])}_stat(){return(0,R.Z)(function*(){return{calculated:!1}})()}_canDoAggregates(){return(0,R.Z)(function*(){return!1})()}static registerAction(){ee.Z._featuresetFunctions.top=function(N){return new Q({parentfeatureset:this,topnum:N})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},54339:(Ie,ie,g)=>{g.d(ie,{Z:()=>F});var R=g(15861),te=g(35458),ee=g(70930),W=g(95418),G=g(58446),Q=g(76961),K=g(77023),N=g(32184),P=g(90373),w=g(50243),b=g(81247),S=g(91866);class F extends W.Z{constructor(p){super(p),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",this._removeGeometry=!1,this._overrideFields=null,this._forceIsTable=!1,p.spatialReference&&(this.spatialReference=p.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=p.layer,this._wset=null,!0===p.isTable&&(this._forceIsTable=!0),void 0!==p.outFields&&(this._overrideFields=p.outFields),void 0!==p.includeGeometry&&(this._removeGeometry=!1===p.includeGeometry)}_maxQueryRate(){return Q.tI}end(){return this._layer}optimisePagingFeatureQueries(){}loadImpl(){var p=this;return(0,R.Z)(function*(){return!0===p._layer.loaded?(p._initialiseFeatureSet(),p):(yield p._layer.load(),p._initialiseFeatureSet(),p)})()}get gdbVersion(){return""}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const p=[],A=[];for(const x of this.fields)if("oid"===x.type)p.push(x),A.push(x.name);else for(const E of this._overrideFields)if(E.toLowerCase()===x.name.toLowerCase()){p.push(x),A.push(x.name);break}this.fields=p,this._overrideFields=A}this.objectIdField=this._layer.objectIdField;for(const p of this.fields)"global-id"===p.type&&(this.globalIdField=p.name);this._databaseType=Q.Bj.Standardised,this.hasZ=!0===this._layer?.capabilities?.data?.supportsZ,this.hasM=!0===this._layer?.capabilities?.data?.supportsM,"subtype-group"===this._layer.type?(this.subtypeField=this._layer.subtypeField??"",this.subtypes=this._layer.subtypes,this.types=null,this.typeIdField=null):"oriented-imagery"===this._layer.type?(this.subtypeField=null,this.subtypes=null,this.typeIdField=this._layer.typeIdField??"",this.types=this._layer.types):(this.subtypeField=this._layer.subtypeField,this.subtypes=this._layer.subtypes,this.typeIdField=this._layer.typeIdField??"",this.types=this._layer.types)}isTable(){return this._forceIsTable||this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType}_isInFeatureSet(){return Q.dj.InFeatureSet}_candidateIdTransform(p){return p}_getSet(p){var A=this;return(0,R.Z)(function*(){if(null===A._wset){yield A._ensureLoaded();const x=yield A._getFilteredSet("",null,null,null,p);return A._wset=x,x}return A._wset})()}_changeFeature(p){const A={};for(const x of this.fields)A[x.name]=p.attributes[x.name];return new te.Z({geometry:!0===this._removeGeometry?null:p.geometry,attributes:A})}_getFilteredSet(p,A,x,E,I){var d=this;return(0,R.Z)(function*(){let v="",m=!1;if(null!==E&&(v=E.constructClause(),m=!0),d.isTable()&&A&&null!==p&&""!==p)return new G.Z([],[],!0,null);const h=new S.Z;h.returnZ=d.hasZ,h.returnM=d.hasM,h.where=null===x?null===A?"1=1":"":(0,K.zR)(x,Q.Bj.Standardised),h.spatialRelationship=d._makeRelationshipEnum(p),h.outSpatialReference=d.spatialReference,h.orderByFields=""!==v?v.split(","):null,h.geometry=null===A?null:A,h.returnGeometry=!0,h.relationParameter=d._makeRelationshipParam(p);const _=yield d._layer.queryFeatures(h);if(null===_)return new G.Z([],[],m,null);d._checkCancelled(I);const B=[];return _.features.forEach(V=>{const Y=V.attributes[d._layer.objectIdField];B.push(Y),d._featureCache[Y]=d._changeFeature(V)}),new G.Z([],B,m,null)})()}_makeRelationshipEnum(p){if(p.includes("esriSpatialRelRelation"))return"relation";switch(p){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return p}_makeRelationshipParam(p){return p.includes("esriSpatialRelRelation")?p.split(":")[1]:""}_queryAllFeatures(){var p=this;return(0,R.Z)(function*(){if(p._wset)return p._wset;const A=new S.Z;if(A.where="1=1",yield p._ensureLoaded(),p._layer.source&&p._layer.source.items){const I=[];return p._layer.source.items.forEach(d=>{const v=d.attributes[p._layer.objectIdField];I.push(v),p._featureCache[v]=p._changeFeature(d)}),p._wset=new G.Z([],I,!1,null),p._wset}A.returnZ=p.hasZ,A.returnM=p.hasM;const x=yield p._layer.queryFeatures(A),E=[];return x.features.forEach(I=>{const d=I.attributes[p._layer.objectIdField];E.push(d),p._featureCache[d]=p._changeFeature(I)}),p._wset=new G.Z([],E,!1,null),p._wset})()}_getFeatures(p,A,x){var E=this;return(0,R.Z)(function*(){const I=[];-1!==A&&void 0===E._featureCache[A]&&I.push(A);for(let d=p._lastFetchedIndex;d<p._known.length&&(p._lastFetchedIndex+=1,!(void 0===E._featureCache[p._known[d]]&&(p._known[d]!==A&&I.push(p._known[d]),I.length>x)));d++);if(0===I.length)return"success";throw new ee.EN(ee.H9.MissingFeatures)})()}_refineSetBlock(p){return(0,R.Z)(function*(){return p})()}_stat(){return(0,R.Z)(function*(){return{calculated:!1}})()}_canDoAggregates(){return(0,R.Z)(function*(){return!1})()}relationshipMetaData(){return[]}static _cloneAttr(p){const A={};for(const x in p)A[x]=p[x];return A}nativeCapabilities(){return{title:this._layer.title??"",canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}}static create(p,A){let x=p.layerDefinition.objectIdField;const E=p.layerDefinition.typeIdField??"",I=[];if(p.layerDefinition.types)for(const k of p.layerDefinition.types)I.push(w.Z.fromJSON(k));let d=p.layerDefinition.geometryType;void 0===d&&(d=p.featureSet.geometryType||"");let v=p.featureSet.features;const m=A.toJSON();if(!x){let k=!1;for(const M of p.layerDefinition.fields)if("oid"===M.type||"esriFieldTypeOID"===M.type){x=M.name,k=!0;break}if(!1===k){let M="FID",J=!0,$=0;for(;J;){let fe=!0;for(const ce of p.layerDefinition.fields)if(ce.name===M){fe=!1;break}!0===fe?J=!1:($++,M="FID"+$.toString())}p.layerDefinition.fields.push({type:"esriFieldTypeOID",name:M,alias:M});const ae=[];for(let fe=0;fe<v.length;fe++)ae.push({geometry:p.featureSet.features[fe].geometry,attributes:p.featureSet.features[fe].attributes?this._cloneAttr(p.featureSet.features[fe].attributes):{}}),ae[fe].attributes[M]=fe;v=ae,x=M}}const h=[];for(const k of p.layerDefinition.fields)h.push(k instanceof b.Z?k:b.Z.fromJSON(k));let _=d;switch(_||(_=""),_){case"esriGeometryPoint":_="point";break;case"esriGeometryPolyline":_="polyline";break;case"esriGeometryPolygon":_="polygon";break;case"esriGeometryEnvelope":_="extent";break;case"esriGeometryMultipoint":_="multipoint";break;case"":case"esriGeometryNull":_="esriGeometryNull"}if("esriGeometryNull"!==_)for(const k of v)k.geometry&&!(k.geometry instanceof N.Z)&&(k.geometry.type=_,void 0===k.geometry.spatialReference&&(k.geometry.spatialReference=m));else for(const k of v)k.geometry&&(k.geometry=null);const B={outFields:["*"],source:v,fields:h,hasZ:!0===p?.layerDefinition?.hasZ||!0===p?.featureSet?.hasZ,hasM:!0===p?.layerDefinition?.hasM||!0===p?.featureSet?.hasM,types:I,typeIdField:E,objectIdField:x,spatialReference:A},V="esriGeometryNull"===_||null===_;V||(B.geometryType=_);const Y=new P.default(B);return p?.layerDefinition?.subtypeField&&p?.layerDefinition?.subtypes&&Y.read({subtypes:p.layerDefinition.subtypes,subtypeField:p.layerDefinition.subtypeField}),new F({layer:Y,spatialReference:A,isTable:V})}queryAttachments(){return(0,R.Z)(function*(){return[]})()}getFeatureByObjectId(p){var A=this;return(0,R.Z)(function*(){const x=new S.Z;x.where=A.objectIdField+"="+p.toString(),x.returnZ=A.hasZ,x.returnM=A.hasM;const E=yield A._layer.queryFeatures(x);return 1===E.features.length?E.features[0]:null})()}getOwningSystemUrl(){return(0,R.Z)(function*(){return""})()}getIdentityUser(){return(0,R.Z)(function*(){return""})()}get preferredTimeZone(){return this._layer.preferredTimeZone??null}get dateFieldsTimeZone(){return this._layer.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._layer.datesInUnknownTimezone??!1}get editFieldsInfo(){return this._layer.editFieldsInfo}get timeInfo(){return this._layer?.timeInfo}getFeatureSetInfo(){var p=this;return(0,R.Z)(function*(){const A=p._layer.title&&p._layer.parent;return p.fsetInfo??{layerId:null,layerName:null,itemId:null,serviceLayerUrl:null,webMapLayerId:A?p._layer.id??null:null,webMapLayerTitle:A?p._layer.title??null:null,className:null,objectClassId:null}})()}}},25677:(Ie,ie,g)=>{function R(ee,W){return ee===W?0:null===ee?-1:null===W?1:ee<W?-1:1}g.d(ie,{Z:()=>te});class te{constructor(W){const G=W.split(",");this._fields=[],this._directions=[];for(let Q=0;Q<G.length;Q++){const K=G[Q].match(/\S+/g);this._fields.push(K[0]),2===K.length?"asc"===K[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}constructClause(){let W="";for(let G=0;G<this._fields.length;G++)0!==G&&(W+=","),W+=this._fields[G],W+=1===this._directions[G]?" ASC":" DESC";return W}order(W){W.sort((G,Q)=>{for(let K=0;K<this._fields.length;K++){const N=this.featureValue(G.feature,this._fields[K],K),P=this.featureValue(Q.feature,this._fields[K],K);let w=0;if(w=1===this._directions[K]?R(N,P):-1*R(N,P),0!==w)return w}return 0})}scanForField(W){for(let G=0;G<this._fields.length;G++)if(this._fields[G].toLowerCase().trim()===W.toLowerCase().trim())return!0;return!1}replaceFields(W){let G="";for(let Q=0;Q<this._fields.length;Q++){0!==Q&&(G+=",");let K=this._fields[Q];for(const N of W)if(K.toLowerCase()===N.field.toLowerCase()){K=N.newfield;break}G+=K,G+=1===this._directions[Q]?" ASC":" DESC"}return new te(G)}featureValue(W,G,Q){const K=W.attributes[G];if(void 0!==K)return K;for(const N in W.attributes)if(G.toLowerCase()===N.toLowerCase())return this._fields[Q]=N,W.attributes[N];return null}}},52540:(Ie,ie,g)=>{g.d(ie,{z:()=>te});var R=g(39921);class te{constructor(W,G){this._storage=new R.WJ,this.id="",this.name="",this.size=0,this._storage.maxSize=W,this._storage.register(this),G&&this._storage.registerRemoveFunc("",G)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(W,G,Q=1){this._storage.put(this,W,G,Q,1)}pop(W){return this._storage.pop(this,W)}get(W){return this._storage.get(this,W)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(W){this._storage.maxSize=W}resetHitRate(){}}},39921:(Ie,ie,g)=>{g.d(ie,{WJ:()=>Q,Xq:()=>G});var W,P,R=g(43029);(P=W||(W={}))[P.ALL=0]="ALL",P[P.SOME=1]="SOME";class G{constructor(w,b,S){this.name=w,this._storage=b,this.id=K+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),S&&(this._storage.registerRemoveFunc(this.id,S),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(w){return this._storage.getSize(this,w)}resetHitRate(){this._hit=this._miss=0}put(w,b,S,F=0){this._storage.put(this,w,b,S,F)}pop(w){const b=this._storage.pop(this,w);return void 0===b?++this._miss:++this._hit,b}get(w){const b=this._storage.get(this,w);return void 0===b?++this._miss:++this._hit,b}peek(w){return this._storage.peek(this,w)}updateSize(w,b,S){this._storage.updateSize(this,w,b,S)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class Q{get size(){return this._size}constructor(w=10485760){this._maxSize=w,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new R.Z,this._users=new R.Z}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(w){this._users.push(w)}deregister(w){this._users.removeUnordered(w)}registerRemoveFunc(w,b){this._removeFuncs.push([w,b])}deregisterRemoveFunc(w){this._removeFuncs.filterInPlace(b=>b[0]!==w)}get maxSize(){return this._maxSize}set maxSize(w){this._maxSize=Math.max(w,-1),this._checkSize()}getSize(w,b){return this._db.get(w.id+b)?.size??0}put(w,b,S,F,L){const p=this._db.get(b=w.id+b);if(p&&(this._size-=p.size,w.size-=p.size,this._db.delete(b),p.entry!==S&&this._notifyRemove(b,p.entry,p.size,W.ALL)),F>this._maxSize)return void this._notifyRemove(b,S,F,W.ALL);if(void 0===S)return void console.warn("Refusing to cache undefined entry ");if(!F||F<0)return console.warn(`Refusing to cache entry with size ${F} for key ${b}`),void this._notifyRemove(b,S,0,W.ALL);const A=1+Math.max(L,-4)- -3;this._db.set(b,new N(S,F,A)),this._size+=F,w.size+=F,this._checkSize()}updateSize(w,b,S,F){const L=this._db.get(b=w.id+b);if(L&&L.entry===S){for(this._size-=L.size,w.size-=L.size;F>this._maxSize;){const p=this._notifyRemove(b,S,F,W.SOME);if(!(null!=p&&p>0))return void this._db.delete(b);F=p}L.size=F,this._size+=F,w.size+=F,this._checkSize()}}pop(w,b){const S=this._db.get(b=w.id+b);if(S)return this._size-=S.size,w.size-=S.size,this._db.delete(b),++this._hit,S.entry;++this._miss}get(w,b){const S=this._db.get(b=w.id+b);if(void 0!==S)return this._db.delete(b),S.lives=S.lifetime,this._db.set(b,S),++this._hit,S.entry;++this._miss}peek(w,b){const S=this._db.get(w.id+b);return S?++this._hit:++this._miss,S?.entry}get performanceInfo(){const w={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},b={},S=new Array;this._db.forEach((p,A)=>{const x=p.lifetime;S[x]=(S[x]||0)+p.size,this._users.forAll(E=>{const{id:I,name:d}=E;A.startsWith(I)&&(b[d]=(b[d]||0)+p.size)})});const F={};this._users.forAll(p=>{const A=p.name;"hitRate"in p&&"number"==typeof p.hitRate&&!isNaN(p.hitRate)&&p.hitRate>0?(b[A]=b[A]||0,F[A]=Math.round(100*p.hitRate)+"%"):F[A]="0%"});const L=Object.keys(b);L.sort((p,A)=>b[A]-b[p]),L.forEach(p=>w[p]=Math.round(b[p]/2**20)+"MB / "+F[p]);for(let p=S.length-1;p>=0;--p){const A=S[p];A&&(w["Priority "+(p+-3-1)]=Math.round(A/this._size*100)+"%")}return w}resetStats(){this._hit=this._miss=0,this._users.forAll(w=>w.resetHitRate())}clear(w){const b=w.id;this._db.forEach((S,F)=>{F.startsWith(b)&&(this._size-=S.size,this._db.delete(F),this._notifyRemove(F,S.entry,S.size,W.ALL))}),w.size=0}clearAll(){this._db.forEach((w,b)=>this._notifyRemove(b,w.entry,w.size,W.ALL)),this._users.forAll(w=>w.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(w,b,S,F){let L;return this._removeFuncs.some(p=>{if(w.startsWith(p[0])){const A=p[1](b,F,S);return"number"==typeof A&&(L=A),!0}return!1}),L}_checkSize(){this._users.forAll(w=>this._checkSizeLimits(w)),this._checkSizeLimits()}_checkSizeLimits(w){const b=w??this;if(b.maxSize<0||b.size<=b.maxSize)return;const S=w?.id;let F=!0;for(;F;){F=!1;for(const[L,p]of this._db)if(0===p.lifetime&&(!S||L.startsWith(S))){if(this._purgeItem(L,p,w),b.size<=.9*b.maxSize)return;F||=this._db.has(L)}}for(const[L,p]of this._db)if((!S||L.startsWith(S))&&(this._purgeItem(L,p,w),b.size<=.9*b.maxSize))return}_purgeItem(w,b,S=this._users.find(F=>w.startsWith(F.id))){if(this._db.delete(w),b.lives<=1){this._size-=b.size,S&&(S.size-=b.size);const F=this._notifyRemove(w,b.entry,b.size,W.SOME);null!=F&&F>0&&(this._size+=F,S&&(S.size+=F),b.lives=b.lifetime,b.size=F,this._db.set(w,b))}else--b.lives,this._db.set(w,b)}}let K=0;class N{constructor(w,b,S){this.entry=w,this.size=b,this.lifetime=S,this.lives=S}}},657:(Ie,ie,g)=>{g.d(ie,{$c:()=>L,Hg:()=>p,jW:()=>b,uD:()=>S});var R=g(73514),te=g(83944),ee=g(49301);const W=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function G(x){return x instanceof R.Z}function Q(x){return x instanceof te.Z?Object.keys(x.items):G(x)?(0,ee.vw)(x).keys():x?Object.keys(x):[]}function K(x,E){return x instanceof te.Z?x.items[E]:x[E]}function P(x){return x?x.declaredClass:null}function w(x,E){const I=x.diff;if(I&&"function"==typeof I)return I(x,E);const d=Q(x),v=Q(E);if(0===d.length&&0===v.length)return;if(!d.length||!v.length||function N(x,E){return!(!Array.isArray(x)||!Array.isArray(E))&&x.length!==E.length}(x,E))return{type:"complete",oldValue:x,newValue:E};const m=v.filter(k=>!d.includes(k)),h=d.filter(k=>!v.includes(k)),_=d.filter(k=>v.includes(k)&&K(x,k)!==K(E,k)).concat(m,h).sort(),B=P(x);if(B&&W.has(B)&&_.length)return{type:"complete",oldValue:x,newValue:E};let V;const Y=G(x)&&G(E);for(const k of _){const M=K(x,k),J=K(E,k);let $;if((Y||"function"!=typeof M&&"function"!=typeof J)&&M!==J&&(null!=M||null!=J)){if(I&&I[k]&&"function"==typeof I[k])$=I[k]?.(M,J);else if(M instanceof Date&&J instanceof Date){if(M.getTime()===J.getTime())continue;$={type:"complete",oldValue:M,newValue:J}}else $="object"==typeof M&&"object"==typeof J&&P(M)===P(J)?w(M,J):{type:"complete",oldValue:M,newValue:J};null!=$&&(null!=V?V.diff[k]=$:V={type:"partial",diff:{[k]:$}})}}return V}function b(x,E){return S(x,E)}function S(x,E){if(null==x)return!1;const I=E.split(".");let d=x;for(const v of I){if("complete"===d.type)return!0;if("partial"!==d.type)return!1;{const m=d.diff[v];if(!m)return!1;d=m}}return!0}function L(x,E){if(!x)return!1;if("partial"===x.type){const I=Object.keys(x.diff);return 1===I.length&&I[0]===E}return!1}function p(x,E){if("function"!=typeof x&&"function"!=typeof E&&(null!=x||null!=E))return null==x||null==E||"object"==typeof x&&"object"==typeof E&&P(x)!==P(E)?{type:"complete",oldValue:x,newValue:E}:w(x,E)}},66398:(Ie,ie,g)=>{function te(T){return T?{originPosition:"upper-left"===T.originPosition?"upperLeft":"lower-left"===T.originPosition?"lowerLeft":T.originPosition,scale:T.tolerance?[T.tolerance,T.tolerance,1,1]:[1,1,1,1],translate:null!=T.extent?[T.extent.xmin,T.extent.ymax,T.extent.zmin??0,T.extent.mmin??0]:[0,0,0,0]}:null}function W(T){if(function ee(T){return"lowerLeft"===T.originPosition&&4===T.scale.length&&4===T.translate.length}(T))return T;const{originPosition:D,scale:O,translate:z}=T,q=O[1]??1;return{originPosition:"lowerLeft",scale:[O[0]??1,"lowerLeft"===D?q:-q,O[2]??1,O[3]??1],translate:[z[0]??0,z[1]??0,z[2]??0,z[3]??0]}}function x({scale:T,translate:D},O){return O*T[0]+D[0]}function E({scale:T,translate:D},O){return O*T[1]+D[1]}function I({scale:T,translate:D},O){return(O??0)*T[2]+D[2]}function d({scale:T,translate:D},O){return O?O*T[3]+D[3]:0}function v(T,D){return T&&D?B:T&&!D?h:!T&&D?_:m}g.d(ie,{G6:()=>je,Ie:()=>Ne,J9:()=>Ze,RF:()=>Ce,U1:()=>Te,vY:()=>te}),g(40637);const m=(T,D)=>{const O=new Array(D.length);if(!D.length)return O;const z=D[0];let X=x(T,z[0]),q=E(T,z[1]);O[0]=[X,q];const{scale:se,originPosition:oe}=T,me=se[0],ye="lowerLeft"===oe?se[1]:-se[1];for(let ue=1;ue<D.length;ue++){const[Fe,Se]=D[ue];X+=me*Fe,q+=ye*Se,O[ue]=[X,q]}return O},h=(T,D)=>{const O=new Array(D.length);if(!D.length)return O;const z=D[0];let X=x(T,z[0]),q=E(T,z[1]);O[0]=[X,q,I(T,z[2])];const{scale:se,originPosition:oe}=T,me=se[0],ye="lowerLeft"===oe?se[1]:-se[1];for(let ue=1;ue<D.length;ue++){const[Fe,Se,ve]=D[ue];X+=me*Fe,q+=ye*Se,O[ue]=[X,q,I(T,ve)]}return O},_=(T,D)=>{const O=new Array(D.length);if(!D.length)return O;const z=D[0];let X=x(T,z[0]),q=E(T,z[1]);O[0]=[X,q,d(T,z[2])];const{scale:se,originPosition:oe}=T,me=se[0],ye="lowerLeft"===oe?se[1]:-se[1];for(let ue=1;ue<D.length;ue++){const[Fe,Se,ve]=D[ue];X+=me*Fe,q+=ye*Se,O[ue]=[X,q,d(T,ve)]}return O},B=(T,D)=>{const O=new Array(D.length);if(!D.length)return O;const z=D[0];let X=x(T,z[0]),q=E(T,z[1]);O[0]=[X,q,I(T,z[2]),d(T,z[3])];const{scale:se,originPosition:oe}=T,me=se[0],ye="lowerLeft"===oe?se[1]:-se[1];for(let ue=1;ue<D.length;ue++){const[Fe,Se,ve,be]=D[ue];X+=me*Fe,q+=ye*Se,O[ue]=[X,q,I(T,ve),d(T,be)]}return O};function V(T,D,O){const z=new Array(O.length);for(let X=0;X<O.length;X++)z[X]=D(T,O[X]);return z}function Ce(T,D,O){const z=W(T);return D.x=function G({scale:T,translate:D},O){return Math.round((O-D[0])/T[0])}(z,O.x),D.y=function Q({scale:T,translate:D},O){return Math.round((O-D[1])/T[1])}(z,O.y),null!=O.z&&(D.z=function K({scale:T,translate:D},O){return Math.round(((O??0)-D[2])/T[2])}(z,O.z)),null!=O.m&&(D.m=function N({scale:T,translate:D},O){return O?Math.round((O-D[3])/T[3]):0}(z,O.m)),D}function Ze(T,D,O,z=O?.hasZ??!1,X=O?.hasM??!1){if(null!=O){const q=W(T);D.points=v(z,X)(q,O.points),D.hasZ=z,D.hasM=X}return D}function Te(T,D,O,z=null!=O?.z,X=null!=O?.m){if(null==O)return D;const q=W(T);return D.x=x(q,O.x),D.y=E(q,O.y),z&&(D.z=I(q,O.z)),X&&(D.m=d(q,O.m)),D}function Ne(T,D,O,z=O?.hasZ??!1,X=O?.hasM??!1){if(null!=O){const q=W(T);D.rings=V(q,v(z,X),O.rings),D.hasZ=z,D.hasM=X}return D}function je(T,D,O,z=O?.hasZ??!1,X=O?.hasM??!1){if(null!=O){const q=W(T);D.paths=V(q,v(z,X),O.paths),D.hasZ=z,D.hasM=X}return D}},50243:(Ie,ie,g)=>{g.d(ie,{Z:()=>L});var R=g(50484),te=g(25387),ee=g(89317),W=g(80543),N=(g(14007),g(4703),g(65311),g(62185)),P=g(10141),w=g(7547),b=g(59300),S=g(30457);let F=class extends((0,te.J)(ee.wq)){constructor(p){super(p),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(p){const A={};for(const x of Object.keys(p))A[x]=(0,b.im)(p[x]);return A}writeDomains(p,A){const x={};for(const E of Object.keys(p))p[E]&&(x[E]=p[E]?.toJSON());A.domains=x}};(0,R._)([(0,W.Cb)({json:{write:!0}})],F.prototype,"id",void 0),(0,R._)([(0,W.Cb)({json:{write:!0}})],F.prototype,"name",void 0),(0,R._)([(0,W.Cb)({json:{write:!0}})],F.prototype,"domains",void 0),(0,R._)([(0,N.r)("domains")],F.prototype,"readDomains",null),(0,R._)([(0,w.c)("domains")],F.prototype,"writeDomains",null),(0,R._)([(0,W.Cb)({type:[S.Z],json:{write:!0}})],F.prototype,"templates",void 0),F=(0,R._)([(0,P.j)("esri.layers.support.FeatureType")],F);const L=F},11642:(Ie,ie,g)=>{g.d(ie,{$6:()=>E,$z:()=>ee,F7:()=>te,Ow:()=>K,S0:()=>Q,d1:()=>N,dm:()=>P});const R=[["binary","application/octet-stream","bin",""]];function te(I,d){return null!=F(d.name,I?.supportedFormats??[])}function ee(I,d){if(!I)return!1;const v=P(d,I.supportedFormats??[]);return null!=v&&I.editFormats.includes(v)}function Q(I,d){return L(function S(I,d){const v=I.toLowerCase();return w(d).find(m=>p(m)===v)}(I,d))}function K(I,d){return L(F(I,d))}function N(I,d){return p(function b(I,d){return w(d).find(v=>L(v)===I)}(I,d))}function P(I,d){return K(I.name,d)??Q(I.type,d)}function w(I){return[...R,...I]}function F(I,d){const v=I.toLowerCase();return w(d).find(m=>function A(I){return I?.[2].split(",").map(d=>d.toLowerCase())??[]}(m).some(h=>v.endsWith(h)))}function L(I){return I?.[0]}function p(I){return I?.[1].toLowerCase()}function E(I){return I.tables?.find(d=>"assetMaps"===d.role)}},56761:(Ie,ie,g)=>{g.d(ie,{UG:()=>b,UO:()=>p,YI:()=>L,dI:()=>A,el:()=>m,hV:()=>F,z7:()=>S});var R=g(72578);const te="__begin__",ee="__end__",W=new RegExp(te,"ig"),G=new RegExp(ee,"ig"),Q=new RegExp("^"+te,"i"),K=new RegExp(ee+"$","i"),N='"',P=N+" + ",w=" + "+N;function b(h){return h.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function S(h){return h.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function F(h){const _={expression:"",type:"none"};return h.labelExpressionInfo?h.labelExpressionInfo.value?(_.expression=h.labelExpressionInfo.value,_.type="conventional"):h.labelExpressionInfo.expression&&(_.expression=h.labelExpressionInfo.expression,_.type="arcade"):null!=h.labelExpression&&(_.expression=b(h.labelExpression),_.type="conventional"),_}function L(h){const _=F(h);if(!_)return null;switch(_.type){case"conventional":return A(_.expression);case"arcade":return _.expression}return null}function p(h){const _=F(h);if(!_)return null;switch(_.type){case"conventional":return function E(h){return h?.match(x)?.[1].trim()||null}(_.expression);case"arcade":return m(_.expression)}return null}function A(h){let _;return h?(_=(0,R.gx)(h,B=>te+'$feature["'+B+'"]'+ee),_=Q.test(_)?_.replace(Q,""):N+_,_=K.test(_)?_.replace(K,""):_+N,_=_.replaceAll(W,P).replaceAll(G,w)):_='""',_}const x=/^\s*\{([^}]+)\}\s*$/i,I=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,d=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,v=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;function m(h){if(!h)return null;let _=I.exec(h)||d.exec(h);return _?_[1]||_[3]:(_=v.exec(h),_?_[2]:null)}},96043:(Ie,ie,g)=>{g.d(ie,{AJ:()=>K,If:()=>w,k0:()=>Q,uI:()=>P,ul:()=>G,wx:()=>b});var R=g(55117),te=g(55768),ee=g(5710),W=g(23515);const G=2.4;function Q(S){return(0,te.Wz)(S*G)}function K(S){return(0,te.F2)(S)/G}function N(S,F,L,p){let{color:A,ratio:x}=F,{color:E,ratio:I}=L;I===x&&(1===I?x-=1e-6:I+=1e-6);const d=(0,R.uZ)((p-x)/(I-x),0,1);(0,ee.l)(S,A.toArray(),E.toArray(),d)}function P(S){const L=new Uint8ClampedArray(2048);if((S=S.filter(({ratio:I})=>I>=0&&I<=1).sort((I,d)=>I.ratio-d.ratio).map(({color:I,ratio:d})=>({color:I,ratio:Math.max(d,.001)}))).length<1)return L;let p=S[0],A=S[0],x=1;const E=(0,W.Ue)();for(let I=0;I<512;I++){const d=(I+.5)/512;for(;d>A.ratio&&x<S.length;)p=A,A=S[x++];N(E,p,A,d),L.set(E,4*I)}return L}function w(S,F,L){const p=Math.sqrt(S**2+F**2)/L;return p>1?0:3/(Math.PI*L**2)*(1-p**2)**2}function b(S){return"function"==typeof S?S:S?F=>+F[S]:()=>1}},24859:(Ie,ie,g)=>{g.d(ie,{P:()=>G});var R=g(15861),te=g(15462),ee=g(82784),W=g(91866);function G(K,N,P){return Q.apply(this,arguments)}function Q(){return(Q=(0,R.Z)(function*(K,N,P){const w=(0,te.en)(K),{data:b}=yield(0,ee.hH)(w,W.Z.from(N),P);return b.count})).apply(this,arguments)}},61375:(Ie,ie,g)=>{g.d(ie,{G:()=>G});var R=g(15861),te=g(15462),ee=g(82784),W=g(91866);function G(K,N,P){return Q.apply(this,arguments)}function Q(){return(Q=(0,R.Z)(function*(K,N,P){const w=(0,te.en)(K),{data:b}=yield(0,ee.Ev)(w,W.Z.from(N),P);return b.objectIds})).apply(this,arguments)}},46708:(Ie,ie,g)=>{g.d(ie,{F:()=>N,e:()=>Q});var R=g(15861),te=g(15462),ee=g(82784),W=g(93792),G=g(91866);function Q(w,b,S){return K.apply(this,arguments)}function K(){return(K=(0,R.Z)(function*(w,b,S){const F=yield N(w,b,S);return W.Z.fromJSON(F)})).apply(this,arguments)}function N(w,b,S){return P.apply(this,arguments)}function P(){return(P=(0,R.Z)(function*(w,b,S){const F=(0,te.en)(w),L={...S},p=G.Z.from(b),{data:A}=yield(0,ee.JT)(F,p,p.sourceSpatialReference,L);return A})).apply(this,arguments)}},36026:(Ie,ie,g)=>{g.d(ie,{t:()=>I});var R=g(15861),te=g(15462),ee=g(51172),W=g(53456),G=g(10842);function Q(v,m){return m}function K(v,m,h,_){switch(h){case 0:return b(v,m+_,0);case 1:return"lowerLeft"===v.originPosition?b(v,m+_,1):function S({translate:v,scale:m},h,_){return v[_]-h*m[_]}(v,m+_,1)}}function N(v,m,h,_){return 2===h?b(v,m,2):K(v,m,h,_)}function P(v,m,h,_){return 2===h?0===m?0:b(v,m,3):K(v,m,h,_)}function w(v,m,h,_){return 3===h?0===m?0:b(v,m,3):N(v,m,h,_)}function b({translate:v,scale:m},h,_){return v[_]+h*m[_]}class F{constructor(m){this._options=m,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this._previousCoordinate=[0,0],this._transform=null,this._applyTransform=Q,this._lengths=[],this._currentLengthIndex=0,this._toAddInCurrentPath=0,this._vertexDimension=0,this._mValueOffset=null,this._coordinateBuffer=null,this._coordinateBufferPtr=0,this._attributesConstructor=class{}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(m){if(this._options.applyTransform&&(m.transform=null),this._attributesConstructor=class{},this._coordinateBuffer=null,this._lengths.length=0,!m.hasZ)return;const h=(0,W.k)(m.geometryType,this._options.sourceSpatialReference,m.spatialReference);if(null!=h)for(const _ of m.features)h(_.geometry)}createSpatialReference(){return{}}addField(m,h){const _=m.fields;(0,ee.O3)(_),_.push(h);const B=_.map(V=>V.name);this._attributesConstructor=function(){for(const V of B)this[V]=null}}addFeature(m,h){m.features.push(h)}prepareFeatures(m){switch(this._transform=m.transform,this._options.applyTransform&&m.transform&&(this._applyTransform=this._deriveApplyTransform(m)),this._mValueOffset=null,this._vertexDimension=2,m.hasZ&&this._vertexDimension++,m.hasM&&(this._mValueOffset=this._vertexDimension,this._vertexDimension++),m.geometryType){case"esriGeometryPoint":this.addCoordinate=(h,_,B)=>this.addCoordinatePoint(h,_,B),this.createGeometry=h=>this.createPointGeometry(h);break;case"esriGeometryPolygon":this.addCoordinate=(h,_,B)=>this._addCoordinatePolygon(h,_,B),this.createGeometry=h=>this._createPolygonGeometry(h);break;case"esriGeometryPolyline":this.addCoordinate=(h,_,B)=>this._addCoordinatePolyline(h,_,B),this.createGeometry=h=>this._createPolylineGeometry(h);break;case"esriGeometryMultipoint":this.addCoordinate=(h,_,B)=>this._addCoordinateMultipoint(h,_,B),this.createGeometry=h=>this._createMultipointGeometry(h)}}createFeature(){return this._lengths.length=0,this._currentLengthIndex=0,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(m,h,_){0===this._lengths.length&&(this._toAddInCurrentPath=h),this._lengths.push(h)}addQueryGeometry(m,h){const{queryGeometry:_,queryGeometryType:B}=h,V=(0,G.$g)(_.clone(),_,!1,!1,this._transform),Y=(0,G.di)(V,B,!1,!1);m.queryGeometryType=B,m.queryGeometry={...Y}}createPointGeometry(m){const h={x:0,y:0,spatialReference:m.spatialReference};return m.hasZ&&(h.z=0),m.hasM&&(h.m=0),h}addCoordinatePoint(m,h,_){switch(h=this._applyTransform(this._transform,h,_,0),_){case 0:m.x=h;break;case 1:m.y=h;break;case 2:"z"in m?m.z=h:m.m=h;break;case 3:m.m=h}}_transformPathLikeValue(m,h){let _=0;return h<=1&&(_=this._previousCoordinate[h],this._previousCoordinate[h]+=m),null!==this._mValueOffset&&0===m&&h>0&&!(h%this._mValueOffset)?0:this._applyTransform(this._transform,m,h,_)}_addCoordinatePolyline(m,h,_){this._dehydratedAddPointsCoordinate(m.paths,h,_)}_addCoordinatePolygon(m,h,_){this._dehydratedAddPointsCoordinate(m.rings,h,_)}_addCoordinateMultipoint(m,h,_){0===_&&m.points.push([]);const B=this._transformPathLikeValue(h,_);m.points[m.points.length-1].push(B)}_createPolygonGeometry(m){return{rings:[[]],spatialReference:m.spatialReference,hasZ:!!m.hasZ,hasM:!!m.hasM}}_createPolylineGeometry(m){return{paths:[[]],spatialReference:m.spatialReference,hasZ:!!m.hasZ,hasM:!!m.hasM}}_createMultipointGeometry(m){return{points:[],spatialReference:m.spatialReference,hasZ:!!m.hasZ,hasM:!!m.hasM}}_dehydratedAddPointsCoordinate(m,h,_){0===_&&0==this._toAddInCurrentPath--&&(m.push([]),this._toAddInCurrentPath=this._lengths[++this._currentLengthIndex]-1,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0);const B=this._transformPathLikeValue(h,_),V=m[m.length-1];0===_&&(this._coordinateBufferPtr=0,this._coordinateBuffer=new Array(this._vertexDimension),V.push(this._coordinateBuffer)),this._coordinateBuffer[this._coordinateBufferPtr++]=B}_deriveApplyTransform(m){const{hasZ:h,hasM:_}=m;return h&&_?w:h?N:_?P:K}}var L=g(82784),A=(g(93792),g(91866));function I(v,m,h){return d.apply(this,arguments)}function d(){return(d=(0,R.Z)(function*(v,m,h){const _=(0,te.en)(v),B={...h},V=A.Z.from(m),Y=!V.quantizationParameters,{data:k}=yield(0,L.qp)(_,V,new F({sourceSpatialReference:V.sourceSpatialReference,applyTransform:Y}),B);return k})).apply(this,arguments)}},8295:(Ie,ie,g)=>{g.d(ie,{p:()=>te});var R=g(53456);function te(ee,W,G){if(!G?.features||!G.hasZ)return;const Q=(0,R.k)(G.geometryType,W,ee.outSpatialReference);if(null!=Q)for(const K of G.features)Q(K.geometry)}},85596:(Ie,ie,g)=>{g.d(ie,{Z:()=>F});var w,R=g(50484),te=g(89317),ee=g(80543),W=g(1535),K=(g(65311),g(14007),g(10141));const b={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let S=w=class extends te.wq{constructor(L){super(L),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:L}=this,p=function N(L){const{exifInfo:p,exifName:A,tagName:x}=L;if(!p||!A||!x)return null;const E=p.find(I=>I.name===A);return E?function P(L){const{tagName:p,tags:A}=L;return A&&p&&A.find(E=>E.name===p)?.value||null}({tagName:x,tags:E.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:L});return b[p]||null}clone(){return new w({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,R._)([(0,ee.Cb)({type:String})],S.prototype,"contentType",void 0),(0,R._)([(0,ee.Cb)()],S.prototype,"exifInfo",void 0),(0,R._)([(0,ee.Cb)({readOnly:!0})],S.prototype,"orientationInfo",null),(0,R._)([(0,ee.Cb)({type:W.z8})],S.prototype,"id",void 0),(0,R._)([(0,ee.Cb)({type:String})],S.prototype,"globalId",void 0),(0,R._)([(0,ee.Cb)({type:String})],S.prototype,"keywords",void 0),(0,R._)([(0,ee.Cb)({type:String})],S.prototype,"name",void 0),(0,R._)([(0,ee.Cb)({json:{read:!1}})],S.prototype,"parentGlobalId",void 0),(0,R._)([(0,ee.Cb)({json:{read:!1}})],S.prototype,"parentObjectId",void 0),(0,R._)([(0,ee.Cb)({type:W.z8})],S.prototype,"size",void 0),(0,R._)([(0,ee.Cb)({json:{read:!1}})],S.prototype,"url",void 0),S=w=(0,R._)([(0,K.j)("esri.rest.query.support.AttachmentInfo")],S);const F=S},93792:(Ie,ie,g)=>{g.d(ie,{Z:()=>I});var A,R=g(50484),te=g(2189),ee=g(35458),W=g(84303),G=g(89317),Q=g(34222),K=g(80543),w=(g(14007),g(4703),g(62185)),b=g(10141),S=g(7547),F=g(43814),L=g(40637),p=g(81247);const x=new W.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let E=A=class extends G.wq{constructor(d){super(d),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(d,v){const m=F.Z.fromJSON(v.spatialReference),h=[];for(let _=0;_<d.length;_++){const B=d[_],V=ee.Z.fromJSON(B),Y=B.geometry?.spatialReference;null==V.geometry||Y||(V.geometry.spatialReference=m);const k=B.aggregateGeometries,M=V.aggregateGeometries;if(k&&null!=M)for(const J in M){const $=M[J],ae=k[J],fe=ae?.spatialReference;null==$||fe||($.spatialReference=m)}h.push(V)}return h}writeGeometryType(d,v,m,h){if(d)return void x.write(d,v,m,h);const{features:_}=this;if(_)for(const B of _)if(null!=B?.geometry)return void x.write(B.geometry.type,v,m,h)}readQueryGeometry(d,v){if(!d)return null;const m=!!d.spatialReference,h=(0,L.im)(d);return h&&!m&&v.spatialReference&&(h.spatialReference=F.Z.fromJSON(v.spatialReference)),h}writeSpatialReference(d,v){if(d)return void(v.spatialReference=d.toJSON());const{features:m}=this;if(m)for(const h of m)if(h&&null!=h.geometry&&h.geometry.spatialReference)return void(v.spatialReference=h.geometry.spatialReference.toJSON())}clone(){return new A(this.cloneProperties())}cloneProperties(){return(0,Q.d9)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(d){const v=this.write();if(v.features&&Array.isArray(d)&&d.length>0)for(let m=0;m<v.features.length;m++){const h=v.features[m];if(h.geometry){const _=d?.[m];h.geometry=_?.toJSON()||h.geometry}}return v}quantize(d){const{scale:[v,m],translate:[h,_]}=d,Y=this.features,k=this._getQuantizationFunction(this.geometryType,M=>Math.round((M-h)/v),M=>Math.round((_-M)/m));for(let M=0,J=Y.length;M<J;M++)k?.(Y[M].geometry)||(Y.splice(M,1),M--,J--);return this.transform=d,this}unquantize(){const{geometryType:d,features:v,transform:m}=this;if(!m)return this;const{translate:[h,_],scale:[B,V]}=m;let M=null,J=null;if(this.hasZ&&null!=m?.scale?.[2]){const{translate:[,,ae],scale:[,,fe]}=m;M=ce=>ce*fe+ae}if(this.hasM&&null!=m?.scale?.[3]){const{translate:[,,,ae],scale:[,,,fe]}=m;J=ce=>null==ce?ce:ce*fe+ae}const $=this._getHydrationFunction(d,ae=>ae*B+h,ae=>_-ae*V,M,J);for(const{geometry:ae}of v)null!=ae&&$&&$(ae);return this.transform=null,this}_quantizePoints(d,v,m){let h,_;const B=[];for(let V=0,Y=d.length;V<Y;V++){const k=d[V];if(V>0){const M=v(k[0]),J=m(k[1]);M===h&&J===_||(B.push([M-h,J-_]),h=M,_=J)}else h=v(k[0]),_=m(k[1]),B.push([h,_])}return B.length>0?B:null}_getQuantizationFunction(d,v,m){return"point"===d?h=>(h.x=v(h.x),h.y=m(h.y),h):"polyline"===d||"polygon"===d?h=>{const _=(0,L.oU)(h)?h.rings:h.paths,B=[];for(let V=0,Y=_.length;V<Y;V++){const M=this._quantizePoints(_[V],v,m);M&&B.push(M)}return B.length>0?((0,L.oU)(h)?h.rings=B:h.paths=B,h):null}:"multipoint"===d?h=>{const _=this._quantizePoints(h.points,v,m);return _&&_.length>0?(h.points=_,h):null}:"extent"===d?h=>h:null}_getHydrationFunction(d,v,m,h,_){return"point"===d?B=>{B.x=v(B.x),B.y=m(B.y),h&&(B.z=h(B.z))}:"polyline"===d||"polygon"===d?B=>{const V=(0,L.oU)(B)?B.rings:B.paths;let Y,k;for(let M=0,J=V.length;M<J;M++){const $=V[M];for(let ae=0,fe=$.length;ae<fe;ae++){const ce=$[ae];ae>0?(Y+=ce[0],k+=ce[1]):(Y=ce[0],k=ce[1]),ce[0]=v(Y),ce[1]=m(k)}}if(h&&_)for(let M=0,J=V.length;M<J;M++){const $=V[M];for(let ae=0,fe=$.length;ae<fe;ae++){const ce=$[ae];ce[2]=h(ce[2]),ce[3]=_(ce[3])}}else if(h)for(let M=0,J=V.length;M<J;M++){const $=V[M];for(let ae=0,fe=$.length;ae<fe;ae++){const ce=$[ae];ce[2]=h(ce[2])}}else if(_)for(let M=0,J=V.length;M<J;M++){const $=V[M];for(let ae=0,fe=$.length;ae<fe;ae++){const ce=$[ae];ce[2]=_(ce[2])}}}:"extent"===d?B=>{B.xmin=v(B.xmin),B.ymin=m(B.ymin),B.xmax=v(B.xmax),B.ymax=m(B.ymax),h&&null!=B.zmax&&null!=B.zmin&&(B.zmax=h(B.zmax),B.zmin=h(B.zmin)),_&&null!=B.mmax&&null!=B.mmin&&(B.mmax=_(B.mmax),B.mmin=_(B.mmin))}:"multipoint"===d?B=>{const V=B.points;let Y,k;for(let M=0,J=V.length;M<J;M++){const $=V[M];M>0?(Y+=$[0],k+=$[1]):(Y=$[0],k=$[1]),$[0]=v(Y),$[1]=m(k)}if(h&&_)for(let M=0,J=V.length;M<J;M++){const $=V[M];$[2]=h($[2]),$[3]=_($[3])}else if(h)for(let M=0,J=V.length;M<J;M++){const $=V[M];$[2]=h($[2])}else if(_)for(let M=0,J=V.length;M<J;M++){const $=V[M];$[2]=_($[2])}}:null}};(0,R._)([(0,K.Cb)({type:String,json:{write:!0}})],E.prototype,"displayFieldName",void 0),(0,R._)([(0,K.Cb)({type:Boolean,json:{write:{overridePolicy:d=>({enabled:d})}}})],E.prototype,"exceededTransferLimit",void 0),(0,R._)([(0,K.Cb)({type:[ee.Z],json:{write:!0}})],E.prototype,"features",void 0),(0,R._)([(0,w.r)("features")],E.prototype,"readFeatures",null),(0,R._)([(0,K.Cb)({type:[p.Z],json:{write:!0}})],E.prototype,"fields",void 0),(0,R._)([(0,K.Cb)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:x.read}}})],E.prototype,"geometryType",void 0),(0,R._)([(0,S.c)("geometryType")],E.prototype,"writeGeometryType",null),(0,R._)([(0,K.Cb)({type:Boolean,json:{write:{overridePolicy:d=>({enabled:d})}}})],E.prototype,"hasM",void 0),(0,R._)([(0,K.Cb)({type:Boolean,json:{write:{overridePolicy:d=>({enabled:d})}}})],E.prototype,"hasZ",void 0),(0,R._)([(0,K.Cb)({types:te.qM,json:{write:!0}})],E.prototype,"queryGeometry",void 0),(0,R._)([(0,w.r)("queryGeometry")],E.prototype,"readQueryGeometry",null),(0,R._)([(0,K.Cb)({type:F.Z,json:{write:!0}})],E.prototype,"spatialReference",void 0),(0,R._)([(0,S.c)("spatialReference")],E.prototype,"writeSpatialReference",null),(0,R._)([(0,K.Cb)({json:{write:!0}})],E.prototype,"transform",void 0),E=A=(0,R._)([(0,b.j)("esri.rest.support.FeatureSet")],E),E.prototype.toJSON.isDefaultToJSON=!0;const I=E}}]);