"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[4051],{6671:(Zt,_t,U)=>{U.d(_t,{a:()=>Y,b:()=>vt,c:()=>Rt,g:()=>Nt,j:()=>an,n:()=>w}),U(14007),U(4703);var k=U(55117),mt=U(39061),Z=U(43548),gt=U(73145),W=U(5710),rt=U(23515),J=U(89612),D=U(48621),at=U(69349),H=U(4267),dt=U(65119);const Ot=Rt();function Rt(){return(0,rt.Ue)()}const tn=W.e,jt=W.e;function Y(S,C){return(0,W.c)(C,S)}function vt(S){return S[3]}function Nt(S){return S}function Bt(S,C,L){if(null==C||!nn(S,C,Jt))return!1;let{t0:V,t1:x}=Jt;if((V<0||x<V&&x>0)&&(V=x),V<0)return!1;if(L){const{origin:Q,direction:ht}=C;L[0]=Q[0]+ht[0]*V,L[1]=Q[1]+ht[1]*V,L[2]=Q[2]+ht[2]*V}return!0}const Jt={t0:0,t1:0};function nn(S,C,L){const{origin:V,direction:x}=C,Q=cn;Q[0]=V[0]-S[0],Q[1]=V[1]-S[1],Q[2]=V[2]-S[2];const ht=x[0]*x[0]+x[1]*x[1]+x[2]*x[2];if(0===ht)return!1;const Pt=2*(x[0]*Q[0]+x[1]*Q[1]+x[2]*Q[2]),xt=Pt*Pt-4*ht*(Q[0]*Q[0]+Q[1]*Q[1]+Q[2]*Q[2]-S[3]*S[3]);if(xt<0)return!1;const zt=Math.sqrt(xt);return L.t0=(-Pt-zt)/(2*ht),L.t1=(-Pt+zt)/(2*ht),!0}const cn=(0,gt.Ue)();function an(S,C){return Bt(S,C,null)}function un(S,C,L){const V=dt.WM.get(),x=dt.MP.get();(0,Z.b)(V,C.origin,C.direction);const Q=vt(S);(0,Z.b)(L,V,C.origin),(0,Z.j)(L,L,1/(0,Z.l)(L)*Q);const ht=Yt(S,C.origin),Pt=(0,H.EU)(C.origin,L);return(0,mt.Us)(x,Pt+ht,V),(0,Z.h)(L,L,x),L}function wt(S,C,L){const V=(0,Z.f)(dt.WM.get(),C,S),x=(0,Z.j)(dt.WM.get(),V,S[3]/(0,Z.l)(V));return(0,Z.g)(L,x,S)}function Yt(S,C){const L=(0,Z.f)(dt.WM.get(),C,S),V=(0,Z.l)(L),x=vt(S),Q=x+Math.abs(x-V);return(0,k.ZF)(x/Q)}const yt=(0,gt.Ue)();function Ct(S,C,L,V){const x=(0,Z.f)(yt,C,S);switch(L){case D.R.X:{const Q=(0,k.jE)(x,yt)[2];return(0,Z.s)(V,-Math.sin(Q),Math.cos(Q),0)}case D.R.Y:{const Q=(0,k.jE)(x,yt),ht=Q[1],Pt=Q[2],xt=Math.sin(ht);return(0,Z.s)(V,-xt*Math.cos(Pt),-xt*Math.sin(Pt),Math.cos(ht))}case D.R.Z:return(0,Z.n)(V,x);default:return}}function Ht(S,C){const L=(0,Z.f)(Gt,C,S);return(0,Z.l)(L)-S[3]}function w(S,C){const L=(0,Z.a)(S,C),V=vt(S);return L<=V*V}const Gt=(0,gt.Ue)(),_n=Rt();Object.freeze(Object.defineProperty({__proto__:null,NullSphere:Ot,altitudeAt:Ht,angleToSilhouette:Yt,axisAt:Ct,clear:function Lt(S){S[0]=S[1]=S[2]=S[3]=0},closestPoint:function en(S,C,L){return Bt(S,C,L)?L:((0,at.JI)(C,S,L),wt(S,L,L))},closestPointOnSilhouette:un,containsPoint:w,copy:Y,create:Rt,distanceToSilhouette:function fn(S,C){const L=(0,Z.f)(dt.WM.get(),C,S),V=(0,Z.q)(L);return Math.sqrt(Math.abs(V-S[3]*S[3]))},elevate:function Xt(S,C,L){return S!==L&&(L[0]=S[0],L[1]=S[1],L[2]=S[2]),L[3]=S[3]+C,L},equals:jt,exactEquals:tn,fromCenterAndRadius:function et(S,C){return(0,rt.al)(S[0],S[1],S[2],C)},fromRadius:function Ut(S,C){return S[0]=S[1]=S[2]=0,S[3]=C,S},fromValues:function pt(S,C,L,V){return(0,rt.al)(S,C,L,V)},getCenter:Nt,getRadius:vt,intersectLine:function $t(S,C,L){const V=(0,at.zk)(C,L);if(!nn(S,V,Jt))return[];const{origin:x,direction:Q}=V,{t0:ht,t1:Pt}=Jt,xt=zt=>{const Kt=(0,gt.Ue)();return(0,Z.r)(Kt,x,Q,zt),wt(S,Kt,Kt)};return Math.abs(ht-Pt)<(0,J.bn)()?[xt(ht)]:[xt(ht),xt(Pt)]},intersectRay:Bt,intersectRayClosestSilhouette:function dn(S,C,L){if(Bt(S,C,L))return L;const V=un(S,C,dt.WM.get());return(0,Z.g)(L,C.origin,(0,Z.j)(dt.WM.get(),C.direction,(0,Z.p)(C.origin,V)/(0,Z.l)(C.direction))),L},intersectsRay:an,projectPoint:wt,setAltitudeAt:function It(S,C,L,V){const x=Ht(S,C),Q=Ct(S,C,D.R.Z,Gt),ht=(0,Z.j)(Gt,Q,L-x);return(0,Z.g)(V,C,ht)},setExtent:function rn(S,C,L){return S!==L&&Y(S,L),L},tmpSphere:_n,union:function gn(S,C,L=(0,rt.Ue)()){const V=(0,Z.p)(S,C),x=S[3],Q=C[3];return V+Q<x?((0,W.c)(L,S),L):V+x<Q?((0,W.c)(L,C),L):((0,Z.o)(L,S,C,(V+Q-x)/(2*V)),L[3]=(V+x+Q)/2,L)},wrap:function tt(S){return S}},Symbol.toStringTag,{value:"Module"}))},16573:(Zt,_t,U)=>{U.d(_t,{x:()=>ot});var ct=U(38119);class ot{constructor(Z){this._allocator=Z,this._items=[],this._itemsPtr=0,this._grow()}get(){return 0===this._itemsPtr&&(0,ct.Y)(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const Z=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*k);this._items.length=Math.min(Z,this._items.length),this._itemsPtr=0}_grow(){for(let Z=0;Z<Math.max(8,Math.min(this._items.length,k));Z++)this._items.push(this._allocator())}}const k=1024},38519:(Zt,_t,U)=>{function ct(){return[1,0,0,0,1,0,0,0,1]}function k(W,rt,J,D,at,H,dt,Ot,Rt){return[W,rt,J,D,at,H,dt,Ot,Rt]}U.d(_t,{Ue:()=>ct,Wd:()=>Z,al:()=>k});const Z=[1,0,0,0,1,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Z,clone:function ot(W){return[W[0],W[1],W[2],W[3],W[4],W[5],W[6],W[7],W[8]]},create:ct,createView:function mt(W,rt){return new Float64Array(W,rt,9)},fromValues:k},Symbol.toStringTag,{value:"Module"}))},41666:(Zt,_t,U)=>{function ct(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ot(W){return[W[0],W[1],W[2],W[3],W[4],W[5],W[6],W[7],W[8],W[9],W[10],W[11],W[12],W[13],W[14],W[15]]}U.d(_t,{Ue:()=>ct,Wd:()=>Z,d9:()=>ot});const Z=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Z,clone:ot,create:ct,createView:function mt(W,rt){return new Float64Array(W,rt,16)},fromValues:function k(W,rt,J,D,at,H,dt,Ot,Rt,tn,jt,Y,et,tt,Lt,Ut){return[W,rt,J,D,at,H,dt,Ot,Rt,tn,jt,Y,et,tt,Lt,Ut]}},Symbol.toStringTag,{value:"Module"}))},686:(Zt,_t,U)=>{function ct(){return[0,0,0,1]}function ot(W){return[W[0],W[1],W[2],W[3]]}U.d(_t,{Ue:()=>ct,Wd:()=>Z,d9:()=>ot});const Z=[0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Z,clone:ot,create:ct,createView:function mt(W,rt){return new Float64Array(W,rt,4)},fromValues:function k(W,rt,J,D){return[W,rt,J,D]}},Symbol.toStringTag,{value:"Module"}))},59287:(Zt,_t,U)=>{U.d(_t,{Ue:()=>Xt,zu:()=>en,st:()=>nn}),U(55117);var ot=U(43548),k=U(73145);function Xt(A=kt){return[A[0],A[1],A[2],A[3]]}function nn(A){return A}function en(A,P,b,j=0,y=Math.floor(b*(1/3)),nt=Math.floor(b*(2/3))){if(b<3)return!1;P(Yt,j);let $=y,ut=!1;for(;$<b-1&&!ut;)P(yt,$),$++,ut=!(0,ot.e)(Yt,yt);if(!ut)return!1;for($=Math.max($,nt),ut=!1;$<b&&!ut;)P(Ct,$),$++,(0,ot.f)(Ht,Yt,yt),(0,ot.n)(Ht,Ht),(0,ot.f)(It,yt,Ct),(0,ot.n)(It,It),ut=!(0,ot.e)(Yt,Ct)&&!(0,ot.e)(yt,Ct)&&Math.abs((0,ot.m)(Ht,It))<fn;return ut?(function un(A,P,b,j=Xt()){const y=b[0]-P[0],nt=b[1]-P[1],$=b[2]-P[2],ut=A[0]-P[0],Tt=A[1]-P[1],Wt=A[2]-P[2],Ft=nt*Wt-$*Tt,Mt=$*ut-y*Wt,ft=y*Tt-nt*ut,lt=Ft*Ft+Mt*Mt+ft*ft,bt=Math.abs(lt-1)>1e-5&&lt>1e-12?1/Math.sqrt(lt):1;j[0]=Ft*bt,j[1]=Mt*bt,j[2]=ft*bt,j[3]=-(j[0]*A[0]+j[1]*A[1]+j[2]*A[2])}(Yt,yt,Ct,A),!0):(0!==j||1!==y||2!==nt)&&en(A,P,b,0,1,2)}U(5710),U(4267),U(65119),(0,k.Ue)(),(0,k.Ue)(),(0,k.Ue)(),(0,k.Ue)(),(0,k.Ue)();const fn=.99619469809,Yt=(0,k.Ue)(),yt=(0,k.Ue)(),Ct=(0,k.Ue)(),Ht=(0,k.Ue)(),It=(0,k.Ue)(),kt=[0,0,1,0];var Dt,A;(A=Dt||(Dt={}))[A.NONE=0]="NONE",A[A.CLAMP=1]="CLAMP",A[A.INFINITE_MIN=4]="INFINITE_MIN",A[A.INFINITE_MAX=8]="INFINITE_MAX"},69349:(Zt,_t,U)=>{U.d(_t,{JI:()=>Ot,Ue:()=>gt,re:()=>J,zk:()=>at}),U(57678);var ot=U(16573),k=U(43548),mt=U(73145);function gt(Y){return Y?W((0,mt.d9)(Y.origin),(0,mt.d9)(Y.direction)):W((0,mt.Ue)(),(0,mt.Ue)())}function W(Y,et){return{origin:Y,direction:et}}function J(Y,et){const tt=tn.get();return tt.origin=Y,tt.direction=et,tt}function at(Y,et,tt=gt()){return(0,k.c)(tt.origin,Y),(0,k.f)(tt.direction,et,Y),tt}function Ot(Y,et,tt){const Lt=(0,k.m)(Y.direction,(0,k.f)(tt,et,Y.origin));return(0,k.g)(tt,Y.origin,(0,k.j)(tt,Y.direction,Lt)),tt}U(65119);const tn=new ot.x(()=>gt());(0,mt.Ue)()},4267:(Zt,_t,U)=>{U.d(_t,{EU:()=>gt});var ct=U(55117),ot=U(43548),k=U(73145);function gt(D,at){const H=(0,ot.m)(D,at)/((0,ot.l)(D)*(0,ot.l)(at));return-(0,ct.ZF)(H)}(0,k.Ue)(),(0,k.Ue)()},65119:(Zt,_t,U)=>{U.d(_t,{MP:()=>Ot,vD:()=>Rt,WM:()=>at}),U(14007);var ot=U(38119),k=U(38519),mt=U(41666),Z=U(686),gt=U(89014),W=U(73145),rt=U(23515);class J{constructor(jt){this._create=jt,this._items=new Array,this._itemsPtr=0}get(){return 0===this._itemsPtr&&(0,ot.Y)(()=>this._reset()),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const jt=2*this._itemsPtr;this._items.length>jt&&(this._items.length=jt),this._itemsPtr=0}static createVec2f64(){return new J(gt.Ue)}static createVec3f64(){return new J(W.Ue)}static createVec4f64(){return new J(rt.Ue)}static createMat3f64(){return new J(k.Ue)}static createMat4f64(){return new J(mt.Ue)}static createQuatf64(){return new J(Z.Ue)}get test(){}}J.createVec2f64();const at=J.createVec3f64(),Ot=(J.createVec4f64(),J.createMat3f64(),J.createMat4f64()),Rt=J.createQuatf64()},84051:(Zt,_t,U)=>{U.r(_t),U.d(_t,{default:()=>Nn});var It,w,E,ct=U(15861),ot=U(50484),k=U(79412),rt=(U(4703),U(14007),U(65311),U(57964),U(10141)),J=U(43548),D=U(73145),at=U(28955),H=U(6671),dt=U(51479),Ot=U(43029),Rt=U(16573),Y=(U(39061),U(5710),U(23515)),et=U(69349);function tt(E){return E?{ray:(0,et.Ue)(E.ray),c0:E.c0,c1:E.c1}:{ray:(0,et.Ue)(),c0:0,c1:Number.MAX_VALUE}}function wt(E,l){for(let T=0;T<Gt;T++){const p=E[T];if(p[0]*l[0]+p[1]*l[1]+p[2]*l[2]+p[3]>=l[3])return!1}return!0}new Rt.x(()=>tt()),U(59287),U(65119),(E=It||(It={}))[E.LEFT=0]="LEFT",E[E.RIGHT=1]="RIGHT",E[E.BOTTOM=2]="BOTTOM",E[E.TOP=3]="TOP",E[E.NEAR=4]="NEAR",E[E.FAR=5]="FAR",function(E){E[E.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",E[E.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",E[E.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",E[E.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",E[E.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",E[E.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",E[E.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",E[E.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(w||(w={}));const Gt=6;(0,Y.al)(-1,-1,-1,1),(0,Y.al)(1,-1,-1,1),(0,Y.al)(1,1,-1,1),(0,Y.al)(-1,1,-1,1),(0,Y.al)(-1,-1,1,1),(0,Y.al)(1,-1,1,1),(0,Y.al)(1,1,1,1),(0,Y.al)(-1,1,1,1),new Rt.x(tt),function an(){(0,D.Ue)(),(0,D.Ue)(),(0,D.Ue)(),(0,D.Ue)(),(0,D.Ue)(),(0,D.Ue)(),(0,D.Ue)(),(0,D.Ue)()}();var L=U(98694);class V{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(l,T){this.objectToBoundingSphere=l,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new x,this._objectCount=0,T&&(void 0!==T.maximumObjectsPerNode&&(this._maximumObjectsPerNode=T.maximumObjectsPerNode),void 0!==T.maximumDepth&&(this._maximumDepth=T.maximumDepth))}destroy(){this._degenerateObjects.clear(),x.clearPool(),Tt[0]=null,bt.prune(),on.prune()}add(l,T=l.length){this._objectCount+=T,this._grow(l,T);const p=x.acquire();for(let v=0;v<T;v++){const z=l[v];this._isDegenerate(z)?this._degenerateObjects.add(z):(p.init(this._root),this._add(z,p))}x.release(p)}remove(l,T=null){this._objectCount-=l.length;const p=x.acquire();for(const v of l){const z=T??(0,H.a)(this.objectToBoundingSphere(v),In);y(z[3])?(p.init(this._root),Pt(v,z,p)):this._degenerateObjects.delete(v)}x.release(p),this._shrink()}update(l,T){if(!y(T[3])&&this._isDegenerate(l))return;const p=function Wt(E){return Tt[0]=E,Tt}(l);this.remove(p,T),this.add(p)}forEachAlongRay(l,T,p){const v=(0,et.re)(l,T);Q(this._root,z=>{if(!function zt(E,l){return sn((0,H.g)(l.bounds),2*-l.halfSize,ft),sn((0,H.g)(l.bounds),2*l.halfSize,lt),(0,L.yK)(E.origin,E.direction,ft,lt)}(v,z))return!1;const X=z.node;return X.terminals.forAll(q=>{this._intersectsObject(v,q)&&p(q)}),null!==X.residents&&X.residents.forAll(q=>{this._intersectsObject(v,q)&&p(q)}),!0})}forEachAlongRayWithVerticalOffset(l,T,p,v){const z=(0,et.re)(l,T);Q(this._root,X=>{if(!function Kt(E,l,T){return sn((0,H.g)(l.bounds),2*-l.halfSize,ft),sn((0,H.g)(l.bounds),2*l.halfSize,lt),T.applyToMinMax(ft,lt),(0,L.yK)(E.origin,E.direction,ft,lt)}(z,X,v))return!1;const q=X.node;return q.terminals.forAll(K=>{this._intersectsObjectWithOffset(z,K,v)&&p(K)}),null!==q.residents&&q.residents.forAll(K=>{this._intersectsObjectWithOffset(z,K,v)&&p(K)}),!0})}forEach(l){Q(this._root,T=>{const p=T.node;return p.terminals.forAll(l),null!==p.residents&&p.residents.forAll(l),!0}),this._degenerateObjects.forEach(l)}forEachDegenerateObject(l){this._degenerateObjects.forEach(l)}findClosest(l,T,p,v=(()=>!0),z=1/0){let X=1/0,q=1/0,K=null;const it=b(l,T),Et=st=>{if(--z,!v(st))return;const St=this.objectToBoundingSphere(st);if(!wt(p,St))return;const Vt=j(l,T,(0,H.g)(St)),hn=Vt-St[3];hn<X&&(X=hn,q=Vt+St[3],K=st)};return ht(this._root,st=>{if(z<=0||!wt(p,st.bounds)||((0,J.j)(Mt,it,st.halfSize),(0,J.g)(Mt,Mt,(0,H.g)(st.bounds)),j(l,T,Mt)>q))return!1;const St=st.node;return St.terminals.forAll(Vt=>Et(Vt)),null!==St.residents&&St.residents.forAll(Vt=>Et(Vt)),!0},l,T),K}forEachInDepthRange(l,T,p,v,z,X,q){let K=-1/0,it=1/0;const Et={setRange:At=>{p===V.DepthOrder.FRONT_TO_BACK?(K=Math.max(K,At.near),it=Math.min(it,At.far)):(K=Math.max(K,-At.far),it=Math.min(it,-At.near))}};Et.setRange(v);const st=j(T,p,l),St=b(T,p),Vt=b(T,-p),hn=At=>{if(!q(At))return;const qt=this.objectToBoundingSphere(At),ln=(0,H.g)(qt),vn=j(T,p,ln)-st;vn-qt[3]>it||vn+qt[3]<K||!wt(X,qt)||z(At,Et)};ht(this._root,At=>{if(!wt(X,At.bounds)||((0,J.j)(Mt,St,At.halfSize),(0,J.g)(Mt,Mt,(0,H.g)(At.bounds)),j(T,p,Mt)-st>it)||((0,J.j)(Mt,Vt,At.halfSize),(0,J.g)(Mt,Mt,(0,H.g)(At.bounds)),j(T,p,Mt)-st<K))return!1;const qt=At.node;return qt.terminals.forAll(ln=>hn(ln)),null!==qt.residents&&qt.residents.forAll(ln=>hn(ln)),!0},T,p)}forEachNode(l){Q(this._root,T=>l(T.node,T.bounds,T.halfSize,T.depth))}forEachNeighbor(l,T){const p=(0,H.b)(T),v=(0,H.g)(T),z=K=>{const it=this.objectToBoundingSphere(K),Et=(0,H.b)(it),st=p+Et;return!((0,J.a)((0,H.g)(it),v)-st*st<=0)||l(K)};let X=!0;const q=K=>{X&&(X=z(K))};Q(this._root,K=>{const it=(0,H.b)(K.bounds),Et=p+it;if((0,J.a)((0,H.g)(K.bounds),v)-Et*Et>0)return!1;const st=K.node;return st.terminals.forAll(q),X&&null!==st.residents&&st.residents.forAll(q),X}),X&&this.forEachDegenerateObject(q)}_intersectsObject(l,T){const p=this.objectToBoundingSphere(T);return!(p[3]>0)||(0,H.j)(p,l)}_intersectsObjectWithOffset(l,T,p){const v=this.objectToBoundingSphere(T);return!(v[3]>0)||(0,H.j)(p.applyToBoundingSphere(v),l)}_add(l,T){T.advanceTo(this.objectToBoundingSphere(l))?T.node.terminals.push(l):(T.node.residents.push(l),T.node.residents.length>this._maximumObjectsPerNode&&T.depth<this._maximumDepth&&this._split(T))}_split(l){const T=l.node.residents;l.node.residents=null;for(let p=0;p<T.length;p++){const v=x.acquire().init(l);this._add(T.at(p),v),x.release(v)}}_grow(l,T){if(0!==T&&(A(l,T,p=>this.objectToBoundingSphere(p),Qt),y(Qt[3])&&!this._fitsInsideTree(Qt)))if(kt(this._root.node))(0,H.a)(Qt,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const p=this._rootBoundsForRootAsSubNode(Qt);this._placingRootViolatesMaxDepth(p)?this._rebuildTree(Qt,p):this._growRootAsSubNode(p),x.release(p)}}_rebuildTree(l,T){(0,J.c)((0,H.g)(Mn),(0,H.g)(T.bounds)),Mn[3]=T.halfSize,A([l,Mn],2,v=>v,En);const p=x.acquire().init(this._root);this._root.initFrom(null,En,En[3]),this._root.increaseHalfSize(1.25),Q(p,v=>(this.add(v.node.terminals.data,v.node.terminals.length),null!==v.node.residents&&this.add(v.node.residents.data,v.node.residents.length),!0)),x.release(p)}_placingRootViolatesMaxDepth(l){const T=Math.log(l.halfSize/this._root.halfSize)*Math.LOG2E;let p=0;return Q(this._root,v=>(p=Math.max(p,v.depth),p+T<=this._maximumDepth)),p+T>this._maximumDepth}_rootBoundsForRootAsSubNode(l){const T=l[3],p=l;let v=-1/0;const z=this._root.bounds,X=this._root.halfSize;for(let K=0;K<3;K++){const Et=p[K]+T-(z[K]+X),st=Math.max(0,Math.ceil((z[K]-X-(p[K]-T))/(2*X))),St=Math.max(0,Math.ceil(Et/(2*X)))+1,Vt=2**Math.ceil(Math.log(st+St)*Math.LOG2E);v=Math.max(v,Vt),mn[K].min=st,mn[K].max=St}for(let K=0;K<3;K++){let it=mn[K].min,Et=mn[K].max;const st=(v-(it+Et))/2;it+=Math.ceil(st),Et+=Math.floor(st),Ft[K]=z[K]-X-it*X*2+(Et+it)*X}const q=v*X;return Ft[3]=q*ut,x.acquire().initFrom(null,Ft,q,0)}_growRootAsSubNode(l){const T=this._root.node;(0,J.c)((0,H.g)(Qt),(0,H.g)(this._root.bounds)),Qt[3]=this._root.halfSize,this._root.init(l),l.advanceTo(Qt,null,!0),l.node.children=T.children,l.node.residents=T.residents,l.node.terminals=T.terminals}_shrink(){for(;;){const l=this._findShrinkIndex();if(-1===l)break;this._root.advance(l),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let l=null;const T=this._root.node.children;let p=0,v=0;for(;v<T.length&&null==l;)p=v++,l=T[p];for(;v<T.length;)if(T[v++])return-1;return p}_isDegenerate(l){return!y(this.objectToBoundingSphere(l)[3])}_fitsInsideTree(l){const T=this._root.bounds,p=this._root.halfSize;return l[3]<=p&&l[0]>=T[0]-p&&l[0]<=T[0]+p&&l[1]>=T[1]-p&&l[1]<=T[1]+p&&l[2]>=T[2]-p&&l[2]<=T[2]+p}toJSON(){const{maximumDepth:l,maximumObjectsPerNode:T,_objectCount:p}=this,v=this._nodeToJSON(this._root.node);return{maximumDepth:l,maximumObjectsPerNode:T,objectCount:p,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:v}}}_nodeToJSON(l){const T=l.children.map(z=>z?this._nodeToJSON(z):null),p=l.residents?.map(z=>this.objectToBoundingSphere(z)),v=l.terminals?.map(z=>this.objectToBoundingSphere(z));return{children:T,residents:p,terminals:v}}static fromJSON(l){const T=new V(p=>p,{maximumDepth:l.maximumDepth,maximumObjectsPerNode:l.maximumObjectsPerNode});return T._objectCount=l.objectCount,T._root.initFrom(l.root.node,l.root.bounds,l.root.halfSize,l.root.depth),T}}class x{constructor(){this.bounds=(0,H.c)(),this.halfSize=0,this.initFrom(null,null,0,0)}init(l){return this.initFrom(l.node,l.bounds,l.halfSize,l.depth)}initFrom(l,T,p,v=this.depth){return this.node=l??x.createEmptyNode(),T&&(0,H.a)(T,this.bounds),this.halfSize=p,this.depth=v,this}increaseHalfSize(l){this.halfSize*=l,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*ut}advance(l){let T=this.node.children[l];T||(T=x.createEmptyNode(),this.node.children[l]=T),this.node=T,this.halfSize/=2,this.depth++;const p=nt[l];return this.bounds[0]+=p[0]*this.halfSize,this.bounds[1]+=p[1]*this.halfSize,this.bounds[2]+=p[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(l,T,p=!1){for(;;){if(this.isTerminalFor(l))return T&&T(this,-1),!0;if(this.isLeaf()){if(!p)return T&&T(this,-1),!1;this.node.residents=null}const v=this._childIndex(l);T&&T(this,v),this.advance(v)}}isLeaf(){return null!=this.node.residents}isTerminalFor(l){return l[3]>this.halfSize/2}_childIndex(l){const T=this.bounds;return(T[0]<l[0]?1:0)+(T[1]<l[1]?2:0)+(T[2]<l[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Ot.Z({shrink:!0}),residents:new Ot.Z({shrink:!0})}}static acquire(){return x._pool.acquire()}static release(l){x._pool.release(l)}static clearPool(){x._pool.prune()}}function Q(E,l){let T=x.acquire().init(E);const p=[T];for(;0!==p.length;){if(T=p.pop(),l(T)&&!T.isLeaf())for(let v=0;v<T.node.children.length;v++)T.node.children[v]&&p.push(x.acquire().init(T).advance(v));x.release(T)}}function ht(E,l,T,p=V.DepthOrder.FRONT_TO_BACK){let v=x.acquire().init(E);const z=[v];for(function P(E,l,T){if(!on.length)for(let p=0;p<8;++p)on.push({index:0,distance:0});for(let p=0;p<8;++p){const v=nt[p];on.data[p].index=p,on.data[p].distance=j(E,l,v)}on.sort((p,v)=>p.distance-v.distance);for(let p=0;p<8;++p)T[p]=on.data[p].index}(T,p,pn);0!==z.length;){if(v=z.pop(),l(v)&&!v.isLeaf())for(let X=7;X>=0;--X){const q=pn[X];v.node.children[q]&&z.push(x.acquire().init(v).advance(q))}x.release(v)}}function Pt(E,l,T){bt.clear();const p=T.advanceTo(l,(v,z)=>{bt.push(v.node),bt.push(z)})?T.node.terminals:T.node.residents;if(p.removeUnordered(E),0===p.length)for(let v=bt.length-2;v>=0&&xt(bt.data[v],bt.data[v+1]);v-=2);}function xt(E,l){return l>=0&&(E.children[l]=null),!!kt(E)&&(null===E.residents&&(E.residents=new Ot.Z({shrink:!0})),!0)}function kt(E){if(0!==E.terminals.length)return!1;if(null!==E.residents)return 0===E.residents.length;for(let l=0;l<E.children.length;l++)if(E.children[l])return!1;return!0}function Dt(E,l){E[0]=Math.min(E[0],l[0]-l[3]),E[1]=Math.min(E[1],l[1]-l[3]),E[2]=Math.min(E[2],l[2]-l[3])}function Tn(E,l){E[0]=Math.max(E[0],l[0]+l[3]),E[1]=Math.max(E[1],l[1]+l[3]),E[2]=Math.max(E[2],l[2]+l[3])}function sn(E,l,T){T[0]=E[0]+l,T[1]=E[1]+l,T[2]=E[2]+l}function A(E,l,T,p){if(1===l){const v=T(E[0]);(0,H.a)(v,p)}else{ft[0]=1/0,ft[1]=1/0,ft[2]=1/0,lt[0]=-1/0,lt[1]=-1/0,lt[2]=-1/0;for(let v=0;v<l;v++){const z=T(E[v]);y(z[3])&&(Dt(ft,z),Tn(lt,z))}(0,J.o)((0,H.g)(p),ft,lt,.5),p[3]=Math.max(lt[0]-ft[0],lt[1]-ft[1],lt[2]-ft[2])/2}}function b(E,l){let T,p=1/0;for(let v=0;v<8;++v){const z=j(E,l,$[v]);z<p&&(p=z,T=$[v])}return T}function j(E,l,T){return l*(E[0]*T[0]+E[1]*T[1]+E[2]*T[2])}function y(E){return!isNaN(E)&&E!==-1/0&&E!==1/0&&E>0}x._pool=new dt.Z(x),function(E){var l;(l=E.DepthOrder||(E.DepthOrder={}))[l.FRONT_TO_BACK=1]="FRONT_TO_BACK",l[l.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(V||(V={}));const nt=[(0,D.al)(-1,-1,-1),(0,D.al)(1,-1,-1),(0,D.al)(-1,1,-1),(0,D.al)(1,1,-1),(0,D.al)(-1,-1,1),(0,D.al)(1,-1,1),(0,D.al)(-1,1,1),(0,D.al)(1,1,1)],$=[(0,D.al)(-1,-1,-1),(0,D.al)(-1,-1,1),(0,D.al)(-1,1,-1),(0,D.al)(-1,1,1),(0,D.al)(1,-1,-1),(0,D.al)(1,-1,1),(0,D.al)(1,1,-1),(0,D.al)(1,1,1)],ut=Math.sqrt(3),Tt=[null],Ft=(0,H.c)(),Mt=(0,D.Ue)(),ft=(0,D.Ue)(),lt=(0,D.Ue)(),bt=new Ot.Z,In=(0,H.c)(),Qt=(0,H.c)(),Mn=(0,H.c)(),En=(0,H.c)(),mn=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],on=new Ot.Z,pn=[0,0,0,0,0,0,0,0],An=V;var bn=U(67384);function jn(E,l,T){const p=(0,H.c)(),v=(0,H.g)(p);return(0,J.r)(v,v,E,.5),(0,J.r)(v,v,l,.5),p[3]=(0,J.p)(v,E),(0,J.g)(v,v,T),p}let Rn=class{constructor(){this._idToComponent=new Map,this._components=new An(E=>E.bounds),this._edges=new An(E=>E.bounds),this._tmpLineSegment=(0,at.Ue)(),this._tmpP1=(0,D.Ue)(),this._tmpP2=(0,D.Ue)(),this._tmpP3=(0,D.Ue)(),this.remoteClient=null}fetchCandidates(E,l){var T=this;return(0,ct.Z)(function*(){yield Promise.resolve(),(0,k.k_)(l),yield T._ensureEdgeLocations(E,l);const p=[];return T._edges.forEachNeighbor(v=>(T._addCandidates(E,v,p),p.length<1e3),E.bounds),{result:{candidates:p}}})()}_ensureEdgeLocations(E,l){var T=this;return(0,ct.Z)(function*(){const p=[];if(T._components.forEachNeighbor(X=>{if(null==X.info){const{id:q,uid:K}=X;p.push({id:q,uid:K})}return!0},E.bounds),!p.length)return;const v={components:p},z=yield T.remoteClient.invoke("fetchAllEdgeLocations",v,l??{});for(const X of z.components)T._setFetchEdgeLocations(X)})()}add(E){var l=this;return(0,ct.Z)(function*(){const T=new Fn(E.id,E.bounds);return l._idToComponent.set(T.id,T),l._components.add([T]),{result:{}}})()}remove(E){var l=this;return(0,ct.Z)(function*(){const T=l._idToComponent.get(E.id);if(T){const p=[];l._edges.forEachNeighbor(v=>(v.component===T&&p.push(v),!0),T.bounds),l._edges.remove(p),l._components.remove([T]),l._idToComponent.delete(T.id)}return{result:{}}})()}_setFetchEdgeLocations(E){const l=this._idToComponent.get(E.id);if(null==l||E.uid!==l.uid)return;const T=bn.n_.createView(E.locations),p=new Array(T.count),v=(0,D.Ue)(),z=(0,D.Ue)();for(let K=0;K<T.count;K++){T.position0.getVec(K,v),T.position1.getVec(K,z);const it=jn(v,z,E.origin),Et=new Un(l,K,it);p[K]=Et}this._edges.add(p);const{objectIds:X,origin:q}=E;l.info={locations:T,objectIds:X,origin:q}}_addCandidates(E,l,T){const{info:p}=l.component,{origin:v,objectIds:z}=p,X=p.locations,q=X.position0.getVec(l.index,this._tmpP1),K=X.position1.getVec(l.index,this._tmpP2);(0,J.g)(q,q,v),(0,J.g)(K,K,v);const it=z[X.componentIndex.get(l.index)];this._addEdgeCandidate(E,it,q,K,T),Pn(E,it,q,T),Pn(E,it,K,T)}_addEdgeCandidate(E,l,T,p,v){if(!E.returnEdge)return;const z=(0,H.g)(E.bounds),X=(0,at.zk)(T,p,this._tmpLineSegment),q=(0,at.nF)(X,z,this._tmpP3);(0,H.n)(E.bounds,q)&&v.push({type:"edge",objectId:l,target:(0,D.d9)(q),distance:(0,J.p)(z,q),start:(0,D.d9)(T),end:(0,D.d9)(p)})}};Rn=(0,ot._)([(0,rt.j)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],Rn);const Nn=Rn;function Pn(E,l,T,p){if(!E.returnVertex||!(0,H.n)(E.bounds,T))return;const v=(0,H.g)(E.bounds);p.push({type:"vertex",objectId:l,target:(0,D.d9)(T),distance:(0,J.p)(v,T)})}let Fn=(()=>{class E{constructor(T,p){this.id=T,this.bounds=p,this.info=null,this.uid=++E.uid}}return E.uid=0,E})();class Un{constructor(l,T,p){this.component=l,this.index=T,this.bounds=p}}}}]);