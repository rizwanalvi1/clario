"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[7734,9005,605],{38737:(ze,ge,w)=>{var R,F;w.d(ge,{Y:()=>R}),(F=R||(R={}))[F.KILOBYTES=1024]="KILOBYTES",F[F.MEGABYTES=1048576]="MEGABYTES",F[F.GIGABYTES=1073741824]="GIGABYTES"},83502:(ze,ge,w)=>{w.d(ge,{S6:()=>z,u_:()=>F});var R=w(62209);class F{constructor(M=null,Y={},de,S){this.geometry=M,this.attributes=Y,this.centroid=de,this.objectId=S,this.displayId=0,this.geohashX=0,this.geohashY=0}static fromJSON(M,Y){const de=M.geometry?R.Z.fromJSON(M.geometry):null,S=M.centroid?R.Z.fromJSON(M.centroid):null;return new F(de,M.attributes,S,M.attributes[Y])}weakClone(){const M=new F(this.geometry,this.attributes,this.centroid,this.objectId);return M.displayId=this.displayId,M.geohashX=this.geohashX,M.geohashY=this.geohashY,M}clone(){const M=this.geometry?.clone(),Y=new F(M,{...this.attributes},this.centroid?.clone(),this.objectId);return Y.displayId=this.displayId,Y.geohashX=this.geohashX,Y.geohashY=this.geohashY,Y}}function z(T){return!!T.geometry?.coords?.length}},40620:(ze,ge,w)=>{w.d(ge,{Z:()=>R});class R{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const z=new R;return z.objectIdFieldName=this.objectIdFieldName,z.globalIdFieldName=this.globalIdFieldName,z.geohashFieldName=this.geohashFieldName,z.geometryProperties=this.geometryProperties,z.geometryType=this.geometryType,z.spatialReference=this.spatialReference,z.hasZ=this.hasZ,z.hasM=this.hasM,z.features=this.features,z.fields=this.fields,z.transform=this.transform,z.exceededTransferLimit=this.exceededTransferLimit,z.uniqueIdField=this.uniqueIdField,z.queryGeometry=this.queryGeometry,z.queryGeometryType=this.queryGeometryType,z}}},62209:(ze,ge,w)=>{w.d(ge,{Z:()=>F});class F{constructor(B=[],T=[],M=!1){this.lengths=B??[],this.coords=T??[],this.hasIndeterminateRingOrder=M}static fromJSON(B){return new F(B.lengths,B.coords,B.hasIndeterminateRingOrder)}static fromRect(B){const[T,M,Y,de]=B,S=Y-T,J=de-M;return new F([5],[T,M,S,0,0,J,-S,0,0,-J])}get isPoint(){return 0===this.lengths.length}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((B,T)=>B+T)}forEachVertex(B){let T=0;this.lengths.length||B(this.coords[0],this.coords[1]);for(let M=0;M<this.lengths.length;M++){const Y=this.lengths[M];for(let de=0;de<Y;de++)B(this.coords[2*(de+T)],this.coords[2*(de+T)+1]);T+=Y}}deltaDecode(){const B=this.clone(),{coords:T,lengths:M}=B;let Y=0;for(const de of M){for(let S=1;S<de;S++)T[2*(Y+S)]+=T[2*(Y+S)-2],T[2*(Y+S)+1]+=T[2*(Y+S)-1];Y+=de}return B}clone(B){if(0===this.lengths.length)return new F([],[this.coords[0],this.coords[1]]);const T=2*(0===this.lengths.length?1:this.lengths.reduce((Y,de)=>Y+de)),M=this.coords.slice(0,T);return B?(B.set(M),new F(this.lengths,B,this.hasIndeterminateRingOrder)):new F(Array.from(this.lengths),Array.from(M),this.hasIndeterminateRingOrder)}}},50243:(ze,ge,w)=>{w.d(ge,{Z:()=>Ee});var R=w(50484),F=w(25387),z=w(89317),B=w(80543),de=(w(14007),w(4703),w(65311),w(62185)),S=w(10141),J=w(7547),Me=w(59300),k=w(30457);let he=class extends((0,F.J)(z.wq)){constructor(ye){super(ye),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(ye){const Ie={};for(const Te of Object.keys(ye))Ie[Te]=(0,Me.im)(ye[Te]);return Ie}writeDomains(ye,Ie){const Te={};for(const ue of Object.keys(ye))ye[ue]&&(Te[ue]=ye[ue]?.toJSON());Ie.domains=Te}};(0,R._)([(0,B.Cb)({json:{write:!0}})],he.prototype,"id",void 0),(0,R._)([(0,B.Cb)({json:{write:!0}})],he.prototype,"name",void 0),(0,R._)([(0,B.Cb)({json:{write:!0}})],he.prototype,"domains",void 0),(0,R._)([(0,de.r)("domains")],he.prototype,"readDomains",null),(0,R._)([(0,J.c)("domains")],he.prototype,"writeDomains",null),(0,R._)([(0,B.Cb)({type:[k.Z],json:{write:!0}})],he.prototype,"templates",void 0),he=(0,R._)([(0,S.j)("esri.layers.support.FeatureType")],he);const Ee=he},56761:(ze,ge,w)=>{w.d(ge,{UG:()=>Me,UO:()=>ye,YI:()=>Ee,dI:()=>Ie,el:()=>G,hV:()=>he,z7:()=>k});var R=w(72578);const F="__begin__",z="__end__",B=new RegExp(F,"ig"),T=new RegExp(z,"ig"),M=new RegExp("^"+F,"i"),Y=new RegExp(z+"$","i"),de='"',S=de+" + ",J=" + "+de;function Me(N){return N.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function k(N){return N.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function he(N){const Z={expression:"",type:"none"};return N.labelExpressionInfo?N.labelExpressionInfo.value?(Z.expression=N.labelExpressionInfo.value,Z.type="conventional"):N.labelExpressionInfo.expression&&(Z.expression=N.labelExpressionInfo.expression,Z.type="arcade"):null!=N.labelExpression&&(Z.expression=Me(N.labelExpression),Z.type="conventional"),Z}function Ee(N){const Z=he(N);if(!Z)return null;switch(Z.type){case"conventional":return Ie(Z.expression);case"arcade":return Z.expression}return null}function ye(N){const Z=he(N);if(!Z)return null;switch(Z.type){case"conventional":return function ue(N){return N?.match(Te)?.[1].trim()||null}(Z.expression);case"arcade":return G(Z.expression)}return null}function Ie(N){let Z;return N?(Z=(0,R.gx)(N,U=>F+'$feature["'+U+'"]'+z),Z=M.test(Z)?Z.replace(M,""):de+Z,Z=Y.test(Z)?Z.replace(Y,""):Z+de,Z=Z.replaceAll(B,S).replaceAll(T,J)):Z='""',Z}const Te=/^\s*\{([^}]+)\}\s*$/i,ke=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,H=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,ne=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;function G(N){if(!N)return null;let Z=ke.exec(N)||H.exec(N);return Z?Z[1]||Z[3]:(Z=ne.exec(N),Z?Z[2]:null)}},46708:(ze,ge,w)=>{w.d(ge,{F:()=>de,e:()=>M});var R=w(15861),F=w(15462),z=w(82784),B=w(93792),T=w(91866);function M(J,Me,k){return Y.apply(this,arguments)}function Y(){return(Y=(0,R.Z)(function*(J,Me,k){const he=yield de(J,Me,k);return B.Z.fromJSON(he)})).apply(this,arguments)}function de(J,Me,k){return S.apply(this,arguments)}function S(){return(S=(0,R.Z)(function*(J,Me,k){const he=(0,F.en)(J),Ee={...k},ye=T.Z.from(Me),{data:Ie}=yield(0,z.JT)(he,ye,ye.sourceSpatialReference,Ee);return Ie})).apply(this,arguments)}},8295:(ze,ge,w)=>{w.d(ge,{p:()=>F});var R=w(53456);function F(z,B,T){if(!T?.features||!T.hasZ)return;const M=(0,R.k)(T.geometryType,B,z.outSpatialReference);if(null!=M)for(const Y of T.features)M(Y.geometry)}},85596:(ze,ge,w)=>{w.d(ge,{Z:()=>he});var J,R=w(50484),F=w(89317),z=w(80543),B=w(1535),Y=(w(65311),w(14007),w(10141));const Me={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let k=J=class extends F.wq{constructor(Ee){super(Ee),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:Ee}=this,ye=function de(Ee){const{exifInfo:ye,exifName:Ie,tagName:Te}=Ee;if(!ye||!Ie||!Te)return null;const ue=ye.find(ke=>ke.name===Ie);return ue?function S(Ee){const{tagName:ye,tags:Ie}=Ee;return Ie&&ye&&Ie.find(ue=>ue.name===ye)?.value||null}({tagName:Te,tags:ue.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:Ee});return Me[ye]||null}clone(){return new J({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,R._)([(0,z.Cb)({type:String})],k.prototype,"contentType",void 0),(0,R._)([(0,z.Cb)()],k.prototype,"exifInfo",void 0),(0,R._)([(0,z.Cb)({readOnly:!0})],k.prototype,"orientationInfo",null),(0,R._)([(0,z.Cb)({type:B.z8})],k.prototype,"id",void 0),(0,R._)([(0,z.Cb)({type:String})],k.prototype,"globalId",void 0),(0,R._)([(0,z.Cb)({type:String})],k.prototype,"keywords",void 0),(0,R._)([(0,z.Cb)({type:String})],k.prototype,"name",void 0),(0,R._)([(0,z.Cb)({json:{read:!1}})],k.prototype,"parentGlobalId",void 0),(0,R._)([(0,z.Cb)({json:{read:!1}})],k.prototype,"parentObjectId",void 0),(0,R._)([(0,z.Cb)({type:B.z8})],k.prototype,"size",void 0),(0,R._)([(0,z.Cb)({json:{read:!1}})],k.prototype,"url",void 0),k=J=(0,R._)([(0,Y.j)("esri.rest.query.support.AttachmentInfo")],k);const he=k},93792:(ze,ge,w)=>{w.d(ge,{Z:()=>ke});var Ie,R=w(50484),F=w(2189),z=w(35458),B=w(84303),T=w(89317),M=w(34222),Y=w(80543),J=(w(14007),w(4703),w(62185)),Me=w(10141),k=w(7547),he=w(43814),Ee=w(40637),ye=w(81247);const Te=new B.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let ue=Ie=class extends T.wq{constructor(H){super(H),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(H,ne){const G=he.Z.fromJSON(ne.spatialReference),N=[];for(let Z=0;Z<H.length;Z++){const U=H[Z],D=z.Z.fromJSON(U),ve=U.geometry?.spatialReference;null==D.geometry||ve||(D.geometry.spatialReference=G);const be=U.aggregateGeometries,V=D.aggregateGeometries;if(be&&null!=V)for(const re in V){const q=V[re],ce=be[re],Ze=ce?.spatialReference;null==q||Ze||(q.spatialReference=G)}N.push(D)}return N}writeGeometryType(H,ne,G,N){if(H)return void Te.write(H,ne,G,N);const{features:Z}=this;if(Z)for(const U of Z)if(null!=U?.geometry)return void Te.write(U.geometry.type,ne,G,N)}readQueryGeometry(H,ne){if(!H)return null;const G=!!H.spatialReference,N=(0,Ee.im)(H);return N&&!G&&ne.spatialReference&&(N.spatialReference=he.Z.fromJSON(ne.spatialReference)),N}writeSpatialReference(H,ne){if(H)return void(ne.spatialReference=H.toJSON());const{features:G}=this;if(G)for(const N of G)if(N&&null!=N.geometry&&N.geometry.spatialReference)return void(ne.spatialReference=N.geometry.spatialReference.toJSON())}clone(){return new Ie(this.cloneProperties())}cloneProperties(){return(0,M.d9)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(H){const ne=this.write();if(ne.features&&Array.isArray(H)&&H.length>0)for(let G=0;G<ne.features.length;G++){const N=ne.features[G];if(N.geometry){const Z=H?.[G];N.geometry=Z?.toJSON()||N.geometry}}return ne}quantize(H){const{scale:[ne,G],translate:[N,Z]}=H,ve=this.features,be=this._getQuantizationFunction(this.geometryType,V=>Math.round((V-N)/ne),V=>Math.round((Z-V)/G));for(let V=0,re=ve.length;V<re;V++)be?.(ve[V].geometry)||(ve.splice(V,1),V--,re--);return this.transform=H,this}unquantize(){const{geometryType:H,features:ne,transform:G}=this;if(!G)return this;const{translate:[N,Z],scale:[U,D]}=G;let V=null,re=null;if(this.hasZ&&null!=G?.scale?.[2]){const{translate:[,,ce],scale:[,,Ze]}=G;V=me=>me*Ze+ce}if(this.hasM&&null!=G?.scale?.[3]){const{translate:[,,,ce],scale:[,,,Ze]}=G;re=me=>null==me?me:me*Ze+ce}const q=this._getHydrationFunction(H,ce=>ce*U+N,ce=>Z-ce*D,V,re);for(const{geometry:ce}of ne)null!=ce&&q&&q(ce);return this.transform=null,this}_quantizePoints(H,ne,G){let N,Z;const U=[];for(let D=0,ve=H.length;D<ve;D++){const be=H[D];if(D>0){const V=ne(be[0]),re=G(be[1]);V===N&&re===Z||(U.push([V-N,re-Z]),N=V,Z=re)}else N=ne(be[0]),Z=G(be[1]),U.push([N,Z])}return U.length>0?U:null}_getQuantizationFunction(H,ne,G){return"point"===H?N=>(N.x=ne(N.x),N.y=G(N.y),N):"polyline"===H||"polygon"===H?N=>{const Z=(0,Ee.oU)(N)?N.rings:N.paths,U=[];for(let D=0,ve=Z.length;D<ve;D++){const V=this._quantizePoints(Z[D],ne,G);V&&U.push(V)}return U.length>0?((0,Ee.oU)(N)?N.rings=U:N.paths=U,N):null}:"multipoint"===H?N=>{const Z=this._quantizePoints(N.points,ne,G);return Z&&Z.length>0?(N.points=Z,N):null}:"extent"===H?N=>N:null}_getHydrationFunction(H,ne,G,N,Z){return"point"===H?U=>{U.x=ne(U.x),U.y=G(U.y),N&&(U.z=N(U.z))}:"polyline"===H||"polygon"===H?U=>{const D=(0,Ee.oU)(U)?U.rings:U.paths;let ve,be;for(let V=0,re=D.length;V<re;V++){const q=D[V];for(let ce=0,Ze=q.length;ce<Ze;ce++){const me=q[ce];ce>0?(ve+=me[0],be+=me[1]):(ve=me[0],be=me[1]),me[0]=ne(ve),me[1]=G(be)}}if(N&&Z)for(let V=0,re=D.length;V<re;V++){const q=D[V];for(let ce=0,Ze=q.length;ce<Ze;ce++){const me=q[ce];me[2]=N(me[2]),me[3]=Z(me[3])}}else if(N)for(let V=0,re=D.length;V<re;V++){const q=D[V];for(let ce=0,Ze=q.length;ce<Ze;ce++){const me=q[ce];me[2]=N(me[2])}}else if(Z)for(let V=0,re=D.length;V<re;V++){const q=D[V];for(let ce=0,Ze=q.length;ce<Ze;ce++){const me=q[ce];me[2]=Z(me[2])}}}:"extent"===H?U=>{U.xmin=ne(U.xmin),U.ymin=G(U.ymin),U.xmax=ne(U.xmax),U.ymax=G(U.ymax),N&&null!=U.zmax&&null!=U.zmin&&(U.zmax=N(U.zmax),U.zmin=N(U.zmin)),Z&&null!=U.mmax&&null!=U.mmin&&(U.mmax=Z(U.mmax),U.mmin=Z(U.mmin))}:"multipoint"===H?U=>{const D=U.points;let ve,be;for(let V=0,re=D.length;V<re;V++){const q=D[V];V>0?(ve+=q[0],be+=q[1]):(ve=q[0],be=q[1]),q[0]=ne(ve),q[1]=G(be)}if(N&&Z)for(let V=0,re=D.length;V<re;V++){const q=D[V];q[2]=N(q[2]),q[3]=Z(q[3])}else if(N)for(let V=0,re=D.length;V<re;V++){const q=D[V];q[2]=N(q[2])}else if(Z)for(let V=0,re=D.length;V<re;V++){const q=D[V];q[2]=Z(q[2])}}:null}};(0,R._)([(0,Y.Cb)({type:String,json:{write:!0}})],ue.prototype,"displayFieldName",void 0),(0,R._)([(0,Y.Cb)({type:Boolean,json:{write:{overridePolicy:H=>({enabled:H})}}})],ue.prototype,"exceededTransferLimit",void 0),(0,R._)([(0,Y.Cb)({type:[z.Z],json:{write:!0}})],ue.prototype,"features",void 0),(0,R._)([(0,J.r)("features")],ue.prototype,"readFeatures",null),(0,R._)([(0,Y.Cb)({type:[ye.Z],json:{write:!0}})],ue.prototype,"fields",void 0),(0,R._)([(0,Y.Cb)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:Te.read}}})],ue.prototype,"geometryType",void 0),(0,R._)([(0,k.c)("geometryType")],ue.prototype,"writeGeometryType",null),(0,R._)([(0,Y.Cb)({type:Boolean,json:{write:{overridePolicy:H=>({enabled:H})}}})],ue.prototype,"hasM",void 0),(0,R._)([(0,Y.Cb)({type:Boolean,json:{write:{overridePolicy:H=>({enabled:H})}}})],ue.prototype,"hasZ",void 0),(0,R._)([(0,Y.Cb)({types:F.qM,json:{write:!0}})],ue.prototype,"queryGeometry",void 0),(0,R._)([(0,J.r)("queryGeometry")],ue.prototype,"readQueryGeometry",null),(0,R._)([(0,Y.Cb)({type:he.Z,json:{write:!0}})],ue.prototype,"spatialReference",void 0),(0,R._)([(0,k.c)("spatialReference")],ue.prototype,"writeSpatialReference",null),(0,R._)([(0,Y.Cb)({json:{write:!0}})],ue.prototype,"transform",void 0),ue=Ie=(0,R._)([(0,Me.j)("esri.rest.support.FeatureSet")],ue),ue.prototype.toJSON.isDefaultToJSON=!0;const ke=ue},64579:(ze,ge,w)=>{function R(S){return S&&"function"==typeof S.highlight}function B(S,J){if(J&&S){const{minScale:Me,maxScale:k}=S;if(function T(S,J){return null!=S&&S>0||null!=J&&J>0}(Me,k))return function z(S,J,Me){return null==S||S>=Me&&(0===J||S<=J)}(J,Me,k)}return!0}function M(S){return!S?.minScale||!S.maxScale||S.minScale>=S.maxScale}w.d(ge,{Cy:()=>M,GB:()=>B,tl:()=>R})},6494:(ze,ge,w)=>{w.r(ge),w.d(ge,{default:()=>Tr});var R=w(15861),F=w(50484),z=w(93300),B=w(4703),T=w(77675),M=w(80543),S=(w(14007),w(65311),w(10141)),J=w(99002),k=(w(91531),w(83944));function he(h,g,y,v){let b=null,C=1e3;"number"==typeof g?(C=g,v=y):(b=g??null,C=y);let I,_=0;const A=()=>{_=0,h.apply(v,I)},P=(...E)=>{b&&b.apply(v,E),I=E,C?_||(_=setTimeout(A,C)):A()};return P.remove=()=>{_&&(clearTimeout(_),_=0)},P.forceUpdate=()=>{_&&(clearTimeout(_),A())},P.hasPendingUpdates=()=>!!_,P}function Te(h){switch(h?.type){case"point":return h;case"extent":return h.center;case"polygon":return h.centroid;case"multipoint":case"polyline":return h.extent?.center;default:return null}}w(2189),w(40408),w(26894);var N=w(48289),Z=w(73018),U=w(53021),D=w(57964),ve=w(38737),V=(w(32017),w(55117)),re=w(49602);function Zt(h,g,y="arithmetic"){return{type:(0,re.UF)(g),value:h,unit:g,rotationType:y}}(function Ze(h,g){(0,re.UF)(g)})(0,"meters"),function me(h,g){(0,re.UF)(g)}(0,"square-meters"),Zt(0,"radians"),Zt(0,"degrees"),Zt(0,"degrees","geographic");var ot=w(72578),Qe=w(37689);const on=["B","kB","MB","GB","TB"];var Mt=w(35458),qe=w(73514),gs=w(85596),rn=w(12768),ei=w(94678),Et=w(85295),ys=w(85971),ti=w(43157),vs=w(4978),ii=w(764);const ni=()=>B.Z.getLogger("esri.widgets.Feature.support.featureUtils"),Cs=/href=(""|'')/gi,ws=/(\{([^{\r\n]+)\})/g,Fs=/'/g,ln=/^\s*expression\//i,Ms=/(\n)/gi,Is=/[\u00A0-\u9999<>&]/gim,_s=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,As=/^(?:mailto:|tel:)/,an="relationships/",dn=(0,ei.Ze)("short-date-short-time");function un(h){if(null!=h)return(h.sourceLayer||h.layer)??void 0}function Ut(h){return si.apply(this,arguments)}function si(){return(si=(0,R.Z)(function*({type:h,value:g,event:y}){try{return"function"==typeof g?g(y):g}catch(v){return void ni().error("error",`An error occurred when calling the "${h}" function`,{error:v,graphic:y.graphic,value:g})}})).apply(this,arguments)}function cn(h=""){if(h)return!As.test(h.trim().toLowerCase())}function oi(h){return!!h&&ln.test(h)}function hn(h,g){const y=function xs(h,g){if(!g||!oi(g)||!h)return;const y=g.replace(ln,"").toLowerCase();return h.find(({name:v})=>v.toLowerCase()===y)}(g,h?.fieldName);return y?y.title||null:h?h.label||h.fieldName:null}function Tt(h,g){const y=ri(g,h);return y?y.name:h}function ri(h,g){return h&&"function"==typeof h.getField&&g?h.getField(g)??null:null}function pn(h){return`${h}`.trim()}function ct({attributes:h,globalAttributes:g,layer:y,text:v,expressionAttributes:b,fieldInfoMap:C}){return v?li({formattedAttributes:g,template:Ns(v,{...g,...b,...h},y),fieldInfoMap:C}):""}function li({formattedAttributes:h,template:g,fieldInfoMap:y}){return pn(function Ts(h){return h.replaceAll(Cs,"")}((0,ot.gx)((0,ot.gx)(g,v=>function Es(h,g){return`{${g.get(h.toLowerCase())?.fieldName||h}}`}(v,y)),h)))}function ai(h,g){return h.replaceAll(ws,(y,v,b)=>{const C=ri(g,b);return C?`{${C.name}}`:v})}function Ns(h,g,y){const v=ai(h,y);return v&&v.replaceAll(_s,(b,C,I)=>function Os(h,g,y){const v=(g=pn(g))&&"{"!==g[0];return(0,ot.gx)(h,function Ls(h,g=!1){const y={...h};return Object.keys(y).forEach(v=>function Rs(h,g,y=!1){const v=g[h];if("string"==typeof v){const b="%27",C=(y?encodeURIComponent(v):v).replaceAll(Fs,b);g[h]=C}}(v,y,g)),y}(y,v||!1))}(b,C||I,g))}function di(h){return function Ss(h){return null!=h&&"object"==typeof h&&"fieldsIndex"in h&&"geometryType"in h&&"getField"in h&&"load"in h&&"loaded"in h&&"objectIdField"in h&&"spatialReference"in h&&"type"in h&&("feature"===h.type||"scene"===h.type||"sublayer"===h.type)&&"when"in h}(h)&&function Us(h){return null!=h&&"object"==typeof h&&"createQuery"in h&&"queryFeatureCount"in h&&"queryObjectIds"in h&&"queryRelatedFeatures"in h&&"queryRelatedFeaturesCount"in h&&"relationships"in h}(h)}function ui(h,g,y,v){return h.trim().split(g).map(b=>(0,Qe.uf)(Number(b),(0,Qe.sh)(v))).join(y)}function mn(h,g){if(h?.length&&g)return h.find(y=>y.fieldName?.toLowerCase()===g.toLowerCase())}function fn(h){const g=[];if(!h)return g;const{fieldInfos:y,content:v}=h;return y&&g.push(...y),v&&Array.isArray(v)&&v.forEach(b=>{if("fields"===b.type){const C=b?.fieldInfos;C&&g.push(...C)}}),g}function ci(h){return h.replaceAll(Is,g=>`&#${g.charCodeAt(0)};`)}function Pt(h){return"string"==typeof h?h.replaceAll(Ms,'<br class="esri-text-new-line" />'):h}function gn(h){const{value:g,fieldName:y,fieldInfos:v,fieldInfoMap:b,layer:C,graphic:I,timeZone:_}=h;if(null==g)return"";const A=function Bs({fieldName:h,value:g,graphic:y,layer:v}){if(et(h)||!v||"function"!=typeof v.getFieldDomain)return null;const b=y&&v.getFieldDomain(h,{feature:y});return b&&"coded-value"===b.type?b.getName(g):null}({fieldName:y,value:g,graphic:I,layer:C});if(A)return A;const P=function Vs({fieldName:h,graphic:g,layer:y}){if(et(h)||!y||"function"!=typeof y.getFeatureType)return null;const{typeIdField:v}=y;if(!v||h!==v)return null;const b=y.getFeatureType(g);return b?b.name:null}({fieldName:y,graphic:I,layer:C});if(P)return P;if(b.get(y.toLowerCase()))return function $s(h,g){const{fieldInfos:y,fieldName:v,preventPlacesFormatting:b,layer:C,timeZone:I}=g,_=mn(y,v),A=ri(C,v);if(_&&!(0,Et.Ec)(v)){const E=A?.type,L=_.format?.dateFormat;if("date"===E||"date-only"===E||"time-only"===E||"timestamp-offset"===E||L)return(0,ti.$8)(h,{format:L,fieldType:E,timeZoneOptions:{layerTimeZone:C&&"preferredTimeZone"in C?C.preferredTimeZone:null,viewTimeZone:I,datesInUnknownTimezone:!(!C||!("datesInUnknownTimezone"in C)||!C.datesInUnknownTimezone)}})}const P=_?.format;return"string"==typeof h&&(0,Et.Ec)(v)&&P?function Ds(h,g){return h=h.trim(),/\d{2}-\d{2}/.test(h)?h:h.includes(",")?ui(h,",",", ",g):h.includes(";")?ui(h,";","; ",g):h.includes(" ")?ui(h," "," ",g):(0,Qe.uf)(Number(h),(0,Qe.sh)(g))}(h,P):"string"==typeof(h=function Zs(h,g){if("string"==typeof h&&g&&null==g.dateFormat&&(null!=g.places||null!=g.digitSeparator)){const y=Number(h);if(!isNaN(y))return y}return h}(h,P))||null==h||null==P?Pt(h):(0,Qe.uf)(h,b?{...(0,Qe.sh)(P),minimumFractionDigits:0,maximumFractionDigits:20}:(0,Qe.sh)(P))}(g,{fieldInfos:v||Array.from(b.values()),fieldName:y,layer:C,timeZone:_});const E=C?.fieldsIndex?.get(y);return E&&((0,ti.a8)(E)||(0,Et.sX)(E))?(0,ti.$8)(g,{fieldType:E.type,timeZoneOptions:{layerTimeZone:C&&"preferredTimeZone"in C?C.preferredTimeZone:null,viewTimeZone:_,datesInUnknownTimezone:!(!C||!("datesInUnknownTimezone"in C)||!C.datesInUnknownTimezone)}}):Pt(g)}function hi({fieldInfos:h,attributes:g,layer:y,graphic:v,fieldInfoMap:b,relatedInfos:C,timeZone:I}){const _={};return C?.forEach(A=>function Gs({attributes:h,relatedInfo:g,fieldInfoMap:y,fieldInfos:v,layer:b,timeZone:C}){h&&g&&(g.relatedFeatures?.forEach(I=>vn({attributes:h,graphic:I,relatedInfo:g,fieldInfoMap:y,fieldInfos:v,layer:b,timeZone:C})),g.relatedStatsFeatures?.forEach(I=>vn({attributes:h,graphic:I,relatedInfo:g,fieldInfoMap:y,fieldInfos:v,layer:b,timeZone:C})))}({attributes:_,relatedInfo:A,fieldInfoMap:b,fieldInfos:h,layer:y,timeZone:I})),g&&Object.keys(g).forEach(A=>{_[A]=gn({fieldName:A,fieldInfos:h,fieldInfoMap:b,layer:y,value:g[A],graphic:v,timeZone:I})}),_}function yn(h,g){return pi.apply(this,arguments)}function pi(){return(pi=(0,R.Z)(function*(h,g){const{layer:y,graphic:v,outFields:b,objectIds:C,returnGeometry:I,spatialReference:_}=h,A=C[0];if("number"!=typeof A&&"string"!=typeof A){const E="Could not query required fields for the specified feature. The feature's ID is invalid.",L={layer:y,graphic:v,objectId:A,requiredFields:b};return ni().warn(E,L),null}if(!(0,ys.S1)(y)?.operations?.supportsQuery){const E="The specified layer cannot be queried. The following fields will not be available.",L={layer:y,graphic:v,requiredFields:b,returnGeometry:I};return ni().warn(E,L),null}const P=y.createQuery();return P.objectIds=C,P.outFields=b?.length?b:[y.objectIdField],P.returnGeometry=!!I,P.returnZ=!!I,P.returnM=!!I,P.outSpatialReference=_,(yield y.queryFeatures(P,g)).features[0]})).apply(this,arguments)}function mi(){return(mi=(0,R.Z)(function*(h){if(!h.expressionInfos?.length)return!1;const g=yield(0,vs.LC)(),{arcadeUtils:{hasGeometryFunctions:y}}=g;return y(h)})).apply(this,arguments)}function fi(){return fi=(0,R.Z)(function*({graphic:h,popupTemplate:g,layer:y,spatialReference:v},b){if(!y||!g||("function"==typeof y.load&&(yield y.load(b)),!h.attributes))return;const C=y.objectIdField,I=h.attributes[C];if(null==I)return;const _=[I],A=yield g.getRequiredFields(y.fieldsIndex),P=(0,Et.R9)(A,h),E=P?[]:A.includes(C)?A:[...A,C],L=g.returnGeometry||(yield function Ws(h){return mi.apply(this,arguments)}(g));if(P&&!L)return;const O=yield yn({layer:y,graphic:h,outFields:E,objectIds:_,returnGeometry:L,spatialReference:v},b);O&&(O.geometry&&(h.geometry=O.geometry),O.attributes&&(h.attributes={...h.attributes,...O.attributes}))}),fi.apply(this,arguments)}function et(h=""){return!!h&&h.includes(an)}function vn({attributes:h,graphic:g,relatedInfo:y,fieldInfos:v,fieldInfoMap:b,layer:C,timeZone:I}){h&&g&&y&&Object.keys(g.attributes).forEach(_=>{const A=function Ys(h){return h?`${an}${h.layerId}/${h.fieldName}`:""}({layerId:y.relation.id.toString(),fieldName:_});h[A]=gn({fieldName:A,fieldInfos:v,fieldInfoMap:b,layer:C,value:g.attributes[_],graphic:g,timeZone:I})})}const bn=h=>{if(!h)return!1;const g=h.toUpperCase();return g.includes("CURRENT_TIMESTAMP")||g.includes("CURRENT_DATE")||g.includes("CURRENT_TIME")},Cn=({layer:h,method:g,query:y,definitionExpression:v})=>{if(!h.capabilities?.query?.supportsCacheHint||"attachments"===g)return;const b=null!=y.where?y.where:null,C=null!=y.geometry?y.geometry:null;bn(v)||bn(b)||"extent"===C?.type||"tile"===y.resultType||(y.cacheHint=!0)};function wn(h,g){return h?.allTables.find(y=>"feature"===y.type&&y.layerId===g.id&&y.url===g.layer?.url)}function It({map:h,relationship:g,relationship:{relatedTableId:y},relatedLayer:v,layers:b}){if(!b)return null;for(const C of b){if("map-image"===C.type){const _=It({layers:C.sublayers,map:h,relatedLayer:v,relationship:g})||It({layers:C.subtables,map:h,relatedLayer:v,relationship:g});if(_)return _;continue}if(!di(C))continue;if("sublayer"===v.type){if(C!==v&&C.id===y)return C.isTable?wn(h,C):C;continue}const I="scene"===v.type&&v.associatedLayer?v.associatedLayer.url:v.url;if(!I)return null;if("sublayer"!==C.type){if(C!==v&&C.url===I&&C.layerId===y)return C}else if(C!==v&&C.layer?.url===I&&C.id===y)return C.isTable?wn(h,C):C}return null}const Fn={editing:!1,operations:{add:!0,update:!0,delete:!0}},Mn=k.Z.ofType(gs.Z);let De=class extends qe.Z{constructor(h){super(h),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities={...Fn},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new Mn,this.fileInfos=new k.Z,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles((0,T.YP)(()=>this.graphic,()=>this._graphicChanged(),T.nn))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(h){return{...Fn,...h}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:h}=this;if(!h)return!1;const g=h.layer||h.sourceLayer;return g?.loaded&&"capabilities"in g&&g.capabilities&&"operations"in g.capabilities&&"supportsResizeAttachments"in g.capabilities.operations&&g.capabilities.operations.supportsResizeAttachments||!1}getAttachments(){var h=this;return(0,R.Z)(function*(){const{_attachmentLayer:g,attachmentInfos:y}=h;if(!g||"function"!=typeof g.queryAttachments)throw new D.Z("invalid-layer","getAttachments(): A valid layer is required.");const v=h._getObjectId(),b=new rn.Z({objectIds:[v],returnMetadata:!0}),C=[],I=g.queryAttachments(b).then(A=>A[v]||C).catch(()=>C);h._getAttachmentsPromise=I,h.notifyChange("state");const _=yield I;return y.destroyAll(),_.length&&y.addMany(_),h._getAttachmentsPromise=null,h.notifyChange("state"),_})()}addAttachment(h,g=this.graphic){var y=this;return(0,R.Z)(function*(){const{_attachmentLayer:v,attachmentInfos:b,capabilities:C}=y;if(!g)throw new D.Z("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:g});if(!h)throw new D.Z("invalid-attachment","addAttachment(): An attachment is required.",{attachment:h});if(!C.operations?.add)throw new D.Z("invalid-capabilities","addAttachment(): add capabilities are required.");if(!v||"function"!=typeof v.addAttachment)throw new D.Z("invalid-layer","addAttachment(): A valid layer is required.");const I=v.addAttachment(g,h).then(A=>y._queryAttachment(A.objectId,g)),_=yield I;return b.add(_),_})()}deleteAttachment(h){var g=this;return(0,R.Z)(function*(){const{_attachmentLayer:y,attachmentInfos:v,graphic:b,capabilities:C}=g;if(!h)throw new D.Z("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:h});if(!C.operations?.delete)throw new D.Z("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!y||"function"!=typeof y.deleteAttachments)throw new D.Z("invalid-layer","deleteAttachment(): A valid layer is required.");if(!b)throw new D.Z("invalid-graphic","deleteAttachment(): A graphic is required.");const I=y.deleteAttachments(b,[h.id]).then(()=>h),_=yield I;return v.remove(_),_.destroy(),_})()}updateAttachment(h,g=this.activeAttachmentInfo){var y=this;return(0,R.Z)(function*(){const{_attachmentLayer:v,attachmentInfos:b,graphic:C,capabilities:I}=y;if(!h)throw new D.Z("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:h});if(!g)throw new D.Z("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:g});if(!I.operations?.update)throw new D.Z("invalid-capabilities","updateAttachment(): Update capabilities are required.");const _=b.indexOf(g);if(!v||"function"!=typeof v.updateAttachment)throw new D.Z("invalid-layer","updateAttachment(): A valid layer is required.");if(!C)throw new D.Z("invalid-graphic","updateAttachment(): A graphic is required.");const A=v.updateAttachment(C,g.id,h).then(E=>y._queryAttachment(E.objectId)),P=yield A;return b.splice(_,1,P),P})()}commitFiles(){var h=this;return(0,R.Z)(function*(){return yield Promise.all(h.fileInfos.items.map(g=>h.addAttachment(g.form))),h.fileInfos.removeAll(),h.getAttachments()})()}addFile(h,g){if(!h||!g)return null;const y={file:h,form:g};return this.fileInfos.add(y),y}updateFile(h,g,y=this.activeFileInfo){if(!h||!g||!y)return null;const v=this.fileInfos.indexOf(y);return v>-1&&this.fileInfos.splice(v,1,{file:h,form:g}),this.fileInfos.items[v]}deleteFile(h){const g=this.fileInfos.find(y=>y.file===h);return g?(this.fileInfos.remove(g),g):null}_queryAttachment(h,g){var y=this;return(0,R.Z)(function*(){const{_attachmentLayer:v}=y;if(!h||!v?.queryAttachments)throw new D.Z("invalid-attachment-id","Could not query attachment.");const b=y._getObjectId(g),C=new rn.Z({objectIds:[b],attachmentsWhere:`AttachmentId=${h}`,returnMetadata:!0});return v.queryAttachments(C).then(I=>I[b][0])})()}_getObjectId(h=this.graphic){return h?.getObjectId()??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:h}=this,g=un(h);this._attachmentLayer=g?"scene"===g.type&&null!=g.associatedLayer?g.associatedLayer:g:null}};(0,F._)([(0,M.Cb)()],De.prototype,"capabilities",void 0),(0,F._)([(0,Z.p)("capabilities")],De.prototype,"castCapabilities",null),(0,F._)([(0,M.Cb)()],De.prototype,"activeAttachmentInfo",void 0),(0,F._)([(0,M.Cb)()],De.prototype,"activeFileInfo",void 0),(0,F._)([(0,M.Cb)({readOnly:!0,type:Mn})],De.prototype,"attachmentInfos",void 0),(0,F._)([(0,M.Cb)()],De.prototype,"fileInfos",void 0),(0,F._)([(0,M.Cb)({type:Mt.Z})],De.prototype,"graphic",void 0),(0,F._)([(0,M.Cb)()],De.prototype,"mode",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],De.prototype,"state",null),(0,F._)([(0,M.Cb)()],De.prototype,"filesEnabled",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],De.prototype,"supportsResizeAttachments",null),De=(0,F._)([(0,S.j)("esri.widgets.Attachments.AttachmentsViewModel")],De);const gi=De;var Xs=w(98930);function In(h){const g=h.toLowerCase();return"image/bmp"===g||"image/emf"===g||"image/exif"===g||"image/gif"===g||"image/x-icon"===g||"image/jpeg"===g||"image/png"===g||"image/tiff"===g||"image/x-wmf"===g}var ht=w(90643),X=w(89219);var We=w(40846),Be=w(26440),x=w(2485);const _n={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},se="esri-attachments",W={base:se,loaderContainer:`${se}__loader-container`,loader:`${se}__loader`,fadeIn:`${se}--fade-in`,container:`${se}__container`,containerList:`${se}__container--list`,containerPreview:`${se}__container--preview`,actions:`${se}__actions`,deleteButton:`${se}__delete-button`,addAttachmentButton:`${se}__add-attachment-button`,errorMessage:`${se}__error-message`,items:`${se}__items`,item:`${se}__item`,itemButton:`${se}__item-button`,itemMask:`${se}__item-mask`,itemMaskIcon:`${se}__item-mask--icon`,itemImage:`${se}__image`,itemImageResizable:`${se}__image--resizable`,itemLabel:`${se}__label`,itemFilename:`${se}__filename`,itemChevronIcon:`${se}__item-chevron-icon`,itemLink:`${se}__item-link`,itemLinkOverlay:`${se}__item-link-overlay`,itemLinkOverlayIcon:`${se}__item-link-overlay-icon`,itemEditIcon:`${se}__item-edit-icon`,itemAddIcon:`${se}__item-add-icon`,itemAddButton:`${se}__item-add-button`,formNode:`${se}__form-node`,fileFieldset:`${se}__file-fieldset`,fileLabel:`${se}__file-label`,fileName:`${se}__file-name`,fileInput:`${se}__file-input`,metadata:`${se}__metadata`,metadataFieldset:`${se}__metadata-fieldset`,progressBar:`${se}__progress-bar`},yi=window.CSS;let Re=class extends U.Z{constructor(h,g){super(h,g),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={..._n},this._supportsImageOrientation=yi&&yi.supports&&yi.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(h){return h?.viewModel||(h={viewModel:new gi,...h}),h}initialize(){this.addHandles([(0,T.on)(()=>this.viewModel?.attachmentInfos,"change",()=>this.scheduleRender()),(0,T.on)(()=>this.viewModel?.fileInfos,"change",()=>this.scheduleRender()),(0,T.YP)(()=>this.viewModel?.mode,()=>this._modeChanged(),T.nn)])}loadDependencies(){return(0,ht.h)({icon:()=>Promise.all([w.e(2115),w.e(4540)]).then(w.bind(w,24540))})}get capabilities(){return this.viewModel.capabilities}set capabilities(h){this.viewModel.capabilities=h}get effectiveDisplayType(){const{displayType:h}=this;return h&&"auto"!==h?h:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(h){this.viewModel.graphic=h}get icon(){return"attachment"}set icon(h){this._overrideIfSome("icon",h)}get label(){return this.messages?.widgetLabel??""}set label(h){this._overrideIfSome("label",h)}castVisibleElements(h){return{..._n,...h}}addAttachment(){const{_addAttachmentForm:h,viewModel:g}=this;return this._set("submitting",!0),this._set("error",null),g.addAttachment(h).then(y=>(this._set("submitting",!1),this._set("error",null),g.mode="view",y)).catch(y=>{throw this._set("submitting",!1),this._set("error",new D.Z("attachments:add-attachment",this.messages.addErrorMessage,y)),y})}deleteAttachment(h){const{viewModel:g}=this;return this._set("submitting",!0),this._set("error",null),g.deleteAttachment(h).then(y=>(this._set("submitting",!1),this._set("error",null),g.mode="view",y)).catch(y=>{throw this._set("submitting",!1),this._set("error",new D.Z("attachments:delete-attachment",this.messages.deleteErrorMessage,y)),y})}updateAttachment(){const{viewModel:h}=this,{_updateAttachmentForm:g}=this;return this._set("submitting",!0),this._set("error",null),h.updateAttachment(g).then(y=>(this._set("submitting",!1),this._set("error",null),h.mode="view",y)).catch(y=>{throw this._set("submitting",!1),this._set("error",new D.Z("attachments:update-attachment",this.messages.updateErrorMessage,y)),y})}addFile(){const h=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",h}updateFile(){const{viewModel:h}=this,g=h.updateFile(this.selectedFile,this._updateAttachmentForm,h.activeFileInfo);return h.mode="view",g}deleteFile(h){const g=this.viewModel.deleteFile(h||this.viewModel.activeFileInfo?.file);return this.viewModel.mode="view",g}render(){const{submitting:h,viewModel:g}=this,{state:y}=g;return(0,x.u)("div",{class:this.classes(W.base,X.z.widget)},h?this._renderProgressBar():null,"loading"===y?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){const{error:h,visibleElements:g}=this;return h&&g.errorMessage?(0,x.u)("div",{class:W.errorMessage,key:"error-message"},h.message):null}_renderAttachments(){const{activeFileInfo:h,mode:g,activeAttachmentInfo:y}=this.viewModel;return"add"===g?this._renderAddForm():"edit"===g?this._renderDetailsForm(y||h):this._renderAttachmentContainer()}_renderLoading(){return(0,x.u)("div",{class:W.loaderContainer,key:"loader"},(0,x.u)("div",{class:W.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?(0,x.u)("div",{class:W.progressBar,key:"progress-bar"}):null}_renderAddForm(){const{submitting:h,selectedFile:g}=this,y=h||!g,v=this.visibleElements.cancelAddButton?(0,x.u)("button",{bind:this,class:this.classes(X.z.button,X.z.buttonTertiary,X.z.buttonSmall,X.z.buttonHalf,h&&X.z.buttonDisabled),disabled:h,onclick:this._cancelForm,type:"button"},this.messages.cancel):null,b=this.visibleElements.addSubmitButton?(0,x.u)("button",{class:this.classes(X.z.button,X.z.buttonSecondary,X.z.buttonSmall,X.z.buttonHalf,{[X.z.buttonDisabled]:y}),disabled:y,type:"submit"},this.messages.add):null,C=g?(0,x.u)("span",{class:W.fileName,key:"file-name"},g.name):null,I=(0,x.u)("form",{afterCreate:We.Yo,afterRemoved:We.pV,bind:this,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},(0,x.u)("fieldset",{class:W.fileFieldset},C,(0,x.u)("label",{class:this.classes(W.fileLabel,X.z.button,X.z.buttonSecondary)},g?this.messages.changeFile:this.messages.selectFile,(0,x.u)("input",{bind:this,class:W.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),b,v);return(0,x.u)("div",{class:W.formNode,key:"add-form-container"},I)}_renderDetailsForm(h){const{visibleElements:g,viewModel:y,selectedFile:v,submitting:b}=this,{capabilities:C}=y,I=b||!v;let _,A,P,E;v?(_=v.type,A=v.name,P=v.size):h&&"file"in h?(_=h.file.type,A=h.file.name,P=h.file.size):h&&"contentType"in h&&(_=h.contentType,A=h.name,P=h.size,E=h.url);const L=C.editing&&C.operations?.delete&&g.deleteButton?(0,x.u)("button",{bind:this,class:this.classes(X.z.button,X.z.buttonSmall,X.z.buttonTertiary,W.deleteButton,{[X.z.buttonDisabled]:b}),disabled:b,key:"delete-button",onclick:ae=>this._submitDeleteAttachment(ae,h),type:"button"},this.messages.delete):void 0,O=C.editing&&C.operations?.update&&g.updateButton?(0,x.u)("button",{class:this.classes(X.z.button,X.z.buttonSmall,X.z.buttonThird,{[X.z.buttonDisabled]:I}),disabled:I,key:"update-button",type:"submit"},this.messages.update):void 0,$=this.visibleElements.cancelUpdateButton?(0,x.u)("button",{bind:this,class:this.classes(X.z.button,X.z.buttonSmall,X.z.buttonTertiary,X.z.buttonThird,{[X.z.buttonDisabled]:b}),disabled:b,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0,j=C.editing&&C.operations?.update?(0,x.u)("fieldset",{class:W.fileFieldset,key:"file"},(0,x.u)("span",{class:W.fileName,key:"file-name"},A),(0,x.u)("label",{class:this.classes(W.fileLabel,X.z.button,X.z.buttonSecondary)},this.messages.changeFile,(0,x.u)("input",{bind:this,class:W.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0,Q=(0,x.u)("fieldset",{class:W.metadataFieldset,key:"size"},(0,x.u)("label",null,function fs(h,g){let y=0===(g=Math.round(g))?0:Math.floor(Math.log(g)/Math.log(ve.Y.KILOBYTES));y=(0,V.uZ)(y,0,on.length-1);const v=(0,Qe.uf)(g/ve.Y.KILOBYTES**y,{maximumFractionDigits:2});return(0,ot.gx)(h.units.bytes[on[y]],{fileSize:v})}(this.messagesUnits,P??0))),oe=(0,x.u)("fieldset",{class:W.metadataFieldset,key:"content-type"},(0,x.u)("label",null,_)),ie=null!=E?(0,x.u)("a",{class:W.itemLink,href:E,rel:"noreferrer",target:"_blank"},this._renderImageMask(h,400),(0,x.u)("div",{class:W.itemLinkOverlay},(0,x.u)("span",{class:W.itemLinkOverlayIcon},(0,x.u)("calcite-icon",{icon:"launch"})))):this._renderImageMask(h,400),fe=(0,x.u)("form",{afterCreate:We.Yo,afterRemoved:We.pV,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:ae=>this._submitUpdateAttachment(ae,h)},(0,x.u)("div",{class:W.metadata},Q,oe),j,(0,x.u)("div",{class:W.actions},L,$,O));return(0,x.u)("div",{class:W.formNode,key:"edit-form-container"},ie,fe)}_renderImageMask(h,g){return h?"file"in h?this._renderGenericImageMask(h.file.name,h.file.type):this._renderImageMaskForAttachment(h,g):null}_renderGenericImageMask(h,g){const{supportsResizeAttachments:y}=this.viewModel,v=function ks(h){const g=(0,Xs.V)("esri/themes/base/images/files/");return h?"text/plain"===h?`${g}text-32.svg`:"application/pdf"===h?`${g}pdf-32.svg`:"text/csv"===h?`${g}csv-32.svg`:"application/gpx+xml"===h?`${g}gpx-32.svg`:"application/x-dwf"===h?`${g}cad-32.svg`:"application/postscript"===h||"application/json"===h||"text/xml"===h||"model/vrml"===h?`${g}code-32.svg`:"application/x-zip-compressed"===h||"application/x-7z-compressed"===h||"application/x-gzip"===h||"application/x-tar"===h||"application/x-gtar"===h||"application/x-bzip2"===h||"application/gzip"===h||"application/x-compress"===h||"application/x-apple-diskimage"===h||"application/x-rar-compressed"===h||"application/zip"===h?`${g}zip-32.svg`:h.includes("image/")?`${g}image-32.svg`:h.includes("audio/")?`${g}sound-32.svg`:h.includes("video/")?`${g}video-32.svg`:h.includes("msexcel")||h.includes("ms-excel")||h.includes("spreadsheetml")?`${g}excel-32.svg`:h.includes("msword")||h.includes("ms-word")||h.includes("wordprocessingml")?`${g}word-32.svg`:h.includes("powerpoint")||h.includes("presentationml")?`${g}report-32.svg`:`${g}generic-32.svg`:`${g}generic-32.svg`}(g),b={[W.itemImageResizable]:y};return(0,x.u)("div",{class:this.classes(W.itemMaskIcon,W.itemMask),key:v},(0,x.u)("img",{alt:h,class:this.classes(b,W.itemImage),src:v,title:h}))}_renderImageMaskForAttachment(h,g){const{supportsResizeAttachments:y}=this.viewModel;if(!h)return null;const{contentType:v,name:b,url:C}=h;if(!y||!In(v))return this._renderGenericImageMask(b,v);const I=this._getCSSTransform(h),_=I?{transform:I,"image-orientation":"none"}:{},A=`${C}${C?.includes("?")?"&":"?"}w=${g}`,P={[W.itemImageResizable]:y};return(0,x.u)("div",{class:this.classes(W.itemMask),key:A},(0,x.u)("img",{alt:b,class:this.classes(P,W.itemImage),src:A,styles:_,title:b}))}_renderFile(h){const{file:g}=h;return(0,x.u)("li",{class:W.item,key:g},(0,x.u)("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:W.itemButton,key:"details-button",onclick:()=>this._startEditFile(h),title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(h),(0,x.u)("label",{class:W.itemLabel},(0,x.u)("span",{class:W.itemFilename},g.name||this.messages.noTitle),(0,x.u)("span",{"aria-hidden":"true",class:this.classes(W.itemChevronIcon,(0,We.dZ)(this.container)?"esri-icon-left":"esri-icon-right")}))))}_renderAttachmentInfo({attachmentInfo:h,displayType:g}){const{viewModel:y,effectiveDisplayType:v}=this,{capabilities:b,supportsResizeAttachments:C}=y,{contentType:I,name:_,url:A}=h,P=this._renderImageMask(h,"list"===g?48:400),E=b.editing?(0,x.u)("span",{"aria-hidden":"true",class:this.classes(W.itemChevronIcon,(0,We.dZ)(this.container)?"esri-icon-left":"esri-icon-right")}):null,L=[P,"preview"===v&&C&&In(I)?null:(0,x.u)("label",{class:W.itemLabel},(0,x.u)("span",{class:W.itemFilename},_||this.messages.noTitle),E)],O=b.editing?(0,x.u)("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:W.itemButton,"data-attachment-info-id":h.id,key:"details-button",onclick:()=>this._startEditAttachment(h),title:this.messages.attachmentDetails,type:"button"},L):(0,x.u)("a",{class:W.itemButton,href:A??void 0,key:"details-link",rel:"noreferrer",target:"_blank"},L);return(0,x.u)("li",{class:W.item,key:h},O)}_renderAttachmentContainer(){const{effectiveDisplayType:h,viewModel:g,visibleElements:y}=this,{attachmentInfos:v,capabilities:b,fileInfos:C}=g,I=!!v?.length,_=!!C?.length,A={[W.containerList]:"preview"!==h,[W.containerPreview]:"preview"===h},P=b.editing&&b.operations?.add&&y.addButton?(0,x.u)("button",{bind:this,class:this.classes(X.z.button,X.z.buttonTertiary,W.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:"button"},(0,x.u)("span",{"aria-hidden":"true",class:this.classes(W.itemAddIcon,"esri-icon-plus")}),this.messages.add):void 0,E=I?(0,x.u)("ul",{class:W.items,key:"attachments-list"},v.toArray().map($=>this._renderAttachmentInfo({attachmentInfo:$,displayType:h}))):void 0,L=_?(0,x.u)("ul",{class:W.items,key:"file-list"},C.toArray().map($=>this._renderFile($))):void 0,O=_||I?void 0:(0,x.u)("div",{class:X.z.empty},this.messages.noAttachments);return(0,x.u)("div",{class:this.classes(W.container,A),key:"attachments-container"},E,L,O,P)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(h){const g=h.target,y=g.files?.item(0);this._set("selectedFile",y)}_submitDeleteAttachment(h,g){h.preventDefault(),g&&("file"in g?this.deleteFile(g.file):g&&this.deleteAttachment(g))}_submitAddAttachment(h){h.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(h,g){h.preventDefault(),g&&"file"in g?this.updateFile():this.updateAttachment()}_startEditAttachment(h){const{viewModel:g}=this;g.activeFileInfo=null,g.activeAttachmentInfo=h,g.mode="edit"}_startEditFile(h){const{viewModel:g}=this;g.activeAttachmentInfo=null,g.activeFileInfo=h,g.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(h){h.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(h){const{orientationInfo:g}=h;return!this._supportsImageOrientation&&g?[g.rotation?`rotate(${g.rotation}deg)`:"",g.mirrored?"scaleX(-1)":""].join(" "):""}};(0,F._)([(0,M.Cb)()],Re.prototype,"capabilities",null),(0,F._)([(0,M.Cb)()],Re.prototype,"displayType",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],Re.prototype,"effectiveDisplayType",null),(0,F._)([(0,M.Cb)()],Re.prototype,"graphic",null),(0,F._)([(0,M.Cb)()],Re.prototype,"icon",null),(0,F._)([(0,M.Cb)()],Re.prototype,"label",null),(0,F._)([(0,M.Cb)(),(0,Be.H)("esri/widgets/Attachments/t9n/Attachments")],Re.prototype,"messages",void 0),(0,F._)([(0,M.Cb)(),(0,Be.H)("esri/core/t9n/Units")],Re.prototype,"messagesUnits",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],Re.prototype,"selectedFile",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],Re.prototype,"submitting",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],Re.prototype,"error",void 0),(0,F._)([(0,M.Cb)({type:gi})],Re.prototype,"viewModel",void 0),(0,F._)([(0,M.Cb)()],Re.prototype,"visibleElements",void 0),(0,F._)([(0,Z.p)("visibleElements")],Re.prototype,"castVisibleElements",null),Re=(0,F._)([(0,S.j)("esri.widgets.Attachments")],Re);const qs=Re;let Rt=class extends gi{constructor(h){super(h),this.description=null,this.title=null}};(0,F._)([(0,M.Cb)()],Rt.prototype,"description",void 0),(0,F._)([(0,M.Cb)()],Rt.prototype,"title",void 0),Rt=(0,F._)([(0,S.j)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],Rt);const vi=Rt;var bi=w(83022);const Ci="esri-feature-element-info",wi={base:Ci,title:`${Ci}__title`,description:`${Ci}__description`};let _t=class extends U.Z{constructor(h,g){super(h,g),this.description=null,this.headingLevel=2,this.title=null}render(){return(0,x.u)("div",{class:wi.base},this._renderTitle(),this._renderDescription())}_renderTitle(){const{title:h}=this;return h?(0,x.u)(bi.X,{class:wi.title,innerHTML:h,level:this.headingLevel}):null}_renderDescription(){const{description:h}=this;return h?(0,x.u)("div",{class:wi.description,innerHTML:h,key:"description"}):null}};(0,F._)([(0,M.Cb)()],_t.prototype,"description",void 0),(0,F._)([(0,M.Cb)()],_t.prototype,"headingLevel",void 0),(0,F._)([(0,M.Cb)()],_t.prototype,"title",void 0),_t=(0,F._)([(0,S.j)("esri.widgets.Feature.support.FeatureElementInfo")],_t);const $t=_t;let Je=class extends U.Z{constructor(h,g){super(h,g),this._featureElementInfo=null,this.attachmentsWidget=new qs,this.headingLevel=2,this.viewModel=new vi}initialize(){this._featureElementInfo=new $t,this.addHandles([(0,T.YP)(()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel],()=>this._setupFeatureElementInfo(),T.nn),(0,T.YP)(()=>this.viewModel,h=>this.attachmentsWidget.viewModel=h,T.nn)])}destroy(){this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),this._featureElementInfo?.destroy()}get description(){return this.viewModel.description}set description(h){this.viewModel.description=h}get displayType(){return this.attachmentsWidget.displayType}set displayType(h){this.attachmentsWidget.displayType=h}get graphic(){return this.viewModel.graphic}set graphic(h){this.viewModel.graphic=h}get title(){return this.viewModel.title}set title(h){this.viewModel.title=h}render(){const{attachmentsWidget:h}=this;return(0,x.u)("div",{class:"esri-feature-attachments"},this._featureElementInfo?.render(),h?.render())}_setupFeatureElementInfo(){const{description:h,title:g,headingLevel:y}=this;this._featureElementInfo?.set({description:h,title:g,headingLevel:y})}};(0,F._)([(0,M.Cb)({readOnly:!0})],Je.prototype,"attachmentsWidget",void 0),(0,F._)([(0,M.Cb)()],Je.prototype,"description",null),(0,F._)([(0,M.Cb)()],Je.prototype,"displayType",null),(0,F._)([(0,M.Cb)()],Je.prototype,"graphic",null),(0,F._)([(0,M.Cb)()],Je.prototype,"headingLevel",void 0),(0,F._)([(0,M.Cb)()],Je.prototype,"title",null),(0,F._)([(0,M.Cb)({type:vi})],Je.prototype,"viewModel",void 0),Je=(0,F._)([(0,S.j)("esri.widgets.Feature.FeatureAttachments")],Je);const to=Je;let rt=class extends qe.Z{constructor(h){super(h),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles((0,T.YP)(()=>this.creator,g=>{this._destroyContent(),this._createContent(g)},T.nn))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:h,graphic:g,destroyer:y}=this;h&&g&&(Ut({type:"content",value:y,event:{graphic:g}}),this._set("created",null))}_createContent(h){var g=this;return(0,R.Z)(function*(){const y=g.graphic;if(!y||!h)return;const v=Ut({type:"content",value:h,event:{graphic:y}});g._loadingPromise=v,g.notifyChange("state");const b=yield v;v===g._loadingPromise&&(g._loadingPromise=null,g.notifyChange("state"),g._set("created",b))})()}};(0,F._)([(0,M.Cb)({readOnly:!0})],rt.prototype,"created",void 0),(0,F._)([(0,M.Cb)()],rt.prototype,"creator",void 0),(0,F._)([(0,M.Cb)()],rt.prototype,"destroyer",void 0),(0,F._)([(0,M.Cb)({type:Mt.Z})],rt.prototype,"graphic",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],rt.prototype,"state",null),rt=(0,F._)([(0,S.j)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],rt);const Dt=rt;var Fi=w(36911);const Mi="esri-feature-content",Ii={base:Mi,loaderContainer:`${Mi}__loader-container`,loader:`${Mi}__loader`};let At=class extends U.Z{constructor(h,g){super(h,g),this.viewModel=null,this._addTargetToAnchors=y=>{Array.from(y.querySelectorAll("a")).forEach(v=>{cn(v.href)&&!v.hasAttribute("target")&&v.setAttribute("target","_blank")})}}get creator(){return this.viewModel?.creator}set creator(h){this.viewModel&&(this.viewModel.creator=h)}get graphic(){return this.viewModel?.graphic}set graphic(h){this.viewModel&&(this.viewModel.graphic=h)}render(){const h=this.viewModel?.state;return(0,x.u)("div",{class:Ii.base},"loading"===h?this._renderLoading():this._renderCreated())}_renderLoading(){return(0,x.u)("div",{class:Ii.loaderContainer,key:"loader"},(0,x.u)("div",{class:Ii.loader}))}_renderCreated(){const h=this.viewModel?.created;return h?h instanceof HTMLElement?(0,x.u)("div",{afterCreate:this._attachToNode,bind:h,key:h}):(0,Fi.Qd)(h)?(0,x.u)("div",{key:h},!h.destroyed&&h.render()):(0,x.u)("div",{afterCreate:this._addTargetToAnchors,innerHTML:h,key:h}):null}_attachToNode(h){h.appendChild(this)}};(0,F._)([(0,M.Cb)()],At.prototype,"creator",null),(0,F._)([(0,M.Cb)()],At.prototype,"graphic",null),(0,F._)([(0,M.Cb)({type:Dt})],At.prototype,"viewModel",void 0),At=(0,F._)([(0,S.j)("esri.widgets.Feature.FeatureContent")],At);const Vt=At;var io=w(59869),An=w(42271);let it=class extends qe.Z{constructor(h){super(h),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:h,fieldInfos:g}=this,y=[];return g?.forEach(v=>{if(v.hasOwnProperty("visible")&&!v.visible)return;const b=v.clone();b.label=hn(b,h),y.push(b)}),y}};(0,F._)([(0,M.Cb)()],it.prototype,"attributes",void 0),(0,F._)([(0,M.Cb)({type:[io.Z]})],it.prototype,"expressionInfos",void 0),(0,F._)([(0,M.Cb)()],it.prototype,"description",void 0),(0,F._)([(0,M.Cb)({type:[An.Z]})],it.prototype,"fieldInfos",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],it.prototype,"formattedFieldInfos",null),(0,F._)([(0,M.Cb)()],it.prototype,"title",void 0),it=(0,F._)([(0,S.j)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],it);const Bt=it,no=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}],jt="esri-feature-fields",zt={base:jt,fieldHeader:`${jt}__field-header`,fieldData:`${jt}__field-data`,fieldDataDate:`${jt}__field-data--date`};let He=class extends U.Z{constructor(h,g){super(h,g),this._featureElementInfo=null,this.viewModel=new Bt,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new $t,this.addHandles((0,T.YP)(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),T.nn))}destroy(){this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(h){this.viewModel.attributes=h}get description(){return this.viewModel.description}set description(h){this.viewModel.description=h}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(h){this.viewModel.expressionInfos=h}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(h){this.viewModel.fieldInfos=h}get title(){return this.viewModel.title}set title(h){this.viewModel.title=h}render(){return(0,x.u)("div",{class:zt.base},this._featureElementInfo?.render(),this._renderFields())}_renderFieldInfo(h,g){const{attributes:y}=this.viewModel,v=h.fieldName||"",b=h.label||v,C=y?null==y[v]?"":y[v]:"",I=!!h.format?.dateFormat,_="number"!=typeof C||I?function so(h,g){if("string"!=typeof g||!g)return g;const y=no.find(A=>A.pattern.test(g));if(!y)return g;const v=g.match(y.pattern),b=v?.[2],C=(0,ot.gx)((0,ot.gx)(y.label,{messages:h,hierPart:b}),{appName:y.appName});return g.replace(y.pattern,`<a${y.target?` target="${y.target}"`:""} href="$1"${"_blank"===y.target?' rel="noreferrer"':""}>${C}</a>`)}(this.messagesURIUtils,C):this._forceLTR(C),A={[zt.fieldDataDate]:I};return(0,x.u)("tr",{key:`fields-element-info-row-${v}-${g}`},(0,x.u)("th",{class:zt.fieldHeader,innerHTML:b,key:`fields-element-info-row-header-${v}-${g}`}),(0,x.u)("td",{class:this.classes(zt.fieldData,A),innerHTML:_,key:`fields-element-info-row-data-${v}-${g}`}))}_renderFields(){const{formattedFieldInfos:h}=this.viewModel;return h?.length?(0,x.u)("table",{class:X.z.table,summary:this.messages.fieldsSummary},(0,x.u)("tbody",null,h.map((g,y)=>this._renderFieldInfo(g,y)))):null}_setupFeatureElementInfo(){const{description:h,title:g}=this;this._featureElementInfo?.set({description:h,title:g})}_forceLTR(h){return`&lrm;${h}`}};(0,F._)([(0,M.Cb)()],He.prototype,"attributes",null),(0,F._)([(0,M.Cb)()],He.prototype,"description",null),(0,F._)([(0,M.Cb)()],He.prototype,"expressionInfos",null),(0,F._)([(0,M.Cb)()],He.prototype,"fieldInfos",null),(0,F._)([(0,M.Cb)()],He.prototype,"title",null),(0,F._)([(0,M.Cb)({type:Bt,nonNullable:!0})],He.prototype,"viewModel",void 0),(0,F._)([(0,M.Cb)(),(0,Be.H)("esri/widgets/Feature/t9n/Feature")],He.prototype,"messages",void 0),(0,F._)([(0,M.Cb)(),(0,Be.H)("esri/widgets/support/t9n/uriUtils")],He.prototype,"messagesURIUtils",void 0),He=(0,F._)([(0,S.j)("esri.widgets.Feature.FeatureFields")],He);const xn=He;var oo=w(37107),ro=w(64023),xt=w(57678),lo=w(17009),ao=w(66476),we=w(79412),_i=(w(46054),w(46708)),Ai=(w(11931),w(26152),w(6785),w(82921),w(33721),w(27048),w(32184),w(12628),w(44107)),xi=(w(5391),w(64222),w(23991),w(43814),w(82301),w(40485),w(93792),w(91866)),Ei=w(46556),uo=(w(89047),w(91085));const En=()=>B.Z.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),Tn=new Map;function Wt(h){if(!et(h))return null;const[g,y]=h.split("/").slice(1);return{layerId:g,fieldName:y}}function Ti(){return(Ti=(0,R.Z)(function*(h,g,y,v){const b=y.layerId.toString(),{layerInfo:C,relation:I,relatedFields:_,outStatistics:A,url:P,sourceSpatialReference:E}=g,L=function bo(h){return h?(0,xt.Tw)(h):void 0}(_),O=function Co(h){return h?(0,xt.Tw)(h,(g,y)=>JSON.stringify(g.toJSON())===JSON.stringify(y.toJSON())):void 0}(A);if(!C||!I)return null;const $=function po({originRelationship:h,relationships:g,layerId:y}){return g.find(({relatedTableId:v,id:b})=>`${v}`===y&&b===h?.id)??null}({originRelationship:I,relationships:C.relationships,layerId:b});if($?.relationshipTableId&&$.keyFieldInRelationshipTable){const Q=(yield function yo(h,g,y,v){const b=new Ei.default;return b.outFields=["*"],b.relationshipId="number"==typeof g.id?g.id:parseInt(g.id,10),b.objectIds=[h.attributes[y.objectIdField]],b.gdbVersion=y.gdbVersion??null,b.historicMoment=y.historicMoment??null,y.queryRelatedFeatures?.(b,v)??Promise.resolve({})}(h,$,y,v))[h.attributes[y.objectIdField]];if(!Q)return null;const oe=Q.features.map(ie=>ie.attributes[C.objectIdField]);if(O?.length&&C.supportsStatistics){const ie=new xi.Z;ie.where=function vo(h,g,y){let v=0;const b=[];for(;v<g.length;)b.push(`${h} IN (${g.slice(v,y+v)})`),v+=y;return b.join(" OR ")}(C.objectIdField,oe,1e3),ie.outFields=L,ie.outStatistics=O,ie.sourceSpatialReference=E;const fe={features:Promise.resolve(Q),statsFeatures:(0,_i.e)(P,ie)};return(0,we.as)(fe)}}const j=$?.keyField;if(j){const Q=(0,Et.H7)(function Ao(h,g){if(null!=h){g=g.toLowerCase();for(const y of h)if(y&&y.name.toLowerCase()===g)return y}return null}(C.fields,j)),oe=function mo(h,g){const y=g.toLowerCase();for(const v in h)if(v.toLowerCase()===y)return h[v];return null}(h.attributes,I.keyField),ie=Q?`${j}=${oe}`:`${j}='${oe}'`,Oe=(0,_i.e)(P,new xi.Z({where:ie,outFields:L,sourceSpatialReference:E,historicMoment:y.historicMoment,gdbVersion:y.gdbVersion}),v),ut=O?.length&&C.supportsStatistics?(0,_i.e)(P,new xi.Z({where:ie,outFields:L,outStatistics:O,sourceSpatialReference:E}),v):null,Ge={features:Oe};return ut&&(Ge.statsFeatures=ut),(0,we.as)(Ge)}return null})).apply(this,arguments)}const Pn={chartAnimation:!0};let _e=class extends qe.Z{constructor(h){super(h),this.abilities={...Pn},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(h){return{...Pn,...h}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(h){this._setContentElementMedia(h)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(h){const{formattedMediaInfoCount:g}=this;this.activeMediaInfoIndex=(h+g)%g}_pageContentElementMedia(h){const{activeMediaInfoIndex:g}=this;this._setContentElementMedia(g+h)}_formatMediaInfos(){const{mediaInfos:h,layer:g}=this,y=this.attributes??{},v=this.formattedAttributes??{},b=this.expressionAttributes??{},C=this.fieldInfoMap??new Map;return h?.map(I=>{const _=I?.clone();return _?(_.title=ct({attributes:y,fieldInfoMap:C,globalAttributes:v,expressionAttributes:b,layer:g,text:_.title}),_.caption=ct({attributes:y,fieldInfoMap:C,globalAttributes:v,expressionAttributes:b,layer:g,text:_.caption}),_.altText=ct({attributes:y,fieldInfoMap:C,globalAttributes:v,expressionAttributes:b,layer:g,text:_.altText}),"image"===_.type?_.value?(this._setImageValue({value:_.value,formattedAttributes:v,layer:g}),_.value.sourceURL?_:void 0):void 0:"pie-chart"===_.type||"line-chart"===_.type||"column-chart"===_.type||"bar-chart"===_.type?_.value?(this._setChartValue({value:_.value,chartType:_.type,attributes:y,formattedAttributes:v,layer:g,expressionAttributes:b}),_):void 0:null):null}).filter(xt.pC)??[]}_setImageValue(h){const g=this.fieldInfoMap??new Map,{value:y,formattedAttributes:v,layer:b}=h,{linkURL:C,sourceURL:I}=y;if(I){const _=ai(I,b);y.sourceURL=li({formattedAttributes:v,template:_,fieldInfoMap:g})}if(C){const _=ai(C,b);y.linkURL=li({formattedAttributes:v,template:_,fieldInfoMap:g})}}_setChartValue(h){const{value:g,attributes:y,formattedAttributes:v,chartType:b,layer:C,expressionAttributes:I}=h,{popupTemplate:_,relatedInfos:A}=this,{fields:P,normalizeField:E}=g,L=C;if(g.fields=function Ps(h,g){return h&&h.map(y=>Tt(y,g))}(P,L),E&&(g.normalizeField=Tt(E,L)),!P.some($=>!!(null!=v[$]||et($)&&A?.size)))return;const O=_?.fieldInfos??[];P.forEach(($,j)=>{const Q=g.colors?.[j];if(et($))return void(g.series=[...g.series,...this._getRelatedChartInfos({fieldInfos:O,fieldName:$,formattedAttributes:v,chartType:b,value:g,color:Q})]);const oe=this._getChartOption({value:g,attributes:y,chartType:b,formattedAttributes:v,expressionAttributes:I,fieldName:$,fieldInfos:O,color:Q});g.series.push(oe)})}_getRelatedChartInfos(h){const{fieldInfos:g,fieldName:y,formattedAttributes:v,chartType:b,value:C,color:I}=h,_=[],A=Wt(y),P=A&&this.relatedInfos?.get(A.layerId.toString());if(!P)return _;const{relatedFeatures:E,relation:L}=P;if(!L||!E)return _;const{cardinality:O}=L;return E.forEach($=>{const{attributes:j}=$;j&&Object.keys(j).forEach(Q=>{Q===A.fieldName&&_.push(this._getChartOption({value:C,attributes:j,formattedAttributes:v,fieldName:y,chartType:b,relatedFieldName:Q,hasMultipleRelatedFeatures:E?.length>1,fieldInfos:g,color:I}))})}),"one-to-many"===O||"many-to-many"===O?_:[_[0]]}_getTooltip({label:h,value:g,chartType:y}){return"pie-chart"===y?`${h}`:`${h}: ${g}`}_getChartOption(h){const{value:g,attributes:y,formattedAttributes:v,expressionAttributes:b,fieldName:C,relatedFieldName:I,fieldInfos:_,chartType:A,hasMultipleRelatedFeatures:P,color:E}=h,L=this.layer,O=this.fieldInfoMap??new Map,{normalizeField:$,tooltipField:j}=g,Q=$?et($)?y[Wt($).fieldName]:y[$]:null,oe=oi(C)&&b&&void 0!==b[C]?b[C]:I&&void 0!==y[I]?y[I]:void 0!==y[C]?y[C]:v[C],ie=new lo.Z({fieldName:C,color:E,value:void 0===oe?null:oe&&Q?oe/Q:oe});if(et(C)){const Ge=O.get(C.toLowerCase()),en=j&&O.get(j.toLowerCase()),qt=Ge?.fieldName??C,Ke=P&&j?Wt(j).fieldName:en?.fieldName??j;return ie.tooltip=this._getTooltip({label:P&&Ke?y[Ke]:v[Ke]??Ge?.label??Ge?.fieldName??I,value:P&&I?y[I]:v[qt],chartType:A}),ie}const fe=mn(_,C),ae=Tt(C,L),Oe=j&&void 0!==v[j]?v[j]:hn(fe||new An.Z({fieldName:ae}),this.popupTemplate?.expressionInfos);return ie.tooltip=this._getTooltip({label:Oe,value:v[ae],chartType:A}),ie}};(0,F._)([(0,M.Cb)()],_e.prototype,"abilities",void 0),(0,F._)([(0,Z.p)("abilities")],_e.prototype,"castAbilities",null),(0,F._)([(0,M.Cb)()],_e.prototype,"activeMediaInfoIndex",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],_e.prototype,"activeMediaInfo",null),(0,F._)([(0,M.Cb)()],_e.prototype,"attributes",void 0),(0,F._)([(0,M.Cb)()],_e.prototype,"description",void 0),(0,F._)([(0,M.Cb)()],_e.prototype,"fieldInfoMap",void 0),(0,F._)([(0,M.Cb)()],_e.prototype,"formattedAttributes",void 0),(0,F._)([(0,M.Cb)()],_e.prototype,"expressionAttributes",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],_e.prototype,"formattedMediaInfos",null),(0,F._)([(0,M.Cb)()],_e.prototype,"isAggregate",void 0),(0,F._)([(0,M.Cb)()],_e.prototype,"layer",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],_e.prototype,"formattedMediaInfoCount",null),(0,F._)([(0,M.Cb)()],_e.prototype,"mediaInfos",void 0),(0,F._)([(0,M.Cb)()],_e.prototype,"popupTemplate",void 0),(0,F._)([(0,M.Cb)()],_e.prototype,"relatedInfos",void 0),(0,F._)([(0,M.Cb)()],_e.prototype,"title",void 0),_e=(0,F._)([(0,S.j)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],_e);const pt=_e;var xo=w(55774),nt=w(36766);const Ae="esri-feature-media",Se={base:Ae,mediaContainer:`${Ae}__container`,mediaItemContainer:`${Ae}__item-container`,mediaItem:`${Ae}__item`,mediaItemText:`${Ae}__item-text`,mediaItemTitle:`${Ae}__item-title`,mediaItemCaption:`${Ae}__item-caption`,mediaNavigation:`${Ae}__item-navigation`,mediaPagination:`${Ae}__pagination`,mediaPaginationText:`${Ae}__pagination-text`,mediaPrevious:`${Ae}__previous`,mediaPreviousIconLTR:`${Ae}__previous-icon`,mediaPreviousIconRTL:`${Ae}__previous-icon--rtl`,mediaNext:`${Ae}__next`,mediaNextIconLTR:`${Ae}__next-icon`,mediaNextIconRTL:`${Ae}__next-icon--rtl`,mediaChart:`${Ae}__chart`,mediaPaginationButton:`${Ae}__pagination-button`,mediaPaginationIcon:`${Ae}__pagination-icon`,mediaChartRendered:`${Ae}__chart--rendered`},lt="category",Lt="value";let Ue=class extends U.Z{constructor(h,g){var y;super(h,g),y=this,this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new pt,this.messages=null,this._disposeChart=v=>{this._chartRootMap.get(v)?.dispose(),this._chartRootMap.delete(v)},this._createChart=function(){var v=(0,R.Z)(function*(b){const{destroyed:C,viewModel:I}=y;if(C||!I||!b)return;const{createRoot:_}=yield Promise.all([w.e(1603),w.e(8592),w.e(1157)]).then(w.bind(w,21157)),A=yield _(b);y._chartRootMap.set(b,A),y._renderChart({mediaInfo:I.activeMediaInfo,root:A})});return function(b){return v.apply(this,arguments)}}()}initialize(){this._featureElementInfo=new $t,this.addHandles([(0,T.YP)(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),T.nn),(0,T.YP)(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),T.nn)])}loadDependencies(){return(0,ht.h)({icon:()=>Promise.all([w.e(2115),w.e(4540)]).then(w.bind(w,24540))})}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(h){this.viewModel.attributes=h}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(h){this.viewModel.activeMediaInfoIndex=h}get description(){return this.viewModel.description}set description(h){this.viewModel.description=h}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(h){this.viewModel.fieldInfoMap=h}get layer(){return this.viewModel.layer}set layer(h){this.viewModel.layer=h}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(h){this.viewModel.mediaInfos=h}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(h){this.viewModel.popupTemplate=h}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(h){this.viewModel.relatedInfos=h}get title(){return this.viewModel.title}set title(h){this.viewModel.title=h}render(){return(0,x.u)("div",{bind:this,class:Se.base,onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this._renderMedia())}_renderMedia(){const{formattedMediaInfoCount:h,activeMediaInfoIndex:g}=this.viewModel,y=this._renderMediaText();return h?(0,x.u)("div",{class:Se.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),(0,x.u)("div",{class:Se.mediaNavigation},y,h>1?(0,x.u)("div",{class:Se.mediaPagination},this._renderMediaPageButton("previous"),(0,x.u)("span",{class:Se.mediaPaginationText},(0,nt.n)(this.messages.pageText,{index:g+1,total:h})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){const{activeMediaInfo:h}=this.viewModel;if(!h)return null;const g=h&&h.title?(0,x.u)("div",{class:Se.mediaItemTitle,innerHTML:h.title,key:"media-title"}):null,y=h&&h.caption?(0,x.u)("div",{class:Se.mediaItemCaption,innerHTML:h.caption,key:"media-caption"}):null;return g||y?(0,x.u)("div",{class:Se.mediaItemText,key:"media-text"},g,y):null}_renderImageMediaInfo(h){if(!h.value)return null;const{_refreshIntervalInfo:g}=this,{activeMediaInfoIndex:y,formattedMediaInfoCount:v}=this.viewModel,{value:b,refreshInterval:C,altText:I,title:_,type:A}=h,{sourceURL:P,linkURL:E}=b,L=cn(E??void 0)?"_blank":"_self",O="_blank"===L?"noreferrer":"",$=C?g:null,oe=(0,x.u)("img",{alt:I||_,key:`media-${A}-${y}-${v}-${$?$.timestamp:0}`,src:($?$.sourceURL:P)??void 0});return(E?(0,x.u)("a",{href:E,rel:O,target:L,title:_},oe):null)??oe}_renderChartMediaInfo(h){const{activeMediaInfoIndex:g,formattedMediaInfoCount:y}=this.viewModel;return(0,x.u)("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:Se.mediaChart,key:`media-${h.type}-${g}-${y}`})}_renderMediaInfoType(){const{activeMediaInfo:h}=this.viewModel;return h?"image"===h.type?this._renderImageMediaInfo(h):h.type.includes("chart")?this._renderChartMediaInfo(h):null:null}_renderMediaInfo(){const{activeMediaInfo:h}=this.viewModel;return h?(0,x.u)("div",{class:Se.mediaItemContainer,key:"media-container"},(0,x.u)("div",{class:Se.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(h){if(this.viewModel.formattedMediaInfoCount<2)return null;const g="previous"===h,y=g?this.messages.previous:this.messages.next;return(0,x.u)("button",{"aria-label":y,bind:this,class:Se.mediaPaginationButton,key:g?"media-previous":"media-next",onclick:g?this._previous:this._next,tabIndex:0,title:y,type:"button"},(0,x.u)("calcite-icon",{class:Se.mediaPaginationIcon,icon:g?"chevron-left":"chevron-right",scale:"s"}))}_setupFeatureElementInfo(){const{description:h,title:g}=this;this._featureElementInfo?.set({description:h,title:g})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;const{isAggregate:h,layer:g}=this.viewModel;return h&&g?.featureReduction&&"renderer"in g.featureReduction?g.featureReduction.renderer:g?.renderer}_getSeriesColors(h){return(0,R.Z)(function*(){const{colorAm5:g}=yield Promise.all([w.e(1603),w.e(8592),w.e(9719)]).then(w.bind(w,99719)),y=new Map;return h.forEach(v=>{v.color&&y.set(v,g(v.color.toCss(!0)))}),y})()}_getRendererColors(){var h=this;return(0,R.Z)(function*(){const{colorAm5:g}=yield Promise.all([w.e(1603),w.e(8592),w.e(9719)]).then(w.bind(w,99719)),y=new Map,v=h._getRenderer();if(!v)return y;const C=yield(0,ro.zB)(v);return C.delete("default"),Array.from(C.values()).every(I=>1===I?.length)&&Array.from(C.keys()).forEach(I=>{const _=C.get(I)?.[0]?.toCss(!0);_&&y.set(I,g(_))}),y})()}_handleMediaKeyup(h){const{key:g}=h;"ArrowLeft"===g&&(h.stopPropagation(),this.viewModel.previous()),"ArrowRight"===g&&(h.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!(0,oo.n)()}_getChartAnimationMS(){return this._canAnimateChart()?250:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?500:0}_renderChart(h){var g=this;return(0,R.Z)(function*(){const{root:y,mediaInfo:v}=h,{value:b,type:C}=v,{ResponsiveThemeAm5:I,DarkThemeAm5:_,AnimatedThemeAm5:A,ColorSetAm5:P,ThemeAm5:E,esriChartColorSet:L}=yield Promise.all([w.e(1603),w.e(8592),w.e(9719)]).then(w.bind(w,99719)),O=E.new(y);O.rule("ColorSet").set("colors",L),O.rule("ColorSet").set("reuse",!0);const $=[I.new(y),O];(0,xo.$o)()&&$.push(_.new(y)),g._canAnimateChart()&&$.push(A.new(y)),y.setThemes($);const j=yield g._getRendererColors(),Q=yield g._getSeriesColors(b.series),oe=P.new(y,{}),ie=Q.get(b.series[0]),fe=ie?{lineSettings:{stroke:ie}}:void 0,ae=b.series.map((Oe,ut)=>{const Ge=Q.get(Oe)||j.get(Oe.fieldName)||oe.getIndex(ut);return{[lt]:Oe.tooltip,[Lt]:Oe.value,columnSettings:{fill:Ge,stroke:Ge},...fe}}).filter(Oe=>"pie-chart"!==C||null!=Oe.value&&Oe.value>0);"pie-chart"===C?g._createPieChart(h,ae):g._createXYChart(h,ae)})()}_getDirection(){return(0,We.dZ)(this.container)?"rtl":"ltr"}_isInversed(){return!!(0,We.dZ)(this.container)}_customizeChartTooltip(h,g="horizontal"){var y=this;return(0,R.Z)(function*(){const{colorAm5:v}=yield Promise.all([w.e(1603),w.e(8592),w.e(9719)]).then(w.bind(w,99719));h.setAll({pointerOrientation:g}),h.get("background")?.setAll({stroke:v("rgba(50, 50, 50, 1)")}),h.label.setAll({direction:y._getDirection(),oversizedBehavior:"wrap",maxWidth:200})})()}_createPieChart(h,g){var y=this;return(0,R.Z)(function*(){const{TooltipAm5:v}=yield Promise.all([w.e(1603),w.e(8592),w.e(9719)]).then(w.bind(w,99719)),{PieChartAm5:b,PieSeriesAm5:C}=yield Promise.all([w.e(1603),w.e(4305),w.e(5498)]).then(w.bind(w,65498)),{mediaInfo:I,root:_}=h,{title:A}=I,L=_.container.children.push(b.new(_,{ariaLabel:I?.altText||I?.title||"",focusable:!0,paddingBottom:5,paddingTop:5,paddingLeft:5,paddingRight:5})),O="{category}: {valuePercentTotal.formatNumber('0.00')}%\n ({value})",$=v.new(_,{labelText:O}),j=L.series.push(C.new(_,{name:A,valueField:Lt,categoryField:lt,tooltip:$}));j.ticks.template.set("forceHidden",!0),j.labels.template.set("forceHidden",!0),j.slices.template.states.create("active",{shiftRadius:5}),y._customizeChartTooltip($),j.slices.template.setAll({ariaLabel:O,focusable:!0,templateField:"columnSettings"}),j.data.setAll(g),j.appear(y._getChartSeriesAnimationMS()),L.appear(y._getChartAnimationMS()),L.root.dom.classList.toggle(Se.mediaChartRendered,!0)})()}_getMinSeriesValue(h){let g=0;return h.forEach(y=>g=Math.min(y.value,g)),g}_createColumnChart(h,g,y){var v=this;return(0,R.Z)(function*(){const{TooltipAm5:b,ScrollbarAm5:C}=yield Promise.all([w.e(1603),w.e(8592),w.e(9719)]).then(w.bind(w,99719)),{CategoryAxisAm5:I,AxisRendererXAm5:_,ValueAxisAm5:A,AxisRendererYAm5:P,ColumnSeriesAm5:E}=yield Promise.all([w.e(1603),w.e(4305),w.e(8592),w.e(2773)]).then(w.bind(w,62773)),{mediaInfo:L,root:O}=g,{value:$,title:j}=L;h.setAll({wheelX:"panX",wheelY:"zoomX"});const Q=h.xAxes.push(I.new(O,{renderer:_.new(O,{inversed:v._isInversed()}),categoryField:lt}));Q.get("renderer").labels.template.setAll({forceHidden:!0});const oe=h.yAxes.push(A.new(O,{renderer:P.new(O,{inside:!1}),min:v._getMinSeriesValue($.series)}));oe.get("renderer").labels.template.setAll({direction:v._getDirection()});const ie="{categoryX}",fe=b.new(O,{labelText:ie}),ae=h.series.push(E.new(O,{name:j,xAxis:Q,yAxis:oe,valueYField:Lt,categoryXField:lt,tooltip:fe}));v._customizeChartTooltip(fe),ae.columns.template.setAll({ariaLabel:ie,focusable:!0,templateField:"columnSettings"}),$.series.length>15&&h.set("scrollbarX",C.new(O,{orientation:"horizontal"})),Q.data.setAll(y),ae.data.setAll(y),ae.appear(v._getChartSeriesAnimationMS()),h.appear(v._getChartAnimationMS())})()}_createBarChart(h,g,y){var v=this;return(0,R.Z)(function*(){const{TooltipAm5:b,ScrollbarAm5:C}=yield Promise.all([w.e(1603),w.e(8592),w.e(9719)]).then(w.bind(w,99719)),{CategoryAxisAm5:I,AxisRendererXAm5:_,ValueAxisAm5:A,AxisRendererYAm5:P,ColumnSeriesAm5:E}=yield Promise.all([w.e(1603),w.e(4305),w.e(8592),w.e(2773)]).then(w.bind(w,62773)),{mediaInfo:L,root:O}=g,{value:$,title:j}=L;h.setAll({wheelX:"panY",wheelY:"zoomY"});const Q=h.yAxes.push(I.new(O,{renderer:P.new(O,{inversed:!0}),categoryField:lt}));Q.get("renderer").labels.template.setAll({forceHidden:!0});const oe=h.xAxes.push(A.new(O,{renderer:_.new(O,{inside:!1,inversed:v._isInversed()}),min:v._getMinSeriesValue($.series)}));oe.get("renderer").labels.template.setAll({direction:v._getDirection()});const ie="{categoryY}",fe=b.new(O,{labelText:ie}),ae=h.series.push(E.new(O,{name:j,xAxis:oe,yAxis:Q,valueXField:Lt,categoryYField:lt,tooltip:fe}));v._customizeChartTooltip(fe,"vertical"),ae.columns.template.setAll({ariaLabel:ie,focusable:!0,templateField:"columnSettings"}),$.series.length>15&&h.set("scrollbarY",C.new(O,{orientation:"vertical"})),Q.data.setAll(y),ae.data.setAll(y),ae.appear(v._getChartSeriesAnimationMS()),h.appear(v._getChartAnimationMS())})()}_createLineChart(h,g,y){var v=this;return(0,R.Z)(function*(){const{TooltipAm5:b,ScrollbarAm5:C}=yield Promise.all([w.e(1603),w.e(8592),w.e(9719)]).then(w.bind(w,99719)),{CategoryAxisAm5:I,AxisRendererXAm5:_,ValueAxisAm5:A,AxisRendererYAm5:P,LineSeriesAm5:E}=yield Promise.all([w.e(1603),w.e(4305),w.e(8592),w.e(2773)]).then(w.bind(w,62773)),{root:L,mediaInfo:O}=g,{value:$,title:j}=O;h.setAll({wheelX:"panX",wheelY:"zoomX"});const Q=h.xAxes.push(I.new(L,{renderer:_.new(L,{inversed:v._isInversed()}),categoryField:lt}));Q.get("renderer").labels.template.setAll({forceHidden:!0});const oe=h.yAxes.push(A.new(L,{renderer:P.new(L,{inside:!1}),min:v._getMinSeriesValue($.series)}));oe.get("renderer").labels.template.setAll({direction:v._getDirection()});const fe=y[0]?.lineSettings?.stroke,ae=b.new(L,{getFillFromSprite:!fe,labelText:"{categoryX}"});fe&&ae.get("background")?.setAll({fill:fe});const Oe=h.series.push(E.new(L,{name:j,xAxis:Q,yAxis:oe,valueYField:Lt,categoryXField:lt,tooltip:ae}));Oe.strokes.template.setAll({templateField:"lineSettings"}),v._customizeChartTooltip(ae,"vertical"),$.series.length>15&&h.set("scrollbarX",C.new(L,{orientation:"horizontal"})),Q.data.setAll(y),Oe.data.setAll(y),Oe.appear(v._getChartSeriesAnimationMS()),h.appear(v._getChartAnimationMS())})()}_createXYChart(h,g){var y=this;return(0,R.Z)(function*(){const{XYChartAm5:v,XYCursorAm5:b}=yield Promise.all([w.e(1603),w.e(4305),w.e(8592),w.e(2773)]).then(w.bind(w,62773)),{root:C,mediaInfo:I}=h,{type:_}=I,P=C.container.children.push(v.new(C,{ariaLabel:I?.altText||I?.title||"",focusable:!0,panX:!0,panY:!0}));P.set("cursor",b.new(C,{})),"column-chart"===_&&(yield y._createColumnChart(P,h,g)),"bar-chart"===_&&(yield y._createBarChart(P,h,g)),"line-chart"===_&&(yield y._createLineChart(P,h,g)),P.root.dom.classList.toggle(Se.mediaChartRendered,!0)})()}_clearMediaRefreshTimer(){const{_refreshTimer:h}=this;h&&(clearTimeout(h),this._refreshTimer=null)}_updateMediaInfoTimestamp(h){const g=Date.now();this._refreshIntervalInfo={timestamp:g,sourceURL:h&&this._getImageSource(h,g)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:h}=this.viewModel;"image"===h?.type&&h?.refreshInterval>0&&this._setRefreshTimeout(h)}_setRefreshTimeout(h){const{refreshInterval:g,value:y}=h,v=6e4*g;this._updateMediaInfoTimestamp(y.sourceURL);const b=setInterval(()=>{this._updateMediaInfoTimestamp(y.sourceURL)},v);this._refreshTimer=b}_getImageSource(h,g){const y=h.includes("?")?"&":"?",[v,b=""]=h.split("#");return`${v}${y}timestamp=${g}${b?"#":""}${b}`}};(0,F._)([(0,M.Cb)()],Ue.prototype,"_refreshIntervalInfo",void 0),(0,F._)([(0,M.Cb)()],Ue.prototype,"attributes",null),(0,F._)([(0,M.Cb)()],Ue.prototype,"activeMediaInfoIndex",null),(0,F._)([(0,M.Cb)()],Ue.prototype,"description",null),(0,F._)([(0,M.Cb)()],Ue.prototype,"fieldInfoMap",null),(0,F._)([(0,M.Cb)()],Ue.prototype,"layer",null),(0,F._)([(0,M.Cb)()],Ue.prototype,"mediaInfos",null),(0,F._)([(0,M.Cb)()],Ue.prototype,"popupTemplate",null),(0,F._)([(0,M.Cb)()],Ue.prototype,"relatedInfos",null),(0,F._)([(0,M.Cb)()],Ue.prototype,"title",null),(0,F._)([(0,M.Cb)({type:pt})],Ue.prototype,"viewModel",void 0),(0,F._)([(0,M.Cb)(),(0,Be.H)("esri/widgets/Feature/t9n/Feature")],Ue.prototype,"messages",void 0),Ue=(0,F._)([(0,S.j)("esri.widgets.Feature.FeatureMedia")],Ue);const Rn=Ue;w(20004),w(37462),w(52225),w(49497);var Lo=w(90629),Oo=w(57229),Ln=(w(98522),w(23002)),No=w(43573),Zo=w(90373);const On=()=>B.Z.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");function Uo(h){return"string"==typeof h?Pt(ci(h)):Array.isArray(h)?function $o(h){return`<ul class="esri-widget__list">${h.map(g=>`<li>${"string"==typeof g?Pt(ci(g)):g}</li>`).join("")}</ul>`}(h):"esri.arcade.Dictionary"===h?.declaredClass?function Do(h){const g=h.keys().map(y=>{const v=h.field(y);return`<tr><th>${y}</th><td>${"string"==typeof v?Pt(ci(v)):v}</td></tr>`}).join("");return`<table class="${X.z.table}">${g}</table>`}(h):h}function Nn(){return Promise.all([w.e(3866),w.e(8592),w.e(3907)]).then(w.bind(w,43907))}function Bo(h){return Ri.apply(this,arguments)}function Ri(){return(Ri=(0,R.Z)(function*({graphic:h,view:g,options:y}){const{isAggregate:v,layer:b}=h;if(!v||!b||"2d"!==g?.type)return[];const C=yield g.whenLayerView(b);if(!function Vo(h){return"createQuery"in h&&"queryFeatures"in h}(C))return[];const I=C.createQuery(),_=h.getObjectId();I.aggregateIds=null!=_?[_]:[];const{features:A}=yield C.queryFeatures(I,y);return A})).apply(this,arguments)}function Zn(h){return Li.apply(this,arguments)}function Li(){return(Li=(0,R.Z)(function*({expressionInfo:h,arcade:g,interceptor:y,spatialReference:v,map:b,graphic:C,location:I,view:_,options:A}){if(!h?.expression)return null;const{isAggregate:P}=C,E=(C.sourceLayer||C.layer)??void 0,L=P?"feature-reduction-popup":"popup",O=g.createArcadeProfile(L),$=g.createArcadeExecutor(h.expression,O).catch(ae=>On().error("arcade-executor-error",{error:ae,expressionInfo:h})),[j,Q]=yield Promise.all([Bo({graphic:C,view:_,options:A}),$]);if(!Q)return null;const oe="feature-reduction-popup"===L?function jo({layer:h,aggregatedFeatures:g,interceptor:y}){const{fields:v,objectIdField:b,geometryType:C,spatialReference:I,displayField:_}=h;return new Zo.default({fields:v,objectIdField:b,geometryType:C,spatialReference:I,displayField:_,interceptor:y,..."feature"===h.type?{templates:h.templates,typeIdField:h.typeIdField,types:h.types}:null,source:g})}({layer:E,aggregatedFeatures:j,interceptor:y}):void 0,ie={..."feature-reduction-popup"===L?{$aggregatedFeatures:oe}:{$datastore:E?.url,$layer:"feature"===E?.type||"subtype-sublayer"===E?.type||"catalog-footprint"===E?.type||"oriented-imagery"===E?.type?E:"scene"===E?.type&&null!=E.associatedLayer?E.associatedLayer:void 0,$map:b,$userInput:I,$graph:"knowledge-graph-sublayer"===E?.type?E?.parentCompositeLayer?.knowledgeGraph:void 0},$feature:C},fe={abortSignal:A?.signal??void 0,interceptor:y??void 0,rawOutput:!0,spatialReference:v??void 0,timeZone:_?.timeZone};return yield Q.executeAsync(ie,fe).catch(ae=>On().error("arcade-execution-error",{error:ae,graphic:C,expressionInfo:h})).finally(()=>oe?.destroy())})).apply(this,arguments)}function zo(h){return Oi.apply(this,arguments)}function Oi(){return(Oi=(0,R.Z)(function*({expressionInfos:h,spatialReference:g,graphic:y,interceptor:v,map:b,view:C,location:I,options:_}){if(!h?.length)return{};const A=yield Nn(),P={};for(const O of h)P[`expression/${O.name}`]=Zn({expressionInfo:O,arcade:A,interceptor:v,spatialReference:g,map:b,graphic:y,location:I,view:C,options:_});const E=yield(0,we.as)(P),L={};for(const O in E)L[O]=Uo(E[O].value);return L})).apply(this,arguments)}let Ve=class extends qe.Z{constructor(h){var g;super(h),g=this,this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._cancelQuery=()=>{const{_abortController:y}=this;y&&y.abort(),this._abortController=null},this._createVM=()=>{const y=this.contentElement?.type;this.contentElementViewModel?.destroy();const v="fields"===y?new Bt:"media"===y?new pt:"text"===y?new Dt:null;this._set("contentElementViewModel",v)},this._compile=(0,R.Z)(function*(){g._cancelQuery();const y=new AbortController;g._abortController=y,yield g._compileExpression(),g._abortController===y&&(g._abortController=null)}),this._compileThrottled=he(this._compile,1,this),this._compileExpression=(0,R.Z)(function*(){const{expressionInfo:y,graphic:v,interceptor:b,spatialReference:C,map:I,location:_,view:A,_abortController:P}=g;if(!y||!v)return void g._set("contentElement",null);const E=yield Nn();if(P!==g._abortController)return;const L=yield Zn({arcade:E,expressionInfo:y,graphic:v,location:_,interceptor:b,map:I,spatialReference:C,view:A});if(!L||"esri.arcade.Dictionary"!==L.declaredClass)return void g._set("contentElement",null);const O=yield L.castAsJsonAsync(P?.signal),$=O?.type,j="media"===$?Oo.Z.fromJSON(O):"text"===$?Ln.Z.fromJSON(O):"fields"===$?Lo.Z.fromJSON(O):null;g._set("contentElement",j)}),this.addHandles([(0,T.YP)(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),T.nn),(0,T.YP)(()=>[this.contentElement],()=>this._createVM(),T.nn)])}initialize(){this.addHandles(this._compileThrottled)}destroy(){this._cancelQuery(),this.contentElementViewModel?.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(h){this._override("spatialReference",h)}get state(){const{_abortController:h,contentElement:g,contentElementViewModel:y}=this;return h?"loading":g||y?"ready":"disabled"}get map(){return this.view?.map??null}set map(h){this._override("map",h)}};(0,F._)([(0,M.Cb)()],Ve.prototype,"_abortController",void 0),(0,F._)([(0,M.Cb)({type:No.Z})],Ve.prototype,"expressionInfo",void 0),(0,F._)([(0,M.Cb)({type:Mt.Z})],Ve.prototype,"graphic",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],Ve.prototype,"contentElement",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],Ve.prototype,"contentElementViewModel",void 0),(0,F._)([(0,M.Cb)()],Ve.prototype,"interceptor",void 0),(0,F._)([(0,M.Cb)({type:Ai.Z})],Ve.prototype,"location",void 0),(0,F._)([(0,M.Cb)()],Ve.prototype,"spatialReference",null),(0,F._)([(0,M.Cb)({readOnly:!0})],Ve.prototype,"state",null),(0,F._)([(0,M.Cb)()],Ve.prototype,"map",null),(0,F._)([(0,M.Cb)()],Ve.prototype,"view",void 0),Ve=(0,F._)([(0,S.j)("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],Ve);const Ni=Ve,Sn="esri-feature",Un={base:`${Sn}-expression`,loadingSpinnerContainer:`${Sn}__loading-container`};let Ht=class extends U.Z{constructor(h,g){super(h,g),this._contentWidget=null,this.viewModel=new Ni}initialize(){this.addHandles((0,T.YP)(()=>this.viewModel?.contentElementViewModel,()=>this._setupExpressionWidget(),T.nn))}loadDependencies(){return(0,ht.h)({loader:()=>Promise.all([w.e(2115),w.e(6083),w.e(5597)]).then(w.bind(w,55597))})}destroy(){this._destroyContentWidget()}render(){const{state:h}=this.viewModel;return(0,x.u)("div",{class:Un.base},"loading"===h?this._renderLoading():"disabled"===h?null:this._contentWidget?.render())}_renderLoading(){return(0,x.u)("div",{class:Un.loadingSpinnerContainer,key:"loading-container"},(0,x.u)("calcite-loader",{inline:!0,label:""}))}_destroyContentWidget(){const{_contentWidget:h}=this;h&&(h.viewModel=null,h.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:h,contentElement:g}=this.viewModel,y=g?.type;this._destroyContentWidget();const v=h?"fields"===y?new xn({viewModel:h}):"media"===y?new Rn({viewModel:h}):"text"===y?new Vt({viewModel:h}):null:null;this._contentWidget=v,this.scheduleRender()}};(0,F._)([(0,M.Cb)({type:Ni})],Ht.prototype,"viewModel",void 0),Ht=(0,F._)([(0,S.j)("esri.widgets.Feature.FeatureExpression")],Ht);const Ho=Ht;var Kt,h,Yo=w(51172),Go=w(25387),$n=w(84373);w(480),w(34222),w(43647),w(42534),(h=Kt||(Kt={})).TOO_SHORT="length-validation-error::too-short",h.TOO_LONG="length-validation-error::too-long";const tr=h=>{const g=[];if(h.formTemplate){const{description:y,title:v}=h.formTemplate;h.fields?.forEach(b=>{const C=v&&(0,ot.pZ)(v,b.name),I=y&&(0,ot.pZ)(y,b.name);(C||I)&&g.push(b.name)})}return g};let le=class extends((0,Go.J)((0,$n.IG)(qe.Z))){constructor(h){var g;super(h),g=this,this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:y}=this;y&&y.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:y}=this;y&&y.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:y}=this;y&&y.abort(),this._queryPageAbortController=null},this._queryController=(0,R.Z)(function*(){g._cancelQuery();const y=new AbortController;g._queryAbortController=y,yield(0,we.R8)(g._query()),g._queryAbortController===y&&(g._queryAbortController=null)}),this._queryFeatureCountController=(0,R.Z)(function*(){g._loaded=!1,g._cancelQueryFeatureCount();const y=new AbortController;g._queryFeatureCountAbortController=y,yield(0,we.R8)(g._queryFeatureCount()),g._queryFeatureCountAbortController===y&&(g._queryFeatureCountAbortController=null),g._loaded=!0}),this._queryPageController=(0,R.Z)(function*(){const y=new AbortController;g._queryPageAbortController=y,yield(0,we.R8)(g._queryPage()),g._queryPageAbortController===y&&(g._queryPageAbortController=null)}),this._queryDebounced=(0,we.Ds)(this._queryController,100),this._queryFeatureCountDebounced=(0,we.Ds)(this._queryFeatureCountController,100),this._queryPageDebounced=(0,we.Ds)(this._queryPageController,100),this._query=(0,R.Z)(function*(){const{_queryAbortController:y,relatedFeatures:v}=g;g.featureCount&&(g._destroyRelatedFeatureViewModels(),g.featurePage=1,v.destroyAll(),g.destroyed||v.addMany(g._sliceFeatures(yield g._queryRelatedFeatures({signal:y?.signal}))))}),this.addHandles([(0,T.YP)(()=>[this.displayCount,this.graphic,this.layer,this.layer?.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount],()=>this._queryDebounced(),T.nn),(0,T.YP)(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),(0,T.YP)(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.destroyAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(h){const{featuresPerPage:g,featureCount:y}=this,b=Math.ceil(y/g)||1;this._set("featurePage",Math.min(Math.max(h,1),b))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:h,relatedLayer:g}=this;return h&&g?.loaded?h.map(y=>{const v=y.clone();return v.field=Tt(y.field,g),v}):h??[]}get supportsCacheHint(){return!!this.layer?.capabilities?.queryRelated?.supportsCacheHint}get canLoad(){return!!this.map&&null!=this.relationshipId&&"number"==typeof this.objectId}get canQuery(){const h=this.layer?.capabilities?.queryRelated;return!!(this.relatedLayer&&this.relationship&&null!=this.relationshipId&&null!=this.objectId&&h?.supportsCount&&h?.supportsPagination)}get itemDescriptionFieldName(){return this.orderByFieldsFixedCasing[0]?.field||null}set displayCount(h){this._set("displayCount",Math.min(Math.max(h,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??null}get objectIdField(){return this.layer?.objectIdField||null}get relatedFeatures(){return this._get("relatedFeatures")||new k.Z}get relatedLayer(){const{layer:h,map:g,relationship:y}=this;return h?.loaded&&g&&y?function Js(h,g,y){return h&&g&&y?"sublayer"===g.type?It({layers:g.layer?.sublayers,map:h,relatedLayer:g,relationship:y})||It({layers:g.layer?.subtables,map:h,relatedLayer:g,relationship:y}):It({layers:h.allLayers,map:h,relatedLayer:g,relationship:y})||It({layers:h.allTables,map:h,relatedLayer:g,relationship:y}):null}(g,h,y)??null:null}get relationship(){const{relationshipId:h,layer:g}=this;return null!=h?g?.relationships?.find(({id:y})=>y===h)??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new k.Z}get state(){const{_queryAbortController:h,_queryFeatureCountAbortController:g,_queryPageAbortController:y,canQuery:v,_loaded:b,canLoad:C}=this;return g||C&&!b?"loading":h||y?"querying":v?"ready":"disabled"}getRelatedFeatureByObjectId(h){return this.relatedFeatures.find(g=>g.getObjectId()===h)}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){this.relatedFeatureViewModels?.destroyAll()}_queryFeatureCount(){var h=this;return(0,R.Z)(function*(){const{layer:g,relatedLayer:y,relationshipId:v,objectId:b,_queryFeatureCountAbortController:C,canQuery:I,supportsCacheHint:_}=h;if(yield g?.load(),yield y?.load(),!I||!g||!y||null==b)return void h._set("featureCount",0);const A=y.createQuery(),{historicMoment:P,gdbVersion:E}=g,L=new Ei.default({cacheHint:_,gdbVersion:E,historicMoment:P,relationshipId:v,returnGeometry:!1,objectIds:[b],where:A.where??void 0}),O=yield g.queryRelatedFeaturesCount(L,{signal:C?.signal});h._set("featureCount",O[b]||0)})()}_sliceFeatures(h){const{showAllEnabled:g,displayCount:y}=this;return g?h:y?h.slice(0,y):[]}_queryPage(){var h=this;return(0,R.Z)(function*(){const{relatedFeatures:g,featurePage:y,showAllEnabled:v,_queryPageAbortController:b,featureCount:C}=h;!v||y<2||!C||g.addMany(yield h._queryRelatedFeatures({signal:b?.signal}))})()}_queryRelatedFeatures(h){var g=this;return(0,R.Z)(function*(){const{orderByFieldsFixedCasing:y,showAllEnabled:v,featuresPerPage:b,displayCount:C,layer:I,relationshipId:_,featurePage:A,featureCount:P,relatedLayer:E,supportsCacheHint:L}=g,{canQuery:O,objectId:$}=g;if(!O||!I||!E||null==$)return[];const j=v?((A-1)*b+P)%P:0,Q=v?b:C,oe=E.objectIdField,ie=[...y.map(Ke=>Ke.field),...tr(E),oe].filter(xt.pC),fe=y.map(Ke=>`${Ke.field} ${Ke.order}`),ae=E.createQuery(),{historicMoment:Oe,gdbVersion:ut}=I,Ge=new Ei.default({orderByFields:fe,start:j,num:Q,outFields:ie,cacheHint:L,historicMoment:Oe,gdbVersion:ut,relationshipId:_,returnGeometry:!1,objectIds:[$],where:ae.where??void 0}),en=yield I.queryRelatedFeatures(Ge,{signal:h?.signal}),qt=en[$]?.features||[];return qt.forEach(Ke=>{Ke.sourceLayer=E,Ke.layer=E}),qt})()}};(0,F._)([(0,M.Cb)()],le.prototype,"_loaded",void 0),(0,F._)([(0,M.Cb)()],le.prototype,"_queryAbortController",void 0),(0,F._)([(0,M.Cb)()],le.prototype,"_queryPageAbortController",void 0),(0,F._)([(0,M.Cb)()],le.prototype,"_queryFeatureCountAbortController",void 0),(0,F._)([(0,M.Cb)({value:1})],le.prototype,"featurePage",null),(0,F._)([(0,M.Cb)()],le.prototype,"featuresPerPage",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],le.prototype,"orderByFieldsFixedCasing",null),(0,F._)([(0,M.Cb)({readOnly:!0})],le.prototype,"supportsCacheHint",null),(0,F._)([(0,M.Cb)({readOnly:!0})],le.prototype,"canLoad",null),(0,F._)([(0,M.Cb)({readOnly:!0})],le.prototype,"canQuery",null),(0,F._)([(0,M.Cb)()],le.prototype,"description",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],le.prototype,"itemDescriptionFieldName",null),(0,F._)([(0,M.Cb)({value:3})],le.prototype,"displayCount",null),(0,F._)([(0,M.Cb)({type:Mt.Z})],le.prototype,"graphic",void 0),(0,F._)([(0,M.Cb)()],le.prototype,"layer",void 0),(0,F._)([(0,M.Cb)()],le.prototype,"map",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],le.prototype,"objectId",null),(0,F._)([(0,M.Cb)({readOnly:!0})],le.prototype,"objectIdField",null),(0,F._)([(0,M.Cb)()],le.prototype,"orderByFields",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],le.prototype,"relatedFeatures",null),(0,F._)([(0,M.Cb)({readOnly:!0})],le.prototype,"relatedLayer",null),(0,F._)([(0,M.Cb)({readOnly:!0})],le.prototype,"relationship",null),(0,F._)([(0,M.Cb)()],le.prototype,"featureCount",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],le.prototype,"relatedFeatureViewModels",null),(0,F._)([(0,M.Cb)()],le.prototype,"relationshipId",void 0),(0,F._)([(0,M.Cb)()],le.prototype,"showAllEnabled",void 0),(0,F._)([(0,M.Cb)()],le.prototype,"state",null),(0,F._)([(0,M.Cb)()],le.prototype,"title",void 0),le=(0,F._)([(0,S.j)("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],le);const Si=le,Qt="esri-feature",Ot=`${Qt}-relationship`,at={base:Ot,listContainer:`${Ot}__list`,listItem:`${Ot}__list-item`,listItemHidden:`${Ot}__list-item--hidden`,listContainerQuerying:`${Ot}__list--querying`,featureObserver:`${Qt}__feature-observer`,stickySpinnerContainer:`${Qt}__sticky-loading-container`,loadingSpinnerContainer:`${Qt}__loading-container`},Wn={title:!0,description:!0};let $e=class extends U.Z{constructor(h,g){super(h,g),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([y])=>{y?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new Si,this.messages=null,this.messagesCommon=null,this.visibleElements={...Wn},this._increaseFeaturePage=()=>{const{state:y,showAllEnabled:v,relatedFeatures:b,featuresPerPage:C,featurePage:I}=this.viewModel;"ready"===y&&v&&b.length>=C*I&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new $t,this.addHandles([(0,T.YP)(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),T.nn),(0,T.YP)(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),(0,T.on)(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return(0,ht.h)({icon:()=>Promise.all([w.e(2115),w.e(4540)]).then(w.bind(w,24540)),list:()=>Promise.all([w.e(2115),w.e(6083),w.e(2964),w.e(1905),w.e(8592),w.e(6221)]).then(w.bind(w,26221)),"list-item":()=>Promise.all([w.e(2115),w.e(6083),w.e(5782),w.e(8592),w.e(9475)]).then(w.bind(w,99475)),loader:()=>Promise.all([w.e(2115),w.e(6083),w.e(5597)]).then(w.bind(w,55597)),notice:()=>Promise.all([w.e(2115),w.e(6083),w.e(8592),w.e(2205)]).then(w.bind(w,72205))})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=(0,Yo.SC)(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:h,featureCount:g,displayCount:y,state:v}=this.viewModel;return!h&&!!g&&"ready"===v&&(g>y||0===y)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(h){this.viewModel.description=h}get featureCountDescription(){const{messages:h}=this,{featureCount:g}=this.viewModel;return(0,nt.n)(h?.numberRecords,{number:g})}get title(){return this.viewModel.title}set title(h){this.viewModel.title=h}castVisibleElements(h){return{...Wn,...h}}render(){const{state:h}=this.viewModel;return(0,x.u)("div",{class:this.classes(at.base,X.z.widget)},this._featureElementInfo?.render(),"loading"===h?this._renderLoading():"disabled"===h?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_renderStickyLoading(){return"querying"===this.viewModel.state?(0,x.u)("div",{class:at.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return(0,x.u)("calcite-loader",{inline:!0,label:""})}_renderLoading(){return(0,x.u)("div",{class:at.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return(0,x.u)("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){const h=(0,We.dZ)(this.container)?"chevron-left":"chevron-right";return(0,x.u)("calcite-icon",{icon:h,scale:"s",slot:"content-end"})}_renderRelatedFeature(h){const{itemDescriptionFieldName:g}=this.viewModel,y=h.title;return h.description=g&&h.formattedAttributes?.global[g],(0,x.u)("calcite-list-item",{class:this.classes(at.listItem,{[at.listItemHidden]:"loading"===h.state}),description:h.description??"",key:h.uid,label:y,onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:h})},this._renderChevronIconNode())}_renderShowAllListItem(){return this.displayShowAllButton?(0,x.u)("calcite-list-item",{description:this.featureCountDescription,key:"show-all-item",label:this.messages?.showAll,onCalciteListItemSelect:()=>this.emit("show-all-records")},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){return(0,x.u)("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},(0,x.u)("div",{slot:"message"},this.messages?.noRelatedFeatures))}_renderFeatureObserver(){return(0,x.u)("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:at.featureObserver,key:"feature-observer"})}_renderList(){const{relatedFeatureViewModels:h}=this.viewModel;return(0,x.u)("calcite-list",null,h.toArray().map(g=>this._renderRelatedFeature(g)),this._renderShowAllListItem())}_renderRelatedFeatures(){const{displayListItems:h}=this,{state:g}=this.viewModel;return(0,x.u)("div",{class:this.classes(at.listContainer,{[at.listContainerQuerying]:"querying"===g}),key:"list-container"},h?this._renderList():"ready"===g?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){return(0,x.u)("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},(0,x.u)("div",{slot:"message"},this.messages?.relationshipNotFound))}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:h}=this.viewModel,g="related-feature-viewmodels";this.removeHandles(g),h?.forEach(y=>{this.addHandles((0,T.YP)(()=>[y.title,y.state],()=>this.scheduleRender(),T.nn),g)}),this.scheduleRender()}_setupFeatureElementInfo(){const{headingLevel:h,visibleElements:g}=this,y=g.description&&this.description,v=g.title&&this.title;this._featureElementInfo?.set({description:y,title:v,headingLevel:h})}_handleRelatedFeatureObserverChange(){var h=this;return(0,R.Z)(function*(){h._unobserveRelatedFeatureObserver();const{state:g,showAllEnabled:y}=h.viewModel;yield(0,we.e4)(0),h._relatedFeatureIntersectionObserverNode&&"ready"===g&&y&&h._relatedFeatureIntersectionObserver.observe(h._relatedFeatureIntersectionObserverNode)})()}_relatedFeatureIntersectionObserverCreated(h){this._relatedFeatureIntersectionObserverNode=h}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};(0,F._)([(0,M.Cb)()],$e.prototype,"_relatedFeatureIntersectionObserverNode",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],$e.prototype,"displayShowAllButton",null),(0,F._)([(0,M.Cb)({readOnly:!0})],$e.prototype,"displayListItems",null),(0,F._)([(0,M.Cb)()],$e.prototype,"description",null),(0,F._)([(0,M.Cb)({readOnly:!0})],$e.prototype,"featureCountDescription",null),(0,F._)([(0,M.Cb)()],$e.prototype,"headingLevel",void 0),(0,F._)([(0,M.Cb)()],$e.prototype,"title",null),(0,F._)([(0,M.Cb)({type:Si})],$e.prototype,"viewModel",void 0),(0,F._)([(0,M.Cb)(),(0,Be.H)("esri/widgets/Feature/t9n/Feature")],$e.prototype,"messages",void 0),(0,F._)([(0,M.Cb)(),(0,Be.H)("esri/t9n/common")],$e.prototype,"messagesCommon",void 0),(0,F._)([(0,M.Cb)()],$e.prototype,"visibleElements",void 0),(0,F._)([(0,Z.p)("visibleElements")],$e.prototype,"castVisibleElements",null),$e=(0,F._)([(0,S.j)("esri.widgets.Feature.FeatureRelationship")],$e);const Hn=$e;var Nt;const Yn="content-view-models",Gn="relationship-view-models",Kn={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let pe=Nt=class extends((0,$n.IG)(qe.Z)){constructor(h){super(h),this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=he(this._graphicChanged,1,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...Kn},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=g=>{const{abilities:y}=this;return"attachments"===g.type&&!!y.attachmentsContent||"custom"===g.type&&!!y.customContent||"fields"===g.type&&!!y.fieldsContent||"media"===g.type&&!!y.mediaContent||"text"===g.type&&!!y.textContent||"expression"===g.type&&!!y.expressionContent||"relationship"===g.type&&!!y.relationshipContent},this.addHandles((0,T.YP)(()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone],()=>this._graphicChangedThrottled(),T.nn))}initialize(){this.addHandles(this._graphicChangedThrottled)}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return null!=this.graphic?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return function zs(h,g){const y=new Map;if(!h)return y;for(const v of h){if(!v.fieldName)continue;const b=Tt(v.fieldName,g);v.fieldName=b,y.set(b.toLowerCase(),v)}return y}(fn(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return un(this.graphic)}castAbilities(h){return{...Kn,...h}}get isTable(){return this._sourceLayer?.isTable||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(h){this._set("graphic",h?.clone()??null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(h){this._override("spatialReference",h)}get timeZone(){return this.view?.timeZone??ii.By}set timeZone(h){this._overrideIfSome("timeZone",h)}get map(){return this.view?.map||null}set map(h){this._override("map",h)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(h,g){const y=this.contentViewModels[h];y instanceof pt&&y.setActiveMedia(g)}nextMedia(h){const g=this.contentViewModels[h];g instanceof pt&&g.next()}previousMedia(h){const g=this.contentViewModels[h];g instanceof pt&&g.previous()}updateGeometry(){var h=this;return(0,R.Z)(function*(){const{graphic:g,spatialReference:y,_sourceLayer:v}=h;yield v?.load();const b=v?.objectIdField;if(!b||!g||!v)return;const C=g?.attributes?.[b];if(null==C)return;const I=[C];if(!g.geometry){const _=yield yn({layer:v,graphic:g,outFields:[],objectIds:I,returnGeometry:!0,spatialReference:y}),A=_?.geometry;A&&(g.geometry=A)}})()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}_graphicChanged(){var h=this;return(0,R.Z)(function*(){h._cancelFeatureQuery(),h._error=null,h._clear();const{graphic:g}=h;if(!g)return;const y=new AbortController;h._featureAbortController=y;try{yield h._queryFeature({signal:y.signal})}catch(v){(0,we.D_)(v)||(h._error=v,B.Z.getLogger(h).error("error","The popupTemplate could not be displayed for this feature.",{error:v,graphic:g,popupTemplate:h._effectivePopupTemplate}))}h._featureAbortController===y&&(h._featureAbortController=null)})()}_cancelFeatureQuery(){const{_featureAbortController:h}=this;h&&h.abort(),this._featureAbortController=null}_compileContentElement(h,g){return"attachments"===h.type?this._compileAttachments(h,g):"custom"===h.type?this._compileCustom(h,g):"fields"===h.type?this._compileFields(h,g):"media"===h.type?this._compileMedia(h,g):"text"===h.type?this._compileText(h,g):"expression"===h.type?this._compileExpression(h,g):"relationship"===h.type?this._compileRelationship(h,g):void 0}_compileContent(h){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(h)?h.filter(this._isAllowedContentType).map((g,y)=>this._compileContentElement(g,y)).filter(xt.pC):"string"==typeof h?this._compileText(new Ln.Z({text:h}),0).text:h}_destroyContentViewModels(){this.removeHandles(Gn),this.removeHandles(Yn),this.contentViewModels.forEach(h=>h&&!h.destroyed&&h.destroy()),this._set("contentViewModels",[])}_matchesFeature(h,g){const y=h?.graphic?.getObjectId(),v=g?.getObjectId();return null!=y&&null!=v&&y===v}_setRelatedFeaturesViewModels({relatedFeatureViewModels:h,relatedFeatures:g,map:y}){const{view:v,spatialReference:b,timeZone:C}=this;g?.filter(Boolean).forEach(I=>{h.some(_=>this._matchesFeature(_,I))||h.add(new Nt({abilities:{relationshipContent:!1},map:y,view:v,spatialReference:b,timeZone:C,graphic:I}))}),h.forEach(I=>{g?.find(A=>this._matchesFeature(I,A))||h.remove(I)})}_setExpressionContentVM(h,g){const y=this.formattedAttributes,{contentElement:v,contentElementViewModel:b}=h,C=v?.type;b&&C&&("fields"===C&&(this._createFieldsFormattedAttributes({contentElement:v,contentElementIndex:g,formattedAttributes:y}),b.set(this._createFieldsVMParams(v,g))),"media"===C&&(this._createMediaFormattedAttributes({contentElement:v,contentElementIndex:g,formattedAttributes:y}),b.set(this._createMediaVMParams(v,g))),"text"===C&&b.set(this._createTextVMParams(v)))}_compileRelationship(h,g){const{displayCount:y,orderByFields:v,relationshipId:b,title:C,description:I}=h,{_sourceLayer:_,graphic:A,map:P}=this;if(!di(_))return;const E=new Si({displayCount:y,graphic:A,orderByFields:v,relationshipId:b,layer:_,map:P,...this._compileTitleAndDesc({title:C,description:I})});return this.contentViewModels[g]=E,this.addHandles((0,T.on)(()=>E.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(E)),Gn),h}_compileExpression(h,g){const{expressionInfo:y}=h,{graphic:v,map:b,spatialReference:C,view:I,location:_}=this,A=new Ni({expressionInfo:y,graphic:v,interceptor:Nt.interceptor,map:b,spatialReference:C,view:I,location:_});return this.contentViewModels[g]=A,this.addHandles((0,T.YP)(()=>A.contentElementViewModel,()=>this._setExpressionContentVM(A,g),T.nn),Yn),h}_compileAttachments(h,g){const{graphic:y}=this,{description:v,title:b}=h;return this.contentViewModels[g]=new vi({graphic:y,...this._compileTitleAndDesc({title:b,description:v})}),h}_compileCustom(h,g){const{graphic:y}=this,{creator:v,destroyer:b}=h;return this.contentViewModels[g]=new Dt({graphic:y,creator:v,destroyer:b}),h}_compileTitleAndDesc({title:h,description:g}){const{_fieldInfoMap:y,_sourceLayer:v,graphic:b,formattedAttributes:C}=this,I=b?.attributes,_=this._expressionAttributes,A=C.global;return{title:ct({attributes:I,fieldInfoMap:y,globalAttributes:A,expressionAttributes:_,layer:v,text:h}),description:ct({attributes:I,fieldInfoMap:y,globalAttributes:A,expressionAttributes:_,layer:v,text:g})}}_createFieldsVMParams(h,g){const y=this._effectivePopupTemplate,v=this.formattedAttributes,b={...v?.global,...v?.content[g]},C=h?.fieldInfos||y?.fieldInfos,I=C?.filter(({fieldName:E})=>!!E&&(oi(E)||et(E)||b.hasOwnProperty(E))),_=y?.expressionInfos,{description:A,title:P}=h;return{attributes:b,expressionInfos:_,fieldInfos:I,...this._compileTitleAndDesc({title:P,description:A})}}_compileFields(h,g){const y=h.clone(),v=new Bt(this._createFieldsVMParams(h,g));return this.contentViewModels[g]=v,y.fieldInfos=v.formattedFieldInfos.slice(0),y}_createMediaVMParams(h,g){const{abilities:y,graphic:v,_fieldInfoMap:b,_effectivePopupTemplate:C,relatedInfos:I,_sourceLayer:_,_expressionAttributes:A}=this,P=this.formattedAttributes,E=v?.attributes??{},{description:L,mediaInfos:O,title:$}=h;return{abilities:{chartAnimation:y.chartAnimation},activeMediaInfoIndex:h.activeMediaInfoIndex||0,attributes:E,isAggregate:v?.isAggregate,layer:_,fieldInfoMap:b,formattedAttributes:{...P?.global,...P?.content[g]},expressionAttributes:A,mediaInfos:O,popupTemplate:C,relatedInfos:I,...this._compileTitleAndDesc({title:$,description:L})}}_compileMedia(h,g){const y=h.clone(),v=new pt(this._createMediaVMParams(h,g));return y.mediaInfos=v.formattedMediaInfos.slice(0),this.contentViewModels[g]=v,y}_createTextVMParams(h){const{graphic:g,_fieldInfoMap:y,_sourceLayer:v,_expressionAttributes:b}=this;return h&&h.text&&(h.text=ct({attributes:g?.attributes??{},fieldInfoMap:y,globalAttributes:this.formattedAttributes?.global??{},expressionAttributes:b,layer:v,text:h.text})),{graphic:g,creator:h.text}}_compileText(h,g){const y=h.clone();return this.contentViewModels[g]=new Dt(this._createTextVMParams(y)),y}_compileLastEditInfo(){const{_effectivePopupTemplate:h,_sourceLayer:g,graphic:y,timeZone:v}=this;if(!h)return;const{lastEditInfoEnabled:b}=h,C=g?.editFieldsInfo;return b&&C?function js(h,g,y,v){const{creatorField:b,creationDateField:C,editorField:I,editDateField:_}=h;if(!g)return;const A=(0,ii.Np)(v&&"preferredTimeZone"in v?v.preferredTimeZone:null,!(!v||!("datesInUnknownTimezone"in v)||!v.datesInUnknownTimezone),y,dn,"date"),P={...dn,...A},E=g[_];if("number"==typeof E){const O=g[I];return{type:"edit",date:(0,ei.p6)(E,P),user:O}}const L=g[C];if("number"==typeof L){const O=g[b];return{type:"create",date:(0,ei.p6)(L,P),user:O}}return null}(C,y?.attributes,v,g):void 0}_compileTitle(h){const{_fieldInfoMap:g,_sourceLayer:y,graphic:v,_expressionAttributes:b}=this;return ct({attributes:v?.attributes??{},fieldInfoMap:g,globalAttributes:this.formattedAttributes?.global??{},expressionAttributes:b,layer:y,text:h})}_getTitle(){var h=this;return(0,R.Z)(function*(){const{_effectivePopupTemplate:g,graphic:y}=h;return y?Ut({type:"title",value:g?.title,event:{graphic:y}}):null})()}_getContent(){var h=this;return(0,R.Z)(function*(){const{_effectivePopupTemplate:g,graphic:y}=h;return y?Ut({type:"content",value:g?.content,event:{graphic:y}}):null})()}_queryFeature(h){var g=this;return(0,R.Z)(function*(){const{_featureAbortController:y,_sourceLayer:v,graphic:b,_effectivePopupTemplate:C}=g,I=g.map,_=g.view,A=g.spatialReference,P=g.location;if(y!==g._featureAbortController||!b)return;yield function Hs(h,g){return fi.apply(this,arguments)}({graphic:b,popupTemplate:C,layer:v,spatialReference:A},h);const{content:{value:E},title:{value:L}}=yield(0,we.as)({content:g._getContent(),title:g._getTitle()}),{expressionAttributes:{value:O}}=yield(0,we.as)({checkForRelatedFeatures:g._checkForRelatedFeatures(h),expressionAttributes:zo({expressionInfos:C?.expressionInfos,spatialReference:A,graphic:b,map:I,interceptor:Nt.interceptor,view:_,options:h,location:P})});y===g._featureAbortController&&b&&(g._expressionAttributes=O,g._graphicExpressionAttributes={...b.attributes,...O},g._set("formattedAttributes",g._createFormattedAttributes(E)),g._set("title",g._compileTitle(L)),g._set("lastEditInfo",g._compileLastEditInfo()||null),g._set("content",g._compileContent(E)||null))})()}_createMediaFormattedAttributes({contentElement:h,contentElementIndex:g,formattedAttributes:y}){const{_effectivePopupTemplate:v,graphic:b,relatedInfos:C,_sourceLayer:I,_fieldInfoMap:_,_graphicExpressionAttributes:A,timeZone:P}=this;y.content[g]=hi({fieldInfos:v?.fieldInfos,graphic:b,attributes:{...A,...h.attributes},layer:I,fieldInfoMap:_,relatedInfos:C,timeZone:P})}_createFieldsFormattedAttributes({contentElement:h,contentElementIndex:g,formattedAttributes:y}){if(h.fieldInfos){const{graphic:v,relatedInfos:b,_sourceLayer:C,_fieldInfoMap:I,_graphicExpressionAttributes:_,timeZone:A}=this;y.content[g]=hi({fieldInfos:h.fieldInfos,graphic:v,attributes:{..._,...h.attributes},layer:C,fieldInfoMap:I,relatedInfos:b,timeZone:A})}}_createFormattedAttributes(h){const{_effectivePopupTemplate:g,graphic:y,relatedInfos:v,_sourceLayer:b,_fieldInfoMap:C,_graphicExpressionAttributes:I,timeZone:_}=this,A=g?.fieldInfos,P={global:hi({fieldInfos:A,graphic:y,attributes:I,layer:b,fieldInfoMap:C,relatedInfos:v,timeZone:_}),content:[]};return Array.isArray(h)&&h.forEach((E,L)=>{"fields"===E.type&&this._createFieldsFormattedAttributes({contentElement:E,contentElementIndex:L,formattedAttributes:P}),"media"===E.type&&this._createMediaFormattedAttributes({contentElement:E,contentElementIndex:L,formattedAttributes:P})}),P}_checkForRelatedFeatures(h){const{graphic:g,_effectivePopupTemplate:y}=this;return this._queryRelatedInfos(g,fn(y),h)}_queryRelatedInfos(h,g,y){var v=this;return(0,R.Z)(function*(){const{relatedInfos:b,_sourceLayer:C}=v;b.clear();const I=null!=C?.associatedLayer?yield C?.associatedLayer.load(y):C;if(!I||!h||!g.filter(E=>!!E.fieldName&&et(E.fieldName))?.length)return;g.forEach(E=>v._configureRelatedInfo(E,I));const A=yield function Mo({relatedInfos:h,layer:g},y){const v={};return h.forEach((b,C)=>{const{relation:I}=b;if(!I){const L=new D.Z("relation-required","A relation is required on a layer to retrieve related records.");throw En().error(L),L}const{relatedTableId:_}=I;if("number"!=typeof _){const L=new D.Z("A related table ID is required on a layer to retrieve related records.");throw En().error(L),L}const A=`${g.url}/${_}`,P=Tn.get(A),E=P??function Fo(h,g){return(0,ao.Z)(h,{query:{f:"json"},signal:g?.signal})}(A);P||Tn.set(A,E),v[C]=E}),(0,we.Hl)((0,we.as)(v),y)}({relatedInfos:b,layer:I},y);Object.keys(A).forEach(E=>{const L=b.get(E.toString()),O=A[E]?.value;L&&O&&(L.layerInfo=O.data)});const P=yield function Io({graphic:h,relatedInfos:g,layer:y},v){const b={};return g.forEach((C,I)=>{C.layerInfo&&(b[I]=function wo(h,g,y,v){return Ti.apply(this,arguments)}(h,C,y,v))}),(0,we.as)(b)}({graphic:h,relatedInfos:b,layer:I},y);Object.keys(P).forEach(E=>{!function go(h,g){if(!g||!h)return;const{features:y,statsFeatures:v}=h,b=y?.value;g.relatedFeatures=b?b.features:[];const C=v?.value;g.relatedStatsFeatures=C?C.features:[]}(P[E]?.value,b.get(E.toString()))})})()}_configureRelatedInfo(h,g){const{relatedInfos:y}=this,v=Wt(h.fieldName||"");if(!v)return;const{layerId:b,fieldName:C}=v;if(!b)return;const I=y.get(b.toString())||function fo(h,g){const y=function ho(h,g){if(!g.relationships)return null;let y=null;const{relationships:v}=g;return v.some(b=>b.id===parseInt(h,10)&&(y=b,!0)),y}(h,g);if(y)return{url:`${g.url}/${y.relatedTableId}`,sourceSpatialReference:g.spatialReference,relation:y,relatedFields:[],outStatistics:[]}}(b,g);I&&(function _o({relatedInfo:h,fieldName:g,fieldInfo:y}){if(h.relatedFields?.push(g),y.statisticType){const v=new uo.Z({statisticType:y.statisticType,onStatisticField:g,outStatisticFieldName:g});h.outStatistics?.push(v)}}({relatedInfo:I,fieldName:C,fieldInfo:h}),this.relatedInfos.set(b,I))}};pe.interceptor=new class ir{constructor(g,y){this.preLayerQueryCallback=g,this.preRequestCallback=y,this.preLayerQueryCallback||(this.preLayerQueryCallback=v=>{}),this.preRequestCallback||(this.preLayerQueryCallback=v=>{})}}(({query:h,layer:g,method:y})=>{Cn({layer:g,method:y,query:h,definitionExpression:`${g.definitionExpression} ${g.serviceDefinitionExpression??""}`})},({queryPayload:h,layer:g,method:y})=>{Cn({layer:g,method:y,query:h,definitionExpression:`${g.definitionExpression} ${g.serviceDefinitionExpression??""}`})}),(0,F._)([(0,M.Cb)()],pe.prototype,"_error",void 0),(0,F._)([(0,M.Cb)()],pe.prototype,"_featureAbortController",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],pe.prototype,"_effectivePopupTemplate",null),(0,F._)([(0,M.Cb)({readOnly:!0})],pe.prototype,"_fieldInfoMap",null),(0,F._)([(0,M.Cb)({readOnly:!0})],pe.prototype,"_sourceLayer",null),(0,F._)([(0,M.Cb)()],pe.prototype,"abilities",void 0),(0,F._)([(0,Z.p)("abilities")],pe.prototype,"castAbilities",null),(0,F._)([(0,M.Cb)({readOnly:!0})],pe.prototype,"content",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],pe.prototype,"contentViewModels",void 0),(0,F._)([(0,M.Cb)()],pe.prototype,"description",void 0),(0,F._)([(0,M.Cb)({type:Boolean})],pe.prototype,"defaultPopupTemplateEnabled",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],pe.prototype,"isTable",null),(0,F._)([(0,M.Cb)({readOnly:!0})],pe.prototype,"state",null),(0,F._)([(0,M.Cb)({readOnly:!0})],pe.prototype,"formattedAttributes",void 0),(0,F._)([(0,M.Cb)({type:Mt.Z,value:null})],pe.prototype,"graphic",null),(0,F._)([(0,M.Cb)({readOnly:!0})],pe.prototype,"lastEditInfo",void 0),(0,F._)([(0,M.Cb)({type:Ai.Z})],pe.prototype,"location",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],pe.prototype,"relatedInfos",void 0),(0,F._)([(0,M.Cb)()],pe.prototype,"spatialReference",null),(0,F._)([(0,M.Cb)()],pe.prototype,"timeZone",null),(0,F._)([(0,M.Cb)({readOnly:!0})],pe.prototype,"title",void 0),(0,F._)([(0,M.Cb)()],pe.prototype,"map",null),(0,F._)([(0,M.Cb)({readOnly:!0})],pe.prototype,"waitingForContent",null),(0,F._)([(0,M.Cb)()],pe.prototype,"view",void 0),pe=Nt=(0,F._)([(0,S.j)("esri.widgets.Feature.FeatureViewModel")],pe);const Ui=pe,Le="esri-feature",Ce={base:Le,container:`${Le}__size-container`,title:`${Le}__title`,main:`${Le}__main-container`,btn:`${Le}__button`,icon:`${Le}__icon`,content:`${Le}__content`,contentNode:`${Le}__content-node`,contentNodeText:`${Le}__content-node--text`,contentElement:`${Le}__content-element`,text:`${Le}__text`,lastEditedInfo:`${Le}__last-edited-info`,fields:`${Le}__fields`,fieldHeader:`${Le}__field-header`,fieldData:`${Le}__field-data`,fieldDataDate:`${Le}__field-data--date`,loadingSpinnerContainer:`${Le}__loading-container`},Qn=h=>{let g=class extends h{constructor(){super(...arguments),this.renderNodeContent=y=>(0,Fi.Qd)(y)&&!y.destroyed?(0,x.u)("div",{class:Ce.contentNode,key:y},y.render()):y instanceof HTMLElement?(0,x.u)("div",{afterCreate:this._attachToNode,bind:y,class:Ce.contentNode,key:y}):(0,Fi.o)(y)?(0,x.u)("div",{afterCreate:this._attachToNode,bind:y.domNode,class:Ce.contentNode,key:y}):null}_attachToNode(y){y.appendChild(this)}};return g=(0,F._)([(0,S.j)("esri.widgets.Feature.support.FeatureContentMixin")],g),g};var $i;const Jn={title:!0,content:!0,lastEditedInfo:!0},Xn="relationship-handles";let xe=$i=class extends(Qn(U.Z)){constructor(h,g){super(h,g),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements={...Jn},this.viewModel=new Ui}initialize(){this.addHandles((0,T.YP)(()=>this.viewModel?.contentViewModels,()=>this._setupContentWidgets(),T.nn))}loadDependencies(){return(0,ht.h)({notice:()=>Promise.all([w.e(2115),w.e(6083),w.e(8592),w.e(2205)]).then(w.bind(w,72205)),loader:()=>Promise.all([w.e(2115),w.e(6083),w.e(5597)]).then(w.bind(w,55597))})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(h){this.viewModel.graphic=h}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(h){this.viewModel.defaultPopupTemplateEnabled=h}get isTable(){return this.viewModel.isTable}get icon(){return"polygon"}set icon(h){this._overrideIfSome("icon",h)}get label(){return this.messages?.widgetLabel??""}set label(h){this._overrideIfSome("label",h)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(h){this.viewModel.spatialReference=h}get timeZone(){return this.viewModel.timeZone}set timeZone(h){this.viewModel.timeZone=h}get title(){return this.viewModel.title}castVisibleElements(h){return{...Jn,...h}}get map(){return this.viewModel.map}set map(h){this.viewModel.map=h}get view(){return this.viewModel.view}set view(h){this.viewModel.view=h}setActiveMedia(h,g){return this.viewModel.setActiveMedia(h,g)}nextMedia(h){return this.viewModel.nextMedia(h)}previousMedia(h){return this.viewModel.previousMedia(h)}render(){const{state:h}=this.viewModel,g=(0,x.u)("div",{class:Ce.container,key:"container"},this._renderTitle(),"error"===h?this._renderError():"loading"===h?this._renderLoading():this._renderContentContainer());return(0,x.u)("div",{class:this.classes(Ce.base,X.z.widget)},g)}_renderError(){const{messagesCommon:h,messages:g,visibleElements:y}=this;return(0,x.u)("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},y.title?(0,x.u)("div",{key:"error-title",slot:"title"},h.errorMessage):null,(0,x.u)("div",{key:"error-message",slot:"message"},g.loadingError))}_renderLoading(){return(0,x.u)("div",{class:Ce.loadingSpinnerContainer,key:"loading-container"},(0,x.u)("calcite-loader",{inline:!0,label:""}))}_renderContentContainer(){const{visibleElements:h}=this;return h.content?(0,x.u)("div",{class:Ce.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){const{visibleElements:h,title:g}=this;return h.title?(0,x.u)(bi.X,{class:Ce.title,innerHTML:g,level:this.headingLevel}):null}_renderContent(){const h=this.viewModel.content,g="content";if(!h)return null;if(Array.isArray(h))return h.length?(0,x.u)("div",{class:Ce.contentNode,key:`${g}-content-elements`},h.map(this._renderContentElement,this)):null;if("string"==typeof h){const y=this._contentWidgets[0];return!y||y.destroyed?null:(0,x.u)("div",{class:this.classes(Ce.contentNode,Ce.contentNodeText),key:`${g}-content`},y.render())}return this.renderNodeContent(h)}_renderContentElement(h,g){const{visibleElements:y}=this;if("boolean"!=typeof y.content&&!y.content?.[h.type])return null;switch(h.type){case"attachments":return this._renderAttachments(g);case"custom":return this._renderCustom(h,g);case"fields":return this._renderFields(g);case"media":return this._renderMedia(g);case"text":return this._renderText(h,g);case"expression":return this._renderExpression(g);case"relationship":return this._renderRelationship(g);default:return null}}_renderAttachments(h){const g=this._contentWidgets[h];if(!g||g.destroyed)return null;const{state:y,attachmentInfos:v}=g.viewModel;return"loading"===y||v.length>0?(0,x.u)("div",{class:this.classes(Ce.contentElement),key:this._buildKey("attachments-element",h)},g.render()):null}_renderRelationship(h){const g=this._contentWidgets[h];return g&&!g.destroyed&&this.flowItems?(0,x.u)("div",{class:Ce.contentElement,key:this._buildKey("relationship-element",h)},g.render()):null}_renderExpression(h){const g=this._contentWidgets[h];return!g||g.destroyed?null:(0,x.u)("div",{class:Ce.contentElement,key:this._buildKey("expression-element",h)},g.render())}_renderCustom(h,g){const{creator:y}=h,v=this._contentWidgets[g];return!v||v.destroyed?null:y?(0,x.u)("div",{class:Ce.contentElement,key:this._buildKey("custom-element",g)},v.render()):null}_renderFields(h){const g=this._contentWidgets[h];return!g||g.destroyed?null:(0,x.u)("div",{class:Ce.contentElement,key:this._buildKey("fields-element",h)},g.render())}_renderMedia(h){const g=this._contentWidgets[h];return!g||g.destroyed?null:(0,x.u)("div",{class:Ce.contentElement,key:this._buildKey("media-element",h)},g.render())}_renderLastEditInfo(){const{visibleElements:h,messages:g}=this,{lastEditInfo:y}=this.viewModel;if(!y||!h.lastEditedInfo)return null;const{date:v,user:b}=y,I=(0,nt.n)("edit"===y.type?b?g.lastEditedByUser:g.lastEdited:b?g.lastCreatedByUser:g.lastCreated,{date:v,user:b});return(0,x.u)("div",{class:this.classes(Ce.lastEditedInfo,Ce.contentElement),key:"edit-info-element"},I)}_renderText(h,g){const v=this._contentWidgets[g];return!v||v.destroyed?null:h.text?(0,x.u)("div",{class:this.classes(Ce.contentElement,Ce.text),key:this._buildKey("text-element",g)},v.render()):null}_buildKey(h,...g){return`${h}__${this.viewModel?.graphic?.uid||"0"}-${g.join("-")}`}_destroyContentWidget(h){h&&(h.viewModel=null,!h.destroyed&&h.destroy())}_destroyContentWidgets(){this.removeHandles(Xn),this._contentWidgets.forEach(h=>this._destroyContentWidget(h)),this._contentWidgets=[]}_addFeatureRelationshipHandles(h){const{flowItems:g,visibleElements:y}=this;this.addHandles([(0,T.on)(()=>h,"select-record",({featureViewModel:v})=>{g&&(v.abilities={relationshipContent:!0},g.push(new $i({flowItems:g,viewModel:v,visibleElements:y})))}),(0,T.on)(()=>h,"show-all-records",()=>{if(!g)return;const{viewModel:v}=h;v.showAllEnabled=!0;const b=new Hn({visibleElements:{title:!1,description:!1},viewModel:v});this._addFeatureRelationshipHandles(b),g.push(b)})],Xn)}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:h,visibleElements:g}=this,y=this.viewModel?.content,{contentViewModels:v}=this.viewModel;if(Array.isArray(y))y.forEach((b,C)=>{if("attachments"===b.type&&(this._contentWidgets[C]=new to({displayType:b.displayType,headingLevel:g.title&&h<6?h+1:h,viewModel:v[C]})),"fields"===b.type&&(this._contentWidgets[C]=new xn({viewModel:v[C]})),"media"===b.type&&(this._contentWidgets[C]=new Rn({viewModel:v[C]})),"text"===b.type&&(this._contentWidgets[C]=new Vt({viewModel:v[C]})),"custom"===b.type&&(this._contentWidgets[C]=new Vt({viewModel:v[C]})),"expression"===b.type&&(this._contentWidgets[C]=new Ho({viewModel:v[C]})),"relationship"===b.type){const I=new Hn({viewModel:v[C]});this._addFeatureRelationshipHandles(I),this._contentWidgets[C]=I}},this);else{const b=v[0];b&&!b.destroyed&&(this._contentWidgets[0]=new Vt({viewModel:b}))}this.scheduleRender()}};(0,F._)([(0,M.Cb)()],xe.prototype,"graphic",null),(0,F._)([(0,M.Cb)()],xe.prototype,"defaultPopupTemplateEnabled",null),(0,F._)([(0,M.Cb)()],xe.prototype,"flowItems",void 0),(0,F._)([(0,M.Cb)()],xe.prototype,"headingLevel",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],xe.prototype,"isTable",null),(0,F._)([(0,M.Cb)()],xe.prototype,"icon",null),(0,F._)([(0,M.Cb)()],xe.prototype,"label",null),(0,F._)([(0,M.Cb)(),(0,Be.H)("esri/widgets/Feature/t9n/Feature")],xe.prototype,"messages",void 0),(0,F._)([(0,M.Cb)(),(0,Be.H)("esri/t9n/common")],xe.prototype,"messagesCommon",void 0),(0,F._)([(0,M.Cb)()],xe.prototype,"spatialReference",null),(0,F._)([(0,M.Cb)()],xe.prototype,"timeZone",null),(0,F._)([(0,M.Cb)({readOnly:!0})],xe.prototype,"title",null),(0,F._)([(0,M.Cb)()],xe.prototype,"visibleElements",void 0),(0,F._)([(0,Z.p)("visibleElements")],xe.prototype,"castVisibleElements",null),(0,F._)([(0,M.Cb)()],xe.prototype,"map",null),(0,F._)([(0,M.Cb)()],xe.prototype,"view",null),(0,F._)([(0,M.Cb)({type:Ui})],xe.prototype,"viewModel",void 0),xe=$i=(0,F._)([(0,S.j)("esri.widgets.Feature")],xe);const sr=xe;var or=w(88278),Di=w(83821);let mt=class extends or.Z.EventedAccessor{constructor(h){super(h),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([(0,T.gx)(()=>{const g=this.screenLocationEnabled?this.view:null;return g?[g.size,"3d"===g.type?g.camera:g.viewpoint]:null},()=>this.notifyChange("screenLocation")),(0,T.YP)(()=>this.screenLocation,(g,y)=>{null!=g&&null!=y&&this.emit("view-change")})])}destroy(){this.view=null}get screenLocation(){const{location:h,view:g,screenLocationEnabled:y}=this,v=g?.spatialReference,b=v?(0,Di.projectOrLoad)(h,v).geometry:null;return y&&b&&g?.ready?g.toScreen(b):null}};(0,F._)([(0,M.Cb)()],mt.prototype,"location",void 0),(0,F._)([(0,M.Cb)()],mt.prototype,"screenLocation",null),(0,F._)([(0,M.Cb)()],mt.prototype,"screenLocationEnabled",void 0),(0,F._)([(0,M.Cb)()],mt.prototype,"view",void 0),mt=(0,F._)([(0,S.j)("esri.widgets.support.AnchorElementViewModel")],mt);const kn=mt;let Jt=class extends kn{constructor(h){super(h),this.visible=!1}};(0,F._)([(0,M.Cb)()],Jt.prototype,"visible",void 0),Jt=(0,F._)([(0,S.j)("esri.widgets.Spinner.SpinnerViewModel")],Jt);const qn=Jt,Vi="esri-spinner",Bi_base=Vi,Bi_spinnerStart=`${Vi}--start`,Bi_spinnerFinish=`${Vi}--finish`;let ft=class extends U.Z{constructor(h,g){super(h,g),this._animationDelay=500,this._animationPromise=null,this.viewModel=new qn}initialize(){this.addHandles((0,T.YP)(()=>this.visible,h=>this._visibleChange(h)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(h){this.viewModel.location=h}get view(){return this.viewModel.view}set view(h){this.viewModel.view=h}get visible(){return this.viewModel.visible}set visible(h){this.viewModel.visible=h}show(h){const{location:g,promise:y}=h??{};g&&(this.viewModel.location=g),this.visible=!0,y&&y.catch(()=>{}).then(()=>this.hide())}hide(){this.visible=!1}render(){const{visible:h}=this,{screenLocation:g}=this.viewModel,y=!!g,C={[Bi_spinnerStart]:h&&y,[Bi_spinnerFinish]:!h&&y},I=this._getPositionStyles();return(0,x.u)("div",{class:this.classes(Bi_base,C),styles:I})}_visibleChange(h){if(h)return void(this.viewModel.screenLocationEnabled=!0);const g=(0,we.e4)(this._animationDelay);this._animationPromise=g,g.catch(()=>{}).then(()=>{this._animationPromise===g&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:h,view:g}=this.viewModel;if(null==g||null==h)return{};const{padding:y}=g;return{left:h.x-y.left+"px",top:h.y-y.top+"px"}}};(0,F._)([(0,M.Cb)()],ft.prototype,"location",null),(0,F._)([(0,M.Cb)()],ft.prototype,"view",null),(0,F._)([(0,M.Cb)({type:qn})],ft.prototype,"viewModel",void 0),(0,F._)([(0,M.Cb)()],ft.prototype,"visible",null),ft=(0,F._)([(0,S.j)("esri.widgets.Spinner")],ft);const rr=ft,Ne="esri-features",Pe={icon:`${Ne}__icon`,actionImage:`${Ne}__action-image`,base:Ne,container:`${Ne}__container`,contentContainer:`${Ne}__content-container`,contentFeature:`${Ne}__content-feature`,flowItemCollapsed:`${Ne}__flow-item--collapsed`,header:`${Ne}__header`,footer:`${Ne}__footer`,featureMenuObserver:`${Ne}__feature-menu-observer`,actionExit:`${Ne}__action--exit`,loader:`${Ne}__loader`,featuresHeading:`${Ne}__heading`,paginationActionBar:`${Ne}__pagination-action-bar`,paginationPrevious:`${Ne}__pagination-previous`,paginationNext:`${Ne}__pagination-next`};let gt=class extends U.Z{constructor(h,g){super(h,g),this.messages=null,this.closed=!1,this.closable=!0,this._handleOpenRelatedFeature=y=>{this.emit("open-related-feature",{feature:y})}}loadDependencies(){return(0,ht.h)({action:()=>Promise.all([w.e(2115),w.e(6083),w.e(5782),w.e(8507)]).then(w.bind(w,18507)),"flow-item":()=>Promise.all([w.e(2115),w.e(6083),w.e(5782),w.e(2805),w.e(4920),w.e(154),w.e(8592),w.e(6546)]).then(w.bind(w,66546))})}render(){const{flowItems:h}=this,g=h?.toArray();return(0,x.u)(x.D,null,g?.map(y=>this._renderRelatedRecordsFlowItem(y)))}_handleCloseClick(){this.emit("close")}_handleExitClick(){this.emit("exit")}_handleRelatedRecordsBackClick(){const h=this.flowItems?.pop();h&&("showAllEnabled"in h.viewModel&&(h.viewModel.showAllEnabled=!1),h&&(h.viewModel=null,h.destroy()))}_renderRelatedRecordsFlowItem(h){const{messages:g,closable:y,closed:v}=this,b="graphic"in h&&!h.isTable&&h.graphic?.geometry,C=g.exitRelatedRecords,I=g.selectFeature;return(0,x.u)("calcite-flow-item",{bind:this,closable:y,closed:v,description:this._getRelatedRecordsFlowItemDescription(h),heading:h.title??"",key:`flow-item-${h.viewModel.uid}`,onCalciteFlowItemBack:_=>{_.preventDefault(),this._handleRelatedRecordsBackClick()},onCalciteFlowItemClose:this._handleCloseClick},(0,x.u)("calcite-action",{appearance:"transparent",bind:this,class:Pe.actionExit,icon:"move-up",key:"exit-related-records-action",onclick:this._handleExitClick,slot:"header-actions-start",text:C,title:C}),b?(0,x.u)("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-related-feature-action",onclick:()=>this._handleOpenRelatedFeature(h),slot:"header-actions-end",text:I,title:I}):null,(0,x.u)("div",{class:Pe.container},h.render()))}_getRelatedRecordsFlowItemDescription(h){return"featureCountDescription"in h?h.featureCountDescription:h.viewModel.description??""}};(0,F._)([(0,M.Cb)()],gt.prototype,"flowItems",void 0),(0,F._)([(0,M.Cb)(),(0,Be.H)("esri/widgets/Features/t9n/Features")],gt.prototype,"messages",void 0),(0,F._)([(0,M.Cb)()],gt.prototype,"closed",void 0),(0,F._)([(0,M.Cb)()],gt.prototype,"closable",void 0),gt=(0,F._)([(0,S.j)("esri.widgets.Features.FeaturesRelatedRecords")],gt);const lr=gt;w(71950);var yt=w(56295),ar=w(19994);class dr{constructor(g){this._observable=new ar.s,this._set=new Set(g)}get size(){return(0,yt.it)(this._observable),this._set.size}add(g){const y=this._set.size;return this._set.add(g),this._set.size!==y&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(g){const y=this._set.delete(g);return y&&this._observable.notify(),y}entries(){return(0,yt.it)(this._observable),this._set.entries()}forEach(g,y){(0,yt.it)(this._observable),this._set.forEach((v,b)=>g.call(y,v,b,this),y)}has(g){return(0,yt.it)(this._observable),this._set.has(g)}keys(){return(0,yt.it)(this._observable),this._set.keys()}values(){return(0,yt.it)(this._observable),this._set.values()}[Symbol.iterator](){return(0,yt.it)(this._observable),this._set[Symbol.iterator]()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}}var ur=w(48230),es=w(95060),ts=w(38826),is=w(64579),hr=w(72031),ns=w(25917);const vt=k.Z.ofType({key:"type",defaultKeyValue:"button",base:hr.Z,typeMap:{button:J.Z,toggle:ns.Z}}),dt=new J.Z({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"}),ji=new J.Z({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:"esri-icon-trash"}),bt=new J.Z({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"}),st=new ns.Z({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:"esri-icon-table",value:!1}),Xt=()=>B.Z.getLogger("esri.widgets.Popup.PopupViewModel"),mr=h=>{const{event:g,view:y,viewModel:v}=h,{action:b}=g;if(!b)return Promise.reject(new D.Z("trigger-action:missing-arguments","Event has no action"));const{disabled:C,id:I}=b;if(!I)return Promise.reject(new D.Z("trigger-action:invalid-action","action.id is missing"));if(C)return Promise.reject(new D.Z("trigger-action:invalid-action","Action is disabled"));if(I===dt.id)return function gr(h){return Wi.apply(this,arguments)}(v).catch(we.H9);if(I===bt.id)return function yr(h){return Hi.apply(this,arguments)}(v);if(I===st.id)return v.browseClusterEnabled=!v.browseClusterEnabled,v.featureMenuOpen=v.browseClusterEnabled,Promise.resolve();if(I===ji.id){v.visible=!1;const{selectedFeature:_}=v;if(!_)return Promise.reject(new D.Z(`trigger-action:${ji.id}`,"selectedFeature is required",{selectedFeature:_}));const{sourceLayer:A}=_;return A?A.remove(_):y?.graphics.remove(_),Promise.resolve()}return Promise.resolve()};function ss(h){const{selectedFeature:g,location:y,view:v}=h;return v?g??y??null:null}function Ct(h){return!!h&&h.isAggregate&&"cluster"===h.sourceLayer?.featureReduction?.type}function zi(){return zi=(0,R.Z)(function*(h,g){if("3d"!==g?.type||!h||"esri.Graphic"!==h.declaredClass)return!0;const y=g.getViewForGraphic(h);if(y&&"whenGraphicBounds"in y){let v=null;try{v=yield y.whenGraphicBounds(h,{useViewElevation:!0})}catch{}return!v||!v.boundingBox||v.boundingBox[0]===v.boundingBox[3]&&v.boundingBox[1]===v.boundingBox[4]&&v.boundingBox[2]===v.boundingBox[5]}return!0}),zi.apply(this,arguments)}function Wi(){return Wi=(0,R.Z)(function*(h){const{location:g,selectedFeature:y,view:v,zoomFactor:b}=h,C=ss(h);if(!v||!C){const E=new D.Z("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:C,view:v});throw Xt().error(E),E}const I=v.scale/b,_=h.selectedFeature?.geometry,A=_??g,P=null!=A&&"point"===A.type&&(yield function fr(h,g){return zi.apply(this,arguments)}(y,v));dt.active=!0,dt.disabled=!0;try{yield h.zoomTo({target:{target:C,scale:P?I:void 0}})}catch{const L=new D.Z("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:y});Xt().error(L)}finally{dt.active=!1,dt.disabled=!1,h.zoomToLocation=null,P&&(h.location=A)}}),Wi.apply(this,arguments)}function Hi(){return Hi=(0,R.Z)(function*(h){const{selectedFeature:g,view:y}=h;if("2d"!==y?.type){const I=new D.Z("zoomToCluster:invalid-view","View must be 2d MapView.",{view:y});throw Xt().error(I),I}if(!g||!Ct(g)){const I=new D.Z("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:g});throw Xt().error(I),I}const[v,b]=yield Ki(y,g);bt.active=!0,bt.disabled=!0;const{extent:C}=yield v.queryExtent(b);C&&(yield h.zoomTo({target:C})),bt.active=!1,bt.disabled=!1}),Hi.apply(this,arguments)}function Yi(){return Yi=(0,R.Z)(function*(h){const{view:g,selectedFeature:y}=h;if(!g||!y)return;const[v,b]=yield Ki(g,y),{extent:C}=yield v.queryExtent(b);h.selectedClusterBoundaryFeature.geometry=C,g.graphics.add(h.selectedClusterBoundaryFeature)}),Yi.apply(this,arguments)}function Gi(){return Gi=(0,R.Z)(function*(h){const{selectedFeature:g,view:y}=h;if(!y||!g)return;const[v,b]=yield Ki(y,g);st.active=!0,st.disabled=!0;const{features:C}=yield v.queryFeatures(b);st.active=!1,st.disabled=!1,st.value=!0,h?.open({features:[g].concat(C),featureMenuOpen:!0})}),Gi.apply(this,arguments)}function Ki(h,g){return Qi.apply(this,arguments)}function Qi(){return Qi=(0,R.Z)(function*(h,g){const y=yield h.whenLayerView(g.sourceLayer),v=y.createQuery(),b=g.getObjectId();return v.aggregateIds=null!=b?[b]:[],[y,v]}),Qi.apply(this,arguments)}var wr=w(42704),Fr=w(89481);const Ji="location-scale-handle";let kt=null,K=class extends((0,wr._)(kn)){constructor(h){var g;super(h),g=this,this._pendingPromises=new dr,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this.actions=new vt,this.activeFeature=null,this.autoCloseEnabled=!1,this.browseClusterEnabled=!1,this.content=null,this.defaultPopupTemplateEnabled=!1,this.featurePage=null,this.featuresPerPage=20,this.featureMenuOpen=!1,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new Mt.Z({symbol:new Fr.Z({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null,this._debouncedLocationUpdate=(0,we.Ds)(function(){var y=(0,R.Z)(function*(v){const{spatialReference:b}=g,C=g.selectedFeature?.geometry?.type,I=g.location??v;if(C&&"mesh"!==C&&b&&I&&g.selectedFeature)if("point"!==C)try{const _=g.selectedFeature;let A=_.geometry;const P=g._getHighlightLayer(_),E=_.getObjectId();if(!P||!g.view)return;if(E){const L=g.view?.allLayerViews.find(j=>j.layer.uid===P.uid);if(!L||!("queryFeatures"in L))return;const O=L.createQuery();O.outSpatialReference=b,O.objectIds=[E],O.returnGeometry=!0;const{features:$}=yield L.queryFeatures(O);A=$[0]?.geometry}if(!A||"mesh"===A.type)return;if(A=(0,Di.project)(A,b),kt||(kt=yield w.e(3686).then(w.bind(w,23686))),!(yield kt.intersects(A,I))){const L=(yield kt.nearestCoordinate(A,I)).coordinate??I;g.selectedFeature===_&&(g.location=L)}}catch(_){(0,we.D_)(_)||B.Z.getLogger(g).error(_)}else g.location=Te(g.selectedFeature.geometry)??I});return function(v){return y.apply(this,arguments)}}())}initialize(){this.addHandles([this.on("view-change",()=>this._autoClose()),(0,T.YP)(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),(0,T.YP)(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),(0,T.YP)(()=>this.view?.animation?.state,h=>this._animationStateChange(h)),(0,T.YP)(()=>this.location,h=>this._locationChange(h)),(0,T.YP)(()=>this.selectedFeature,h=>this._selectedFeatureChange(h)),(0,T.YP)(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),(0,T.YP)(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),(0,T.YP)(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",h=>mr({event:h,viewModel:this,view:this.view})),(0,T.gx)(()=>!this.waitingForResult,()=>this._waitingForResultChange(),T.Z_),(0,T.YP)(()=>[this.features,this.map,this.spatialReference,this.timeZone],()=>this._updateFeatureVMs()),(0,T.YP)(()=>this.view?.scale,()=>this._viewScaleChange()),(0,T.gx)(()=>!this.visible,()=>this.browseClusterEnabled=!1),(0,T.YP)(()=>this.browseClusterEnabled,h=>h?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null,this.map=null,this.spatialReference=null,this.timeZone=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const h=this._get("allActions")||new vt;h.removeAll();const{actions:g,defaultActions:y,defaultPopupTemplateEnabled:v,includeDefaultActions:b,selectedFeature:C}=this,I=b?y.concat(g):g,_=C&&("function"==typeof C.getEffectivePopupTemplate&&C.getEffectivePopupTemplate(v)||C.popupTemplate),A=_?.actions;return(_?.overwriteActions?A:A?.concat(I)??I)?.filter(Boolean).forEach(E=>h.add(E)),h}get defaultActions(){const h=this._get("defaultActions")||new vt;return h.removeAll(),h.addMany(Ct(this.selectedFeature)?[bt.clone(),st.clone()]:[dt.clone()]),h}get featureCount(){return this.features.length}set features(h){const g=h||[];this._set("features",g);const{pendingPromisesCount:y,promiseCount:v,selectedFeatureIndex:b}=this,C=v&&g.length;C&&y&&-1===b?this.selectedFeatureIndex=0:C&&-1!==b||(this.selectedFeatureIndex=g.length?0:-1)}set location(h){let g=h;const y=this.spatialReference?.isWebMercator;h?.spatialReference?.isWGS84&&y&&(g=(0,ur.$)(h)),this._set("location",g)}get map(){return this.view?.map??null}set map(h){this._override("map",h)}get pendingPromisesCount(){return this._pendingPromises.size}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(h){this._pendingPromises.clear(),this.features=[],Array.isArray(h)&&h.length?(this._set("promises",h),(h=h.slice(0)).forEach(g=>this._pendingPromises.add(g)),h.reduce((g,y)=>g.finally(()=>y.then(v=>{this._pendingPromises.has(y)&&this._updateFeatures(v)}).finally(()=>this._pendingPromises.delete(y)).catch(()=>{})),Promise.resolve())):this._set("promises",[])}get selectedFeature(){const{features:h,selectedFeatureIndex:g}=this;return-1===g?null:h[g]||null}get selectedFeatureIndex(){const h=this._get("selectedFeatureIndex");return"number"==typeof h?h:-1}set selectedFeatureIndex(h){const{featureCount:g}=this;h=isNaN(h)||h<-1||!g?-1:(h+g)%g,this.activeFeature=null,this._set("selectedFeatureIndex",h)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(h){this._override("spatialReference",h)}get state(){const{view:h,map:g}=this;return h?h.ready?"ready":"disabled":g?"ready":"disabled"}get timeZone(){return this.view?.timeZone??ii.By}set timeZone(h){this._overrideIfSome("timeZone",h)}get waitingForContents(){return this.featureViewModels.some(h=>h.waitingForContent)}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}centerAtLocation(){const{view:h}=this,g=ss(this);return g&&h?this.callGoTo({target:{target:g,scale:h.scale}}):Promise.reject(new D.Z("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:g,view:h}))}zoomTo(h){return this.callGoTo(h)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(h,g){const{view:y}=this;if(!y||!h)throw new D.Z("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:h,view:y});return y.fetchPopupFeatures(h,{pointerType:g?.event?.pointerType,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:g?.signal})}open(h){const g={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...h,visible:!0},{fetchFeatures:y}=g;delete g.fetchFeatures,y&&this._setFetchFeaturesPromises(g.location);const v=["actionsMenuOpen","collapsed"];for(const b of v)delete g[b];this.set(g)}triggerAction(h){const g=this.allActions.at(h);g&&!g.disabled&&this.emit("trigger-action",{action:g})}next(){return this.selectedFeatureIndex++,this}previous(){return this.selectedFeatureIndex--,this}disableClusterBrowsing(){(function Cr(h){st.value=!1;const g=h.features.filter(y=>Ct(y));g.length&&(h.features=g)})(this),this._clearBrowsedClusterGraphics()}enableClusterBrowsing(){var h=this;return(0,R.Z)(function*(){const{view:g,selectedFeature:y}=h;"2d"===g?.type?Ct(y)?(yield function vr(h){return Yi.apply(this,arguments)}(h),yield function br(h){return Gi.apply(this,arguments)}(h)):B.Z.getLogger(h).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",y):B.Z.getLogger(h).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",y)})()}handleViewClick(h){this._fetchFeaturesAndOpen(h)}_animationStateChange(h){this.zoomToLocation||(dt.disabled="waiting-for-target"===h)}_clearBrowsedClusterGraphics(){const h=[this.selectedClusterBoundaryFeature,this._selectedClusterFeature].filter(xt.pC);this.view?.graphics?.removeMany(h),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(Ct(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(h){const{selectedFeature:g,updateLocationEnabled:y,view:v}=this;v&&y&&h&&(!g||g.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:h,featureCount:g,featurePage:y,featuresPerPage:v,featureViewModels:b}=this;if(null===y)return;const C=((y-1)*v+g)%g;b.slice(C,C+v).forEach((_,A)=>{_&&(_.graphic??=h[C+A])})}_selectedFeatureChange(h){var g=this;return(0,R.Z)(function*(){const{location:y,updateLocationEnabled:v,view:b}=g;if(!h||!b)return;if(g.browseClusterEnabled)return g._selectedClusterFeature&&(b.graphics.remove(g._selectedClusterFeature),g._selectedClusterFeature=null),Ct(h)?void 0:(h.symbol=yield(0,ts.zd)(h),g._selectedClusterFeature=h,void b.graphics.add(g._selectedClusterFeature));const C=h.sourceLayer?.type;if("map-image"!==C&&"imagery"!==C&&"imagery-tile"!==C||(h.symbol=yield(0,ts.zd)(h)),!v&&y||!h.geometry){if(v&&!h.geometry){yield g.centerAtLocation();const I=b.center?.clone();I&&(g.location=I)}}else g.location=Te(h.geometry)})()}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(h){var g=this;return(0,R.Z)(function*(){const{pendingFeatures:y}=yield g._fetchFeaturesWithController({mapPoint:h});g.promises=y})()}_destroyFeatureVMs(){this.featureViewModels.forEach(h=>h&&!h.destroyed&&h.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:h,features:g,featureViewModels:y,view:v,spatialReference:b,map:C,timeZone:I,location:_}=this;if(Ct(h)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!g?.length)return;const A=y.slice(0),P=[];g.forEach((E,L)=>{if(!E)return;let O=null;if(A.some(($,j)=>($&&$.graphic===E&&(O=$,A.splice(j,1)),!!O)),O)P[L]=O;else{const $=new Ui({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:b,graphic:E===h?E:null,location:_,map:C,view:v,timeZone:I});P[L]=$}}),A.forEach(E=>E&&!E.destroyed&&E.destroy()),this._set("featureViewModels",P)}_getScreenPoint(h,g){var y=this;return(0,R.Z)(function*(){const{spatialReference:v,view:b}=y;if(!b)return null;yield b?.when();const C=h?.spatialReference;return C&&v?(yield(0,Di.initializeProjection)(C,v,null,g),b.toScreen(h)):null})()}_cancelFetchingFeatures(){const h=this._fetchFeaturesController;h&&h.abort(),this._fetchFeaturesController=null}_projectScreenPointAndFetchFeatures({mapPoint:h,screenPoint:g,event:y,signal:v}){var b=this;return(0,R.Z)(function*(){return b.fetchFeatures(g??(yield b._getScreenPoint(h??b.location,{signal:v})),{signal:v,event:y})})()}_fetchFeaturesWithController({mapPoint:h,screenPoint:g,event:y}){this._cancelFetchingFeatures();const v=new AbortController,{signal:b}=v;this._fetchFeaturesController=v;const C=this._projectScreenPointAndFetchFeatures({mapPoint:h,screenPoint:g,signal:b,event:y});return C.catch(()=>{}).then(()=>{this._fetchFeaturesController=null}),C}_fetchFeaturesAndOpen(h){var g=this;return(0,R.Z)(function*(){const{mapPoint:y,screenPoint:v}=h,{view:b}=g;g.removeHandles(Ji),g.addHandles([(0,T.YP)(()=>g.view?.scale,()=>g._debouncedLocationUpdate(y).catch(I=>{(0,we.D_)(I)||B.Z.getLogger(g).error(I)})),(0,T.gx)(()=>!g.visible,()=>{g.removeHandles(Ji)},{once:!0})],Ji);const{pendingFeatures:C}=yield g._fetchFeaturesWithController({mapPoint:y,screenPoint:v,event:h});b?.popup&&"open"in b.popup&&b.popup.open({location:y??void 0,promises:C})})()}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getLayerView(h,g){return(0,R.Z)(function*(){return yield h.when(),h.whenLayerView(g)})()}_getHighlightLayer(h){const{layer:g,sourceLayer:y}=h;return y&&"layer"in y&&y.layer?y.layer:"map-notes"===y?.type||"subtype-group"===y?.type?y:g}_getHighlightTarget(h,g,y){if(function _r(h,g){return"building-scene"===h||"2d"===g&&("map-image"===h||"tile"===h||"imagery"===h||"imagery-tile"===h)}(g.type,y))return h;const v=h.getObjectId();if(null!=v)return v;const b="imagery"===g.type?void 0:"objectIdField"in g?g.objectIdField||"OBJECTID":null,C=h.attributes;return C&&b&&C[b]||h}_mapIncludesLayer(h){return!!this.map?.allLayers?.includes(h)}_highlightActiveFeature(){var h=this;return(0,R.Z)(function*(){const g="highlight-active-feature";h.removeHandles(g);const{highlightEnabled:y,view:v,activeFeature:b,visible:C}=h;if(!(b&&v&&y&&C))return;const I=h._getHighlightLayer(b);if(!(I&&I instanceof es.Z&&h._mapIncludesLayer(I)))return;const _=h._getLayerView(v,I);h._highlightActiveFeaturePromise=_;const A=yield _;if(!(A&&(0,is.tl)(A)&&h._highlightActiveFeaturePromise===_&&h.activeFeature&&h.highlightEnabled))return;const P=A.highlight(h._getHighlightTarget(b,I,v.type));h.addHandles(P,g)})()}_highlightSelectedFeature(){var h=this;return(0,R.Z)(function*(){const g="highlight-selected-feature";h.removeHandles(g);const{selectedFeature:y,highlightEnabled:v,view:b,visible:C}=h;if(!(y&&b&&v&&C))return;const I=h._getHighlightLayer(y);if(!(I&&I instanceof es.Z&&h._mapIncludesLayer(I)))return;const _=h._getLayerView(b,I);h._highlightSelectedFeaturePromise=_;const A=yield _;if(!(A&&(0,is.tl)(A)&&h._highlightSelectedFeaturePromise===_&&h.selectedFeature&&h.highlightEnabled&&h.visible))return;const P=A.highlight(h._getHighlightTarget(y,I,b.type));h.addHandles(P,g)})()}_updateFeatures(h){const{features:g}=this,y=h.filter(v=>!g.includes(v));y?.length&&(this.features=g.concat(y))}};(0,F._)([(0,M.Cb)()],K.prototype,"_fetchFeaturesController",void 0),(0,F._)([(0,M.Cb)({type:vt})],K.prototype,"actions",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],K.prototype,"active",null),(0,F._)([(0,M.Cb)()],K.prototype,"activeFeature",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],K.prototype,"allActions",null),(0,F._)([(0,M.Cb)()],K.prototype,"autoCloseEnabled",void 0),(0,F._)([(0,M.Cb)()],K.prototype,"browseClusterEnabled",void 0),(0,F._)([(0,M.Cb)()],K.prototype,"content",void 0),(0,F._)([(0,M.Cb)({type:vt,readOnly:!0})],K.prototype,"defaultActions",null),(0,F._)([(0,M.Cb)({type:Boolean})],K.prototype,"defaultPopupTemplateEnabled",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],K.prototype,"featureCount",null),(0,F._)([(0,M.Cb)()],K.prototype,"featurePage",void 0),(0,F._)([(0,M.Cb)({value:[]})],K.prototype,"features",null),(0,F._)([(0,M.Cb)()],K.prototype,"featuresPerPage",void 0),(0,F._)([(0,M.Cb)()],K.prototype,"featureMenuOpen",void 0),(0,F._)([(0,M.Cb)()],K.prototype,"featureViewModelAbilities",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],K.prototype,"featureViewModels",void 0),(0,F._)([(0,M.Cb)()],K.prototype,"highlightEnabled",void 0),(0,F._)([(0,M.Cb)()],K.prototype,"includeDefaultActions",void 0),(0,F._)([(0,M.Cb)({type:Ai.Z})],K.prototype,"location",null),(0,F._)([(0,M.Cb)()],K.prototype,"map",null),(0,F._)([(0,M.Cb)({readOnly:!0})],K.prototype,"pendingPromisesCount",null),(0,F._)([(0,M.Cb)({readOnly:!0})],K.prototype,"promiseCount",null),(0,F._)([(0,M.Cb)()],K.prototype,"promises",null),(0,F._)([(0,M.Cb)({readOnly:!0})],K.prototype,"selectedClusterBoundaryFeature",void 0),(0,F._)([(0,M.Cb)({value:null,readOnly:!0})],K.prototype,"selectedFeature",null),(0,F._)([(0,M.Cb)({value:-1})],K.prototype,"selectedFeatureIndex",null),(0,F._)([(0,M.Cb)({readOnly:!0})],K.prototype,"selectedFeatureViewModel",null),(0,F._)([(0,M.Cb)({readOnly:!0})],K.prototype,"state",null),(0,F._)([(0,M.Cb)()],K.prototype,"timeZone",null),(0,F._)([(0,M.Cb)()],K.prototype,"title",void 0),(0,F._)([(0,M.Cb)()],K.prototype,"updateLocationEnabled",void 0),(0,F._)([(0,M.Cb)()],K.prototype,"view",void 0),(0,F._)([(0,M.Cb)()],K.prototype,"visible",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],K.prototype,"waitingForContents",null),(0,F._)([(0,M.Cb)({readOnly:!0})],K.prototype,"waitingForResult",null),(0,F._)([(0,M.Cb)()],K.prototype,"zoomFactor",void 0),(0,F._)([(0,M.Cb)()],K.prototype,"zoomToLocation",void 0),(0,F._)([(0,M.Cb)()],K.prototype,"centerAtLocation",null),K=(0,F._)([(0,S.j)("esri.widgets.Features.FeaturesViewModel")],K);const Xi=K;let Ye=class extends qe.Z{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!1,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.flow=!0,this.heading=!0,this.spinner=!0}};(0,F._)([(0,M.Cb)({type:Boolean,nonNullable:!0})],Ye.prototype,"actionBar",void 0),(0,F._)([(0,M.Cb)({type:Boolean,nonNullable:!0})],Ye.prototype,"closeButton",void 0),(0,F._)([(0,M.Cb)({type:Boolean,nonNullable:!0})],Ye.prototype,"collapseButton",void 0),(0,F._)([(0,M.Cb)({type:Boolean,nonNullable:!0})],Ye.prototype,"featureNavigation",void 0),(0,F._)([(0,M.Cb)({type:Boolean,nonNullable:!0})],Ye.prototype,"featureListLayerTitle",void 0),(0,F._)([(0,M.Cb)({type:Boolean,nonNullable:!0})],Ye.prototype,"flow",void 0),(0,F._)([(0,M.Cb)({type:Boolean,nonNullable:!0})],Ye.prototype,"heading",void 0),(0,F._)([(0,M.Cb)({type:Boolean,nonNullable:!0})],Ye.prototype,"spinner",void 0),Ye=(0,F._)([(0,S.j)("esri.widgets.Features.FeaturesVisibleElements")],Ye);const os=Ye;var rs=w(92795);const ls="selected-index",as="features-spinner";function ds(h){return h?.declaredClass.startsWith("esri.layers.")??!1}let ee=class extends(Qn(U.Z)){constructor(h,g){var y;super(h,g),y=this,this._featureMenuIntersectionObserverCallback=([v])=>{v?.isIntersecting&&null!=this.viewModel.featurePage&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._featureMenuIntersectionObserverNode=null,this._focusOn=null,this._spinner=null,this._feature=null,this._relatedRecordsFlowItems=new k.Z,this._relatedRecordsWidget=new lr({flowItems:this._relatedRecordsFlowItems}),this._rootFlowItemNode=null,this._featureMenuViewportNode=null,this._actionBarMenuNode=null,this.collapsed=!1,this.featureNavigationTop=!1,this.headerActions=new vt,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new Xi,this.visibleElements=new os,this._renderAction=(v,b)=>{const C=this._getActionTitle(v),{type:I,active:_,uid:A,disabled:P,indicator:E}=v;return v.visible?(0,x.u)("calcite-action",{active:"toggle"===I&&v.value,appearance:"solid",bind:this,"data-action-uid":A,disabled:P,icon:this._getActionIcon(v),indicator:E,key:`action-${b}`,loading:_,onclick:this._triggerAction,scale:"s",text:C,title:this._hideActionText?C:void 0},this._getFallbackIcon(v)):null},this._openFeatureMenu=()=>{this.featureMenuOpen=!0,this._focusOn="menu-flow-item"},this._previousFeature=()=>{this.viewModel.selectedFeatureIndex--},this._nextFeature=()=>{this.viewModel.selectedFeatureIndex++},this._handleFeatureMenuBack=()=>{this.featureMenuOpen&&(this._focusOn="root-flow-item",this.featureMenuOpen=!1)},this._focusFlowItemNode=v=>{this._focusOn===v&&requestAnimationFrame((0,R.Z)(function*(){switch(v){case"menu-flow-item":yield y._featureMenuViewportNode?.setFocus();break;case"root-flow-item":yield y._rootFlowItemNode?.setFocus()}y._focusOn=null}))},this._focusFlowItemNodeThrottled=he(this._focusFlowItemNode,50),this._displaySpinnerThrottled=he(()=>this._displaySpinner(),0),this._addSelectedFeatureIndexHandle(),this.addHandles([this._displaySpinnerThrottled,this._focusFlowItemNodeThrottled,(0,T.YP)(()=>this.viewModel?.active,()=>this._toggleScreenLocationEnabled()),(0,T.YP)(()=>this.viewModel?.active,v=>this._relatedRecordsWidget.closed=!v),(0,T.YP)(()=>this.visibleElements?.closeButton,v=>this._relatedRecordsWidget.closable=v),(0,T.YP)(()=>this.visibleElements?.spinner,v=>this._spinnerEnabledChange(v)),(0,T.YP)(()=>this.viewModel?.view,(v,b)=>this._viewChange(v,b)),(0,T.YP)(()=>this.viewModel?.view?.ready,(v,b)=>this._viewReadyChange(v??!1,b??!1)),(0,T.YP)(()=>[this.viewModel?.waitingForResult,this.viewModel?.location],()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),(0,T.YP)(()=>this.viewModel?.screenLocation,()=>this._closeOpenActionMenu()),(0,T.YP)(()=>this.selectedFeatureWidget,()=>this._destroyRelatedRecordsFlowItemWidgets()),(0,T.YP)(()=>{const v=this.selectedFeatureWidget?.viewModel;return[v?.title,v?.state]},()=>this._setTitleFromFeatureWidget()),(0,T.YP)(()=>{const v=this.selectedFeatureWidget?.viewModel;return[v?.content,v?.state]},()=>this._setContentFromFeatureWidget()),(0,T.YP)(()=>this.viewModel?.featureViewModels,()=>this._featureMenuViewportScrollTop()),this._relatedRecordsWidget.on("close",()=>this.close()),this._relatedRecordsWidget.on("exit",()=>this._destroyRelatedRecordsFlowItemWidgets()),this._relatedRecordsWidget.on("open-related-feature",({feature:v})=>this._openRelatedFeature(v))])}loadDependencies(){return(0,ht.h)({action:()=>Promise.all([w.e(2115),w.e(6083),w.e(5782),w.e(8507)]).then(w.bind(w,18507)),"action-bar":()=>Promise.all([w.e(2115),w.e(6083),w.e(5782),w.e(2805),w.e(4920),w.e(154),w.e(8592),w.e(9962)]).then(w.bind(w,69962)),"action-group":()=>Promise.all([w.e(2115),w.e(6083),w.e(5782),w.e(2805),w.e(4920),w.e(154),w.e(8592),w.e(3607)]).then(w.bind(w,43607)),button:()=>Promise.all([w.e(2115),w.e(6083),w.e(2964),w.e(9926)]).then(w.bind(w,69926)),flow:()=>w.e(3669).then(w.bind(w,13669)),"flow-item":()=>Promise.all([w.e(2115),w.e(6083),w.e(5782),w.e(2805),w.e(4920),w.e(154),w.e(8592),w.e(6546)]).then(w.bind(w,66546)),list:()=>Promise.all([w.e(2115),w.e(6083),w.e(2964),w.e(1905),w.e(8592),w.e(6221)]).then(w.bind(w,26221)),"list-item":()=>Promise.all([w.e(2115),w.e(6083),w.e(5782),w.e(8592),w.e(9475)]).then(w.bind(w,99475)),"list-item-group":()=>Promise.all([w.e(8592),w.e(3768)]).then(w.bind(w,23768)),loader:()=>Promise.all([w.e(2115),w.e(6083),w.e(5597)]).then(w.bind(w,55597))})}destroy(){this._destroyRelatedRecordsFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver?.disconnect(),this._relatedRecordsWidget?.destroy()}get _hideActionText(){if(!this.responsiveActionsEnabled)return!1;const h=this.view?.widthBreakpoint;return"xsmall"===h||"small"===h||"medium"===h}get _featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get _isCollapsed(){return this._collapseEnabled&&this.collapsed}get _collapseEnabled(){return this.visibleElements.collapseButton&&!!this.title&&!!this.content}get active(){return this.viewModel.active}get content(){return this.viewModel.content}set content(h){this.viewModel.content=h}get icon(){return null}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(h){this.viewModel.featureMenuOpen=h}get features(){return this.viewModel.features}set features(h){this.viewModel.features=h}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(h){this.viewModel.goToOverride=h}get location(){return this.viewModel.location}set location(h){this.viewModel.location=h}get label(){return this.messages?.widgetLabel??""}set label(h){this._overrideIfSome("label",h)}get map(){return this.viewModel.map}set map(h){this.viewModel.map=h}get promises(){return this.viewModel.promises}set promises(h){this.viewModel.promises=h}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(h){this.viewModel.selectedFeatureIndex=h}get selectedFeatureWidget(){const{_feature:h,headingLevel:g,_relatedRecordsFlowItems:y,timeZone:v,spatialReference:b,map:C}=this,{selectedFeatureViewModel:I}=this.viewModel,_={title:!1};return I?(h?(h.viewModel=I,h.visibleElements=_):this._feature=new sr({flowItems:y,headingLevel:g+1,timeZone:v,spatialReference:b,map:C,viewModel:I,visibleElements:_}),this._feature):null}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(h){this.viewModel.spatialReference=h}get title(){return this.viewModel.title}set title(h){this.viewModel.title=h}get timeZone(){return this.viewModel.timeZone}set timeZone(h){this.viewModel.timeZone=h}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(h){this.viewModel.updateLocationEnabled=h}get view(){return this.viewModel.view}set view(h){this.viewModel.view=h}get visible(){return this.viewModel.visible}set visible(h){this.viewModel.visible=h}blur(){const{active:h}=this.viewModel;h?this._rootFlowItemNode?.blur():B.Z.getLogger(this).warn("Features can only be blurred when currently active.")}clear(){return this.viewModel.clear()}close(){this.viewModel.visible=!1}fetchFeatures(h,g){return this.viewModel.fetchFeatures(h,g)}focus(){const{active:h}=this.viewModel;h?this._setFocusOn():B.Z.getLogger(this).warn("Features can only be focused when currently active.")}next(){return this.viewModel.next()}open(h){this.removeHandles(ls),this.set({collapsed:h?.collapsed??!1}),this.viewModel.open(h),this.addHandles((0,T.gx)(()=>!this.viewModel.waitingForResult,()=>this._addSelectedFeatureIndexHandle(),{once:!0}))}previous(){return this.viewModel.previous()}triggerAction(h){return this.viewModel.triggerAction(h)}render(){return(0,x.u)("div",{bind:this,class:this.classes(Pe.base,X.z.widget,X.z.panel),onkeydown:this._onMainKeydown},this._renderHeader(),this._renderContentContainer())}_renderFeatureNavigation(){return[this._renderPagination(),this._renderFeatureMenuButton()]}_renderHeader(){return!this.featureMenuOpen&&this.featureNavigationTop&&this._featureNavigationVisible?(0,x.u)("div",{class:Pe.header,key:"header-actions"},this._renderFeatureNavigation()):null}_renderFooter(){return this.featureMenuOpen||this.featureNavigationTop||!this._featureNavigationVisible?null:(0,x.u)("div",{class:Pe.footer,key:"footer-actions",slot:"footer"},this._renderFeatureNavigation())}_renderFeatureMenuButton(){const{messages:h,viewModel:g}=this,{featureCount:y,selectedFeatureIndex:v,pendingPromisesCount:b}=g;return(0,x.u)("calcite-action",{appearance:"solid",bind:this,icon:"list",key:"feature-menu-button",label:h.selectFeature,loading:b>0,onclick:this._openFeatureMenu,scale:"s",text:(0,nt.n)(h.pageText,{index:(0,Qe.uf)(v+1),total:(0,Qe.uf)(y)}),textEnabled:!0,title:h.selectFeature})}_renderPagination(){const{previous:h,next:g}=this.messagesCommon.pagination;return(0,x.u)("calcite-action-bar",{class:Pe.paginationActionBar,expandDisabled:!0,key:"pagination-action-bar",layout:"horizontal",overflowActionsDisabled:!0,scale:"s"},(0,x.u)("calcite-action-group",{scale:"s"},(0,x.u)("calcite-action",{appearance:"solid",class:Pe.paginationPrevious,icon:"chevron-left",iconFlipRtl:!0,label:h,onclick:this._previousFeature,scale:"s",text:h,title:h}),(0,x.u)("calcite-action",{appearance:"solid",icon:"chevron-right",iconFlipRtl:!0,label:g,onclick:this._nextFeature,scale:"s",text:g,title:g})))}_renderFeatureMenuItem(h){const{selectedFeatureViewModel:g,featureViewModels:y}=this.viewModel,v=h===g,b=y.indexOf(h);return(0,x.u)("calcite-list-item",{bind:this,"data-feature-index":b,key:`feature-menu-item-${h.uid}`,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onmouseleave:this._removeActiveFeature,onmouseover:this._setActiveFeature,selected:v,onCalciteListItemSelect:this._selectFeature},(0,x.u)("span",{innerHTML:h.title||this.messagesCommon.untitled,slot:"content"}))}_groupResultsByLayer(){const{featureViewModels:h}=this.viewModel,g=new Map;return h.forEach(y=>{const v=y?.graphic;if(!v)return;const{layer:b,sourceLayer:C}=v,I=(ds(b)?b:null)||(ds(C)?C:null),_=g.get(I)??[];g.set(I,[..._,y])}),g}_renderFeatureMenu(){const{featureViewModels:h}=this.viewModel,g=this._groupResultsByLayer();return h.length?(0,x.u)("calcite-list",{selectionAppearance:"icon",selectionMode:"single"},Array.from(g.keys(),y=>{const v=g.get(y)?.map(C=>this._renderFeatureMenuItem(C)),b=y?y.title??this.messagesCommon.untitled:null;return this.visibleElements.featureListLayerTitle&&null!==b?(0,x.u)("calcite-list-item-group",{heading:b,key:y?.uid||"map-graphics"},v):v})):null}_renderHeaderAction(h,g){const y=h.title||"";return h.visible?(0,x.u)("calcite-action",{active:"toggle"===h.type&&h.value,appearance:"solid",bind:this,"data-action-uid":h.uid,disabled:h.disabled,icon:h.icon??void 0,indicator:h.indicator,key:`header-action-${g}`,loading:h.active,onclick:this._triggerHeaderAction,slot:"header-actions-end",text:y,title:y}):null}_renderHeaderActions(){return this.headerActions.map((h,g)=>this._renderHeaderAction(h,g)).toArray()}_renderContentFeature(){const{headingLevel:h,visibleElements:g,_isCollapsed:y,_collapseEnabled:v,featureNavigationTop:b}=this,{title:C,active:I}=this.viewModel,_=g.heading&&C?C:"";return(0,x.u)("calcite-flow-item",{afterCreate:this._storeRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,class:this.classes({[Pe.contentFeature]:!0,[Pe.flowItemCollapsed]:y}),closable:g.closeButton,closed:!I,collapsed:y,collapseDirection:b?"down":"up",collapsible:v,headingLevel:h,key:"root-flow-item",onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},_?(0,x.u)(bi.X,{class:this.classes(Pe.featuresHeading,X.z.heading),innerHTML:_,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),y?null:(0,x.u)("div",{class:this.classes(Pe.container,Pe.contentContainer)},this._renderContent()),this._renderFooter())}_renderFeatureMenuContainer(){const{viewModel:h,featureMenuOpen:g,messages:y,messagesCommon:v}=this,{active:b,featureViewModels:C,pendingPromisesCount:I}=h;return g?(0,x.u)("calcite-flow-item",{afterCreate:this._storeFeatureMenuFlowItemNode,afterUpdate:this._focusFeatureMenuFlowItemNode,bind:this,closable:!1,closed:!b,description:(0,nt.n)(y.total,{total:C.length}),heading:y.selectFeature,key:"feature-menu",loading:h.waitingForContents,onCalciteFlowItemBack:_=>{_.preventDefault(),this._handleFeatureMenuBack()}},I>0?(0,x.u)("calcite-loader",{class:Pe.loader,inline:!0,key:"feature-menu-loader",label:v.loading,slot:"header-actions-end"}):null,(0,x.u)("div",{class:Pe.container},this._renderFeatureMenu()),(0,x.u)("div",{afterCreate:this._featureMenuIntersectionObserverCreated,bind:this,class:Pe.featureMenuObserver}),(0,x.u)("calcite-button",{appearance:"transparent",onclick:this._handleFeatureMenuBack,slot:"footer-actions",width:"full"},v.back)):null}_renderContentContainer(){const h=[this._renderContentFeature(),this._renderFeatureMenuContainer(),this._relatedRecordsWidget.render()];return this.visibleElements.flow?(0,x.u)("calcite-flow",{key:"content-container"},h):h}_getFallbackIcon(h){const{className:g,icon:y}=h;if(y)return null;const v=(0,N.b$)({action:h,feature:this.selectedFeature}),b={[Pe.icon]:!!g,[Pe.actionImage]:!!v};return g&&(b[g]=!0),v||g?(0,x.u)("span",{"aria-hidden":"true",class:this.classes(Pe.icon,b),key:"icon",styles:(0,N.uS)(v)}):null}_renderActionBar(){return!this._isCollapsed&&this.visibleElements.actionBar&&this.viewModel.allActions?.length?(0,x.u)("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},(0,x.u)("calcite-action-group",{afterCreate:h=>this._actionBarMenuNode=h,overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map(this._renderAction)}_renderContent(){const h=this.viewModel?.content;return h?"string"==typeof h?(0,x.u)("div",{class:Ce.contentNode,innerHTML:h,key:h}):this.renderNodeContent(h):null}_setFocusOn(){this.renderNow(),requestAnimationFrame(()=>{this._focusOn=this.featureMenuOpen?"menu-flow-item":"root-flow-item"})}_handleCollapseToggle(){this.collapsed=!this.collapsed}_openRelatedFeature(h){var g=this;return(0,R.Z)(function*(){yield h.viewModel.updateGeometry();const y=h.graphic,v=y?.geometry;if(null==v||null==y)return;g._destroyRelatedRecordsFlowItemWidgets(),yield g.viewModel.zoomTo({target:v});const b=Te(v);g.open({features:[y],location:b??void 0})})()}_focusRootFlowItemNode(){this._focusFlowItemNodeThrottled("root-flow-item")}_focusFeatureMenuFlowItemNode(){this._focusFlowItemNodeThrottled("menu-flow-item")}_storeRootFlowItemNode(h){this._rootFlowItemNode=h,this._focusFlowItemNodeThrottled("root-flow-item")}_storeFeatureMenuFlowItemNode(h){this._featureMenuViewportNode=h,this._focusFlowItemNodeThrottled("menu-flow-item")}_setActiveFeature(h){const{viewModel:g}=this,y=h.currentTarget["data-feature-index"];g.activeFeature=g.features?.[y]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_selectFeature(h){const g=h.currentTarget["data-feature-index"];isNaN(g)||(this.viewModel.selectedFeatureIndex=g),this._handleFeatureMenuBack()}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(h){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(h),this._featureMenuIntersectionObserverNode=h}_getActionIcon(h){return h.icon?h.icon:h.image||h.className?void 0:"question"}_getActionTitle(h){const{messages:g,selectedFeature:y,messagesCommon:v}=this,{id:b}=h,C=y?.attributes,I=h.title??"",_="zoom-to-feature"===b?(0,nt.n)(I,{messages:g}):"remove-selected-feature"===b?(0,nt.n)(I,{messages:v}):"zoom-to-clustered-features"===b||"browse-clustered-features"===b?(0,nt.n)(I,{messages:g}):h.title;return _&&C?(0,nt.n)(_,C):_??""}_onMainKeydown(h){const{key:g}=h;"ArrowLeft"===g&&(h.stopPropagation(),this._handleFeatureMenuBack(),this.previous()),"ArrowRight"===g&&(h.stopPropagation(),this._handleFeatureMenuBack(),this.next())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&this._featureMenuViewportNode.scrollContentTo({top:0})}_setContentFromFeatureWidget(){const{selectedFeatureWidget:h}=this;h&&(this.viewModel.content=h)}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:h,messagesCommon:g}=this,y=h?.viewModel;h&&(this.viewModel.title="error"===y?.state?g?.errorMessage:y?.title||"")}_addSelectedFeatureIndexHandle(){const h=(0,T.YP)(()=>this.viewModel?.selectedFeatureIndex,(g,y)=>this._selectedFeatureIndexUpdated(g,y));this.addHandles(h,ls)}_selectedFeatureIndexUpdated(h,g){const{featureCount:y}=this.viewModel;y&&h!==g&&-1!==h&&(this._destroyRelatedRecordsFlowItemWidgets(),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_triggerHeaderAction(h){const g=h.currentTarget;if(g.disabled)return;const y=g.dataset.actionUid,v=this.headerActions.find(({uid:b})=>b===y);v&&!v.disabled&&("toggle"===v?.type&&(v.value=!v.value),this.emit("trigger-header-action",{action:v}))}_triggerAction(h){const g=h.currentTarget;if(g.disabled)return;const y=g.dataset.actionUid,{allActions:v}=this.viewModel,b=v.findIndex(I=>I.uid===y),C=v.at(b);C&&"toggle"===C.type&&(C.value=!C.value),this.viewModel.triggerAction(b)}_createSpinner(h){h&&(this._spinner=new rr({view:h}),h.ui.add(this._spinner,{key:as,position:"manual",internal:!0}))}_wireUpView(h){this._destroySpinner(),h&&this.visibleElements?.spinner&&this._createSpinner(h)}_hideSpinner(){const{_spinner:h}=this;h&&(h.location=null,h.hide())}_viewReadyChange(h,g){h?this._wireUpView(this.viewModel?.view):g&&this.viewModel.clear()}_viewChange(h,g){h&&g&&this.viewModel.clear()}_destroySelectedFeatureWidget(){const{_feature:h}=this;h&&(h.viewModel=null,!h.destroyed&&h.destroy()),this._feature=null}_closeOpenActionMenu(){const{_actionBarMenuNode:h}=this;h&&(h.menuOpen=!1)}_destroyRelatedRecordsFlowItemWidgets(){this._relatedRecordsFlowItems.drain(h=>{"showAllEnabled"in h.viewModel&&(h.viewModel.showAllEnabled=!1),h.viewModel=null,h.destroy()})}_toggleScreenLocationEnabled(){const{viewModel:h}=this;h&&(h.screenLocationEnabled=h.active)}_displaySpinner(){const{_spinner:h}=this;if(!h)return;const{location:g,waitingForResult:y}=this.viewModel;y&&g?h.show({location:g}):h.hide()}_destroySpinner(){const{_spinner:h,view:g}=this;h&&(g?.ui?.remove(h,as),h.destroy(),this._spinner=null)}_spinnerEnabledChange(h){this._destroySpinner(),h&&this._createSpinner(this.viewModel?.view)}};(0,F._)([(0,M.Cb)()],ee.prototype,"_focusOn",void 0),(0,F._)([(0,M.Cb)()],ee.prototype,"_relatedRecordsFlowItems",void 0),(0,F._)([(0,M.Cb)()],ee.prototype,"_hideActionText",null),(0,F._)([(0,M.Cb)()],ee.prototype,"_featureNavigationVisible",null),(0,F._)([(0,M.Cb)()],ee.prototype,"_isCollapsed",null),(0,F._)([(0,M.Cb)()],ee.prototype,"_collapseEnabled",null),(0,F._)([(0,M.Cb)({readOnly:!0})],ee.prototype,"active",null),(0,F._)([(0,M.Cb)()],ee.prototype,"collapsed",void 0),(0,F._)([(0,M.Cb)()],ee.prototype,"content",null),(0,F._)([(0,M.Cb)()],ee.prototype,"icon",null),(0,F._)([(0,M.Cb)()],ee.prototype,"featureMenuOpen",null),(0,F._)([(0,M.Cb)()],ee.prototype,"featureNavigationTop",void 0),(0,F._)([(0,M.Cb)()],ee.prototype,"features",null),(0,F._)([(0,M.Cb)()],ee.prototype,"goToOverride",null),(0,F._)([(0,M.Cb)({type:vt})],ee.prototype,"headerActions",void 0),(0,F._)([(0,M.Cb)()],ee.prototype,"headingLevel",void 0),(0,F._)([(0,M.Cb)()],ee.prototype,"location",null),(0,F._)([(0,M.Cb)()],ee.prototype,"label",null),(0,F._)([(0,M.Cb)()],ee.prototype,"map",null),(0,F._)([(0,M.Cb)(),(0,Be.H)("esri/widgets/Features/t9n/Features")],ee.prototype,"messages",void 0),(0,F._)([(0,M.Cb)(),(0,Be.H)("esri/t9n/common")],ee.prototype,"messagesCommon",void 0),(0,F._)([(0,M.Cb)()],ee.prototype,"promises",null),(0,F._)([(0,M.Cb)()],ee.prototype,"responsiveActionsEnabled",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],ee.prototype,"selectedFeature",null),(0,F._)([(0,M.Cb)()],ee.prototype,"selectedFeatureIndex",null),(0,F._)([(0,M.Cb)({readOnly:!0})],ee.prototype,"selectedFeatureWidget",null),(0,F._)([(0,M.Cb)()],ee.prototype,"spatialReference",null),(0,F._)([(0,M.Cb)()],ee.prototype,"title",null),(0,F._)([(0,M.Cb)()],ee.prototype,"timeZone",null),(0,F._)([(0,M.Cb)()],ee.prototype,"updateLocationEnabled",null),(0,F._)([(0,M.Cb)()],ee.prototype,"view",null),(0,F._)([(0,M.Cb)({type:Xi}),(0,rs.s)(["triggerAction","trigger-action"])],ee.prototype,"viewModel",void 0),(0,F._)([(0,M.Cb)({type:os,nonNullable:!0})],ee.prototype,"visibleElements",void 0),(0,F._)([(0,M.Cb)()],ee.prototype,"visible",null),ee=(0,F._)([(0,S.j)("esri.widgets.Features")],ee);const Er=ee,je="esri-popup",wt=`${je}--is-docked`,Fe={base:je,baseHidden:`${je}--hidden`,main:`${je}__main-container`,shadow:`${je}--shadow`,isDocked:wt,isDockedTopLeft:`${wt}-top-left`,isDockedTopCenter:`${wt}-top-center`,isDockedTopRight:`${wt}-top-right`,isDockedBottomLeft:`${wt}-bottom-left`,isDockedBottomCenter:`${wt}-bottom-center`,isDockedBottomRight:`${wt}-bottom-right`,alignTopCenter:`${je}--aligned-top-center`,alignBottomCenter:`${je}--aligned-bottom-center`,alignTopLeft:`${je}--aligned-top-left`,alignBottomLeft:`${je}--aligned-bottom-left`,alignTopRight:`${je}--aligned-top-right`,alignBottomRight:`${je}--aligned-bottom-right`,pointer:`${je}__pointer`,pointerDirection:`${je}__pointer-direction`};let ki=class extends Xi{constructor(h){super(h)}};ki=(0,F._)([(0,S.j)("esri.widgets.Popup.PopupViewModel")],ki);const us=ki;let Xe=class extends qe.Z{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!0,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.heading=!0,this.spinner=!0}};(0,F._)([(0,M.Cb)({type:Boolean,nonNullable:!0})],Xe.prototype,"actionBar",void 0),(0,F._)([(0,M.Cb)({type:Boolean,nonNullable:!0})],Xe.prototype,"closeButton",void 0),(0,F._)([(0,M.Cb)({type:Boolean,nonNullable:!0})],Xe.prototype,"collapseButton",void 0),(0,F._)([(0,M.Cb)({type:Boolean,nonNullable:!0})],Xe.prototype,"featureNavigation",void 0),(0,F._)([(0,M.Cb)({type:Boolean,nonNullable:!0})],Xe.prototype,"featureListLayerTitle",void 0),(0,F._)([(0,M.Cb)({type:Boolean,nonNullable:!0})],Xe.prototype,"heading",void 0),(0,F._)([(0,M.Cb)({type:Boolean,nonNullable:!0})],Xe.prototype,"spinner",void 0),Xe=(0,F._)([(0,S.j)("esri.widgets.Popup.PopupVisibleElements")],Xe);const qi=Xe,cs={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};let te=class extends U.Z{constructor(h,g){super(h,g),this._dockAction=new J.Z({id:"popup-dock-action"}),this._featuresWidget=new Er({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this.alignment="auto",this.dockEnabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new us,this.visibleElements=new qi}initialize(){this.addHandles([(0,T.YP)(()=>[this.viewModel?.view?.widthBreakpoint,this.dockEnabled],()=>this._handleDockIcon(),T.nn),(0,T.YP)(()=>[this.dockEnabled,this.messages?.undock,this.messages?.dock],()=>this._handleDockEnabled(),T.nn),(0,T.YP)(()=>this.dockOptions,h=>{const{_dockAction:g}=this,y=this._featuresWidget.headerActions;y.remove(g),h.buttonEnabled&&y.add(g)},T.nn),(0,T.YP)(()=>this.viewModel?.screenLocation,()=>this._positionContainer()),(0,T.YP)(()=>[this.viewModel?.active,this.dockEnabled],()=>this._toggleScreenLocationEnabled()),(0,T.YP)(()=>[this.viewModel?.screenLocation,this.viewModel?.view?.padding,this.viewModel?.view?.size,this.viewModel?.active,this.viewModel?.location,this.alignment],()=>this.reposition()),(0,T.YP)(()=>this.viewModel?.view?.size,(h,g)=>this._updateDockEnabledForViewSize(h,g)),(0,T.YP)(()=>this.viewModel?.view,(h,g)=>this._viewChange(h,g)),(0,T.YP)(()=>this.viewModel?.view?.ready,(h,g)=>this._viewReadyChange(h??!1,g??!1)),(0,T.YP)(()=>this.viewModel,()=>this._featuresWidget.viewModel=this.viewModel,T.nn),(0,T.YP)(()=>this._featureNavigationTop,h=>this._featuresWidget.featureNavigationTop=h,T.nn),(0,T.YP)(()=>this.headingLevel,h=>this._featuresWidget.headingLevel=h,T.nn),(0,T.YP)(()=>this.visibleElements.actionBar,h=>this._featuresWidget.visibleElements.actionBar=!!h,T.nn),(0,T.YP)(()=>this.visibleElements.closeButton,h=>this._featuresWidget.visibleElements.closeButton=!!h,T.nn),(0,T.YP)(()=>this.visibleElements.collapseButton,h=>this._featuresWidget.visibleElements.collapseButton=!!h,T.nn),(0,T.YP)(()=>this.visibleElements.heading,h=>this._featuresWidget.visibleElements.heading=!!h,T.nn),(0,T.YP)(()=>this.visibleElements.spinner,h=>this._featuresWidget.visibleElements.spinner=!!h,T.nn),(0,T.YP)(()=>this.visibleElements.featureNavigation,h=>this._featuresWidget.visibleElements.featureNavigation=!!h,T.nn),(0,T.YP)(()=>this.visibleElements.featureListLayerTitle,h=>this._featuresWidget.visibleElements.featureListLayerTitle=!!h,T.nn),(0,T.on)(()=>this._featuresWidget,"trigger-header-action",h=>{h.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)})])}normalizeCtorArgs(h){const g={...h};return null!=h?.visibleElements&&(g.visibleElements=new qi(h.visibleElements),null!=h.collapseEnabled&&(g.visibleElements.collapseButton=h.collapseEnabled),null!=h.spinnerEnabled&&(g.visibleElements.spinner=h.spinnerEnabled)),g}destroy(){this._dockAction.destroy(),this._featuresWidget?.destroy()}get _featureNavigationTop(){const{currentAlignment:h,currentDockPosition:g}=this;return"bottom-left"===h||"bottom-center"===h||"bottom-right"===h||"top-left"===g||"top-center"===g||"top-right"===g}get actions(){return this.viewModel.actions}set actions(h){this.viewModel.actions=h}get active(){return this.viewModel.active}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(h){this.viewModel.autoCloseEnabled=h}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(h){this.viewModel.defaultPopupTemplateEnabled=h}get content(){return this.viewModel.content}set content(h){this.viewModel.content=h}get collapsed(){return this._featuresWidget.collapsed}set collapsed(h){this._featuresWidget.collapsed=h}get collapseEnabled(){return(0,z.Mr)(B.Z.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton}set collapseEnabled(h){(0,z.Mr)(B.Z.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton=h}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||cs}set dockOptions(h){const g={...cs},y=this.viewModel?.view?.breakpoints,v={};y&&(v.width=y.xsmall,v.height=y.xsmall);const b={...g,...h},C={...g.breakpoint,...v},{breakpoint:I}=b;"object"==typeof I?b.breakpoint={...C,...I}:I&&(b.breakpoint=C),this._set("dockOptions",b),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(h){this.viewModel.featureMenuOpen=h}get features(){return this.viewModel.features}set features(h){this.viewModel.features=h}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(h){this.viewModel.goToOverride=h}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(h){this.viewModel.highlightEnabled=h}get icon(){return"popup"}set icon(h){this._overrideIfSome("icon",h)}get location(){return this.viewModel.location}set location(h){this.viewModel.location=h}get label(){return this.messages?.widgetLabel??""}set label(h){this._overrideIfSome("label",h)}get promises(){return this.viewModel.promises}set promises(h){this.viewModel.promises=h}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(h){this.viewModel.selectedFeatureIndex=h}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get spinnerEnabled(){return(0,z.Mr)(B.Z.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner}set spinnerEnabled(h){(0,z.Mr)(B.Z.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner=h}get title(){return this.viewModel.title}set title(h){this.viewModel.title=h}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(h){this.viewModel.updateLocationEnabled=h}get view(){return this.viewModel.view}set view(h){this.viewModel.view=h}get visible(){return this.viewModel.visible}set visible(h){this.viewModel.visible=h}blur(){const{active:h}=this.viewModel;h||B.Z.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(h,g){return this.viewModel.fetchFeatures(h,g)}focus(){const{active:h}=this.viewModel;h||B.Z.getLogger(this).warn("Popup can only be focused when currently active."),this.reposition(),requestAnimationFrame(()=>{this._featuresWidget.focus()})}next(){return this.viewModel.next()}open(h){this.set({collapsed:!!h&&!!h.collapsed,featureMenuOpen:!!h&&!!h.featureMenuOpen}),this.viewModel.open(h),this._shouldFocus(h)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(h){return this.viewModel.triggerAction(h)}render(){const{dockEnabled:h,currentAlignment:g,currentDockPosition:y}=this,{active:v,screenLocation:b}=this.viewModel,C=v&&h,I=v&&!h,_=this.selectedFeature?.layer?.title,A=this.selectedFeature?.layer?.id;return(0,x.u)("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,bind:this,class:this.classes(Fe.base,{[Fe.alignTopCenter]:"top-center"===g,[Fe.alignBottomCenter]:"bottom-center"===g,[Fe.alignTopLeft]:"top-left"===g,[Fe.alignBottomLeft]:"bottom-left"===g,[Fe.alignTopRight]:"top-right"===g,[Fe.alignBottomRight]:"bottom-right"===g,[Fe.isDocked]:C,[Fe.shadow]:I,[Fe.isDockedTopLeft]:"top-left"===y,[Fe.isDockedTopCenter]:"top-center"===y,[Fe.isDockedTopRight]:"top-right"===y,[Fe.isDockedBottomLeft]:"bottom-left"===y,[Fe.isDockedBottomCenter]:"bottom-center"===y,[Fe.isDockedBottomRight]:"bottom-right"===y},{[Fe.baseHidden]:!b&&!h}),"data-layer-id":A,"data-layer-title":_,role:"presentation"},v?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:(0,x.u)("div",{class:Fe.pointer,key:"popup-pointer",role:"presentation"},(0,x.u)("div",{class:this.classes(Fe.pointerDirection,Fe.shadow)}))}_renderMainContainer(){const{dockEnabled:h}=this;return(0,x.u)("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(Fe.main,X.z.widget,{[Fe.shadow]:h})},this._featuresWidget.render())}_shouldFocus(h){var g=this;return(0,R.Z)(function*(){h?.shouldFocus&&(yield(0,T.N1)(()=>!0===g.viewModel?.active),g.focus())})()}_isOutsideView(h){const{popupHeight:g,popupWidth:y,screenLocation:v,side:b,view:C}=h;if(isNaN(y)||isNaN(g)||!C||!v)return!1;const I=C.padding;return"right"===b&&v.x+y/2>C.width-I.right||"left"===b&&v.x-y/2<I.left||"top"===b&&v.y-g<I.top||"bottom"===b&&v.y+g>C.height-I.bottom}_calculateAutoAlignment(h){if("auto"!==h)return h;const{_pointerOffsetInPx:g,_containerNode:y,_mainContainerNode:v,viewModel:b}=this,{screenLocation:C,view:I}=b;if(null==C||!I||!y)return"top-center";function _(ae){return parseInt(ae.replaceAll(/[^-\d.]/g,""),10)}const A=v?window.getComputedStyle(v,null):null,P=A?_(A.getPropertyValue("max-height")):0,E=A?_(A.getPropertyValue("height")):0,{height:L,width:O}=y.getBoundingClientRect(),$=O+g,j=Math.max(L,P,E)+g,Q=this._isOutsideView({popupHeight:j,popupWidth:$,screenLocation:C,side:"right",view:I}),oe=this._isOutsideView({popupHeight:j,popupWidth:$,screenLocation:C,side:"left",view:I}),ie=this._isOutsideView({popupHeight:j,popupWidth:$,screenLocation:C,side:"top",view:I}),fe=this._isOutsideView({popupHeight:j,popupWidth:$,screenLocation:C,side:"bottom",view:I});return oe?ie?"bottom-right":"top-right":Q?ie?"bottom-left":"top-left":ie?fe?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(h){return"function"==typeof h?h.call(this):h}_getCurrentAlignment(){const{alignment:h,dockEnabled:g}=this;return g||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(h)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(h){const g=["left","right"];return(0,We.dZ)(this.container)&&g.reverse(),h?.replace(/leading/gi,g[0]).replaceAll(/trailing/gi,g[1])}_callDockPosition(h){return"function"==typeof h?h.call(this):h}_getDockPosition(){return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(this.dockOptions?.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(h){if("auto"!==h)return h;const g=this.viewModel?.view,y=(0,We.dZ)(this.container)?"top-left":"top-right";if(!g)return y;const v=g.padding||{left:0,right:0,top:0,bottom:0},b=g.width-v.left-v.right,{breakpoints:C}=g;return C&&b<=C.xsmall?"bottom-center":y}_getDockIcon(){const h=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(h){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){this._dockAction.title=this.dockEnabled?this.messages?.undock:this.messages?.dock}_setMainContainerNode(h){this._mainContainerNode=h}_positionContainer(h=this._containerNode){if(h&&(this._containerNode=h),!this._containerNode)return;const{screenLocation:g}=this.viewModel,{width:y}=this._containerNode.getBoundingClientRect(),v=this._calculatePositionStyle(g,y);v&&Object.assign(this._containerNode.style,v)}_calculateFullWidth(h){const{currentAlignment:g,_pointerOffsetInPx:y}=this;return"top-left"===g||"bottom-left"===g||"top-right"===g||"bottom-right"===g?h+y:h}_calculateAlignmentPosition(h,g,y,v){const{currentAlignment:b,_pointerOffsetInPx:C}=this;if(!y)return;const{padding:I}=y,_=v/2,A=y.height-g,P=y.width-h;return"bottom-center"===b?{top:g+C-I.top,left:h-_-I.left}:"top-left"===b?{bottom:A+C-I.bottom,right:P+C-I.right}:"bottom-left"===b?{top:g+C-I.top,right:P+C-I.right}:"top-right"===b?{bottom:A+C-I.bottom,left:h+C-I.left}:"bottom-right"===b?{top:g+C-I.top,left:h+C-I.left}:"top-center"===b?{bottom:A+C-I.bottom,left:h-_-I.left}:void 0}_calculatePositionStyle(h,g){const{dockEnabled:y,view:v}=this;if(!v)return;if(y)return{left:"",top:"",right:"",bottom:""};if(null==h||!g)return;const b=this._calculateFullWidth(g),C=this._calculateAlignmentPosition(h.x,h.y,v,b);return C?{top:void 0!==C.top?`${C.top}px`:"auto",left:void 0!==C.left?`${C.left}px`:"auto",bottom:void 0!==C.bottom?`${C.bottom}px`:"auto",right:void 0!==C.right?`${C.right}px`:"auto"}:void 0}_viewChange(h,g){h&&g&&(this.close(),this.clear())}_viewReadyChange(h,g){h?this._wireUpView():g&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(h,g,y){const[v,b]=h,[C,I]=g,{width:_=0,height:A=0}=y??{};return v<=_&&C>_||v>_&&C<=_||b<=A&&I>A||b>A&&I<=A}_updateDockEnabledForViewSize(h,g){if(!h||!g)return;const y=this.viewModel?.view?.padding||{left:0,right:0,top:0,bottom:0},v=y.left+y.right,b=y.top+y.bottom,C=[],I=[];C[0]=h[0]-v,C[1]=h[1]-b,I[0]=g[0]-v,I[1]=g[1]-b;const{dockOptions:_}=this;this._dockingThresholdCrossed(C,I,_.breakpoint)&&this._setDockEnabledForViewSize(_),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){const{dockEnabled:h,viewModel:g}=this;g&&(g.screenLocationEnabled=g.active&&!h)}_shouldDockAtCurrentViewSize(h){const g=h.breakpoint,y=this.viewModel?.view?.ui;if(!y)return!1;const{width:v,height:b}=y;if(isNaN(v)||isNaN(b)||!g)return!1;const C=g.hasOwnProperty("width")&&v<=(g.width??0),I=g.hasOwnProperty("height")&&b<=(g.height??0);return C||I}_setDockEnabledForViewSize(h){h.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(h))}};(0,F._)([(0,M.Cb)({readOnly:!0})],te.prototype,"_featureNavigationTop",null),(0,F._)([(0,M.Cb)()],te.prototype,"actions",null),(0,F._)([(0,M.Cb)({readOnly:!0})],te.prototype,"active",null),(0,F._)([(0,M.Cb)()],te.prototype,"alignment",void 0),(0,F._)([(0,M.Cb)()],te.prototype,"autoCloseEnabled",null),(0,F._)([(0,M.Cb)()],te.prototype,"defaultPopupTemplateEnabled",null),(0,F._)([(0,M.Cb)()],te.prototype,"content",null),(0,F._)([(0,M.Cb)()],te.prototype,"collapsed",null),(0,F._)([(0,M.Cb)()],te.prototype,"collapseEnabled",null),(0,F._)([(0,M.Cb)({readOnly:!0})],te.prototype,"currentAlignment",null),(0,F._)([(0,M.Cb)({readOnly:!0})],te.prototype,"currentDockPosition",null),(0,F._)([(0,M.Cb)()],te.prototype,"dockOptions",null),(0,F._)([(0,M.Cb)()],te.prototype,"dockEnabled",void 0),(0,F._)([(0,M.Cb)({readOnly:!0})],te.prototype,"featureCount",null),(0,F._)([(0,M.Cb)()],te.prototype,"featureMenuOpen",null),(0,F._)([(0,M.Cb)()],te.prototype,"features",null),(0,F._)([(0,M.Cb)()],te.prototype,"goToOverride",null),(0,F._)([(0,M.Cb)()],te.prototype,"headingLevel",void 0),(0,F._)([(0,M.Cb)()],te.prototype,"highlightEnabled",null),(0,F._)([(0,M.Cb)()],te.prototype,"icon",null),(0,F._)([(0,M.Cb)()],te.prototype,"location",null),(0,F._)([(0,M.Cb)()],te.prototype,"label",null),(0,F._)([(0,M.Cb)(),(0,Be.H)("esri/widgets/Popup/t9n/Popup")],te.prototype,"messages",void 0),(0,F._)([(0,M.Cb)()],te.prototype,"promises",null),(0,F._)([(0,M.Cb)({readOnly:!0})],te.prototype,"selectedFeature",null),(0,F._)([(0,M.Cb)()],te.prototype,"selectedFeatureIndex",null),(0,F._)([(0,M.Cb)({readOnly:!0})],te.prototype,"selectedFeatureWidget",null),(0,F._)([(0,M.Cb)()],te.prototype,"spinnerEnabled",null),(0,F._)([(0,M.Cb)()],te.prototype,"title",null),(0,F._)([(0,M.Cb)()],te.prototype,"updateLocationEnabled",null),(0,F._)([(0,M.Cb)()],te.prototype,"view",null),(0,F._)([(0,M.Cb)({type:us}),(0,rs.s)(["triggerAction","trigger-action"])],te.prototype,"viewModel",void 0),(0,F._)([(0,M.Cb)()],te.prototype,"visible",null),(0,F._)([(0,M.Cb)({type:qi,nonNullable:!0})],te.prototype,"visibleElements",void 0),te=(0,F._)([(0,S.j)("esri.widgets.Popup")],te);const Tr=te}}]);