"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[3130,9454,318],{95539:(w,S,e)=>{e.d(S,{Z:()=>D});var c=e(50484),d=e(25387),R=e(89317),C=e(51431),K=e(80543),m=(e(14007),e(4703),e(65311),e(21070)),y=e(10141),f=e(81238);let g=class extends((0,d.J)(R.wq)){constructor(M){super(M),this.unit="milliseconds",this.value=0}toMilliseconds(){return(0,C.rJ)(this.value,this.unit,"milliseconds")}};(0,c._)([(0,m.J)(f.v,{nonNullable:!0})],g.prototype,"unit",void 0),(0,c._)([(0,K.Cb)({type:Number,json:{write:!0},nonNullable:!0})],g.prototype,"value",void 0),g=(0,c._)([(0,y.j)("esri.TimeInterval")],g);const D=g},19799:(w,S,e)=>{e.d(S,{F:()=>v,M:()=>c});const c={Base64:0,Hex:1,String:2,Raw:3},d=8,R=(1<<d)-1;function C(s,u){const i=(65535&s)+(65535&u);return(s>>16)+(u>>16)+(i>>16)<<16|65535&i}function y(s,u,i,o,a,r){return C(function m(s,u){return s<<u|s>>>32-u}(C(C(u,s),C(o,r)),a),i)}function f(s,u,i,o,a,r,p){return y(u&i|~u&o,s,u,a,r,p)}function g(s,u,i,o,a,r,p){return y(u&o|i&~o,s,u,a,r,p)}function D(s,u,i,o,a,r,p){return y(u^i^o,s,u,a,r,p)}function M(s,u,i,o,a,r,p){return y(i^(u|~o),s,u,a,r,p)}function v(s,u=c.Hex){const i=u||c.Base64,o=function j(s,u){s[u>>5]|=128<<u%32,s[14+(u+64>>>9<<4)]=u;let i=1732584193,o=-271733879,a=-1732584194,r=271733878;for(let p=0;p<s.length;p+=16){const B=i,Z=o,b=a,O=r;i=f(i,o,a,r,s[p],7,-680876936),r=f(r,i,o,a,s[p+1],12,-389564586),a=f(a,r,i,o,s[p+2],17,606105819),o=f(o,a,r,i,s[p+3],22,-1044525330),i=f(i,o,a,r,s[p+4],7,-176418897),r=f(r,i,o,a,s[p+5],12,1200080426),a=f(a,r,i,o,s[p+6],17,-1473231341),o=f(o,a,r,i,s[p+7],22,-45705983),i=f(i,o,a,r,s[p+8],7,1770035416),r=f(r,i,o,a,s[p+9],12,-1958414417),a=f(a,r,i,o,s[p+10],17,-42063),o=f(o,a,r,i,s[p+11],22,-1990404162),i=f(i,o,a,r,s[p+12],7,1804603682),r=f(r,i,o,a,s[p+13],12,-40341101),a=f(a,r,i,o,s[p+14],17,-1502002290),o=f(o,a,r,i,s[p+15],22,1236535329),i=g(i,o,a,r,s[p+1],5,-165796510),r=g(r,i,o,a,s[p+6],9,-1069501632),a=g(a,r,i,o,s[p+11],14,643717713),o=g(o,a,r,i,s[p],20,-373897302),i=g(i,o,a,r,s[p+5],5,-701558691),r=g(r,i,o,a,s[p+10],9,38016083),a=g(a,r,i,o,s[p+15],14,-660478335),o=g(o,a,r,i,s[p+4],20,-405537848),i=g(i,o,a,r,s[p+9],5,568446438),r=g(r,i,o,a,s[p+14],9,-1019803690),a=g(a,r,i,o,s[p+3],14,-187363961),o=g(o,a,r,i,s[p+8],20,1163531501),i=g(i,o,a,r,s[p+13],5,-1444681467),r=g(r,i,o,a,s[p+2],9,-51403784),a=g(a,r,i,o,s[p+7],14,1735328473),o=g(o,a,r,i,s[p+12],20,-1926607734),i=D(i,o,a,r,s[p+5],4,-378558),r=D(r,i,o,a,s[p+8],11,-2022574463),a=D(a,r,i,o,s[p+11],16,1839030562),o=D(o,a,r,i,s[p+14],23,-35309556),i=D(i,o,a,r,s[p+1],4,-1530992060),r=D(r,i,o,a,s[p+4],11,1272893353),a=D(a,r,i,o,s[p+7],16,-155497632),o=D(o,a,r,i,s[p+10],23,-1094730640),i=D(i,o,a,r,s[p+13],4,681279174),r=D(r,i,o,a,s[p],11,-358537222),a=D(a,r,i,o,s[p+3],16,-722521979),o=D(o,a,r,i,s[p+6],23,76029189),i=D(i,o,a,r,s[p+9],4,-640364487),r=D(r,i,o,a,s[p+12],11,-421815835),a=D(a,r,i,o,s[p+15],16,530742520),o=D(o,a,r,i,s[p+2],23,-995338651),i=M(i,o,a,r,s[p],6,-198630844),r=M(r,i,o,a,s[p+7],10,1126891415),a=M(a,r,i,o,s[p+14],15,-1416354905),o=M(o,a,r,i,s[p+5],21,-57434055),i=M(i,o,a,r,s[p+12],6,1700485571),r=M(r,i,o,a,s[p+3],10,-1894986606),a=M(a,r,i,o,s[p+10],15,-1051523),o=M(o,a,r,i,s[p+1],21,-2054922799),i=M(i,o,a,r,s[p+8],6,1873313359),r=M(r,i,o,a,s[p+15],10,-30611744),a=M(a,r,i,o,s[p+6],15,-1560198380),o=M(o,a,r,i,s[p+13],21,1309151649),i=M(i,o,a,r,s[p+4],6,-145523070),r=M(r,i,o,a,s[p+11],10,-1120210379),a=M(a,r,i,o,s[p+2],15,718787259),o=M(o,a,r,i,s[p+9],21,-343485551),i=C(i,B),o=C(o,Z),a=C(a,b),r=C(r,O)}return[i,o,a,r]}(function K(s){const u=[];for(let i=0,o=s.length*d;i<o;i+=d)u[i>>5]|=(s.charCodeAt(i/d)&R)<<i%32;return u}(s),s.length*d);switch(i){case c.Raw:return o;case c.Hex:return function I(s){const u="0123456789abcdef",i=[];for(let o=0,a=4*s.length;o<a;o++)i.push(u.charAt(s[o>>2]>>o%4*8+4&15)+u.charAt(s[o>>2]>>o%4*8&15));return i.join("")}(o);case c.String:return function T(s){const u=[];for(let i=0,o=32*s.length;i<o;i+=d)u.push(String.fromCharCode(s[i>>5]>>>i%32&R));return u.join("")}(o);case c.Base64:return function E(s){const o=[];for(let a=0,r=4*s.length;a<r;a+=3){const p=(s[a>>2]>>a%4*8&255)<<16|(s[a+1>>2]>>(a+1)%4*8&255)<<8|s[a+2>>2]>>(a+2)%4*8&255;for(let B=0;B<4;B++)o.push(8*a+6*B>32*s.length?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(p>>6*(3-B)&63))}return o.join("")}(o)}}},79107:(w,S,e)=>{e.r(S),e.d(S,{default:()=>_t});var c=e(15861),d=e(50484),R=e(35458),C=e(62691),M=(e(36699),e(12610),e(53722),e(82752),e(28999),e(38748),e(50923),e(42212),e(91963),e(41007)),j=e(25387),v=e(83944),s=e(57964),u=e(4703),i=e(3233),o=e(79412),a=e(77675),r=e(80543),Z=(e(14007),e(65311),e(49301)),b=e(62185),O=e(10141),P=e(60301),U=e(1868),A=e(44107),H=e(95060),N=e(52315),X=e(29674),k=e(4257),W=e(27426),ee=e(92344),$=e(80099),re=e(70509),ce=e(29717),se=e(38866),pe=e(12522),J=e(34411),Ne=e(95539),ye=e(89317),ne=e(85295);function je({associatedLayer:t,serviceUpdateTimeStamp:l}){const n=t?.editingInfo?.lastEditDate,h=t?.serverGens,L=null!=n,F=null!=l,x=L&&F&&l.lastUpdate!==n.getTime();return L&&(x||!F&&h?.minServerGen!==h?.serverGen)}var Ue=e(97403);const Ge=t=>{let l=class extends t{constructor(){super(...arguments),this.serviceTimeInfo=null}get timeInfo(){const n=this.associatedLayer?.timeInfo;if(null==n)return null;const h=n.clone();return(0,ne.UF)(h,this.fieldsIndex),h}set timeInfo(n){(0,ne.UF)(n,this.fieldsIndex),this._override("timeInfo",n)}get timeExtent(){return this.associatedLayer?.timeExtent}set timeExtent(n){this._override("timeExtent",n)}get timeOffset(){return this.associatedLayer?.timeOffset}set timeOffset(n){this._override("timeOffset",n)}get datesInUnknownTimezone(){return this.associatedLayer?.datesInUnknownTimezone??!1}set datesInUnknownTimezone(n){this._override("datesInUnknownTimezone",n)}loadTimeInfoFromService(n){var h=this;return(0,c.Z)(function*(){const{serviceTimeInfo:L}=h;if(null==L)return;const{startTimeField:F,endTimeField:x}=L;if(null==F&&null==x||je({associatedLayer:h.associatedLayer,serviceUpdateTimeStamp:h.serviceUpdateTimeStamp}))return;const G=function(){var z=(0,c.Z)(function*(Y){let ie=null;try{ie=(yield h.fetchStatistics?.(Y,n))?.stats}catch{}if(null==ie)return null;const{minTimeStr:De,min:Me,maxTimeStr:Le,max:Ce}=ie,me=Y===F?De??Me:Le??Ce;return null!=me?new Date(me):null});return function(ie){return z.apply(this,arguments)}}(),[V,Q]=yield Promise.all([G(F),G(x)]);if(null!=F&&null==V||null!=x&&null==Q)return;const te=new J.Z({start:V,end:Q});h.setAtOrigin("timeInfo",new Ue.Z({endField:x,startField:F,fullTimeExtent:te}),"service")})()}};return(0,d._)([(0,r.Cb)({type:Ue.Z,json:{read:!1,write:!1}})],l.prototype,"timeInfo",null),(0,d._)([(0,r.Cb)({type:J.Z,json:{read:!1,write:!1}})],l.prototype,"timeExtent",null),(0,d._)([(0,r.Cb)({type:Ne.Z,json:{read:!1,write:!1}})],l.prototype,"timeOffset",null),(0,d._)([(0,r.Cb)({type:Boolean,nonNullable:!0,json:{read:!1,write:!1}})],l.prototype,"datesInUnknownTimezone",null),(0,d._)([(0,r.Cb)({type:ae,readOnly:!0,json:{read:{source:"timeInfo"}}})],l.prototype,"serviceTimeInfo",void 0),l=(0,d._)([(0,O.j)("esri.layers.mixins.TemporalSceneLayer")],l),l};let ae=class extends ye.wq{constructor(){super(...arguments),this.endTimeField=null,this.startTimeField=null}};(0,d._)([(0,r.Cb)({type:String})],ae.prototype,"endTimeField",void 0),(0,d._)([(0,r.Cb)({type:String})],ae.prototype,"startTimeField",void 0),ae=(0,d._)([(0,O.j)("esri.layers.mixins.TemporalSceneLayer.SceneServiceTimeInfo")],ae);var Ae=e(89713),Ve=e(63724),He=e(36297),le=e(56956),Re=e(78818),$e=e(30664),Je=e(54887),Qe=e(27969),ze=e(40100),de=e(46637),Se=e(11642),Ye=e(40591),Fe=e(75421),Xe=e(39557),ke=e(79936);let q=class extends ye.wq{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};(0,d._)([(0,r.Cb)({type:String,json:{read:!0,write:!0}})],q.prototype,"name",void 0),(0,d._)([(0,r.Cb)({type:String,json:{read:!0,write:!0}})],q.prototype,"field",void 0),(0,d._)([(0,r.Cb)({type:[Number],json:{read:!0,write:!0}})],q.prototype,"currentRangeExtent",void 0),(0,d._)([(0,r.Cb)({type:[Number],json:{read:!0,write:!0}})],q.prototype,"fullRangeExtent",void 0),(0,d._)([(0,r.Cb)({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],q.prototype,"type",void 0),q=(0,d._)([(0,O.j)("esri.layers.support.RangeInfo")],q);var _e,be=e(66476),qe=e(34222),et=e(42214),Ke=e(23206),ve=e(5391),Be=e(83821);let Ee=_e=class extends((0,ye.eC)(v.Z.ofType(ve.Z))){constructor(t){super(t)}clone(){return new _e(this.items.map(t=>t.clone()))}write(t,l){return this.toJSON(l)}toJSON(t){const l=t?.layer?.spatialReference;return l?this.toArray().map(n=>{if(!l.equals(n.spatialReference)){if(!(0,Be.canProjectWithoutEngine)(n.spatialReference,l))return t?.messages&&t.messages.push(new Ke.Z("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:t.layer.spatialReference,context:t})),null;const L=new ve.Z;(0,Be.projectPolygon)(n,L,l),n=L}const h=n.toJSON(t);return delete h.spatialReference,h}).filter(n=>null!=n):(t?.messages&&t.messages.push(new Ke.Z("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:t.layer.spatialReference,context:t})),this.toArray().map(n=>n.toJSON(t)))}static fromJSON(t,l){const n=new _e;return t.forEach(h=>n.add(ve.Z.fromJSON(h,l))),n}};Ee=_e=(0,d._)([(0,O.j)("esri.layers.support.PolygonCollection")],Ee);const fe=Ee;var ge,tt=e(19677);let oe=ge=class extends ye.wq{constructor(t){super(t),this.spatialRelationship="disjoint",this.geometries=new fe,this._geometriesSource=null}initialize(){this.addHandles((0,a.on)(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,a.Z_))}readGeometries(t,l,n){Array.isArray(t)?this.geometries=fe.fromJSON(t,n):this._geometriesSource={url:(0,tt.f)(t,n),context:n}}loadGeometries(t,l){var n=this;return(0,c.Z)(function*(){if(null==n._geometriesSource)return;const{url:h,context:L}=n._geometriesSource,F=yield(0,be.Z)(h,{responseType:"json",signal:l?.signal}),x=t.toJSON(),G=F.data.map(V=>({...V,spatialReference:x}));n.geometries=fe.fromJSON(G,L),n._geometriesSource=null})()}clone(){const t=new ge({geometries:(0,qe.d9)(this.geometries),spatialRelationship:this.spatialRelationship});return t._geometriesSource=this._geometriesSource,t}};(0,d._)([(0,r.Cb)({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],oe.prototype,"spatialRelationship",void 0),(0,d._)([(0,r.Cb)({type:fe,nonNullable:!0,json:{write:!0}}),(0,et.B)({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],oe.prototype,"geometries",void 0),(0,d._)([(0,b.r)(["web-scene","portal-item"],"geometries")],oe.prototype,"readGeometries",null),oe=ge=(0,d._)([(0,O.j)("esri.layers.support.SceneFilter")],oe);const rt=oe;var st=e(6785);function Ie(){return(Ie=(0,c.Z)(function*({fieldName:t,statisticsInfo:l,errorContext:n,fieldsIndex:h,path:L,customParameters:F,apiKey:x,signal:G}){if(null==l)throw new s.Z(`${n}:no-cached-statistics`,"Cached statistics are not available for this layer");const V=h.get(t);if(null==V)throw new s.Z(`${n}:field-unexisting`,`Field '${t}' does not exist on the layer`);const Q=l.find(Y=>Y.name===V.name);if(null==Q)throw new s.Z(`${n}:no-cached-statistics`,"Cached statistics for this attribute are not available");const te=(0,st.v_)(L,Q.href),{data:z}=yield(0,be.Z)(te,{query:{f:"json",...F,token:x},responseType:"json",signal:G});return z})).apply(this,arguments)}var it=e(39262),nt=e(91866),he=e(43688),xe=e(13967),at=e(33331);function Oe(){return(Oe=(0,c.Z)(function*(t){const l=[];for(const n of t)n.name.toLowerCase().endsWith(".zip")?l.push(dt(n)):l.push(Promise.resolve(n));return(yield Promise.all(l)).flat()})).apply(this,arguments)}function dt(t){return Pe.apply(this,arguments)}function Pe(){return(Pe=(0,c.Z)(function*(t){const{BlobReader:l,ZipReader:n,BlobWriter:h}=yield Promise.all([e.e(8592),e.e(4548)]).then(e.bind(e,84548)),L=[];return(yield new n(new l(t)).getEntries()).forEach(x=>{if(x.directory||/^__MACOS/i.test(x.filename))return;const G=new h,V=x.getData?.(G).then(Q=>new File([Q],x.filename));V&&L.push(V)}),Promise.all(L)})).apply(this,arguments)}var ut=e(13643),We=e(96696),ct=e(39437);const pt=new Set(["3DObject","Point"]),Ze=(0,Qe.v)();let _=class extends(Ge((0,ee.o1)((0,se.Vt)((0,k.Y)((0,$.q)((0,re.I)((0,ce.M)((0,i.R)((0,W.N)((0,X.V)((0,j.J)(H.Z)))))))))))){constructor(...t){super(...t),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new v.Z,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0,this.serviceItemId=void 0}normalizeCtorArgs(t,l){return"string"==typeof t?{url:t,...l}:t}destroy(){this._set("renderer",null)}getField(t){return this.fieldsIndex.get(t)}getFieldDomain(t,l){const n=this.getFeatureType(l?.feature)?.domains?.[t];return n&&"inherited"!==n.type?n:this.getField(t)?.domain??null}getFeatureType(t){return t&&this.associatedLayer?this.associatedLayer.getFeatureType(t):null}get types(){return this.associatedLayer?.types??[]}get typeIdField(){return this.associatedLayer?.typeIdField??null}get templates(){return this.associatedLayer?.templates??null}get formTemplate(){return this.associatedLayer?.formTemplate??null}get fieldsIndex(){return new ze.Z(this.fields)}readNodePages(t,l,n){return"Point"===l.layerType&&(t=l.pointNodePages),null==t||"object"!=typeof t?null:de.U4.fromJSON(t,n)}set elevationInfo(t){this._set("elevationInfo",t),this.loaded&&this._validateElevationInfo()}get effectiveCapabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.effectiveCapabilities)}get effectiveEditingEnabled(){return null!=this.associatedLayer&&(0,Re.sX)(this.associatedLayer)}get geometryType(){return yt[this.profile]||"mesh"}set renderer(t){(0,ne.YN)(t,this.fieldsIndex),this._set("renderer",t)}readCachedDrawingInfo(t){return null!=t&&"object"==typeof t||(t={}),null==t.color&&(t.color=!1),t}get capabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.capabilities)}_capabilitiesFromAssociatedFeatureLayer(t){t=t??He.C;const{query:l,queryRelated:n,editing:{supportsGlobalId:h,supportsRollbackOnFailure:L,supportsUploadWithItemId:F,supportsGeometryUpdate:x,supportsReturnServiceEditsInSourceSpatialReference:G},data:{supportsZ:V,supportsM:Q,isVersioned:te,supportsAttachment:z},operations:{supportsEditing:Y,supportsAdd:ie,supportsUpdate:De,supportsDelete:Me,supportsQuery:Le,supportsQueryAttachments:Ce,supportsAsyncConvert3D:me}}=t,ue=t.operations.supportsChangeTracking,Te=!!this.associatedLayer?.infoFor3D&&(0,xe.Rx)();return{query:l,queryRelated:n,editing:{supportsGlobalId:h,supportsReturnServiceEditsInSourceSpatialReference:G,supportsRollbackOnFailure:L,supportsGeometryUpdate:Te&&x,supportsUploadWithItemId:F},data:{supportsAttachment:z,supportsZ:V,supportsM:Q,isVersioned:te},operations:{supportsQuery:Le,supportsQueryAttachments:Ce,supportsEditing:Y&&ue,supportsAdd:Te&&ie&&ue,supportsDelete:Te&&Me&&ue,supportsUpdate:De&&ue,supportsAsyncConvert3D:me}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.associatedLayer?.editingEnabled??!1}set editingEnabled(t){this._overrideIfSome("editingEnabled",t)}get infoFor3D(){return this.associatedLayer?.infoFor3D??null}get relationships(){return this.associatedLayer?.relationships}get defaultPopupTemplate(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(t,l){return!t&&l.fields&&l.fields.some(n=>("esriFieldTypeOID"===n.type&&(t=n.name),!!t)),t||void 0}readGlobalIdField(t,l){return!t&&l.fields&&l.fields.some(n=>("esriFieldTypeGlobalID"===n.type&&(t=n.name),!!t)),t||void 0}get displayField(){return this.associatedLayer?.displayField??null}readProfile(t,l){const n=l.store.profile;return null!=n&&we[n]?we[n]:(u.Z.getLogger(this).error("Unknown or missing profile",{profile:n,layer:this}),"mesh-pyramids")}get useViewTime(){return this.associatedLayer?.useViewTime??!0}set useViewTime(t){this._override("useViewTime",t)}load(t){return this.addResolvingPromise(this._load(t)),Promise.resolve(this)}_load(t){var l=this;return(0,c.Z)(function*(){const n=null!=t?t.signal:null;yield l.loadFromPortal({supportedTypes:["Scene Service"]},t).catch(o.r9),yield l._fetchService(n),yield Promise.all([l._fetchIndexAndUpdateExtent(l.nodePages,n),l._setAssociatedFeatureLayer(n),l._loadFilterGeometries()]),l._validateElevationInfo(),l._applyAssociatedLayerOverrides(),l._populateFieldUsageInfo(),yield l.loadTimeInfoFromService(t),yield(0,it.y)(l,{origin:"service"},n),(0,ne.YN)(l.renderer,l.fieldsIndex),yield l.finishLoadEditablePortalLayer(t)})()}beforeSave(){var t=this;return(0,c.Z)(function*(){null!=t.filter&&(t.filter=t.filter.clone(),yield t.load())})()}_loadFilterGeometries(){var t=this;return(0,c.Z)(function*(){if(t.filter)try{yield t.filter.loadGeometries(t.spatialReference)}catch(l){u.Z.getLogger(t).error("#_loadFilterGeometries()",t,"Failed to load filter geometries. Geometry filter will not be applied for this layer.",{error:l}),t.filter=null}})()}createQuery(){const t=new nt.Z;return"mesh"===this.geometryType?this.associatedLayer?.infoFor3D&&(t.returnGeometry=!0):(t.returnGeometry=!0,t.returnZ=!0),t.where=this.definitionExpression||"1=1",t.sqlFormat="standard",t.outFields=["*"],t}queryExtent(t,l){return this._getAssociatedLayerForQuery().then(n=>n.queryExtent(t||this.createQuery(),l))}queryFeatureCount(t,l){return this._getAssociatedLayerForQuery().then(n=>n.queryFeatureCount(t||this.createQuery(),l))}queryFeatures(t,l){return this._getAssociatedLayerForQuery().then(n=>n.queryFeatures(t||this.createQuery(),l)).then(n=>{if(n?.features)for(const h of n.features)h.layer=this,h.sourceLayer=this;return n})}queryRelatedFeatures(t,l){var n=this;return(0,c.Z)(function*(){if(yield n.load(),!n.associatedLayer)throw new s.Z("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:n});return n.associatedLayer.queryRelatedFeatures(t,l)})()}queryRelatedFeaturesCount(t,l){var n=this;return(0,c.Z)(function*(){if(yield n.load(),!n.associatedLayer)throw new s.Z("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:n});return n.associatedLayer.queryRelatedFeaturesCount(t,l)})()}queryCachedAttributes(t,l){var n=this;return(0,c.Z)(function*(){const h=(0,ne.Lk)(n.fieldsIndex,yield(0,We.e7)(n,(0,We.V5)(n)));return(0,ut.xe)(n.parsedUrl?.path??"",n.attributeStorageInfo??[],t,l,h,n.apiKey,n.customParameters)})()}queryCachedFeature(t,l){var n=this;return(0,c.Z)(function*(){const h=yield n.queryCachedAttributes(t,[l]);if(!h||0===h.length)throw new s.Z("scenelayer:feature-not-in-cached-data","Feature not found in cached data");const L=new R.Z;return L.attributes=h[0],L.layer=n,L.sourceLayer=n,L})()}queryObjectIds(t,l){return this._getAssociatedLayerForQuery().then(n=>n.queryObjectIds(t||this.createQuery(),l))}queryAttachments(t,l){return this._getAssociatedLayerForQuery().then(n=>n.queryAttachments(t,l))}getFieldUsageInfo(t){const l={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[t]||l:(u.Z.getLogger(this).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),l)}createPopupTemplate(t){return(0,at.eZ)(this,t)}_getAssociatedLayerForQuery(){const t=this.associatedLayer;return t?.loaded?Promise.resolve(t):this._loadAssociatedLayerForQuery()}_loadAssociatedLayerForQuery(){var t=this;return(0,c.Z)(function*(){if(yield t.load(),!t.associatedLayer)throw new s.Z("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:t});try{yield t.associatedLayer.load()}catch(l){throw new s.Z("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:t,error:l})}return t.associatedLayer})()}hasCachedStatistics(t){return null!=this.statisticsInfo&&this.statisticsInfo.some(l=>l.name===t)}queryCachedStatistics(t,l){var n=this;return(0,c.Z)(function*(){return yield n.load(l),yield n.fetchStatistics(t,l)})()}saveAs(t,l){var n=this;return(0,c.Z)(function*(){return n._debouncedSaveOperations(se.xp.SAVE_AS,{...l,getTypeKeywords:()=>n._getTypeKeywords(),portalItemLayerType:"scene"},t)})()}save(){var t=this;return(0,c.Z)(function*(){const l={getTypeKeywords:()=>t._getTypeKeywords(),portalItemLayerType:"scene"};return t._debouncedSaveOperations(se.xp.SAVE,l)})()}applyEdits(t,l){var n=this;return(0,c.Z)(function*(){const{applyEdits:h}=yield e.e(4523).then(e.bind(e,52334));let L=l;yield n.load();const F=n.associatedLayer;if(!F)throw new s.Z(`${n.type}-layer:not-editable`,"Service is not editable");yield F.load();const{globalIdField:x}=F,G=!!F.infoFor3D,V=L?.globalIdUsed??!0;if(G&&null==x)throw new s.Z(`${n.type}-layer:not-editable`,"Valid globalIdField expected on editable SceneLayer");if(G&&!V)throw new s.Z(`${n.type}-layer:globalid-required`,"globalIdUsed must not be false for SceneLayer editing as globalIds are required.");return(0,Ae.M8)(F.url)&&G&&null!=t.deleteFeatures&&null!=x&&(L={...L,globalIdToObjectId:yield(0,Re.HW)(F,t.deleteFeatures,x)}),h(n,F.source,t,L)})()}uploadAssets(t,l){var n=this;return(0,c.Z)(function*(){if(yield n.load(),null==n.associatedLayer)throw new s.Z(`${n.type}-layer:not-editable`,"Service is not editable");return yield n.associatedLayer.load(),n.associatedLayer.uploadAssets(t,l)})()}on(t,l){return super.on(t,l)}convertMesh(t,l){var n=this;return(0,c.Z)(function*(){const h=z=>{throw u.Z.getLogger(n).error(".convertMesh()",z.message),z};yield n.load(),n.infoFor3D||h(new s.Z("invalid:layer","SceneLayer has no capability for mesh conversion"));const L=yield n.extractAndFilterFiles(t),F=L.reduce((z,Y)=>(0,Se.$z)(n.infoFor3D,Y)?z+1:z,0);0===F&&h(new N.Q_),F>1&&h(new N.i1);const x=n.spatialReference,G=l?.location??new A.Z({x:0,y:0,z:0,spatialReference:x}),Q=U.Z.createWithExternalSource(G,L,{vertexSpace:G.spatialReference.isGeographic?"local":"georeferenced"}),[te]=yield n.uploadAssets([Q],l);return te})()}extractAndFilterFiles(t){var l=this;return(0,c.Z)(function*(){yield l.load();const n=l.infoFor3D;return n?(yield function lt(t){return Oe.apply(this,arguments)}(t)).filter(h=>(0,Se.F7)(n,h)):t})()}validateLayer(t){if(t.layerType&&!pt.has(t.layerType))throw new s.Z("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:t.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new s.Z("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new s.Z("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});!function l(n,h){let L=!1,F=!1;if(null==n)L=!0,F=!0;else{const x=h&&h.isGeographic;switch(n){case"east-north-up":case"earth-centered":L=!0,F=x;break;case"vertex-reference-frame":L=!0,F=!x;break;default:L=!1}}if(!L)throw new s.Z("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!F)throw new s.Z("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){const t=[];if("points"===this.profile)t.push("Point");else{if("mesh-pyramids"!==this.profile)throw new s.Z("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);t.push("3DObject")}return t}_populateFieldUsageInfo(){if(this._fieldUsageInfo={},this.fields)for(const t of this.fields){const l=!!this.attributeStorageInfo?.some(L=>L.name===t.name),n=!!this.associatedLayer?.fields?.some(L=>L&&t.name===L.name);this._fieldUsageInfo[t.name]={supportsLabelingInfo:l,supportsRenderer:l,supportsPopupTemplate:l||n,supportsLayerQuery:n}}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPopupOverrides(),this._applyAssociatedLayerExtentOverride(),this._applyAssociatedLayerPrivileges()}_applyAssociatedLayerFieldsOverrides(){if(!this.associatedLayer?.fields)return;let t=null;for(const l of this.associatedLayer.fields){const n=this.getField(l.name);n?(!n.domain&&l.domain&&(n.domain=l.domain.clone()),n.editable=l.editable,n.nullable=l.nullable,n.length=l.length):(t||(t=this.fields?this.fields.slice():[]),t.push(l.clone()))}t&&this._set("fields",t)}_applyAssociatedLayerPopupOverrides(){if(!this.associatedLayer)return;const t=["popupTemplate","popupEnabled"],l=(0,Z.vw)(this);for(let n=0;n<t.length;n++){const h=t[n],L=this.originIdOf(h),F=this.associatedLayer.originIdOf(h);L<F&&(F===P.s3.SERVICE||F===P.s3.PORTAL_ITEM)&&l.setAtOrigin(h,this.associatedLayer[h],F)}}_applyAssociatedLayerExtentOverride(){const t=this.associatedLayer?.getAtOrigin("fullExtent","service");(0,xe.Rx)()&&null!=this.associatedLayer?.infoFor3D&&t&&(0,Ae.M8)(this.associatedLayer?.url)&&je(this)&&(0,Z.vw)(this).setAtOrigin("fullExtent",t.clone(),P.s3.SERVICE)}_applyAssociatedLayerPrivileges(){const t=this.associatedLayer;t&&(this._set("userHasEditingPrivileges",t.userHasEditingPrivileges),this._set("userHasFullEditingPrivileges",t.userHasFullEditingPrivileges),this._set("userHasUpdateItemPrivileges",t.userHasUpdateItemPrivileges))}_setAssociatedFeatureLayer(t){var l=this;return(0,c.Z)(function*(){if(["mesh-pyramids","points"].includes(l.profile))try{const{serverUrl:n,layerId:h,portalItem:L}=yield(0,Ve.w)(`${l.url}/layers/${l.layerId}`,{sceneLayerItem:l.portalItem,customParameters:l.customParameters,apiKey:l.apiKey,signal:t}),F=yield ke.T.FeatureLayer();l.associatedLayer=new F({url:n,customParameters:l.customParameters,layerId:h,portalItem:L}),yield l.associatedLayer.load()}catch(n){(0,o.D_)(n)||l._logWarningOnPopupEnabled()}})()}_logWarningOnPopupEnabled(){var t=this;return(0,c.Z)(function*(){yield(0,a.N1)(()=>t.popupEnabled&&null!=t.popupTemplate);const l=`this SceneLayer: ${t.title}`;null==t.attributeStorageInfo?u.Z.getLogger(t).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${l}`):u.Z.getLogger(t).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${l}`)})()}_validateElevationInfo(){const t=this.elevationInfo;"mesh-pyramids"===this.profile&&(0,he.LR)(u.Z.getLogger(this),(0,he.Wb)("Mesh scene layers","relative-to-scene",t)),(0,he.LR)(u.Z.getLogger(this),(0,he.kf)("Scene layers",t))}fetchStatistics(t,l){var n=this;return(0,c.Z)(function*(){return yield function ot(t){return Ie.apply(this,arguments)}({fieldName:t,statisticsInfo:n.statisticsInfo,errorContext:"scenelayer",fieldsIndex:n.fieldsIndex,path:n.parsedUrl?.path??"",customParameters:n.customParameters,apiKey:n.apiKey,signal:l?.signal})})()}};(0,d._)([(0,r.Cb)({types:{key:"type",base:$e.B,typeMap:{selection:Je.Z}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],_.prototype,"featureReduction",void 0),(0,d._)([(0,r.Cb)({type:[q],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],_.prototype,"rangeInfos",void 0),(0,d._)([(0,r.Cb)({json:{read:!1}})],_.prototype,"associatedLayer",void 0),(0,d._)([(0,r.Cb)({type:["show","hide"]})],_.prototype,"listMode",void 0),(0,d._)([(0,r.Cb)({type:["ArcGISSceneServiceLayer"]})],_.prototype,"operationalLayerType",void 0),(0,d._)([(0,r.Cb)({json:{read:!1},readOnly:!0})],_.prototype,"type",void 0),(0,d._)([(0,r.Cb)({...Ze.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],_.prototype,"fields",void 0),(0,d._)([(0,r.Cb)()],_.prototype,"types",null),(0,d._)([(0,r.Cb)()],_.prototype,"typeIdField",null),(0,d._)([(0,r.Cb)()],_.prototype,"templates",null),(0,d._)([(0,r.Cb)()],_.prototype,"formTemplate",null),(0,d._)([(0,r.Cb)({readOnly:!0,clonable:!1})],_.prototype,"fieldsIndex",null),(0,d._)([(0,r.Cb)({type:Xe.Z,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],_.prototype,"floorInfo",void 0),(0,d._)([(0,r.Cb)(Ze.outFields)],_.prototype,"outFields",void 0),(0,d._)([(0,r.Cb)({type:de.U4,readOnly:!0,json:{read:!1}})],_.prototype,"nodePages",void 0),(0,d._)([(0,b.r)("service","nodePages",["nodePages","pointNodePages"])],_.prototype,"readNodePages",null),(0,d._)([(0,r.Cb)({type:[de.QI],readOnly:!0})],_.prototype,"materialDefinitions",void 0),(0,d._)([(0,r.Cb)({type:[de.Yh],readOnly:!0})],_.prototype,"textureSetDefinitions",void 0),(0,d._)([(0,r.Cb)({type:[de.H3],readOnly:!0})],_.prototype,"geometryDefinitions",void 0),(0,d._)([(0,r.Cb)({readOnly:!0})],_.prototype,"serviceUpdateTimeStamp",void 0),(0,d._)([(0,r.Cb)({readOnly:!0})],_.prototype,"attributeStorageInfo",void 0),(0,d._)([(0,r.Cb)({readOnly:!0})],_.prototype,"statisticsInfo",void 0),(0,d._)([(0,r.Cb)({type:v.Z.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],_.prototype,"excludeObjectIds",void 0),(0,d._)([(0,r.Cb)({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],_.prototype,"definitionExpression",void 0),(0,d._)([(0,r.Cb)({type:rt,json:{name:"layerDefinition.polygonFilter",write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],_.prototype,"filter",void 0),(0,d._)([(0,r.Cb)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],_.prototype,"path",void 0),(0,d._)([(0,r.Cb)(le.PV)],_.prototype,"elevationInfo",null),(0,d._)([(0,r.Cb)({readOnly:!0,json:{read:!1}})],_.prototype,"effectiveCapabilities",null),(0,d._)([(0,r.Cb)({readOnly:!0})],_.prototype,"effectiveEditingEnabled",null),(0,d._)([(0,r.Cb)({type:String})],_.prototype,"geometryType",null),(0,d._)([(0,r.Cb)(le.iR)],_.prototype,"labelsVisible",void 0),(0,d._)([(0,r.Cb)({type:[Ye.Z],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:Fe.r},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:Fe.r},write:!0}})],_.prototype,"labelingInfo",void 0),(0,d._)([(0,r.Cb)(le.rn)],_.prototype,"legendEnabled",void 0),(0,d._)([(0,r.Cb)({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(t,l){if("number"==typeof t&&t>=0&&t<=1)return t;const n=l.layerDefinition?.drawingInfo?.transparency;return void 0!==n?(0,ct.b)(n):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],_.prototype,"opacity",void 0),(0,d._)([(0,r.Cb)({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],_.prototype,"priority",void 0),(0,d._)([(0,r.Cb)({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],_.prototype,"semantic",void 0),(0,d._)([(0,r.Cb)({types:M.o,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],_.prototype,"renderer",null),(0,d._)([(0,r.Cb)({json:{read:!1}})],_.prototype,"cachedDrawingInfo",void 0),(0,d._)([(0,b.r)("service","cachedDrawingInfo")],_.prototype,"readCachedDrawingInfo",null),(0,d._)([(0,r.Cb)({readOnly:!0,json:{read:!1}})],_.prototype,"capabilities",null),(0,d._)([(0,r.Cb)({type:Boolean,json:{read:!1}})],_.prototype,"editingEnabled",null),(0,d._)([(0,r.Cb)({readOnly:!0,json:{write:!1,read:!1}})],_.prototype,"infoFor3D",null),(0,d._)([(0,r.Cb)({readOnly:!0,json:{write:!1,read:!1}})],_.prototype,"relationships",null),(0,d._)([(0,r.Cb)(le.C_)],_.prototype,"popupEnabled",void 0),(0,d._)([(0,r.Cb)({type:C.Z,json:{name:"popupInfo",write:!0}})],_.prototype,"popupTemplate",void 0),(0,d._)([(0,r.Cb)({readOnly:!0,json:{read:!1}})],_.prototype,"defaultPopupTemplate",null),(0,d._)([(0,r.Cb)({type:String,json:{read:!1}})],_.prototype,"objectIdField",void 0),(0,d._)([(0,b.r)("service","objectIdField",["objectIdField","fields"])],_.prototype,"readObjectIdField",null),(0,d._)([(0,r.Cb)({type:String,json:{read:!1}})],_.prototype,"globalIdField",void 0),(0,d._)([(0,b.r)("service","globalIdField",["globalIdField","fields"])],_.prototype,"readGlobalIdField",null),(0,d._)([(0,r.Cb)({readOnly:!0,type:String,json:{read:!1}})],_.prototype,"displayField",null),(0,d._)([(0,r.Cb)({type:String,json:{read:!1}})],_.prototype,"profile",void 0),(0,d._)([(0,b.r)("service","profile",["store.profile"])],_.prototype,"readProfile",null),(0,d._)([(0,r.Cb)({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],_.prototype,"normalReferenceFrame",void 0),(0,d._)([(0,r.Cb)(le.YI)],_.prototype,"screenSizePerspectiveEnabled",void 0),(0,d._)([(0,r.Cb)({json:{read:!1,origins:{service:{read:!0}}}})],_.prototype,"serviceItemId",void 0),(0,d._)([(0,r.Cb)(pe.I)],_.prototype,"useViewTime",null),_=(0,d._)([(0,O.j)("esri.layers.SceneLayer")],_);const we={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},yt={"mesh-pyramids":"mesh",points:"point"},_t=_},29674:(w,S,e)=>{e.d(S,{V:()=>E});var c=e(50484),d=e(80543),T=(e(14007),e(4703),e(65311),e(10141));const E=m=>{let y=class extends m{get apiKey(){return this._isOverridden("apiKey")?this._get("apiKey"):function I(m){return"portalItem"in m}(this)?this.portalItem?.apiKey:null}set apiKey(f){null!=f?this._override("apiKey",f):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return(0,c._)([(0,d.Cb)({type:String})],y.prototype,"apiKey",null),y=(0,c._)([(0,T.j)("esri.layers.mixins.APIKeyMixin")],y),y}},4257:(w,S,e)=>{e.d(S,{Y:()=>E});var c=e(50484),d=e(4703),R=e(80543),T=(e(14007),e(65311),e(10141)),I=e(89713);const E=m=>{let y=class extends m{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const f=(0,I.Qc)(this.url);if(null!=f&&f.title)return f.title}return this._get("title")||""}set title(f){this._set("title",f)}set url(f){this._set("url",(0,I.Nm)(f,d.Z.getLogger(this)))}};return(0,c._)([(0,R.Cb)()],y.prototype,"title",null),(0,c._)([(0,R.Cb)({type:String})],y.prototype,"url",null),y=(0,c._)([(0,T.j)("esri.layers.mixins.ArcGISService")],y),y}},27426:(w,S,e)=>{e.d(S,{N:()=>I});var c=e(50484),d=e(80543),T=(e(14007),e(4703),e(65311),e(10141));const I=E=>{let m=class extends E{constructor(){super(...arguments),this.customParameters=null}};return(0,c._)([(0,d.Cb)({type:Object,json:{write:{overridePolicy:y=>({enabled:!!(y&&Object.keys(y).length>0)})}}})],m.prototype,"customParameters",void 0),m=(0,c._)([(0,T.j)("esri.layers.mixins.CustomParametersMixin")],m),m}},92344:(w,S,e)=>{e.d(S,{jF:()=>D,lQ:()=>v,o1:()=>i});var c=e(50484),d=e(88278),R=e(34222),C=e(79412),K=e(80543),E=(e(14007),e(4703),e(10141)),m=e(93604);const y=new d.Z.EventEmitter;function D(o,a,r=null,p=!1){const B=(0,C.hh)();return y.emit("apply-edits",{serviceUrl:o,layerId:a,gdbVersion:r,mayReceiveServiceEdits:p=null==a||p,result:B.promise}),B}const j=Symbol();function v(o){return null!=o&&"object"==typeof o&&j in o}function s(o){return null!=o&&"object"==typeof o&&"gdbVersion"in o}function u(o,a,r){const p=new URL(o).host,B=m.Jp.get(p),Z=b=>!b||b===B;return Z(a)&&Z(r)||a===r}const i=o=>{var a;let r=class extends o{constructor(...p){super(...p),this[a]=!0,this._applyEditsHandler=B=>{const{serviceUrl:Z,layerId:b,gdbVersion:O,mayReceiveServiceEdits:P,result:U}=B,A=Z===this.url,H=null!=b&&null!=this.layerId&&b===this.layerId,N=s(this),X=s(this)&&u(Z,O,this.gdbVersion);if(!A||N&&!X||!H&&!P)return;const k=U.then(W=>{if(this.lastEditsEventDate=new Date,H&&(W.addedFeatures.length||W.updatedFeatures.length||W.deletedFeatures.length||W.addedAttachments.length||W.updatedAttachments.length||W.deletedAttachments.length))return this.emit("edits",(0,R.d9)(W)),W;const ee=W.editedFeatures?.find(({layerId:re})=>re===this.layerId);if(ee){const{adds:re,updates:ce,deletes:se}=ee.editedFeatures,pe={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:re?re.map(({attributes:J})=>({objectId:this.objectIdField&&J[this.objectIdField],globalId:this.globalIdField&&J[this.globalIdField]})):[],deletedFeatures:se?se.map(({attributes:J})=>({objectId:this.objectIdField&&J[this.objectIdField],globalId:this.globalIdField&&J[this.globalIdField]})):[],updatedFeatures:ce?ce.map(({current:{attributes:J}})=>({objectId:this.objectIdField&&J[this.objectIdField],globalId:this.globalIdField&&J[this.globalIdField]})):[],editedFeatures:(0,R.d9)(W.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,R.d9)(W.historicMoment)};return this.emit("edits",pe),pe}const $={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:(0,R.d9)(W.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,R.d9)(W.historicMoment)};return"historicMoment"in this&&this._shouldUpdateHistoricMoment(Z,O,$.historicMoment)&&this.emit("edits",$),$}).then(W=>("historicMoment"in this&&this._shouldUpdateHistoricMoment(Z,O,W.historicMoment)&&(this.historicMoment=W.historicMoment),W));this.emit("apply-edits",{result:k})},this._updateMomentHandler=B=>{const{serviceUrl:Z,gdbVersion:b,moment:O}=B,P=Z===this.url,U=s(this),A=s(this)&&u(Z,b,this.gdbVersion),H=s(this)&&!u(Z,this.gdbVersion,null);P&&U&&A&&H&&"historicMoment"in this&&this.historicMoment!==O&&(this.historicMoment=O)},this.when().then(()=>{this.addHandles(function f(o){return y.on("apply-edits",new WeakRef(o))}(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(function g(o){return y.on("update-moment",new WeakRef(o))}(this._updateMomentHandler))},()=>{})}_shouldUpdateHistoricMoment(p,B,Z){return"historicMoment"in this&&this.historicMoment!==Z&&(0,m.JV)(p,B)}};return a=j,(0,c._)([(0,K.Cb)()],r.prototype,"lastEditsEventDate",void 0),r=(0,c._)([(0,E.j)("esri.layers.mixins.EditBusLayer")],r),r}},70509:(w,S,e)=>{e.d(S,{I:()=>p});var c=e(15861),d=e(50484),R=e(11931),C=e(26152),K=e(66476),T=e(37636),I=e(57964),E=e(4703),m=e(51172),y=e(79412),f=e(6785),g=e(80543),j=(e(14007),e(65311),e(62185)),v=e(10141),s=e(7547),u=e(85971),i=e(61018),o=e(27835),a=e(57437),r=e(50318);const p=Z=>{let b=class extends Z{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,m.SC)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(O){O!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",O))}readPortalItem(O,P,U){if(P.itemId)return new o.default({id:P.itemId,portal:U?.portal})}writePortalItem(O,P){O?.id&&(P.itemId=O.id)}loadFromPortal(O,P){var U=this;return(0,c.Z)(function*(){if(U.portalItem?.id)try{const{load:A}=yield Promise.all([e.e(2772),e.e(8592),e.e(6964)]).then(e.bind(e,36964));return(0,y.k_)(P),yield A({instance:U,supportedTypes:O.supportedTypes,validateItem:O.validateItem,supportsData:O.supportsData,layerModuleTypeMap:O.layerModuleTypeMap},P)}catch(A){throw(0,y.D_)(A)||E.Z.getLogger(U).warn(`Failed to load layer (${U.title}, ${U.id}) portal item (${U.portalItem.id})\n  ${A}`),A}})()}finishLoadEditablePortalLayer(O){var P=this;return(0,c.Z)(function*(){P._set("userHasEditingPrivileges",yield P._fetchUserHasEditingPrivileges(O).catch(U=>((0,y.r9)(U),!0)))})()}setUserPrivileges(O,P){var U=this;return(0,c.Z)(function*(){if(!R.default.userPrivilegesApplied)return U.finishLoadEditablePortalLayer(P);if(U.url)try{const{features:{edit:A,fullEdit:H},content:{updateItem:N}}=yield U._fetchUserPrivileges(O,P);U._set("userHasEditingPrivileges",A),U._set("userHasFullEditingPrivileges",H),U._set("userHasUpdateItemPrivileges",N)}catch(A){(0,y.r9)(A)}})()}_fetchUserPrivileges(O,P){var U=this;return(0,c.Z)(function*(){let A=U.portalItem;if(!O||!A||!A.loaded||A.sourceUrl)return U._fetchFallbackUserPrivileges(P);const H=O===A.id;if(H&&A.portal.user)return(0,r.Ss)(A);let N,X;if(H)N=A.portal.url;else try{N=yield(0,u.oP)(U.url,P)}catch($){(0,y.r9)($)}if(!N||!(0,f.Zo)(N,A.portal.url))return U._fetchFallbackUserPrivileges(P);try{const $=null!=P?P.signal:null;X=yield C.id?.getCredential(`${N}/sharing`,{prompt:!1,signal:$})}catch($){(0,y.r9)($)}if(!X)return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}};try{if(H?yield A.reload():(A=new o.default({id:O,portal:{url:N}}),yield A.load(P)),A.portal.user)return(0,r.Ss)(A)}catch($){(0,y.r9)($)}return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}}})()}_fetchFallbackUserPrivileges(O){var P=this;return(0,c.Z)(function*(){let U=!0;try{U=yield P._fetchUserHasEditingPrivileges(O)}catch(A){(0,y.r9)(A)}return{features:{edit:U,fullEdit:!1},content:{updateItem:!1}}})()}_fetchUserHasEditingPrivileges(O){var P=this;return(0,c.Z)(function*(){const U=P.url?C.id?.findCredential(P.url):null;if(!U)return!0;const A=B.credential===U?B.user:yield P._fetchEditingUser(O);return B.credential=U,B.user=A,null==A?.privileges||A.privileges.includes("features:user:edit")})()}_fetchEditingUser(O){var P=this;return(0,c.Z)(function*(){const U=P.portalItem?.portal?.user;if(U)return U;const A=C.id?.findServerInfo(P.url??"");if(!A?.owningSystemUrl)return null;const H=`${A.owningSystemUrl}/sharing/rest`,N=i.Z.getDefault();if(N&&N.loaded&&(0,f.Fv)(N.restUrl)===(0,f.Fv)(H))return N.user;const X=`${H}/community/self`,k=null!=O?O.signal:null,W=yield(0,T.q6)((0,K.Z)(X,{authMode:"no-prompt",query:{f:"json"},signal:k}));return W.ok?a.Z.fromJSON(W.value.data):null})()}read(O,P){P&&(P.layer=this),super.read(O,P)}write(O,P){const U=P?.portal,A=this.portalItem?.id&&(this.portalItem.portal||i.Z.getDefault());return U&&A&&!(0,f.tm)(A.restUrl,U.restUrl)?(P.messages&&P.messages.push(new I.Z("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(O,{...P,layer:this})}};return(0,d._)([(0,g.Cb)({type:o.default})],b.prototype,"portalItem",null),(0,d._)([(0,j.r)("web-document","portalItem",["itemId"])],b.prototype,"readPortalItem",null),(0,d._)([(0,s.c)("web-document","portalItem",{itemId:{type:String}})],b.prototype,"writePortalItem",null),(0,d._)([(0,g.Cb)({clonable:!1})],b.prototype,"resourceReferences",void 0),(0,d._)([(0,g.Cb)({type:Boolean,readOnly:!0})],b.prototype,"userHasEditingPrivileges",void 0),(0,d._)([(0,g.Cb)({type:Boolean,readOnly:!0})],b.prototype,"userHasFullEditingPrivileges",void 0),(0,d._)([(0,g.Cb)({type:Boolean,readOnly:!0})],b.prototype,"userHasUpdateItemPrivileges",void 0),b=(0,d._)([(0,v.j)("esri.layers.mixins.PortalLayer")],b),b},B={credential:null,user:null}},12522:(w,S,e)=>{e.d(S,{I:()=>M,n:()=>j});var c=e(50484),d=e(34411),R=e(95539),C=e(80543),E=(e(14007),e(4703),e(65311),e(62185)),m=e(10141),y=e(76215),f=e(85295),g=e(97403),D=e(81238);const M={type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation",layerContainerTypes:y.C}}},j=v=>{let s=class extends v{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(u,i){const o=i.timeInfo.exportOptions;if(!o)return null;const a=o.timeOffset,r=D.v.fromJSON(o.timeOffsetUnits);return a&&r?new R.Z({value:a,unit:r}):null}set timeInfo(u){(0,f.UF)(u,this.fieldsIndex),this._set("timeInfo",u)}};return(0,c._)([(0,C.Cb)({type:d.Z,json:{write:!1}})],s.prototype,"timeExtent",void 0),(0,c._)([(0,C.Cb)({type:R.Z})],s.prototype,"timeOffset",void 0),(0,c._)([(0,E.r)("service","timeOffset",["timeInfo.exportOptions"])],s.prototype,"readOffset",null),(0,c._)([(0,C.Cb)({value:null,type:g.Z,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],s.prototype,"timeInfo",null),(0,c._)([(0,C.Cb)(M)],s.prototype,"useViewTime",void 0),s=(0,c._)([(0,m.j)("esri.layers.mixins.TemporalLayer")],s),s}},30664:(w,S,e)=>{e.d(S,{B:()=>E});var c=e(50484),d=e(89317),R=e(80543),I=(e(14007),e(4703),e(65311),e(10141));let E=class extends d.wq{constructor(){super(...arguments),this.type=null}};(0,c._)([(0,R.Cb)({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],E.prototype,"type",void 0),E=(0,c._)([(0,I.j)("esri.layers.support.FeatureReduction")],E)},54887:(w,S,e)=>{e.d(S,{Z:()=>y});var E,c=e(50484),d=e(80543),T=(e(14007),e(4703),e(65311),e(10141)),I=e(30664);let m=E=class extends I.B{constructor(f){super(f),this.type="selection"}clone(){return new E}};(0,c._)([(0,d.Cb)({type:["selection"]})],m.prototype,"type",void 0),m=E=(0,c._)([(0,T.j)("esri.layers.support.FeatureReductionSelection")],m);const y=m},39557:(w,S,e)=>{e.d(S,{Z:()=>f});var m,c=e(50484),d=e(83944),R=e(89317),C=e(80543),E=(e(14007),e(4703),e(65311),e(10141));let y=m=class extends R.wq{constructor(g){super(g),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new d.Z}clone(){return new m({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};(0,c._)([(0,C.Cb)({type:String,json:{write:!0}})],y.prototype,"floorField",void 0),(0,c._)([(0,C.Cb)({json:{read:!1,write:!1}})],y.prototype,"viewAllMode",void 0),(0,c._)([(0,C.Cb)({json:{read:!1,write:!1}})],y.prototype,"viewAllLevelIds",void 0),y=m=(0,c._)([(0,E.j)("esri.layers.support.LayerFloorInfo")],y);const f=y},97403:(w,S,e)=>{e.d(S,{Z:()=>v});var c=e(50484),d=e(34411),R=e(95539),C=e(25387),K=e(89317),T=e(80543),y=(e(14007),e(4703),e(65311),e(62185)),f=e(10141),g=e(7547),D=e(764);function M(s,u){return R.Z.fromJSON({value:s,unit:u})}let j=class extends((0,C.J)(K.wq)){constructor(s){super(s),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeZone=null,this.trackIdField=null,this.useTime=!0,this.stops=null}readFullTimeExtent(s,u){return u.timeExtent&&Array.isArray(u.timeExtent)&&2===u.timeExtent.length?d.Z.fromArray(u.timeExtent):null}writeFullTimeExtent(s,u){u.timeExtent=null!=s?.start&&null!=s.end?s.toArray():null}readInterval(s,u){return u.timeInterval&&u.timeIntervalUnits?M(u.timeInterval,u.timeIntervalUnits):u.defaultTimeInterval&&u.defaultTimeIntervalUnits?M(u.defaultTimeInterval,u.defaultTimeIntervalUnits):null}writeInterval(s,u){u.timeInterval=s?.toJSON().value??null,u.timeIntervalUnits=s?.toJSON().unit??null}};(0,c._)([(0,T.Cb)({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],j.prototype,"cumulative",void 0),(0,c._)([(0,T.Cb)({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],j.prototype,"endField",void 0),(0,c._)([(0,T.Cb)({type:d.Z,json:{write:{enabled:!0,allowNull:!0}}})],j.prototype,"fullTimeExtent",void 0),(0,c._)([(0,y.r)("fullTimeExtent",["timeExtent"])],j.prototype,"readFullTimeExtent",null),(0,c._)([(0,g.c)("fullTimeExtent")],j.prototype,"writeFullTimeExtent",null),(0,c._)([(0,T.Cb)({type:Boolean,json:{write:!0}})],j.prototype,"hasLiveData",void 0),(0,c._)([(0,T.Cb)({type:R.Z,json:{write:{enabled:!0,allowNull:!0}}})],j.prototype,"interval",void 0),(0,c._)([(0,y.r)("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],j.prototype,"readInterval",null),(0,c._)([(0,g.c)("interval")],j.prototype,"writeInterval",null),(0,c._)([(0,T.Cb)({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],j.prototype,"startField",void 0),(0,c._)([(0,T.Cb)((0,D.mi)("timeReference",!0))],j.prototype,"timeZone",void 0),(0,c._)([(0,T.Cb)({type:String,json:{write:{enabled:!0,allowNull:!0}}})],j.prototype,"trackIdField",void 0),(0,c._)([(0,T.Cb)({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],j.prototype,"useTime",void 0),(0,c._)([(0,T.Cb)({type:[Date],json:{read:!1}})],j.prototype,"stops",void 0),j=(0,c._)([(0,f.j)("esri.layers.support.TimeInfo")],j);const v=j},27969:(w,S,e)=>{e.d(S,{v:()=>T});var c=e(14007),d=e(4703),R=e(81247),C=e(40100),K=e(85295);function T(){return{fields:{type:[R.Z],value:null,set:function(I){if(I&&(0,c.Z)("big-integer-warning-enabled")){const E=I.filter(m=>"big-integer"===m.type||"oid"===m.type&&(m.length||0)>=8);if(E.length){const m=E.map(y=>`'${y.name}'`).join(", ");d.Z.getLogger(this).warn("#fields",`Layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}') references big-integer field(s): ${m}, support for which is experimental. Only integers less than ${Number.MAX_SAFE_INTEGER} (Number.MAX_SAFE_INTEGER) are supported.`)}}this._set("fields",I)}},fieldsIndex:{readOnly:!0,get(){return C.Z.fromLayer(this)}},outFields:{type:[String],json:{read:!1},set:function(I){this._userOutFields=I,this.notifyChange("outFields")},get:function(){const I=this._userOutFields;if(!I?.length)return null;if(I.includes("*"))return["*"];if(!this.fields)return I;for(const E of I)this.fieldsIndex?.has(E)||d.Z.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${E} found in outFields`,{layer:this,outFields:I});return(0,K.Q0)(this.fieldsIndex,I)}}}}},11642:(w,S,e)=>{e.d(S,{$6:()=>u,$z:()=>R,F7:()=>d,Ow:()=>I,S0:()=>T,d1:()=>E,dm:()=>m});const c=[["binary","application/octet-stream","bin",""]];function d(i,o){return null!=D(o.name,i?.supportedFormats??[])}function R(i,o){if(!i)return!1;const a=m(o,i.supportedFormats??[]);return null!=a&&i.editFormats.includes(a)}function T(i,o){return M(function g(i,o){const a=i.toLowerCase();return y(o).find(r=>j(r)===a)}(i,o))}function I(i,o){return M(D(i,o))}function E(i,o){return j(function f(i,o){return y(o).find(a=>M(a)===i)}(i,o))}function m(i,o){return I(i.name,o)??T(i.type,o)}function y(i){return[...c,...i]}function D(i,o){const a=i.toLowerCase();return y(o).find(r=>function v(i){return i?.[2].split(",").map(o=>o.toLowerCase())??[]}(r).some(p=>a.endsWith(p)))}function M(i){return i?.[0]}function j(i){return i?.[1].toLowerCase()}function u(i){return i.tables?.find(o=>"assetMaps"===o.role)}},50318:(w,S,e)=>{e.d(S,{$o:()=>g,Fj:()=>m,IW:()=>f,Ss:()=>j,_$:()=>E,ck:()=>y,hz:()=>M,qj:()=>I});var c=e(15861),d=e(83821),R=e(43814),C=e(48230);function T(){return(T=(0,c.Z)(function*(v){const s=v.spatialReference;if(s.isWGS84)return v.clone();if(s.isWebMercator)return(0,C.Sx)(v);const u=R.Z.WGS84;return yield(0,d.initializeProjection)(s,u),(0,d.project)(v,u)})).apply(this,arguments)}function I(v,s){if(!E(v,s)){const u=v.typeKeywords;u?u.push(s):v.typeKeywords=[s]}}function E(v,s){return!!v.typeKeywords?.includes(s)}function m(v){return E(v,M.HOSTED_SERVICE)}function y(v,s){const u=v.typeKeywords;if(u){const i=u.indexOf(s);i>-1&&u.splice(i,1)}}function f(v,s,u){u?I(v,s):y(v,s)}function g(v){return D.apply(this,arguments)}function D(){return D=(0,c.Z)(function*(v){const s=v.clone().normalize();let u;if(s.length>1)for(const i of s)u?i.width>u.width&&(u=i):u=i;else u=s[0];return function K(v){return T.apply(this,arguments)}(u)}),D.apply(this,arguments)}const M={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function j(v){const{portal:s,isOrgItem:u,itemControl:i}=v,o=s.user?.privileges;let a=!o||o.includes("features:user:edit"),r=!!u&&!!o?.includes("features:user:fullEdit");const p="update"===i||"admin"===i;return p?r=a=!0:r&&(a=!0),{features:{edit:a,fullEdit:r},content:{updateItem:p}}}},81238:(w,S,e)=>{e.d(S,{v:()=>d});const d=(0,e(84303).w)()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0})},39262:(w,S,e)=>{e.d(S,{y:()=>K});var c=e(15861),d=e(37636),R=e(79412),C=e(23206);function K(I,E,m){return T.apply(this,arguments)}function T(){return(T=(0,c.Z)(function*(I,E,m){const y=I&&I.getAtOrigin&&I.getAtOrigin("renderer",E.origin);if(y&&"unique-value"===y.type&&y.styleOrigin){const f=yield(0,d.q6)(y.populateFromStyle());if((0,R.k_)(m),!1===f.ok){const g=f.error;E?.messages&&E.messages.push(new C.Z("renderer:style-reference",`Failed to create unique value renderer from style reference: ${g.message}`,{error:g,context:E})),I.clear("renderer",E?.origin)}}})).apply(this,arguments)}},93604:(w,S,e)=>{e.d(S,{JV:()=>g,Jp:()=>K,Px:()=>y,U8:()=>C,r9:()=>E});var c=e(15861),d=e(66476);const C=(0,e(19986).dG)(),K=new Map,T=new Map;function E(D,M,j){return m.apply(this,arguments)}function m(){return(m=(0,c.Z)(function*(D,M,j){if(!D||!j)return!1;if(!M)return!0;const v=new URL(D).host;let s=K.get(v);if(!s){const u=D.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");s=(yield(0,d.Z)(u,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return s===M})).apply(this,arguments)}function y(D,M){return f.apply(this,arguments)}function f(){return(f=(0,c.Z)(function*(D,M,j=!1){if(!D||!M)return!0;const v=D.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),s=T.get(v)?.entries();if(s)for(const[u,i]of s)if(i.name===M){const o=!i.stack?.hasForwardEdits();if(!o&&j){const[{deleteForwardEdits:a},{default:r}]=yield Promise.all([e.e(1015).then(e.bind(e,51015)),e.e(560).then(e.bind(e,80560))]),p=yield a(v,u,new r({sessionId:C,moment:i.moment}));return p.success&&i.stack?.clearForwardEdits(),p.success}return o}return!0})).apply(this,arguments)}function g(D,M){if(!D)return!1;const j=D.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),v=T.get(j)?.entries();if(v)for(const[s,u]of v)if(u.name===M)return"edit"===u.lockType;return!1}}}]);