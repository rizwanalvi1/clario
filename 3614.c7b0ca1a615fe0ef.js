"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[3614],{34317:(be,q,m)=>{m.d(q,{k2:()=>ze,IG:()=>Yt,W4:()=>Xt});var R=m(99657),E=m(43101);class N{constructor(){this.drawPhase=E.jx.MAP|E.jx.HITTEST|E.jx.HIGHLIGHT|E.jx.DEBUG}startup(){}shutdown(i){}}class F extends N{constructor(){super(...arguments),this.overrideStencilRef=null,this.symbologyPlane=E.mH.FILL,this.postProcessingEnabled=!1}postProcess(i,r){}}var h=m(32398),I=m(75399),u=m(50484),d=m(78607),s=m(49598),H=m(29564),J=m(66511);class ne extends d.Pz{}(0,u._)([(0,d.xh)(0,s.Sg)],ne.prototype,"pos",void 0);class le extends d.oo{}(0,u._)([(0,d.e5)(s.bv)],le.prototype,"dotSize",void 0);class re extends d.oo{}(0,u._)([(0,d.e5)(s.Eg)],re.prototype,"locations",void 0),(0,u._)([(0,d.e5)(s.bv)],re.prototype,"pixelRatio",void 0),(0,u._)([(0,d.e5)(s.bv)],re.prototype,"tileZoomFactor",void 0);class v extends d.ri{vertex(i){const r=new s.Tu(1,0,0,0,-1,0,0,1,1).multiply(new s.AO(i.pos.xy.divide(R.i9),1)),a=(0,s.ig)(this.draw.locations,r.xy),o=(0,s.Fp)(this.instance.dotSize.divide(2),new s.bv(1));let l=new s.bv(0);l=l.add((0,s.Nb)(a.a,new s.bv(1e-6)).multiply(2));let p=o.add(this.instance.dotSize);const f=this.view.displayViewScreenMat3.multiply(new s.AO(i.pos.add(.5),1)),x=new s.T8(f.xy,l,1),V=this.instance.dotSize.divide(p),w=new s.bv(-1).divide(o.divide(p));return p=p.multiply(this.draw.pixelRatio.multiply(this.draw.tileZoomFactor)),{glPosition:x,glPointSize:p,color:a,ratio:V,invEdgeRatio:w}}fragment(i){const r=(0,s.kE)(i.glPointCoord.subtract(.5)).multiply(2),a=(0,s.CW)(new s.bv(0),new s.bv(1),i.invEdgeRatio.multiply(r.subtract(i.ratio)).add(1)),o=new d.Qt;return o.glFragColor=i.color.multiply(a),o}}(0,u._)([(0,d.e5)(le)],v.prototype,"instance",void 0),(0,u._)([(0,d.e5)(re)],v.prototype,"draw",void 0),(0,u._)([(0,d.e5)(J.C)],v.prototype,"view",void 0),(0,u._)([(0,u.a)(0,(0,d.qH)(ne))],v.prototype,"vertex",null),(0,u._)([(0,u.a)(0,(0,d.qH)(class he extends H.fz{}))],v.prototype,"fragment",null);var _=m(78139),O=m(73089);class K extends H.HN{}(0,u._)([(0,d.xh)(3,s.bv)],K.prototype,"inverseArea",void 0);class ee extends d.oo{}(0,u._)([(0,d.e5)(s.v8.ofType(s.T8,2))],ee.prototype,"isActive",void 0),(0,u._)([(0,d.e5)(s.v8.ofType(s.T8,8))],ee.prototype,"colors",void 0),(0,u._)([(0,d.e5)(s.bv)],ee.prototype,"dotValue",void 0);class S extends d.oo{}(0,u._)([(0,d.e5)(s.Eg)],S.prototype,"dotTexture0",void 0),(0,u._)([(0,d.e5)(s.Eg)],S.prototype,"dotTexture1",void 0),(0,u._)([(0,d.e5)(s.bv)],S.prototype,"tileZoomFactor",void 0),(0,u._)([(0,d.e5)(s.bv)],S.prototype,"pixelRatio",void 0),(0,u._)([(0,d.e5)(s.bv)],S.prototype,"tileDotsOverArea",void 0);class n extends H.Ie{_dotThreshold(i,r,a){return i.divide(r).divide(a)}vertex(i){const r=new s.Tu(2/R.i9,0,0,0,-2/R.i9,0,-1,1,1).multiply(new s.AO(i.pos,1)),a=this.clip(i.id),o=new s.T8(r.xy,a,1),l=this.storage.getVVData(i.id).multiply(this.instance.isActive.get(0)).multiply(i.inverseArea),p=this.storage.getDataDrivenData0(i.id).multiply(this.instance.isActive.get(1)).multiply(i.inverseArea),f=this.draw.tileZoomFactor.multiply(R.i9).divide(this.draw.pixelRatio),x=this._dotThreshold(l,this.instance.dotValue,this.draw.tileDotsOverArea),V=this._dotThreshold(p,this.instance.dotValue,this.draw.tileDotsOverArea),w=i.pos.add(.5).divide(f);return{glPosition:o,color:new s.T8(0,0,0,0),textureCoords:w,thresholds0:x,thresholds1:V}}fragment(i){const r=new d.Qt,a=(0,s.ig)(this.draw.dotTexture0,i.textureCoords),o=(0,s.ig)(this.draw.dotTexture1,i.textureCoords),l=i.thresholds0.subtract(a),p=i.thresholds1.subtract(o);let f;const x=s.yb.fromColumns(this.instance.colors[0],this.instance.colors[1],this.instance.colors[2],this.instance.colors[3]),V=s.yb.fromColumns(this.instance.colors[4],this.instance.colors[5],this.instance.colors[6],this.instance.colors[7]);if(this.blending){const w=(0,s.Nb)(new s.bv(0),l),T=(0,s.Nb)(new s.bv(0),p),z=(0,s.AK)(w,l).add((0,s.AK)(T,p)),P=(0,s.Nb)(z,new s.bv(0)),L=new s.bv(1).subtract(P),B=z.add(P),U=l.multiply(w).divide(B),G=p.multiply(T).divide(B),ie=x.multiply(U).add(V.multiply(G));f=L.multiply(ie)}else{const w=(0,s.Fp)((0,O.X3)(l),(0,O.X3)(p)),T=(0,s.Nb)(w,new s.bv(0)),z=new s.bv(1).subtract(T),P=(0,s.Nb)(w,l),L=(0,s.Nb)(w,p),B=x.multiply(P).add(V.multiply(L));f=z.multiply(B)}return r.glFragColor=f,r}hittest(i){return(0,_.Oz)(this.hittestRequest)}}(0,u._)([d.Ou],n.prototype,"blending",void 0),(0,u._)([(0,d.e5)(ee)],n.prototype,"instance",void 0),(0,u._)([(0,d.e5)(S)],n.prototype,"draw",void 0),(0,u._)([(0,u.a)(0,(0,d.qH)(K))],n.prototype,"vertex",null),(0,u._)([(0,u.a)(0,(0,d.qH)(H.fz))],n.prototype,"fragment",null);var b=m(65311),c=m(39237);const y={[c.g.BYTE]:1,[c.g.UNSIGNED_BYTE]:1,[c.g.SHORT]:2,[c.g.UNSIGNED_SHORT]:2,[c.g.HALF_FLOAT]:2,[c.g.INT]:4,[c.g.UNSIGNED_INT]:4,[c.g.FLOAT]:4};var M=m(39853),C=m(46682),X=m(50205);class j{constructor(i,r){this._boundPart=null;const a=[];for(const l of r.vertex){const p=M.f.createVertex(i,c.l1.STATIC_DRAW,l);a.push(p)}const o=[];for(const l of r.index||[]){const p=M.f.createIndex(i,c.l1.STATIC_DRAW,l);o.push(p)}this.groups=[];for(const l of r.groups){let p;if(null!=l.index){if(!r.index)throw new Error("No index data.");const{BYTES_PER_ELEMENT:z}=r.index[l.index];2===z?p=c.g.UNSIGNED_SHORT:4===z&&(p=c.g.UNSIGNED_INT)}const f=null!=l.index?o[l.index]:null,x=new Map,V={},w={};for(const z of l.attributes){const{name:P,count:L,type:B,offset:U,normalized:G,divisor:ie,stride:de,vertex:pe,location:Y}=z,Z=`vertex-buffer-${pe}`;let $=V[Z];$||($=V[Z]=[]);const se=new X.G(P,L,B,U,de,G,ie);$.push(se),x.set(P,Y),w[Z]=a[pe]}const T=new C.U(i,x,V,w,f);this.groups.push({...l,vertexArray:T,locations:x,layout:V,indexing:p})}this.parts=r.parts}bind(i,r){this._boundPart=r;const{group:a}=this.parts[this._boundPart],{vertexArray:o}=this.groups[a];i.bindVAO(o)}draw(i){if(null==this._boundPart)throw new Error("Mesh.bind() has not been called.");const{start:r,count:a}=this.parts[this._boundPart],{group:o}=this.parts[this._boundPart],{indexing:l,primitive:p}=this.groups[o];l?i.drawElements(p,a,l,r*y[l]):i.drawArrays(p,r,a)}unbind(i){this._boundPart=null,i.bindVAO(null)}destroy(){for(const{vertexArray:i}of this.groups)i.dispose()}}var W=m(51059);class Q extends j{static create(i,r){const a=[];let{stride:o,hash:l}=r.layout;if(null==o){o=0;for(const{count:z,type:P,offset:L}of r.layout.attributes){if(null!=L)throw new Error("Stride cannot be computed automatically when attribute offsets are supplied explicitly.");o+=z*y[P]}}let p=0,f=0;for(const{count:z,name:P,offset:L,type:B,normalized:U}of r.layout.attributes)null!=L&&(f=L),a.push({name:P,location:p,vertex:0,count:z,type:B,offset:f,stride:o,divisor:0,normalized:null!=U&&U}),p++,f+=z*y[B];const x={attributes:a,primitive:r.primitive};null!=r.index&&(x.index=0);let{count:V}=r;if(null==V&&(V=r.index?r.index.length:r.vertex.byteLength/o,Math.floor(V)!==V))throw new Error(`The byte length of vertex data must be an exact multiple of the stride, which is ${o}.`);const T={vertex:[r.vertex],parts:[{start:0,count:V,group:0,primitive:r.primitive}],groups:[x]};return null!=r.index&&(T.index=[r.index]),null==l&&(l=(0,W.ig)(a)),new Q(i,T,{hash:l,attributes:a,stride:o})}constructor(i,r,a){super(i,r),this.layout=a}bind(i,r=0){super.bind(i,r)}}var oe=m(83018),Ae=m(19170),Ue=m(61312),Ne=m(17091),Oe=m(22784);class lt{constructor(){this._dotTextureSize=0,this._dotTextures=null,this._dotMesh=null}destroy(){this._disposeTextures(),this._dotFBO&&this._dotFBO.dispose(),this._dotMesh&&this._dotMesh.destroy()}getFBO(i){if(null==this._dotFBO){const r=R.i9,a=R.i9,o=new Oe.X(r,a);o.samplingMode=c.cw.NEAREST,o.wrapMode=c.e8.CLAMP_TO_EDGE;const l=new Ae.r(i,new Ue.Y(c.Tg.DEPTH_STENCIL,r,a));this._dotFBO=new oe.X(i,o,l)}return this._dotFBO}getDotDensityMesh(i){if(null==this._dotMesh){const r=R.i9,a=r*r,o=2,l=new Int16Array(a*o);for(let x=0;x<r;x++)for(let V=0;V<r;V++)l[o*(V+x*r)]=V,l[o*(V+x*r)+1]=x;const p=[{count:2,type:c.g.UNSIGNED_SHORT,name:"a_position",offset:0}],f={hash:(0,W.ig)(p),attributes:p,stride:4};this._dotMesh=Q.create(i,{primitive:c.MX.POINTS,vertex:l,count:a,layout:f})}return this._dotMesh}getDotDensityTextures(i,r,a){if(this._dotTextureSize===r&&this._seed===a||(this._disposeTextures(),this._dotTextureSize=r,this._seed=a),null===this._dotTextures){const o=new b.Z(a);this._dotTextures=[this._allocDotDensityTexture(i,r,o),this._allocDotDensityTexture(i,r,o)]}return this._dotTextures}_disposeTextures(){if(this._dotTextures){for(let i=0;i<this._dotTextures.length;i++)this._dotTextures[i].dispose();this._dotTextures=null}}_allocDotDensityTexture(i,r,a){const o=new Float32Array(r*r*4);for(let p=0;p<o.length;p++)o[p]=a.getFloat();const l=new Oe.X;return l.dataType=c.Br.FLOAT,l.samplingMode=c.cw.NEAREST,l.width=r,l.height=r,new Ne.x(i,l,o)}}var Ke=m(20220),ct=m(82812);function Se(g){const i=1/g;return{antialiasing:i,blur:0+i}}var pt=m(91197),mt=m(15690),yt=m(48366),gt=m(48303),St=m(4703),We=m(51172),Ee=m(57964);class je{constructor(i,r,a,o){this.dataType=i,this.samplingMode=r,this.pixelFormat=a,this.internalFormat=o}}class Vt{destroy(){this._accumulateFramebuffer=(0,We.M2)(this._accumulateFramebuffer),this._resolveGradientTexture=(0,We.M2)(this._resolveGradientTexture),this._prevGradientHash=null,this._qualityProfile=null}get initialized(){return null!=this._accumulateFramebuffer&&null!=this._resolveGradientTexture}get accumulateFramebuffer(){return this._accumulateFramebuffer}get resolveGradientTexture(){return this._resolveGradientTexture}loadQualityProfile(i){if(null==this._qualityProfile){const r=function _t(g,i){const{textureFloatLinear:r,colorBufferFloat:a}=g.capabilities,o=a?.textureFloat,l=a?.textureHalfFloat,p=a?.floatBlend,f=g.driverTest.floatBufferBlend.result;if(!o&&!l)throw new Ee.Z("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(p&&f||l))throw new Ee.Z("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float."+(f?"":" This device claims support for EXT_float_blend, but does not actually support it."));const x=o&&p&&f,V=l,w=r,T=!!a?.R32F,z=!!a?.R16F;if(x&&w)return w||i.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new je(c.Br.FLOAT,w?c.cw.LINEAR:c.cw.NEAREST,T?c.VI.RED:c.VI.RGBA,T?c.lP.R32F:c.VI.RGBA);if(V)return new je(c.Br.HALF_FLOAT,c.cw.LINEAR,z?c.VI.RED:c.VI.RGBA,z?c.lP.R16F:c.VI.RGBA);throw new Ee.Z("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.")}(i,St.Z.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.heatmap.HeatmapResources"));this._qualityProfile={...r,defines:{usesHalfFloatPrecision:r.dataType!==c.Br.FLOAT}}}return this._qualityProfile}ensureAccumulateFBO(i,r,a){if(null==this._accumulateFramebuffer){const{dataType:o,samplingMode:l,pixelFormat:p,internalFormat:f}=this.loadQualityProfile(i),x=new Oe.X(r,a);x.pixelFormat=p,x.internalFormat=f,x.dataType=o,x.samplingMode=l,x.wrapMode=c.e8.CLAMP_TO_EDGE;const V=new Ue.Y(c.Tg.DEPTH_STENCIL,r,a);this._accumulateFramebuffer=new oe.X(i,x,V)}else{const{width:o,height:l}=this._accumulateFramebuffer;o===r&&l===a||this._accumulateFramebuffer.resize(r,a)}return this._accumulateFramebuffer}ensureResolveGradientTexture(i,r,a){if(null==this._resolveGradientTexture){const o=new Oe.X;o.wrapMode=c.e8.CLAMP_TO_EDGE,this._resolveGradientTexture=new Ne.x(i,o)}else this._prevGradientHash!==r&&(this._resolveGradientTexture.resize(a.length/4,1),this._resolveGradientTexture.setData(a),this._prevGradientHash=r);return this._resolveGradientTexture}}function Ge(g){return g?.25:1}class ke extends H.HN{}(0,u._)([(0,d.xh)(5,s.Sg)],ke.prototype,"offset",void 0);class Fe extends d.oo{}(0,u._)([(0,d.e5)(s.bv)],Fe.prototype,"radius",void 0),(0,u._)([(0,d.e5)(s.bv)],Fe.prototype,"isFieldActive",void 0);class _e extends H.Ie{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(i){const{radius:r,isFieldActive:a}=this.kernelControls,o=i.offset,l=a.multiply(this.storage.getVVData(i.id).x).add(new s.bv(1).subtract(a)),p=this.view.displayViewScreenMat3.multiply(new s.AO(i.pos,1)).add(this.view.displayViewMat3.multiply(new s.AO(o,0)).multiply(r)),f=this.clip(i.id);return{glPosition:new s.T8(p.xy,f,1),offset:o,fieldValue:l,color:new s.T8(0),...this.maybeRunHittest(i,{},null)}}fragment(i){const{offset:r,fieldValue:a}=i,o=(0,s.kE)(r),l=(0,s.Nb)(o,new s.bv(1)),p=new s.bv(1).subtract(o.multiply(o)),f=p.multiply(p),x=l.multiply(f).multiply(a).multiply(new s.bv(Ge(this.usesHalfFloatPrecision)));return this.getFragmentOutput(new s.T8(x),i)}hittest(i){const{viewMat3:r,tileMat3:a}=this.view,o=r.multiply(a).multiply(new s.AO(i.pos,1));return(0,_.XM)(o.xy,this.kernelControls.radius,this.hittestRequest.position)}}(0,u._)([d.Ou],_e.prototype,"usesHalfFloatPrecision",void 0),(0,u._)([(0,d.e5)(Fe)],_e.prototype,"kernelControls",void 0),(0,u._)([(0,u.a)(0,(0,d.qH)(ke))],_e.prototype,"vertex",null),(0,u._)([(0,u.a)(0,(0,d.qH)(class Tt extends H.fz{}))],_e.prototype,"fragment",null);class Ze extends d.Pz{}(0,u._)([(0,d.xh)(0,s.Sg)],Ze.prototype,"pos",void 0);class Me extends d.oo{}(0,u._)([(0,d.e5)(s.Eg)],Me.prototype,"texture",void 0),(0,u._)([(0,d.e5)(s.Sg)],Me.prototype,"minAndInvRange",void 0),(0,u._)([(0,d.e5)(s.bv)],Me.prototype,"normalization",void 0);class Xe extends d.oo{}(0,u._)([(0,d.e5)(s.Eg)],Xe.prototype,"texture",void 0);class xe extends d.ri{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(i){return{glPosition:new s.T8(i.pos.multiply(2).subtract(1),1,1),uv:i.pos}}fragment(i){const{accumulatedDensity:r,gradient:a}=this;let o=(0,s.ig)(r.texture,i.uv).r.multiply(new s.bv(Ge(this.usesHalfFloatPrecision)));o=o.multiply(r.normalization),o=o.subtract(r.minAndInvRange.x).multiply(r.minAndInvRange.y);const l=(0,s.ig)(a.texture,new s.Sg(o,.5)),p=new d.Qt;return p.glFragColor=new s.T8(l.rgb.multiply(l.a),l.a),p}}function Ye(g){return g.key.level+1}(0,u._)([d.Ou],xe.prototype,"usesHalfFloatPrecision",void 0),(0,u._)([(0,d.e5)(Me)],xe.prototype,"accumulatedDensity",void 0),(0,u._)([(0,d.e5)(Xe)],xe.prototype,"gradient",void 0),(0,u._)([(0,u.a)(0,(0,d.qH)(Ze))],xe.prototype,"vertex",null),(0,u._)([(0,u.a)(0,(0,d.qH)(class zt extends d.XB{}))],xe.prototype,"fragment",null);const $e={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:{write:!1,test:{ref:Ye,compare:c.wb.GEQUAL,mask:255,op:{fail:c.xS.KEEP,zFail:c.xS.KEEP,zPass:c.xS.REPLACE}}}},Pt={...$e,stencil:!1},At={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};function Je(g,i){const{referenceScale:r,radius:a}=g.uniforms;return a*(0!==r?r/i.scale:1)}var ae=m(90450),Ce=m(54108),Qe=m(43158),qe=m(28121);class Re extends d.oo{getVVRotationMat4(i){return(0,s.KJ)((0,O.In)(i),s.yb.identity(),()=>{const r=this._getNormalizedAngle(i).multiply(ae.nF),a=(0,s.O$)(r),o=(0,s.mC)(r);return new s.yb(o,a,0,0,a.multiply(new s.bv(-1)),o,0,0,0,0,1,0,0,0,0,1)})}getVVRotationMat3(i){return(0,s.KJ)((0,O.In)(i),s.Tu.identity(),()=>{const r=this._getNormalizedAngle(i).multiply(ae.nF),a=(0,s.O$)(r),o=(0,s.mC)(r);return new s.Tu(o,a,0,a.multiply(new s.bv(-1)),o,0,0,0,1)})}_getNormalizedAngle(i){const r=(0,s.ln)(this.rotationType,new s.bv(ae.MO.Arithmatic));return(0,s.KJ)(r,new s.bv(90).subtract(i),i)}}(0,u._)([(0,d.e5)(s.bv)],Re.prototype,"rotationType",void 0);var et=m(87965),tt=m(38577),it=m(45597),st=m(76972),ge=m(56166);class ue extends H.HN{}(0,u._)([(0,d.xh)(3,s.T8)],ue.prototype,"color",void 0),(0,u._)([(0,d.xh)(4,s.Sg)],ue.prototype,"offset",void 0),(0,u._)([(0,d.xh)(5,s.Sg)],ue.prototype,"textureUV",void 0),(0,u._)([(0,d.xh)(6,s.bv)],ue.prototype,"fontSize",void 0),(0,u._)([(0,d.xh)(7,s.bv)],ue.prototype,"referenceSize",void 0),(0,u._)([(0,d.xh)(8,s.bv)],ue.prototype,"haloFontSize",void 0),(0,u._)([(0,d.xh)(9,s.T8)],ue.prototype,"haloColor",void 0),(0,u._)([(0,d.xh)(10,s.Sg)],ue.prototype,"zoomRange",void 0),(0,u._)([(0,d.xh)(11,s.bv)],ue.prototype,"clipAngle",void 0),(0,u._)([(0,d.xh)(12,s.T8)],ue.prototype,"referenceSymbol",void 0);class De extends d.yu{}(0,u._)([(0,d.xh)(13,s.Sg)],De.prototype,"offsetNextVertex1",void 0),(0,u._)([(0,d.xh)(14,s.Sg)],De.prototype,"offsetNextVertex2",void 0);class te extends H.Ie{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"]},this.isHaloPass=!1,this.isBackgroundPass=!1,this.isLabel=!1}clipLabel(i,r,a){const o=r.multiply(1.4173228346456692),l=(0,s.Wn)(this.view.rotation.subtract(o)),p=(0,s.VV)(new s.bv(360).subtract(l),l);let f=new s.bv(0);const x=(0,s.GW)(this.view.currentZoom.multiply(R.JS)).divide(R.JS),V=i.x,w=i.y,T=new s.bv(1).subtract((0,s.Nb)(V,x)).multiply(2),z=(0,s.Nb)(new s.bv(90),p).multiply(2),P=new s.bv(2).multiply(new s.bv(1).subtract((0,s.Nb)(x,w)));return f=f.add(a.multiply(T)),f=f.add(a.multiply(z)),f=f.add(P),f}vertex(i,r){const a=(0,O.qD)(i.bitset,ae.mL),o=new s.bv(1).subtract(a);let l=i.fontSize,p=l.divide(ae.V_);const f=this.isHaloPass?i.haloColor:this._getVertexColor(i),x=this.isLabel?this.storage.getAnimationValue(i.id):new s.bv(1),V=this.isLabel?f.multiply(x):f,w=this.view.displayViewScreenMat3.multiply(new s.AO(i.pos,1));let T=i.offset,z=new s.bv(1),P=s.Tu.identity(),L=new s.Sg(0);if(this.isLabel){if(!i.referenceSymbol)throw new Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");const Z=i.referenceSymbol,$=Z.xy,se=Z.z,k=this._unpackDirection(Z.w),Be=(0,ge.Vm)(this,i.id,se).divide(2),He=k.multiply(Be.add(R.gj));L=$.add(He),T=T.add(L)}else z=(0,ge.Vm)(this,i.id,i.referenceSize).divide(i.referenceSize),l=l.multiply(z),p=p.multiply(z),T=T.multiply(z),P=(0,ge.H8)(this,i.id),T=P.multiply(new s.AO(T,0)).xy;const B=(0,O.qD)(i.bitset,ae.$r),U=this._getViewRotationMatrix(B).multiply(new s.AO(T,0));let G=this.isLabel?this.clipLabel(i.zoomRange,i.clipAngle,B):this.clip(i.id,i.zoomRange);G=G.add(this.isBackgroundPass?o.multiply(2):a.multiply(2));const ie=this.isLabel?(0,s.or)((0,s.tS)(G,new s.bv(1)),(0,s.ln)(x,new s.bv(0))):new s.tW(!1),de=new s.T8(w.xy.add(U.xy),G,1),pe=i.textureUV.divide(this.mosaicInfo.size);let Y=new s.bv(0);return this.isHaloPass&&(Y=i.haloFontSize.divide(p).divide(ae.Ke)),{glPosition:de,color:V,size:p,textureUV:pe,antialiasingWidth:new s.bv(.105*ae.V_).divide(l).divide(this.view.pixelRatio),haloDistanceOffset:Y,...this.maybeRunHittest(i,r,{vvSizeAdjustment:z,vvRotation:P,labelOffset:L,labelClipped:ie})}}_getViewRotationMatrix(i){const r=this.view.displayViewMat3,a=this.view.displayMat3,o=new s.bv(1).subtract(i);return r.multiply(i).add(a.multiply(o))}fragment(i){const r=new s.bv(.25),a=new s.bv(1).subtract(r),o=(0,s.ig)(this.mosaicInfo.texture,i.textureUV).a;let l=a.subtract(i.haloDistanceOffset);this.highlight&&(l=l.divide(2));const p=i.antialiasingWidth,f=(0,s.CW)(l.subtract(p),l.add(p),o);return this.getFragmentOutput(i.color.multiply(f),i)}hittest(i,r,{vvSizeAdjustment:a,vvRotation:o,labelOffset:l,labelClipped:p}){let f,x,V;this.isLabel?(f=new s.AO(i.offset.add(l),0),x=new s.AO(r.offsetNextVertex1.add(l),0),V=new s.AO(r.offsetNextVertex2.add(l),0)):(f=o.multiply(new s.AO(i.offset.multiply(a),0)),x=o.multiply(new s.AO(r.offsetNextVertex1.multiply(a),0)),V=o.multiply(new s.AO(r.offsetNextVertex2.multiply(a),0)));const{viewMat3:w,tileMat3:T}=this.view,z=w.multiply(T).multiply(new s.AO(i.pos,1)),P=z.add(T.multiply(f)).xy,L=z.add(T.multiply(x)).xy,B=z.add(T.multiply(V)).xy,U=(0,_.P0)(this.hittestRequest.position,P.xy,L.xy,B.xy);return this.isLabel?(0,s.KJ)(p,(0,_.Oz)(this.hittestRequest),U):U}_unpackDirection(i){const r=new s.J7(i),a=(0,s.Dg)(r,new s.J7(2)),o=(0,s.hx)(r,new s.J7(3));return new s.Sg(new s.bv(a).subtract(1),new s.bv(o).subtract(1))}_getVertexColor(i){let r=i.color;if(this.visualVariableColor){const a=this.storage.getColorValue(i.id);r=this.visualVariableColor.getColor(a,i.color,new s.tW(!1))}if(this.visualVariableOpacity){const a=this.storage.getOpacityValue(i.id),o=this.visualVariableOpacity.getOpacity(a);r=r.multiply(o)}return r}}(0,u._)([(0,d.Kw)(Qe.W)],te.prototype,"visualVariableColor",void 0),(0,u._)([(0,d.Kw)(qe.V)],te.prototype,"visualVariableOpacity",void 0),(0,u._)([(0,d.Kw)(Re)],te.prototype,"visualVariableRotation",void 0),(0,u._)([(0,d.Kw)(et.k)],te.prototype,"visualVariableSizeMinMaxValue",void 0),(0,u._)([(0,d.Kw)(tt.U)],te.prototype,"visualVariableSizeScaleStops",void 0),(0,u._)([(0,d.Kw)(it.W)],te.prototype,"visualVariableSizeStops",void 0),(0,u._)([(0,d.Kw)(st.V)],te.prototype,"visualVariableSizeUnitValue",void 0),(0,u._)([(0,d.e5)(Ce.N)],te.prototype,"mosaicInfo",void 0),(0,u._)([d.Ou],te.prototype,"isHaloPass",void 0),(0,u._)([d.Ou],te.prototype,"isBackgroundPass",void 0),(0,u._)([d.Ou],te.prototype,"isLabel",void 0),(0,u._)([(0,u.a)(0,(0,d.qH)(ue)),(0,u.a)(1,(0,d.qH)(De))],te.prototype,"vertex",null),(0,u._)([(0,u.a)(0,(0,d.qH)(class Ft extends H.fz{}))],te.prototype,"fragment",null);var we=m(46074),Dt=m(33820);class Pe extends we.tp{}(0,u._)([(0,d.xh)(9,s.bv)],Pe.prototype,"accumulatedDistance",void 0),(0,u._)([(0,d.xh)(10,s.Sg)],Pe.prototype,"segmentDirection",void 0),(0,u._)([(0,d.xh)(11,s.T8)],Pe.prototype,"tlbr",void 0);class Ie extends we.Pf{_getLineWidthRatio(i,r){const a=new s.bv(Dt.v),o=(0,O.qD)(i.bitset,ae.Wq);return o.multiply((0,s.Fp)(r,new s.bv(.25))).add(new s.bv(1).subtract(o)).divide(a)}_getSDFAlpha(i){const{halfWidth:r,normal:a,tlbr:o,patternSize:l,accumulatedDistance:p,lineWidthRatio:f}=i,x=l.x.multiply(new s.bv(2)).multiply(f),V=(0,s.ZI)(p.divide(x)),w=new s.bv(.25).multiply(a.y).add(new s.bv(.5)),T=(0,s.CD)(o.xy,o.zw,new s.Sg(V,w)),z=(0,O.JH)((0,s.ig)(this.mosaicInfo.texture,T)).subtract(new s.bv(.5)).multiply(r),P=(0,s.uZ)(new s.bv(.5).subtract(z),new s.bv(0),new s.bv(1));return new s.T8(P)}_getPatternColor(i){const{halfWidth:r,normal:a,color:o,accumulatedDistance:l,patternSize:p,sampleAlphaOnly:f,tlbr:x}=i,V=p.y.multiply(new s.bv(2).multiply(r).divide(p.x)),w=(0,s.ZI)(l.divide(V)),T=new s.bv(.5).multiply(a.y).add(new s.bv(.5)),z=(0,s.CD)(x.xy,x.zw,new s.Sg(T,w));let P=(0,s.ig)(this.mosaicInfo.texture,z);return null!=this.visualVariableColor&&(P=(0,s.KJ)((0,s.tS)(f,new s.bv(.5)),new s.T8(o.a),o)),P}vertex(i,r){const{segmentDirection:a,tlbr:o,bitset:l}=i,p=(0,we.uY)(this,i),f=i.accumulatedDistance.divide(this.view.displayZoomFactor).add((0,s.AK)(a,p.scaledOffset)),x=new s.Sg(o.z.subtract(o.x),o.w.subtract(o.y)),V=o.divide(this.mosaicInfo.size.xyxy),w=(0,O.qD)(l,ae.B7),T=(0,O.qD)(l,ae.GS),z=(0,s.KJ)((0,s.tS)(w,new s.bv(.5)),this._getLineWidthRatio(i,p.scaledHalfWidth),new s.bv(1));return{...p,tlbr:V,patternSize:x,accumulatedDistance:f,isSDF:w,sampleAlphaOnly:T,lineWidthRatio:z,...this.maybeRunHittest(i,r,p.halfWidth)}}fragment(i){const{color:r,opacity:a,isSDF:o}=i,l=(0,we.Wc)(i,this.antialiasingControls.blur),p=(0,s.KJ)((0,s.tS)(o,new s.bv(.5)),this._getSDFAlpha(i),this._getPatternColor(i)),f=r.multiply(a).multiply(l).multiply(p);return this.getFragmentOutput(f,i)}}(0,u._)([(0,d.e5)(Ce.N)],Ie.prototype,"mosaicInfo",void 0),(0,u._)([(0,u.a)(0,(0,d.qH)(Pe)),(0,u.a)(1,(0,d.qH)(H.RS))],Ie.prototype,"vertex",null);var Ve=m(76455);class ve extends H.HN{}(0,u._)([(0,d.xh)(3,s.T8)],ve.prototype,"color",void 0),(0,u._)([(0,d.xh)(4,s.T8)],ve.prototype,"outlineColor",void 0),(0,u._)([(0,d.xh)(5,s.Sg)],ve.prototype,"offset",void 0),(0,u._)([(0,d.xh)(6,s.Sg)],ve.prototype,"textureUV",void 0),(0,u._)([(0,d.xh)(7,s.T8)],ve.prototype,"sizing",void 0),(0,u._)([(0,d.xh)(8,s.bv)],ve.prototype,"placementAngle",void 0),(0,u._)([(0,d.xh)(9,s.bv)],ve.prototype,"sizeRatio",void 0),(0,u._)([(0,d.xh)(10,s.Sg)],ve.prototype,"zoomRange",void 0);class Te extends d.yu{}function ye(g,i,r,a){return i.multiply(g.x).add(r.multiply(g.y)).add(a.multiply(g.z))}function Le(g){return g.multiply(g).divide(128)}(0,u._)([(0,d.xh)(12,s.Sg)],Te.prototype,"offsetNextVertex1",void 0),(0,u._)([(0,d.xh)(13,s.Sg)],Te.prototype,"offsetNextVertex2",void 0),(0,u._)([(0,d.xh)(14,s.Sg)],Te.prototype,"textureUVNextVertex1",void 0),(0,u._)([(0,d.xh)(15,s.Sg)],Te.prototype,"textureUVNextVertex2",void 0);class ce extends H.Ie{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],textureUV:["textureUVNextVertex1","textureUVNextVertex2"]}}vertex(i,r){const a=Le(i.sizing.x),o=Le(i.sizing.y),l=Le(i.sizing.z),p=i.placementAngle,f=(0,O.qD)(i.bitset,Ve.m.bitset.isSDF),x=(0,O.qD)(i.bitset,Ve.m.bitset.isMapAligned),V=(0,O.qD)(i.bitset,Ve.m.bitset.scaleSymbolsProportionally),w=(0,O.h7)(i.bitset,Ve.m.bitset.colorLocked),T=(0,ge.sY)(this,i.id),z=(0,ge.Zt)(this,i.id,i.color,w).multiply(T),P=this.view.displayViewScreenMat3.multiply(new s.AO(i.pos.xy,1)),L=(0,ge.Vm)(this,i.id,l).divide(l),B=a.multiply(L),U=i.offset.xy.multiply(L);let G=o.multiply(V.multiply(L.subtract(1)).add(1));G=(0,s.VV)(G,(0,s.Fp)(B.subtract(.99),new s.bv(0)));const ie=(0,s.Fp)(G,new s.bv(1)),de=(0,s.VV)(G,new s.bv(1)),pe=s.Tu.fromRotation(p.multiply(ae.e4)),Y=(0,ge.H8)(this,i.id),Z=this._getViewRotationMatrix(x).multiply(Y).multiply(pe).multiply(new s.AO(U.xy,0)),$=this.clip(i.id,i.zoomRange),se=new s.T8(P.xy.add(Z.xy),$,1),k=i.textureUV.divide(this.mosaicInfo.size),Be=i.outlineColor.multiply(de),He=(0,O.qD)(i.bitset,Ve.m.bitset.overrideOutlineColor),nt=i.sizeRatio.multiply(B).multiply(.5);return{glPosition:se,color:z,textureUV:k,outlineColor:Be,outlineSize:ie,distanceToPx:nt,isSDF:f,overrideOutlineColor:He,...this.maybeRunHittest(i,r,{pos:i.pos,size:B,sizeCorrection:L,isMapAligned:x,vvRotationMat3:Y,placementMat3:pe,outlineSize:ie,distanceToPx:nt,isSDF:f})}}fragment(i){const r=this._getColor(i.textureUV,i);return this.getFragmentOutput(r,i)}hittest(i,r,a){return(0,s.KJ)((0,s.Qj)(a.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(i,r,a),this._hittestMarker(i,r,a))}_getViewRotationMatrix(i){const r=this.view.displayViewMat3,a=this.view.displayMat3,o=new s.bv(1).subtract(i);return r.multiply(i).add(a.multiply(o))}_getViewScreenMatrix(i){const r=this.view.viewMat3.multiply(this.view.tileMat3),a=this.view.tileMat3,o=new s.bv(1).subtract(i);return r.multiply(i).add(a.multiply(o))}_getColor(i,r){return(0,s.KJ)((0,s.ln)(r.isSDF,new s.bv(1)),this._getSDFColor(i,r),this._getSpriteColor(i,r))}_getSpriteColor(i,r){return(0,s.ig)(this.mosaicInfo.texture,i).multiply(r.color)}_getSDFColor(i,r){const a=(0,s.ig)(this.mosaicInfo.texture,i),o=new s.bv(.5).subtract((0,O.JH)(a)).multiply(r.distanceToPx).multiply(ae.nU),l=(0,s.uZ)(new s.bv(.5).subtract(o),new s.bv(0),new s.bv(1)),p=r.color.multiply(l);let f=r.outlineSize;this.highlight&&(f=(0,s.Fp)(f,r.overrideOutlineColor.multiply(4)));const x=f.multiply(.5),V=(0,s.Wn)(o).subtract(x),w=(0,s.uZ)(new s.bv(.5).subtract(V),new s.bv(0),new s.bv(1)),T=(0,s.CD)(r.outlineColor,r.color,r.overrideOutlineColor).multiply(w);return new s.bv(1).subtract(T.a).multiply(p).add(T)}_hittestSmallMarker(i,r,a){const{position:o,distance:l,smallSymbolDistance:p}=this.hittestRequest,f=l.subtract(p),{viewMat3:x,tileMat3:V}=this.view,w=x.multiply(V).multiply(new s.AO(a.pos,1)).xy,T=a.size.multiply(.5);return(0,s.TE)(w,o).subtract(T).add(f)}_hittestMarker(i,r,a){const{pos:o,sizeCorrection:l,isMapAligned:p}=a,f=new s.AO(i.offset.multiply(l),0),x=new s.AO(r.offsetNextVertex1.multiply(l),0),V=new s.AO(r.offsetNextVertex2.multiply(l),0),{viewMat3:w,tileMat3:T}=this.view,z=w.multiply(T).multiply(new s.AO(o,1)),P=this._getViewScreenMatrix(p).multiply(a.vvRotationMat3).multiply(a.placementMat3),L=z.add(P.multiply(f)).xy,B=z.add(P.multiply(x)).xy,U=z.add(P.multiply(V)).xy,ie=this.hittestRequest.distance,de=(0,_.P0)(this.hittestRequest.position,L,B,U);return(0,s.KJ)((0,s.tS)(de,ie),de,this._hittestSamples(L,B,U,i,r,a))}_hittestSamples(i,r,a,o,l,p){const{outlineSize:f,isSDF:x,distanceToPx:V}=p,w=this.hittestRequest.position,T=this.hittestRequest.distance,z=(0,_.hF)(w.add(new s.Sg((0,s.tk)(T),(0,s.tk)(T))),i,r,a),P=(0,_.hF)(w.add(new s.Sg(0,(0,s.tk)(T))),i,r,a),L=(0,_.hF)(w.add(new s.Sg(T,(0,s.tk)(T))),i,r,a),B=(0,_.hF)(w.add(new s.Sg((0,s.tk)(T),0)),i,r,a),U=(0,_.hF)(w,i,r,a),G=(0,_.hF)(w.add(new s.Sg(T,0)),i,r,a),ie=(0,_.hF)(w.add(new s.Sg((0,s.tk)(T),T)),i,r,a),de=(0,_.hF)(w.add(new s.Sg(0,T)),i,r,a),pe=(0,_.hF)(w.add(new s.Sg(T,T)),i,r,a),Y=o.textureUV.divide(this.mosaicInfo.size),Z=l.textureUVNextVertex1.divide(this.mosaicInfo.size),$=l.textureUVNextVertex2.divide(this.mosaicInfo.size),se={color:new s.T8(1),outlineColor:new s.T8(1),overrideOutlineColor:new s.bv(1),outlineSize:f,distanceToPx:V,isSDF:x};let k=new s.bv(0);return k=k.add((0,_.lD)(z).multiply(this._getColor(ye(z,Y,Z,$),se).a)),k=k.add((0,_.lD)(P).multiply(this._getColor(ye(P,Y,Z,$),se).a)),k=k.add((0,_.lD)(L).multiply(this._getColor(ye(L,Y,Z,$),se).a)),k=k.add((0,_.lD)(B).multiply(this._getColor(ye(B,Y,Z,$),se).a)),k=k.add((0,_.lD)(U).multiply(this._getColor(ye(U,Y,Z,$),se).a)),k=k.add((0,_.lD)(G).multiply(this._getColor(ye(G,Y,Z,$),se).a)),k=k.add((0,_.lD)(ie).multiply(this._getColor(ye(ie,Y,Z,$),se).a)),k=k.add((0,_.lD)(de).multiply(this._getColor(ye(de,Y,Z,$),se).a)),k=k.add((0,_.lD)(pe).multiply(this._getColor(ye(pe,Y,Z,$),se).a)),(0,s.Nb)(k,new s.bv(.05)).multiply((0,_.Oz)(this.hittestRequest))}}(0,u._)([(0,d.Kw)(Qe.W)],ce.prototype,"visualVariableColor",void 0),(0,u._)([(0,d.Kw)(qe.V)],ce.prototype,"visualVariableOpacity",void 0),(0,u._)([(0,d.Kw)(Re)],ce.prototype,"visualVariableRotation",void 0),(0,u._)([(0,d.Kw)(et.k)],ce.prototype,"visualVariableSizeMinMaxValue",void 0),(0,u._)([(0,d.Kw)(tt.U)],ce.prototype,"visualVariableSizeScaleStops",void 0),(0,u._)([(0,d.Kw)(it.W)],ce.prototype,"visualVariableSizeStops",void 0),(0,u._)([(0,d.Kw)(st.V)],ce.prototype,"visualVariableSizeUnitValue",void 0),(0,u._)([(0,d.e5)(Ce.N)],ce.prototype,"mosaicInfo",void 0),(0,u._)([(0,u.a)(0,(0,d.qH)(ve)),(0,u.a)(1,(0,d.qH)(Te))],ce.prototype,"vertex",null),(0,u._)([(0,u.a)(0,(0,d.qH)(class Lt extends H.fz{}))],ce.prototype,"fragment",null);var Ht=m(72578),Ut=m(78619);class Nt{constructor(){this.computeAttributes={}}get locationsMap(){const i=new Map;for(const r in this.locations)i.set(r,this.locations[r].index);return i}get optionPropertyKeys(){if(!this._optionPropertyKeys){const i=new Set(Object.keys(this.options));this._optionPropertyKeys=i}return this._optionPropertyKeys}get _transformFeedbackBindings(){return[]}get locationInfo(){if(!this._locationInfo){const i=this.locationsMap,r=Array.from(i.entries()).map(([o,l])=>`${o}.${l}`).join("."),a=(0,Ht.hP)(r);this._locationInfo={hash:a,locations:i,computeAttributeMap:this.computeAttributes}}return this._locationInfo}get renamedLocationsMap(){const i=new Map;for(const[r,a]of this.locationsMap.entries())i.set("a_"+r,a);return i}getShaderKey(i,r,a){return`${Object.keys(i).map(o=>`${o}.${i[o]}`).join(".")}.${Object.keys(a).filter(o=>a[o]).map(o=>`${o}_${a[o].toString()}`).join(".")}.${Object.keys(r).filter(o=>this.optionPropertyKeys.has(o)).join(".")}`}getProgram(i,r,a,o){let l="",p="";for(const f in a)if(a[f]){const x="boolean"==typeof a[f]?`#define ${f}\n`:`#define ${f} ${a[f]}\n`;l+=x,p+=x}return l+=this.vertexShader,p+=this.fragmentShader,new Ut.X(l,p,this.renamedLocationsMap,this.locationInfo,this._getUniformBindings(r),this._transformFeedbackBindings)}_getUniformBindings(i){const r=[];for(const a in this.required){const o=this.required[a];r.push({uniformHydrated:null,shaderModulePath:a,uniformName:a,uniformType:o.type,uniformArrayElementType:rt(o),uniformArrayLength:ot(o)})}for(const a in i){const o=this.options[a];if(i[a])for(const l in o){const p=o[l];r.push({uniformHydrated:null,shaderModulePath:`${a}.${l}`,uniformName:l,uniformType:p.type,uniformArrayElementType:rt(p),uniformArrayLength:ot(p)})}}return r}}const rt=g=>"array"===g.type?g.elementType?.type:void 0,ot=g=>"array"===g.type?g.size:void 0;var at=m(61362);const Kt={hittestDist:s.bv,hittestPos:s.Sg},Wt={filterFlags:s.Eg,animation:s.Eg,visualVariableData:s.Eg,dataDriven0:s.Eg,dataDriven1:s.Eg,dataDriven2:s.Eg,gpgpu:s.Eg,size:s.bv},jt={displayViewScreenMat3:s.Tu,displayViewMat3:s.Tu,displayMat3:s.Tu,viewMat3:s.Tu,tileMat3:s.Tu,displayZoomFactor:s.bv,requiredZoomFactor:s.bv,tileOffset:s.Sg,currentScale:s.bv,currentZoom:s.bv,metersPerSRUnit:s.bv};class Gt extends Nt{constructor(){super(...arguments),this.vertexShader=(0,at.w)("materials/pie/pie.vert"),this.fragmentShader=(0,at.w)("materials/pie/pie.frag"),this.required={...Wt,...jt,outlineWidth:s.bv,colors:s.v8,defaultColor:s.T8,othersColor:s.T8,outlineColor:s.T8,donutRatio:s.bv,sectorThreshold:s.bv},this.options={hittestUniforms:Kt,visualVariableSizeMinMaxValue:{minMaxValueAndSize:s.T8},visualVariableSizeScaleStops:{sizes:{...s.v8.ofType(s.bv,8),type:"array",elementType:s.bv,size:8},values:{...s.v8.ofType(s.bv,8),type:"array",elementType:s.bv,size:8}},visualVariableSizeStops:{sizes:{...s.v8.ofType(s.bv,8),type:"array",elementType:s.bv,size:8},values:{...s.v8.ofType(s.bv,8),type:"array",elementType:s.bv,size:8}},visualVariableSizeUnitValue:{unitValueToPixelsRatio:s.bv},visualVariableOpacity:{opacities:{...s.v8.ofType(s.bv,8),type:"array",elementType:s.bv,size:8},opacityValues:{...s.v8.ofType(s.bv,8),type:"array",elementType:s.bv,size:8}}},this.locations={pos:{index:0,type:s.Sg},id:{index:1,type:s.AO},bitset:{index:2,type:s.bv},offset:{index:3,type:s.Sg},texCoords:{index:4,type:s.Sg},size:{index:5,type:s.Sg},referenceSize:{index:6,type:s.bv},zoomRange:{index:7,type:s.Sg}},this.defines={VV_SIZE_MIN_MAX_VALUE:"boolean",VV_SIZE_SCALE_STOPS:"boolean",VV_SIZE_FIELD_STOPS:"boolean",VV_SIZE_UNIT_VALUE:"boolean",VV_OPACITY:"boolean",HITTEST:"boolean",numberOfFields:"number",highlight:"boolean",inside:"boolean",outside:"boolean"}}setNumberOfFields(i){this.required.colors={...s.v8.ofType(s.T8,i),type:"array",elementType:s.T8,size:i}}}const ze={fill:new class ft extends F{constructor(){super(...arguments),this.type=I.t.Fill,this.shaders={geometry:new Ke.C}}render(i,r){const{painter:a}=i,o=r.instance.getInput();a.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.vY)(i,r.target,o.uniforms),...(0,h.l5)(i,r.target)},defines:(0,h.rO)(i),optionalAttributes:o.optionalAttributes,useComputeBuffer:(0,h.VF)(i)}),a.setPipelineState((0,h.H6)(i)),a.submitDraw(i,r)}},patternFill:new class bt extends F{constructor(){super(...arguments),this.type=I.t.PatternFill,this.shaders={geometry:new yt.lA}}render(i,r){const{context:a,painter:o}=i,l=r.instance.getInput();o.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.vY)(i,r.target,l.uniforms),...(0,h.l5)(i,r.target),mosaicInfo:o.textureManager.getMosaicInfo(a,r.textureKey),localTileOffset:(0,h.wb)(r.target)},defines:{...(0,h.rO)(i)},optionalAttributes:l.optionalAttributes,useComputeBuffer:(0,h.VF)(i)}),o.setPipelineState((0,h.H6)(i)),o.submitDraw(i,r)}},complexFill:new class dt extends F{constructor(){super(...arguments),this.type=I.t.ComplexFill,this.shaders={geometry:new ct.LU}}render(i,r){const{context:a,painter:o}=i,l=r.instance.getInput();o.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.vY)(i,r.target,l.uniforms),...(0,h.l5)(i,r.target),mosaicInfo:o.textureManager.getMosaicInfo(a,r.textureKey),localTileOffset:(0,h.wb)(r.target)},defines:{...(0,h.rO)(i)},optionalAttributes:l.optionalAttributes,useComputeBuffer:(0,h.VF)(i)}),o.setPipelineState((0,h.H6)(i)),o.submitDraw(i,r)}},outlineFill:new class vt extends F{constructor(){super(...arguments),this.type=I.t.OutlineFill,this.shaders={geometry:new mt.py}}render(i,r){const{painter:a,pixelRatio:o}=i,l=r.instance.getInput();a.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.vY)(i,r.target,l.uniforms),...(0,h.l5)(i,r.target),antialiasingControls:Se(o)},defines:{...(0,h.rO)(i)},optionalAttributes:l.optionalAttributes,useComputeBuffer:(0,h.VF)(i)}),a.setPipelineState((0,h.H6)(i)),a.submitDraw(i,r)}},patternOutlineFill:new class xt extends F{constructor(){super(...arguments),this.type=I.t.PatternOutlineFill,this.shaders={geometry:new gt.Zd}}render(i,r){const{context:a,painter:o,pixelRatio:l}=i,p=r.instance.getInput();o.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.vY)(i,r.target,p.uniforms),...(0,h.l5)(i,r.target),antialiasingControls:Se(l),mosaicInfo:o.textureManager.getMosaicInfo(a,r.textureKey),localTileOffset:(0,h.wb)(r.target)},defines:{...(0,h.rO)(i)},optionalAttributes:p.optionalAttributes,useComputeBuffer:(0,h.VF)(i)}),o.setPipelineState((0,h.H6)(i)),o.submitDraw(i,r)}},complexOutlineFill:new class ht extends F{constructor(){super(...arguments),this.type=I.t.ComplexOutlineFill,this.shaders={geometry:new pt.Nz}}render(i,r){const{context:a,painter:o,pixelRatio:l}=i,p=r.instance.getInput();o.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.vY)(i,r.target,p.uniforms),...(0,h.l5)(i,r.target),antialiasingControls:Se(l),mosaicInfo:o.textureManager.getMosaicInfo(a,r.textureKey),localTileOffset:(0,h.wb)(r.target)},defines:{...(0,h.rO)(i)},optionalAttributes:p.optionalAttributes,useComputeBuffer:(0,h.VF)(i)}),o.setPipelineState((0,h.H6)(i)),o.submitDraw(i,r)}},marker:new class Bt extends F{constructor(){super(...arguments),this.type=I.t.Marker,this.shaders={geometry:new ce},this.symbologyPlane=E.mH.MARKER}render(i,r){const{context:a,painter:o}=i,l=r.instance.getInput();o.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.vY)(i,r.target,l.uniforms),...(0,h.l5)(i,r.target),mosaicInfo:o.textureManager.getMosaicInfo(a,r.textureKey,!0)},defines:{...(0,h.rO)(i)},optionalAttributes:l.optionalAttributes,useComputeBuffer:(0,h.VF)(i)}),o.setPipelineState((0,h.H6)(i)),o.submitDraw(i,r)}},pieChart:new class kt extends F{constructor(){super(...arguments),this.type=I.t.PieChart,this.shaders={geometry:new Gt},this.symbologyPlane=E.mH.MARKER}render(i,r){const{painter:a}=i,{instance:o,target:l}=r,p=this.shaders.geometry,f=o.getInput(),x=f.uniforms.numberOfFields,V=(0,h.VF)(i),w=(0,h.l5)(i,l),T=(0,h.rO)(i);p.setNumberOfFields(x),a.setShader({shader:p,uniforms:{...(0,h.vY)(i,r.target,f.uniforms.shader),...w.storage,...w.view,hittestUniforms:w.hittestRequest?{hittestDist:w.hittestRequest?.distance,hittestPos:w.hittestRequest?.position}:null},defines:{VV_SIZE_MIN_MAX_VALUE:!!f.uniforms.shader.visualVariableSizeMinMaxValue,VV_SIZE_SCALE_STOPS:!!f.uniforms.shader.visualVariableSizeScaleStops,VV_SIZE_FIELD_STOPS:!!f.uniforms.shader.visualVariableSizeStops,VV_SIZE_UNIT_VALUE:!!f.uniforms.shader.visualVariableSizeUnitValue,VV_OPACITY:!!f.uniforms.shader.visualVariableOpacity,HITTEST:V,highlight:w.highlight?1:0,...T,numberOfFields:x},optionalAttributes:{},useComputeBuffer:V}),a.setPipelineState((0,h.H6)(i)),a.submitDraw(i,r)}},line:new class Rt extends F{constructor(){super(...arguments),this.type=I.t.Line,this.shaders={geometry:new we.Pf},this.symbologyPlane=E.mH.LINE}render(i,r){const{painter:a,pixelRatio:o}=i,l=r.instance.getInput();a.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.vY)(i,r.target,l.uniforms),...(0,h.l5)(i,r.target),antialiasingControls:Se(o)},defines:{...(0,h.rO)(i)},optionalAttributes:l.optionalAttributes,useComputeBuffer:(0,h.VF)(i)}),a.setPipelineState((0,h.H6)(i)),a.submitDraw(i,r)}},texturedLine:new class It extends F{constructor(){super(...arguments),this.type=I.t.TexturedLine,this.shaders={geometry:new Ie},this.symbologyPlane=E.mH.LINE}render(i,r){const{context:a,painter:o,pixelRatio:l}=i,p=r.instance.getInput();o.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.vY)(i,r.target,p.uniforms),...(0,h.l5)(i,r.target),antialiasingControls:Se(l),mosaicInfo:o.textureManager.getMosaicInfo(a,r.textureKey)},defines:{...(0,h.rO)(i)},optionalAttributes:p.optionalAttributes,useComputeBuffer:(0,h.VF)(i)}),o.setPipelineState((0,h.H6)(i)),o.submitDraw(i,r)}},text:new class Zt extends F{constructor(){super(...arguments),this.type=I.t.Text,this.shaders={geometry:new te},this.symbologyPlane=E.mH.TEXT}render(i,r){const{context:a,painter:o}=i,l=(0,h.rO)(i),p=r.instance.getInput(),f={shader:this.shaders.geometry,uniforms:{...(0,h.vY)(i,r.target,p.uniforms),...(0,h.l5)(i,r.target),mosaicInfo:o.textureManager.getMosaicInfo(a,r.textureKey)},defines:{...l,isHaloPass:!1,isBackgroundPass:!0,isLabel:!1},optionalAttributes:p.optionalAttributes,useComputeBuffer:(0,h.VF)(i)};o.setShader(f),o.setPipelineState((0,h.H6)(i)),o.submitDraw(i,r),o.setShader({...f,defines:{...l,isHaloPass:!0,isBackgroundPass:!1,isLabel:!1}}),o.submitDraw(i,r),o.setShader({...f,defines:{...l,isHaloPass:!1,isBackgroundPass:!1,isLabel:!1}}),o.submitDraw(i,r)}},label:new class Ct extends F{constructor(){super(...arguments),this.type=I.t.Label,this.shaders={geometry:new te},this.drawPhase=E.jx.LABEL|E.jx.LABEL_ALPHA|E.jx.HITTEST,this.symbologyPlane=E.mH.TEXT}render(i,r){const{context:a,painter:o}=i,l=(0,h.rO)(i),p={...(0,h.H6)(i)},f=r.instance.getInput(),x={shader:this.shaders.geometry,uniforms:{...(0,h.vY)(i,r.target,f.uniforms),...(0,h.l5)(i,r.target),mosaicInfo:o.textureManager.getMosaicInfo(a,r.textureKey)},defines:{...l,isHaloPass:!1,isBackgroundPass:!0,isLabel:!0},optionalAttributes:f.optionalAttributes,useComputeBuffer:(0,h.VF)(i)};o.setShader(x),o.setPipelineState(p),o.submitDraw(i,r),o.setShader({...x,defines:{...l,isHaloPass:!0,isBackgroundPass:!1,isLabel:!0}}),o.setPipelineState(p),o.submitDraw(i,r),o.setShader({...x,defines:{...l,isHaloPass:!1,isBackgroundPass:!1,isLabel:!0}}),o.setPipelineState(p),o.submitDraw(i,r)}},heatmap:new class Ot extends F{constructor(){super(...arguments),this.type=I.t.Heatmap,this.shaders={accumulate:new _e,resolve:new xe},this.postProcessingEnabled=!0,this._isBound=!1,this._resources=new Map,this.overrideStencilRef=Ye}shutdown(i){super.shutdown(i),this._resources.get(i)?.destroy(),this._resources.delete(i),this._prevFBO=null,this._unbind()}render(i,r){const{context:a,painter:o,state:l}=i,p=r.instance.getInput(),{isFieldActive:f}=p.uniforms,x=this._getOrCreateResourcesRecord(a),V=x.loadQualityProfile(a);if((0,h.il)(i))return;(0,h.VF)(i)||this._bind(i,x,p),o.setShader({shader:this.shaders.accumulate,uniforms:{...(0,h.l5)(i,r.target),kernelControls:{radius:Je(p,l),isFieldActive:f?1:0}},defines:{...(0,h.rO)(i),...V.defines},optionalAttributes:{},useComputeBuffer:(0,h.VF)(i)});const w=(0,h.VF)(i)?Pt:$e;o.setPipelineState(w),o.submitDraw(i,r)}postProcess(i,r){if((0,h.VF)(i)||(0,h.il)(i))return;const{context:a,painter:o}=i,l=this._resources.get(a);if(null==this._prevFBO||null==this._prevViewport||!l?.initialized)return;const{defines:p}=l.loadQualityProfile(a),{minDensity:f,maxDensity:x,radius:V}=r.getInput().uniforms,z=l.accumulateFramebuffer,P=l.resolveGradientTexture;o.setShader({shader:this.shaders.resolve,uniforms:{accumulatedDensity:{texture:{unit:8,texture:z.colorTexture},minAndInvRange:[f,1/(x-f)],normalization:3/(V*V*Math.PI)},gradient:{texture:{unit:9,texture:P}}},defines:p,optionalAttributes:{},useComputeBuffer:!1}),a.bindFramebuffer(this._prevFBO),a.setViewport(0,0,this._prevViewport.width,this._prevViewport.height),a.bindTexture(z.colorTexture,8),a.bindTexture(P,9),o.setPipelineState(At),o.submitDrawQuad(a),this._unbind()}_getOrCreateResourcesRecord(i){let r=this._resources.get(i);return null==r&&(r=new Vt,this._resources.set(i,r)),r}_unbind(){this._prevFBO=null,this._prevViewport=null,this._isBound=!1}_bind(i,r,a){if(this._isBound)return;const{context:o,state:l,pixelRatio:p}=i,f=o.getBoundFramebufferObject(),x=o.getViewport();this._prevFBO=f,this._prevViewport=x;const{gradient:V,gradientHash:w}=a.uniforms;r.ensureResolveGradientTexture(o,w,V);const{width:T,height:z}=x,P=function Mt(g,i){const r=i>1.5?.25:.5;return g<1/(2*r)?1:r}(Je(a,l),p),U=r.ensureAccumulateFBO(o,T*P,z*P);o.blitFramebuffer(f,U,0,0,f.width,f.height,0,0,U.width,U.height,c.lk.STENCIL_BUFFER_BIT,c.cw.NEAREST),o.bindFramebuffer(U),o.setViewport(0,0,U.width,U.height),o.setColorMask(!0,!0,!0,!0),o.setClearColor(0,0,0,0),o.clear(c.lk.COLOR_BUFFER_BIT),this._isBound=!0}},dotDensity:new class ut extends F{constructor(){super(...arguments),this.type=I.t.DotDensity,this.shaders={polygon:new n,point:new v,fill:new Ke.C},this._resources=new Map}render(i,r){(0,h.il)(i)||(0,h.VF)(i)?this._renderPolygons(i,r):this._renderDotDensity(i,r)}_renderPolygons(i,r){const{painter:a}=i;a.setShader({shader:this.shaders.fill,uniforms:{...(0,h.l5)(i,r.target),visualVariableColor:null,visualVariableOpacity:null},defines:{...(0,h.rO)(i)},optionalAttributes:{zoomRange:!1},useComputeBuffer:(0,h.VF)(i)}),a.setPipelineState((0,h.H6)(i)),a.submitDraw(i,r)}_renderDotDensity(i,r){const{context:a,painter:o,requiredLevel:l}=i,p=r.instance.getInput().uniforms,f=this._getOrCreateResourcesRecord(a),x=f.getDotDensityTextures(a,R.i9,p.seed),V=1/2**(l-r.target.key.level),w=R.i9,T=w*window.devicePixelRatio*w*window.devicePixelRatio,L=p.dotValue*(p.dotScale?i.state.scale/p.dotScale:1)*(1/V*(1/V));o.setShader({shader:this.shaders.polygon,uniforms:{...(0,h.l5)(i,r.target),instance:{isActive:p.isActive,colors:p.colors,dotValue:Math.max(1,L)},draw:{dotTexture0:{unit:R.Of,texture:x[0]},dotTexture1:{unit:R.vk,texture:x[1]},tileZoomFactor:V,pixelRatio:window.devicePixelRatio,tileDotsOverArea:T/(R.i9*window.devicePixelRatio*R.i9*window.devicePixelRatio)}},defines:{...(0,h.rO)(i),blending:p.blending},optionalAttributes:{},useComputeBuffer:!1}),o.setPipelineState((0,h.H6)(i));const B=a.getViewport();a.setViewport(0,0,R.i9,R.i9);const U=a.getBoundFramebufferObject(),G=f.getFBO(a);a.bindFramebuffer(G),a.setClearColor(0,0,0,0),o.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),o.updatePipelineState(a),a.clear(c.lk.COLOR_BUFFER_BIT),o.submitDraw(i,r),a.bindFramebuffer(U),a.setViewport(B.x,B.y,B.width,B.height);const ie=f.getFBO(a).colorTexture;o.setShader({shader:this.shaders.point,uniforms:{view:(0,h.yF)(i,r.target),instance:{dotSize:p.dotSize},draw:{locations:{unit:R.Of,texture:ie},tileZoomFactor:1,pixelRatio:window.devicePixelRatio}},defines:{...(0,h.rO)(i)},optionalAttributes:{},useComputeBuffer:!1}),o.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),o.submitDrawMesh(a,f.getDotDensityMesh(a))}shutdown(i){super.shutdown(i),this._resources.get(i)?.destroy(),this._resources.delete(i)}_getOrCreateResourcesRecord(i){let r=this._resources.get(i);return null==r&&(r=new lt,this._resources.set(i,r)),r}}};function Xt(){for(const g in ze)ze[g].startup()}function Yt(g){for(const i in ze)ze[i].shutdown(g)}},89170:(be,q,m)=>{m.d(q,{$F:()=>h,vZ:()=>J});var R=m(57678),E=m(43101),N=m(29024),F=m(19903);function h(v,_){return{type:"simple",filters:_,capabilities:{maxTextureSize:(0,F.h)().maxTextureSize},bindings:u(v)}}function I(v){switch(v){case"opacity":return E.CU.OPACITY;case"color":return E.CU.COLOR;case"rotation":return E.CU.ROTATION;case"size":return E.CU.SIZE;default:return null}}function u(v){if(!v)return[];switch(v.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return J(v);case"dot-density":return function d(v){const _=[];for(const O of v.attributes)_.push({binding:_.length,expression:O.valueExpression,field:O.field});return _}(v);case"pie-chart":return function s(v){const _=J(v);let O=4;for(const K of v.attributes)_.push({binding:O++,expression:K.valueExpression,field:K.field});return _}(v);case"heatmap":return function H({valueExpression:v,field:_}){return v||_?[{binding:0,expression:v,field:_}]:[]}(v)}}function J(v){return"visualVariables"in v&&v.visualVariables?.length?(0,N.t)(v.visualVariables).map(_=>function fe(v){switch(v.type){case"size":return function ne(v){return"$view.scale"===v.valueExpression?null:{binding:I(v.type),field:v.field,normalizationField:v.normalizationField,expression:v.valueExpression,valueRepresentation:v.valueRepresentation}}(v);case"color":return function he(v){return{binding:I(v.type),field:v.field,normalizationField:v.normalizationField,expression:v.valueExpression}}(v);case"opacity":return function le(v){return{binding:I(v.type),field:v.field,normalizationField:v.normalizationField,expression:v.valueExpression}}(v);case"rotation":return function re(v){return{binding:I(v.type),expression:v.valueExpression,field:v.field}}(v)}}(_)).filter(R.pC):[]}},28105:(be,q,m)=>{m.d(q,{Jh:()=>K,Sc:()=>ee,XS:()=>me}),m(14007);var E=m(55768),N=m(49602),F=m(44526),h=m(99657),I=m(90450),u=m(33380),d=m(29024);const s=1.25,H=128,J=128;function ne(n){if(!n.stops?.length)return null;const b=n.stops.sort((C,X)=>C.value-X.value),c=(0,u.Q)(b,8);return{values:c.map(({value:C})=>C),colors:c.map(({color:C})=>(0,u.n)(C))}}function he(n){if(!n.stops?.length)return null;const b=n.stops.sort((y,M)=>y.value-M.value),c=(0,u.Q)(b,8);return{opacityValues:c.map(({value:y})=>y),opacities:c.map(({opacity:y})=>y)}}function le(n){return{rotationType:"geographic"===n.rotationType?I.MO.Geographic:I.MO.Arithmatic}}function re(n){if(!n.stops?.length)return null;if(n.stops.some(y=>y.useMaxValue||y.useMinValue))return(y,M)=>{const C=y.statisticsByLevel.get(M.key.level),X=n.stops.map(W=>({value:W.useMaxValue?C?.get(n.field)?.maxValue??0:W.useMinValue?C?.get(n.field)?.minValue??0:W.value,size:W.size?(0,E.F2)(W.size):h.k9})).sort((W,Q)=>W.value-Q.value),j=(0,u.Q)(X,8);return{values:j.map(({value:W})=>W),sizes:j.map(({size:W})=>W)}};const b=n.stops.sort((y,M)=>y.value-M.value),c=(0,u.Q)(b,8);return{values:c.map(({value:y})=>y),sizes:c.map(({size:y})=>(0,E.F2)(y))}}function v(n){return b=>{const{state:c}=b;return{unitValueToPixelsRatio:(0,N.c9)(c.spatialReference)/F.a[n.valueUnit??"meters"]/c.resolution}}}function _(n,b){const c=b.length;if(n<b[0].value||1===c)return b[0].size;for(let y=1;y<c;y++)if(n<b[y].value)return b[y-1].size+(n-b[y-1].value)/(b[y].value-b[y-1].value)*(b[y].size-b[y-1].size);return b[c-1].size}function O(n){const{minDataValue:b,maxDataValue:c,minSize:y,maxSize:M}=n;if("object"==typeof y&&"object"==typeof M)return(C,X)=>{const j=C.state.scale,W=(0,E.F2)(_(j,y.stops)),Q=(0,E.F2)(_(j,M.stops));return{minMaxValueAndSize:[b,c,W,Q]}};if("object"==typeof y||"object"==typeof M)throw new Error("InternalError: Found a partial VisualVariableSizeMinMaxValue");return{minMaxValueAndSize:[b,c,(0,E.F2)(y),(0,E.F2)(M)]}}const K={visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null};function me(n,b=J,c=s){if(n.visualVariableSizeMinMaxValue)return n.visualVariableSizeMinMaxValue instanceof Function?H:Math.max(n.visualVariableSizeMinMaxValue.minMaxValueAndSize[3]*c,b);if(n.visualVariableSizeScaleStops){if(n.visualVariableSizeScaleStops instanceof Function)return H;const y=n.visualVariableSizeScaleStops.sizes;return Math.max(y[y.length-1]*c,b)}if(n.visualVariableSizeStops){if(n.visualVariableSizeStops instanceof Function)return H;const y=n.visualVariableSizeStops.sizes;return Math.max(y[y.length-1]*c,b)}return n.visualVariableSizeUnitValue?2*H:0}function ee(n){const b={...K};if(!n||!("visualVariables"in n)||!n.visualVariables)return b;for(const c of(0,d.t)(n.visualVariables))switch(c.type){case"color":b.visualVariableColor=ne(c);break;case"opacity":b.visualVariableOpacity=he(c);break;case"rotation":b.visualVariableRotation=le(c);break;case"size":switch(S(c)){case"field-stops":b.visualVariableSizeStops=re(c);break;case"scale-stops":"outline"===c.target?b.visualVariableSizeOutlineScaleStops=re(c):b.visualVariableSizeScaleStops=re(c);break;case"min-max":b.visualVariableSizeMinMaxValue=O(c);break;case"unit-value":b.visualVariableSizeUnitValue=v(c)}}return b}function S(n){return"number"==typeof n.minDataValue&&"number"==typeof n.maxDataValue&&null!=n.minSize&&null!=n.maxSize?"min-max":"$view.scale"===n?.valueExpression&&Array.isArray(n.stops)?"scale-stops":null==n.field&&"$view.scale"===n?.valueExpression||!(Array.isArray(n.stops)||"levels"in n&&n.levels)?null!=n.field||"$view.scale"!==n?.valueExpression?"unit-value":null:"field-stops"}},33380:(be,q,m)=>{function R(N,F){const h=N.slice(0,F),I=F-h.length;for(let u=0;u<I;u++)h.push(h[h.length-1]);return h}function E(N){if(!N)return[0,0,0,0];const{r:F,g:h,b:I,a:u}=N;return[F*(u/255),h*(u/255),I*(u/255),u]}m.d(q,{Q:()=>R,n:()=>E})},59104:(be,q,m)=>{m.d(q,{$L:()=>s,KR:()=>O,QA:()=>ee,U9:()=>le,UX:()=>u,cs:()=>K,ep:()=>fe,zw:()=>ne});var R=m(15861),E=m(84176),N=m(73896),F=m(34317),h=m(28105),I=m(35074);function u(S){return S.minScale||S.maxScale?{minScale:S.minScale??0,maxScale:S.maxScale??0}:null}function d(S){if(null==S)return null;if(Array.isArray(S)){const[n,b,c,y]=S;return[n,b,c,255*y]}return"string"==typeof S?S:{...S,defaultValue:d(S?.defaultValue)}}function s(S,n){return H.apply(this,arguments)}function H(){return(H=(0,R.Z)(function*(S,n){const{cimResourceManager:b,cimAnalyzer:c,scaleExpression:y}=n.schemaOptions;yield Promise.all(E.B$.fetchResources(S.symbol,b,[]));const M=c.analyzeSymbolReference(S,!1),C={scaleInfo:u(S),scaleExpression:y},X=[];for(const j of M)switch(j.type){case"marker":X.push(...J(j,n,C));break;case"fill":X.push(...re(j,n,C));break;case"line":X.push(...v(j,n,C));break;case"text":X.push(...me(j,n,C))}return X})).apply(this,arguments)}function J(S,n,b){const{uniforms:c,schemaOptions:y}=n,{store:M}=y,C=S.isOutline?{...h.Jh,visualVariableSizeScaleStops:c.visualVariableSizeOutlineScaleStops}:{visualVariableColor:c.visualVariableColor,visualVariableOpacity:c.visualVariableOpacity,visualVariableSizeMinMaxValue:c.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:c.visualVariableSizeScaleStops,visualVariableSizeStops:c.visualVariableSizeStops,visualVariableSizeUnitValue:c.visualVariableSizeUnitValue,visualVariableRotation:c.visualVariableRotation};return ne(M.ensureInstance(F.k2.marker,{uniforms:C,optionalAttributes:{zoomRange:!!b.scaleInfo}}),S,c,b)}function ne(S,n,b,{scaleInfo:c,scaleExpression:y}){const M=(0,I.h)(b);return[S.createMeshInfo({size:n.size,scaleX:n.scaleX,anchorX:n.anchorPoint.x,anchorY:n.anchorPoint.y,angle:n.rotation,color:d(n.color)??[0,0,0,0],colorLocked:n.colorLocked,frameHeight:n.frameHeight,widthRatio:n.widthRatio,scaleInfo:c,offsetX:n.offsetX,offsetY:n.offsetY,outlineColor:d(n.outlineColor)??[0,0,0,0],outlineSize:n.outlineWidth,referenceSize:n.referenceSize||N.E.CIMVectorMarker.size,rotateClockwise:n.rotateClockwise,scaleFactor:y??1,sizeRatio:n.sizeRatio,alignment:n.alignment,isAbsoluteAnchorPoint:n.isAbsoluteAnchorPoint,scaleSymbolsProportionally:n.scaleSymbolsProportionally,sprite:n.spriteRasterizationParam,hasSizeVV:M,placement:n.markerPlacement,effects:n.effects?{type:"cim-effect-infos",effectInfos:n.effects}:null,transforms:n.transform,minPixelBuffer:(0,h.XS)(b)})]}function le(S,n,{scaleInfo:b}){return[S.createMeshInfo({color:d(n.color)??[0,0,0,0],scaleInfo:b,effects:n.effects?{type:"cim-effect-infos",effectInfos:n.effects}:null})]}function re(S,n,b){if(!S.spriteRasterizationParam)return function he(S,n,b){const{uniforms:c,schemaOptions:y}=n,{store:M}=y;return le(M.ensureInstance(F.k2.fill,{uniforms:{visualVariableColor:S.colorLocked?null:c.visualVariableColor,visualVariableOpacity:c.visualVariableOpacity},optionalAttributes:{zoomRange:!!b.scaleInfo}}),S,b)}(S,n,b);const{uniforms:c,schemaOptions:y}=n,{store:M}=y;return fe(M.ensureInstance(F.k2.complexFill,{uniforms:{visualVariableColor:S.colorLocked?null:c.visualVariableColor,visualVariableOpacity:c.visualVariableOpacity},optionalAttributes:{zoomRange:!!b.scaleInfo}}),S,null!=c.visualVariableColor,b)}function fe(S,n,b,{scaleInfo:c}){if(!n.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const M=n.sampleAlphaOnly&&!(n.hasUnresolvedReplacementColor&&(!b||n.colorLocked)),C=n.spriteRasterizationParam;return[S.createMeshInfo({color:d(n.color)??[0,0,0,0],height:n.height,aspectRatio:n.scaleX,offsetX:n.offsetX,offsetY:n.offsetY,scaleX:1,scaleY:1,angle:n.angle,applyRandomOffset:n.applyRandomOffset,sampleAlphaOnly:M,scaleProportionally:"CIMHatchFill"===C.resource.type,sprite:C,scaleInfo:c,effects:n.effects?{type:"cim-effect-infos",effectInfos:n.effects}:null})]}function v(S,n,b){const{uniforms:c,schemaOptions:y}=n,{store:M}=y,C=S.isOutline?{...h.Jh,visualVariableSizeScaleStops:c.visualVariableSizeOutlineScaleStops}:{visualVariableColor:S.colorLocked?null:c.visualVariableColor,visualVariableOpacity:c.visualVariableOpacity,visualVariableSizeMinMaxValue:c.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:c.visualVariableSizeScaleStops,visualVariableSizeStops:c.visualVariableSizeStops,visualVariableSizeUnitValue:c.visualVariableSizeUnitValue},X={uniforms:C,optionalAttributes:{zoomRange:!!b.scaleInfo}},j=!!(C.visualVariableSizeMinMaxValue||C.visualVariableSizeScaleStops||C.visualVariableSizeStops||C.visualVariableSizeUnitValue);return S.spriteRasterizationParam?K(M.ensureInstance(F.k2.texturedLine,X),S,j,b):O(M.ensureInstance(F.k2.line,X),S,j,b)}function _(S,n,{scaleInfo:b}){return{color:d(S.color)??[0,0,0,0],width:S.width,referenceWidth:S.referenceWidth,capType:S.cap,joinType:S.join,miterLimit:S.miterLimit,scaleInfo:b,hasSizeVV:n,effects:S.effects?{type:"cim-effect-infos",effectInfos:S.effects}:null}}function O(S,n,b,c){if(n.spriteRasterizationParam)throw new Error("InternalError: Sprite should not be defined");const y=_(n,b,c);return[S.createMeshInfo(y)]}function K(S,n,b,c){const{spriteRasterizationParam:y,scaleDash:M,sampleAlphaOnly:C}=n;if(!y)throw new Error("InternalError: Sprite should be defined");return[S.createMeshInfo({..._(n,b,c),shouldScaleDash:M??!1,shouldSampleAlphaOnly:C,isSDF:"CIMPictureStroke"!==y.resource.type,sprite:y})]}function me(S,n,b){const{uniforms:c,schemaOptions:y}=n,{store:M}=y;return ee(M.ensureInstance(F.k2.text,{uniforms:{visualVariableColor:S.colorLocked?null:c.visualVariableColor,visualVariableOpacity:c.visualVariableOpacity,visualVariableRotation:c.visualVariableRotation,visualVariableSizeMinMaxValue:c.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:c.visualVariableSizeScaleStops,visualVariableSizeStops:c.visualVariableSizeStops,visualVariableSizeUnitValue:c.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!b.scaleInfo,referenceSymbol:!1,clipAngle:!1}}),S,c,b)}function ee(S,n,b,{scaleInfo:c,scaleExpression:y}){return[S.createMeshInfo({boxBackgroundColor:d(n.backgroundColor),boxBorderLineColor:d(n.borderLineColor),boxBorderLineSize:n.borderLineWidth??0,color:d(n.color)??[0,0,0,0],offsetX:n.offsetX,offsetY:n.offsetY,postAngle:n.angle,fontSize:n.size,referenceSize:n.referenceSize,decoration:n.decoration,haloColor:d(n.outlineColor)??[0,0,0,0],haloFontSize:n.outlineSize,lineWidth:n.lineWidth||512,lineHeightRatio:1,horizontalAlignment:n.horizontalAlignment??"center",verticalAlignment:n.verticalAlignment??"baseline",useCIMAngleBehavior:!1,glyphs:n.textRasterizationParam,scaleInfo:c,effects:n.effects?{type:"cim-effect-infos",effectInfos:n.effects}:null,placement:n.markerPlacement,transforms:n.transform,scaleFactor:y??1,minPixelBuffer:(0,h.XS)(b),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null,isLineLabel:!1})]}},35074:(be,q,m)=>{function R(N){return!!(N.visualVariableSizeMinMaxValue||N.visualVariableSizeScaleStops||N.visualVariableSizeStops||N.visualVariableSizeUnitValue||N.visualVariableSizeOutlineScaleStops)}function E(N){return!!N.visualVariableRotation}m.d(q,{A:()=>E,h:()=>R})},29024:(be,q,m)=>{m.d(q,{T:()=>fe,t:()=>d});var R=m(57964),E=m(4703),N=m(55768),F=m(19903);const h=8,I=h-2,u=()=>E.Z.getLogger("esri.views.2d.layers.features.support.rendererUtils");function d(v){return v.map(_=>function s(v){return("size"===v.type||"color"===v.type||"opacity"===v.type)&&null!=v.stops}(_)?function H(v){return v.stops=function le(v,_){return _.length<=h?_:(u().warn(`Found ${_.length} Visual Variable stops, but MapView only supports ${h}. Displayed stops will be simplified.`),_.length>2*h?function ne(v,_){const[O,...K]=_,me=K.pop(),ee=K[0].value,S=K[K.length-1].value,n=(S-ee)/I,b=[];for(let c=ee;c<S;c+=n){let y=0;for(;c>=K[y].value;)y++;const M=K[y],C=_[y-1],j=M.value===C.value?1:(c-C.value)/(M.value-C.value);if("color"===v){const W=K[y],Q=_[y-1],oe=W.color.clone();oe.r=J(Q.color.r,oe.r,j),oe.g=J(Q.color.g,oe.g,j),oe.b=J(Q.color.b,oe.b,j),oe.a=J(Q.color.a,oe.a,j),b.push({value:c,color:oe,label:W.label})}else if("size"===v){const W=K[y],Q=_[y-1],oe=(0,N.t_)(W.size),Ae=J((0,N.t_)(Q.size),oe,j);b.push({value:c,size:Ae,label:W.label})}else{const W=K[y],Q=J(_[y-1].opacity,W.opacity,j);b.push({value:c,opacity:Q,label:W.label})}}return[O,...b,me]}(v,_):function he(v){const[_,...O]=v,K=O.pop();for(;O.length>I;){let me=0,ee=0;for(let S=1;S<O.length;S++){const c=Math.abs(O[S].value-O[S-1].value);c>ee&&(ee=c,me=S)}O.splice(me,1)}return[_,...O,K]}(_))}(v.type,v.stops??[]),v}(_.clone()):_)}function J(v,_,O){return(1-O)*v+O*_}function fe(v){if(!v)return!0;switch(v.type){case"dot-density":break;case"heatmap":if(!function re(){const{supportsColorBufferFloat:v,supportsColorBufferFloatBlend:_,supportsColorBufferHalfFloat:O}=(0,F.h)();return v&&_||O}()){const _=(0,F.h)(),O=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter(K=>!_[K]).join(", ");return u().errorOnce(new R.Z("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${O}`)),!1}}return!0}},60320:(be,q,m)=>{m.d(q,{Z:()=>h});var R=m(15861),E=m(79412),N=m(82070),F=m(96214);class h{constructor(u){this.updateTracking=new N.x({debugName:"FeatureCommandQueue"}),this._queueProcessor=new F.e({concurrency:1,process:u.process})}destroy(){this.updateTracking.destroy(),this._queueProcessor.destroy(),this.clear()}clear(){this._queueProcessor.clear()}push(u){var d=this;return(0,R.Z)(function*(){return(0,E.R8)(d.updateTracking.addPromise(d._doPush(u)))})()}_doPush(u){var d=this;return(0,R.Z)(function*(){const s=d._queueProcessor,H=s.last();switch(u.type){case"update":case"highlight":return H?.type===u.type?void 0:s.push(u);case"edit-by-id":case"edit-by-feature":return s.push(u)}})()}}}}]);