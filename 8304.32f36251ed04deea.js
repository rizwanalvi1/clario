"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[8304],{90295:(te,X,l)=>{l.d(X,{Z:()=>c});class c{constructor(W){this.size=0,this._start=0,this.maxSize=W,this._buffer=new Array(W)}get entries(){return this._buffer}enqueue(W){if(this.size===this.maxSize){const h=this._buffer[this._start];return this._buffer[this._start]=W,this._start=(this._start+1)%this.maxSize,h}return this._buffer[(this._start+this.size++)%this.maxSize]=W,null}dequeue(){if(0===this.size)return null;const W=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,W}peek(){return 0===this.size?null:this._buffer[this._start]}peekLast(){return 0===this.size?null:this._buffer[(this._start+(this.size-1))%this.maxSize]}find(W){if(0===this.size)return null;for(const h of this._buffer)if(null!=h&&W(h))return h;return null}clear(W){let h=this.dequeue();for(;null!=h;)W&&W(h),h=this.dequeue()}}},11462:(te,X,l)=>{l.d(X,{I:()=>S,v:()=>W});var c=l(55117);function S(A,G,N=0){const $=(0,c.uZ)(A,0,L);for(let O=0;O<4;O++)G[N+O]=Math.floor(256*v($*h[O]))}function W(A,G=0){let N=0;for(let $=0;$<4;$++)N+=A[G+$]*P[$];return N}const h=[1,256,65536,16777216],P=[1/256,1/65536,1/16777216,1/4294967296],L=W(new Uint8ClampedArray([255,255,255,255]));function v(A){return A-Math.floor(A)}},27173:(te,X,l)=>{l.d(X,{Z:()=>d});var O,c=l(50484),S=l(57964),W=l(89317),h=l(71763),P=l(80543),G=(l(14007),l(4703),l(65311),l(10141)),N=l(53984),$=l(74321);const k={read:{reader:N.ij},write:{writer:N.cW,overridePolicy(){return{allowNull:null!=this.excludedEffect,isRequired:null==this.excludedEffect}}}},J={read:{reader:N.ij},write:{writer:N.cW,overridePolicy(){return{allowNull:null!=this.includedEffect,isRequired:null==this.includedEffect}}}},_={name:"showExcludedLabels",default:!0};let x=O=class extends W.wq{constructor(f){super(f),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(f,y){const p=super.write(f,y);if(y?.origin){if(p.filter){const I=Object.keys(p.filter);if(I.length>1||"where"!==I[0])return y.messages?.push(new S.Z("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:y.layer,effect:this})),null}if("showExcludedLabels"in p)return y.messages?.push(new S.Z("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:y.layer,effect:this})),null}return p}clone(){return new O({filter:null!=this.filter?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};(0,c._)([(0,P.Cb)({type:$.Z,json:{write:{allowNull:!0,writer(f,y,p,I){const V=f?.write({},I);V&&0!==Object.keys(V).length?(0,h.RB)(p,V,y):(0,h.RB)(p,null,y)}}}})],x.prototype,"filter",void 0),(0,c._)([(0,P.Cb)({json:{read:N.ij,write:{writer:N.cW,allowNull:!0},origins:{"web-map":k,"portal-item":k}}})],x.prototype,"includedEffect",void 0),(0,c._)([(0,P.Cb)({json:{read:N.ij,write:{writer:N.cW,allowNull:!0},origins:{"web-map":J,"portal-item":J}}})],x.prototype,"excludedEffect",void 0),(0,c._)([(0,P.Cb)({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":_,"portal-item":_}}})],x.prototype,"excludedLabelsVisible",void 0),x=O=(0,c._)([(0,G.j)("esri.layers.support.FeatureEffect")],x);const d=x},74321:(te,X,l)=>{l.d(X,{Z:()=>x});var O,c=l(50484),S=l(2189),W=l(34411),h=l(84303),P=l(89317),L=l(34222),v=l(80543),N=(l(14007),l(4703),l(10141)),$=l(91866);const k=new h.X({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),J=new h.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let _=O=class extends P.wq{constructor(d){super(d),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(d={}){const{where:f,geometry:y,spatialRelationship:p,timeExtent:I,objectIds:V,units:b,distance:T}=this;return new $.Z({geometry:(0,L.d9)(y),objectIds:(0,L.d9)(V),spatialRelationship:p,timeExtent:(0,L.d9)(I),where:f,units:b,distance:T,...d})}clone(){const{where:d,geometry:f,spatialRelationship:y,timeExtent:p,objectIds:I,units:V,distance:b}=this;return new O({geometry:(0,L.d9)(f),objectIds:(0,L.d9)(I),spatialRelationship:y,timeExtent:(0,L.d9)(p),where:d,units:V,distance:b})}};(0,c._)([(0,v.Cb)({type:String,json:{write:!0}})],_.prototype,"where",void 0),(0,c._)([(0,v.Cb)({types:S.qM,json:{write:!0}})],_.prototype,"geometry",void 0),(0,c._)([(0,v.Cb)({type:k.apiValues,json:{name:"spatialRel",read:{reader:k.read},write:{allowNull:!1,writer:k.write,overridePolicy(){return{enabled:null!=this.geometry}}}}})],_.prototype,"spatialRelationship",void 0),(0,c._)([(0,v.Cb)({type:Number,json:{write:{overridePolicy(d){return{enabled:null!=d&&null!=this.geometry}}}}})],_.prototype,"distance",void 0),(0,c._)([(0,v.Cb)({type:[Number],json:{write:!0}})],_.prototype,"objectIds",void 0),(0,c._)([(0,v.Cb)({type:J.apiValues,json:{read:J.read,write:{writer:J.write,overridePolicy(d){return{enabled:null!=d&&null!=this.geometry}}}}})],_.prototype,"units",void 0),(0,c._)([(0,v.Cb)({type:W.Z,json:{write:!0}})],_.prototype,"timeExtent",void 0),_=O=(0,c._)([(0,N.j)("esri.layers.support.FeatureFilter")],_);const x=_},40591:(te,X,l)=>{l.d(X,{Z:()=>M});var _,c=l(50484),S=l(71950),h=(l(14007),l(84303)),P=l(89317),L=l(34222),v=l(55768),A=l(80543),N=(l(4703),l(62185)),$=l(10141),O=l(7547),J=(l(65311),l(56761));let x=_=class extends P.wq{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(w,D){return D.value?(0,J.dI)(D.value):w}writeExpression(w,D,F){null!=this.value&&(w=(0,J.dI)(this.value)),null!=w&&(D[F]=w)}clone(){return new _({expression:this.expression,title:this.title,value:this.value})}};(0,c._)([(0,A.Cb)({type:String,json:{write:{writerEnsuresNonNull:!0}}})],x.prototype,"expression",void 0),(0,c._)([(0,N.r)("expression",["expression","value"])],x.prototype,"readExpression",null),(0,c._)([(0,O.c)("expression")],x.prototype,"writeExpression",null),(0,c._)([(0,A.Cb)({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],x.prototype,"title",void 0),(0,c._)([(0,A.Cb)({json:{read:!1,write:!1}})],x.prototype,"value",void 0),x=_=(0,c._)([(0,$.j)("esri.layers.support.LabelExpressionInfo")],x);const d=x;var I,f=l(85971),y=l(26981),p=l(15532);const V=new h.X({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function b(w,D,F){return{enabled:!(0,f.A2)(F?.layer)}}function T(w){return!w||"service"!==w.origin&&"map-image"!==w.layer?.type}function z(w){return!!function C(w){return"map-image"===w?.type}(w)&&!!w.capabilities?.exportMap?.supportsArcadeExpressionForLabeling}let B=I=class extends P.wq{static evaluateWhere(w,D){const F=(Z,Q,Y)=>{switch(Q){case"=":return Z==Y;case"<>":return Z!=Y;case">":return Z>Y;case">=":return Z>=Y;case"<":return Z<Y;case"<=":return Z<=Y}return!1};try{if(null==w)return!0;const Z=w.split(" ");if(3===Z.length)return F(D[Z[0]],Z[1],Z[2]);if(7===Z.length){const Q=F(D[Z[0]],Z[1],Z[2]),Y=Z[3],ee=F(D[Z[4]],Z[5],Z[6]);switch(Y){case"AND":return Q&&ee;case"OR":return Q||ee}}return!1}catch{}}constructor(w){super(w),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=y.Rz,this.useCodedValues=void 0,this.where=null}readLabelExpression(w,D){const F=D.labelExpressionInfo;if(!F||!F.value&&!F.expression)return w}writeLabelExpression(w,D,F){if(this.labelExpressionInfo)if(null!=this.labelExpressionInfo.value)w=(0,J.z7)(this.labelExpressionInfo.value);else if(null!=this.labelExpressionInfo.expression){const Z=(0,J.el)(this.labelExpressionInfo.expression);Z&&(w="["+Z+"]")}null!=w&&(D[F]=w)}writeLabelExpressionInfo(w,D,F,Z){if(null==w&&null!=this.labelExpression&&T(Z))w=new d({expression:this.getLabelExpressionArcade()});else if(!w)return;const Q=w.toJSON(Z);Q.expression&&(D[F]=Q)}writeMaxScale(w,D){(w||this.minScale)&&(D.maxScale=w)}writeMinScale(w,D){(w||this.maxScale)&&(D.minScale=w)}getLabelExpression(){return(0,J.hV)(this)}getLabelExpressionArcade(){return(0,J.YI)(this)}getLabelExpressionSingleField(){return(0,J.UO)(this)}hash(){return JSON.stringify(this)}clone(){return new I({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:(0,L.d9)(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:(0,L.d9)(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};(0,c._)([(0,A.Cb)({type:String,json:{write:!0}})],B.prototype,"name",void 0),(0,c._)([(0,A.Cb)({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:b}}}}})],B.prototype,"allowOverrun",void 0),(0,c._)([(0,A.Cb)({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:b}}}}})],B.prototype,"deconflictionStrategy",void 0),(0,c._)([(0,A.Cb)({type:String,json:{write:{overridePolicy(w,D,F){return this.labelExpressionInfo&&"service"===F?.origin&&z(F.layer)?{enabled:!1}:{allowNull:!0}}}}})],B.prototype,"labelExpression",void 0),(0,c._)([(0,N.r)("labelExpression")],B.prototype,"readLabelExpression",null),(0,c._)([(0,O.c)("labelExpression")],B.prototype,"writeLabelExpression",null),(0,c._)([(0,A.Cb)({type:d,json:{write:{overridePolicy:(w,D,F)=>function j(w){return T(w)||z(w?.layer)}(F)?{allowNull:!0}:{enabled:!1}}}})],B.prototype,"labelExpressionInfo",void 0),(0,c._)([(0,O.c)("labelExpressionInfo")],B.prototype,"writeLabelExpressionInfo",null),(0,c._)([(0,A.Cb)({type:V.apiValues,json:{type:V.jsonValues,read:V.read,write:V.write}})],B.prototype,"labelPlacement",void 0),(0,c._)([(0,A.Cb)({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],B.prototype,"labelPosition",void 0),(0,c._)([(0,A.Cb)({type:Number})],B.prototype,"maxScale",void 0),(0,c._)([(0,O.c)("maxScale")],B.prototype,"writeMaxScale",null),(0,c._)([(0,A.Cb)({type:Number})],B.prototype,"minScale",void 0),(0,c._)([(0,O.c)("minScale")],B.prototype,"writeMinScale",null),(0,c._)([(0,A.Cb)({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:b}}}}})],B.prototype,"repeatLabel",void 0),(0,c._)([(0,A.Cb)({type:Number,cast:v.t_,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:b}}}}})],B.prototype,"repeatLabelDistance",void 0),(0,c._)([(0,A.Cb)({types:S.yK,json:{origins:{"web-scene":{types:S.S6,write:p.vX,default:null}},write:p.vX,default:null}})],B.prototype,"symbol",void 0),(0,c._)([(0,A.Cb)({type:Boolean,json:{write:!0}})],B.prototype,"useCodedValues",void 0),(0,c._)([(0,A.Cb)({type:String,json:{write:!0}})],B.prototype,"where",void 0),B=I=(0,c._)([(0,$.j)("esri.layers.support.LabelClass")],B);const M=B},35469:(te,X,l)=>{l.d(X,{Z:()=>O});var G,c=l(50484),S=l(84303),W=l(89317),h=l(80543),A=(l(14007),l(4703),l(65311),l(10141));const N=new S.X({asc:"ascending",desc:"descending"});let $=G=class extends W.wq{constructor(k){super(k),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new G({field:this.field,valueExpression:this.valueExpression,order:this.order})}};(0,c._)([(0,h.Cb)({type:String,json:{write:!0}})],$.prototype,"field",void 0),(0,c._)([(0,h.Cb)({type:String,json:{write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],$.prototype,"valueExpression",void 0),(0,c._)([(0,h.Cb)({type:N.apiValues,json:{type:N.jsonValues,read:N.read,write:N.write}})],$.prototype,"order",void 0),$=G=(0,c._)([(0,A.j)("esri.layers.support.OrderByInfo")],$);const O=$},1865:(te,X,l)=>{function c(h){const P=h.layer;return"floorInfo"in P&&P.floorInfo?.floorField&&"floors"in h.view?W(h.view.floors,P.floorInfo.floorField):null}function S(h,P){return"floorInfo"in P&&P.floorInfo?.floorField?W(h,P.floorInfo.floorField):null}function W(h,P){if(!h?.length)return null;const L=h.filter(v=>""!==v).map(v=>`'${v}'`);return L.push("''"),`${P} IN (${L.join(",")}) OR ${P} IS NULL`}l.d(X,{c:()=>c,f:()=>S})},75421:(te,X,l)=>{l.d(X,{a:()=>G,r:()=>L});var c=l(57964),S=l(4703),W=l(40591);const h=()=>S.Z.getLogger("esri.layers.support.labelingInfo"),P=/\[([^[\]]+)\]/gi;function L(N,$,O){return N?N.map(k=>{const J=new W.Z;if(J.read(k,O),J.labelExpression){const _=$.fields||$.layerDefinition?.fields||this.fields;J.labelExpression=J.labelExpression.replaceAll(P,(x,d)=>`[${function v(N,$){if(!$)return N;const O=N.toLowerCase();for(let k=0;k<$.length;k++){const J=$[k].name;if(J.toLowerCase()===O)return J}return N}(d,_)}]`)}return J}):null}const A={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along","above-along","below-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};function G(N,$){const O=[];for(const k of N){const J=k.labelPlacement,_=A[$];if(!k.symbol)return h().warn("No ILabelClass symbol specified."),[];if(!_)return h().error(new c.Z("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${$}' is not supported`)),[];if(_.includes(J))O.push(k);else{const x=_[0];J&&h().warn(`Found invalid label placement type ${J} for ${$}. Defaulting to ${x}`);const d=k.clone();d.labelPlacement=x,O.push(d)}}return O}},96043:(te,X,l)=>{l.d(X,{AJ:()=>v,If:()=>N,k0:()=>L,uI:()=>G,ul:()=>P,wx:()=>$});var c=l(55117),S=l(55768),W=l(5710),h=l(23515);const P=2.4;function L(O){return(0,S.Wz)(O*P)}function v(O){return(0,S.F2)(O)/P}function A(O,k,J,_){let{color:x,ratio:d}=k,{color:f,ratio:y}=J;y===d&&(1===y?d-=1e-6:y+=1e-6);const p=(0,c.uZ)((_-d)/(y-d),0,1);(0,W.l)(O,x.toArray(),f.toArray(),p)}function G(O){const J=new Uint8ClampedArray(2048);if((O=O.filter(({ratio:y})=>y>=0&&y<=1).sort((y,p)=>y.ratio-p.ratio).map(({color:y,ratio:p})=>({color:y,ratio:Math.max(p,.001)}))).length<1)return J;let _=O[0],x=O[0],d=1;const f=(0,h.Ue)();for(let y=0;y<512;y++){const p=(y+.5)/512;for(;p>x.ratio&&d<O.length;)_=x,x=O[d++];A(f,_,x,p),J.set(f,4*y)}return J}function N(O,k,J){const _=Math.sqrt(O**2+k**2)/J;return _>1?0:3/(Math.PI*J**2)*(1-_**2)**2}function $(O){return"function"==typeof O?O:O?k=>+k[O]:()=>1}},50532:(te,X,l)=>{var c,S,v;function W(v){return v&&"esri.renderers.visualVariables.SizeVariable"===v.declaredClass}function h(v){return null!=v&&!isNaN(v)&&isFinite(v)}function P(v){return v.valueExpression?c.Expression:v.field&&"string"==typeof v.field?c.Field:c.Unknown}function L(v,A){return(A||P(v))===c.Unknown?S.Constant:v.stops?S.Stops:null!=v.minSize&&null!=v.maxSize&&null!=v.minDataValue&&null!=v.maxDataValue?S.ClampedLinear:"unknown"===(v.valueUnit||"unknown")?null!=v.minSize&&null!=v.minDataValue?v.minSize&&v.minDataValue?S.Proportional:S.Additive:S.Identity:S.RealWorldSize}l.d(X,{PS:()=>P,QW:()=>L,RY:()=>c,hL:()=>S,iY:()=>W,qh:()=>h}),(v=c||(c={})).Unknown="unknown",v.Expression="expression",v.Field="field",function(v){v.Unknown="unknown",v.Stops="stops",v.ClampedLinear="clamped-linear",v.Proportional="proportional",v.Additive="additive",v.Constant="constant",v.Identity="identity",v.RealWorldSize="real-world-size"}(S||(S={}))},93792:(te,X,l)=>{l.d(X,{Z:()=>y});var x,c=l(50484),S=l(2189),W=l(35458),h=l(84303),P=l(89317),L=l(34222),v=l(80543),N=(l(14007),l(4703),l(62185)),$=l(10141),O=l(7547),k=l(43814),J=l(40637),_=l(81247);const d=new h.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let f=x=class extends P.wq{constructor(p){super(p),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(p,I){const V=k.Z.fromJSON(I.spatialReference),b=[];for(let T=0;T<p.length;T++){const C=p[T],z=W.Z.fromJSON(C),j=C.geometry?.spatialReference;null==z.geometry||j||(z.geometry.spatialReference=V);const B=C.aggregateGeometries,M=z.aggregateGeometries;if(B&&null!=M)for(const w in M){const D=M[w],F=B[w],Z=F?.spatialReference;null==D||Z||(D.spatialReference=V)}b.push(z)}return b}writeGeometryType(p,I,V,b){if(p)return void d.write(p,I,V,b);const{features:T}=this;if(T)for(const C of T)if(null!=C?.geometry)return void d.write(C.geometry.type,I,V,b)}readQueryGeometry(p,I){if(!p)return null;const V=!!p.spatialReference,b=(0,J.im)(p);return b&&!V&&I.spatialReference&&(b.spatialReference=k.Z.fromJSON(I.spatialReference)),b}writeSpatialReference(p,I){if(p)return void(I.spatialReference=p.toJSON());const{features:V}=this;if(V)for(const b of V)if(b&&null!=b.geometry&&b.geometry.spatialReference)return void(I.spatialReference=b.geometry.spatialReference.toJSON())}clone(){return new x(this.cloneProperties())}cloneProperties(){return(0,L.d9)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(p){const I=this.write();if(I.features&&Array.isArray(p)&&p.length>0)for(let V=0;V<I.features.length;V++){const b=I.features[V];if(b.geometry){const T=p?.[V];b.geometry=T?.toJSON()||b.geometry}}return I}quantize(p){const{scale:[I,V],translate:[b,T]}=p,j=this.features,B=this._getQuantizationFunction(this.geometryType,M=>Math.round((M-b)/I),M=>Math.round((T-M)/V));for(let M=0,w=j.length;M<w;M++)B?.(j[M].geometry)||(j.splice(M,1),M--,w--);return this.transform=p,this}unquantize(){const{geometryType:p,features:I,transform:V}=this;if(!V)return this;const{translate:[b,T],scale:[C,z]}=V;let M=null,w=null;if(this.hasZ&&null!=V?.scale?.[2]){const{translate:[,,F],scale:[,,Z]}=V;M=Q=>Q*Z+F}if(this.hasM&&null!=V?.scale?.[3]){const{translate:[,,,F],scale:[,,,Z]}=V;w=Q=>null==Q?Q:Q*Z+F}const D=this._getHydrationFunction(p,F=>F*C+b,F=>T-F*z,M,w);for(const{geometry:F}of I)null!=F&&D&&D(F);return this.transform=null,this}_quantizePoints(p,I,V){let b,T;const C=[];for(let z=0,j=p.length;z<j;z++){const B=p[z];if(z>0){const M=I(B[0]),w=V(B[1]);M===b&&w===T||(C.push([M-b,w-T]),b=M,T=w)}else b=I(B[0]),T=V(B[1]),C.push([b,T])}return C.length>0?C:null}_getQuantizationFunction(p,I,V){return"point"===p?b=>(b.x=I(b.x),b.y=V(b.y),b):"polyline"===p||"polygon"===p?b=>{const T=(0,J.oU)(b)?b.rings:b.paths,C=[];for(let z=0,j=T.length;z<j;z++){const M=this._quantizePoints(T[z],I,V);M&&C.push(M)}return C.length>0?((0,J.oU)(b)?b.rings=C:b.paths=C,b):null}:"multipoint"===p?b=>{const T=this._quantizePoints(b.points,I,V);return T&&T.length>0?(b.points=T,b):null}:"extent"===p?b=>b:null}_getHydrationFunction(p,I,V,b,T){return"point"===p?C=>{C.x=I(C.x),C.y=V(C.y),b&&(C.z=b(C.z))}:"polyline"===p||"polygon"===p?C=>{const z=(0,J.oU)(C)?C.rings:C.paths;let j,B;for(let M=0,w=z.length;M<w;M++){const D=z[M];for(let F=0,Z=D.length;F<Z;F++){const Q=D[F];F>0?(j+=Q[0],B+=Q[1]):(j=Q[0],B=Q[1]),Q[0]=I(j),Q[1]=V(B)}}if(b&&T)for(let M=0,w=z.length;M<w;M++){const D=z[M];for(let F=0,Z=D.length;F<Z;F++){const Q=D[F];Q[2]=b(Q[2]),Q[3]=T(Q[3])}}else if(b)for(let M=0,w=z.length;M<w;M++){const D=z[M];for(let F=0,Z=D.length;F<Z;F++){const Q=D[F];Q[2]=b(Q[2])}}else if(T)for(let M=0,w=z.length;M<w;M++){const D=z[M];for(let F=0,Z=D.length;F<Z;F++){const Q=D[F];Q[2]=T(Q[2])}}}:"extent"===p?C=>{C.xmin=I(C.xmin),C.ymin=V(C.ymin),C.xmax=I(C.xmax),C.ymax=V(C.ymax),b&&null!=C.zmax&&null!=C.zmin&&(C.zmax=b(C.zmax),C.zmin=b(C.zmin)),T&&null!=C.mmax&&null!=C.mmin&&(C.mmax=T(C.mmax),C.mmin=T(C.mmin))}:"multipoint"===p?C=>{const z=C.points;let j,B;for(let M=0,w=z.length;M<w;M++){const D=z[M];M>0?(j+=D[0],B+=D[1]):(j=D[0],B=D[1]),D[0]=I(j),D[1]=V(B)}if(b&&T)for(let M=0,w=z.length;M<w;M++){const D=z[M];D[2]=b(D[2]),D[3]=T(D[3])}else if(b)for(let M=0,w=z.length;M<w;M++){const D=z[M];D[2]=b(D[2])}else if(T)for(let M=0,w=z.length;M<w;M++){const D=z[M];D[2]=T(D[2])}}:null}};(0,c._)([(0,v.Cb)({type:String,json:{write:!0}})],f.prototype,"displayFieldName",void 0),(0,c._)([(0,v.Cb)({type:Boolean,json:{write:{overridePolicy:p=>({enabled:p})}}})],f.prototype,"exceededTransferLimit",void 0),(0,c._)([(0,v.Cb)({type:[W.Z],json:{write:!0}})],f.prototype,"features",void 0),(0,c._)([(0,N.r)("features")],f.prototype,"readFeatures",null),(0,c._)([(0,v.Cb)({type:[_.Z],json:{write:!0}})],f.prototype,"fields",void 0),(0,c._)([(0,v.Cb)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:d.read}}})],f.prototype,"geometryType",void 0),(0,c._)([(0,O.c)("geometryType")],f.prototype,"writeGeometryType",null),(0,c._)([(0,v.Cb)({type:Boolean,json:{write:{overridePolicy:p=>({enabled:p})}}})],f.prototype,"hasM",void 0),(0,c._)([(0,v.Cb)({type:Boolean,json:{write:{overridePolicy:p=>({enabled:p})}}})],f.prototype,"hasZ",void 0),(0,c._)([(0,v.Cb)({types:S.qM,json:{write:!0}})],f.prototype,"queryGeometry",void 0),(0,c._)([(0,N.r)("queryGeometry")],f.prototype,"readQueryGeometry",null),(0,c._)([(0,v.Cb)({type:k.Z,json:{write:!0}})],f.prototype,"spatialReference",void 0),(0,c._)([(0,O.c)("spatialReference")],f.prototype,"writeSpatialReference",null),(0,c._)([(0,v.Cb)({json:{write:!0}})],f.prototype,"transform",void 0),f=x=(0,c._)([(0,$.j)("esri.rest.support.FeatureSet")],f),f.prototype.toJSON.isDefaultToJSON=!0;const y=f},43248:(te,X,l)=>{l.d(X,{Fp:()=>P,RL:()=>$,UV:()=>N,bk:()=>G});var c=l(11462),S=l(40637),W=l(43818),h=l(99657);function P(_){switch(_.type){case"CIMPointSymbol":{const x=_.symbolLayers;if(!x||1!==x.length)return null;const d=x[0];return"CIMVectorMarker"!==d.type?null:P(d)}case"CIMVectorMarker":{const x=_.markerGraphics;if(!x||1!==x.length)return null;const d=x[0];if(!d)return null;const f=d.geometry;if(!f)return null;const y=d.symbol;return!y||"CIMPolygonSymbol"!==y.type&&"CIMLineSymbol"!==y.type||y.symbolLayers?.some(p=>!!p.effects)?null:{type:"sdf",geom:f,asFill:"CIMPolygonSymbol"===y.type}}}}function A(_){let x=1/0,d=-1/0,f=1/0,y=-1/0;for(const p of _)for(const I of p)I[0]<x&&(x=I[0]),I[0]>d&&(d=I[0]),I[1]<f&&(f=I[1]),I[1]>y&&(y=I[1]);return[x,f,d,y]}function G(_){return _?_.rings?A(_.rings):_.paths?A(_.paths):(0,S.YX)(_)?[_.xmin,_.ymin,_.xmax,_.ymax]:null:null}function N(_,x,d,f,y){const[p,I,V,b]=_;if(V<p||b<I)return[0,0,0,1];const T=V-p,C=b-I,z=h.iA,j=h.s4,B=Math.floor(.5*(.5*z-j)),M=(z-2*(B+j))/Math.max(T,C),w=Math.round(T*M)+2*B,D=Math.round(C*M)+2*B;let F=1;x&&(F=D/M/(x.ymax-x.ymin));let Z=0,Q=0,Y=1;f&&(y?x&&d&&x.ymax-x.ymin>0&&(Y=(x.xmax-x.xmin)/(x.ymax-x.ymin),Z=f.x/(d*Y),Q=f.y/d):(Z=f.x,Q=f.y)),x&&(Z=.5*(x.xmax+x.xmin)+Z*(x.xmax-x.xmin),Q=.5*(x.ymax+x.ymin)+Q*(x.ymax-x.ymin)),Z-=p,Q-=I,Z*=M,Q*=M,Z+=B,Q+=B;let ee=Z/w-.5,he=Q/D-.5;return y&&d&&(ee*=d*Y,he*=d),[F,ee,he,Y]}function $(_){const x=function L(_){return _?_.rings?_.rings:_.paths?_.paths:void 0!==_.xmin&&void 0!==_.ymin&&void 0!==_.xmax&&void 0!==_.ymax?[[[_.xmin,_.ymin],[_.xmin,_.ymax],[_.xmax,_.ymax],[_.xmax,_.ymin],[_.xmin,_.ymin]]]:null:null}(_.geom),d=function v(_){let x=1/0,d=-1/0,f=1/0,y=-1/0;for(const p of _)for(const I of p)I[0]<x&&(x=I[0]),I[0]>d&&(d=I[0]),I[1]<f&&(f=I[1]),I[1]>y&&(y=I[1]);return new W.Z(x,f,d-x,y-f)}(x),f=h.iA,y=h.s4,p=Math.floor(.5*(.5*f-y)),I=(f-2*(p+y))/Math.max(d.width,d.height),V=Math.round(d.width*I)+2*p,b=Math.round(d.height*I)+2*p,T=[];for(const z of x)if(z&&z.length>1){const j=[];for(const B of z){let[M,w]=B;M-=d.x,w-=d.y,M*=I,w*=I,M+=p-.5,w+=p-.5,j.push(_.asFill?[M,w]:[Math.round(M),Math.round(w)])}if(_.asFill){const B=j.length-1;j[0][0]===j[B][0]&&j[0][1]===j[B][1]||j.push(j[0])}T.push(j)}const C=function O(_,x,d,f){const y=x*d,p=new Array(y),I=f*f+1;for(let V=0;V<y;++V)p[V]=I;for(const V of _){const b=V.length;for(let T=1;T<b;++T){const C=V[T-1],z=V[T];let j,B,M,w;C[0]<z[0]?(j=C[0],B=z[0]):(j=z[0],B=C[0]),C[1]<z[1]?(M=C[1],w=z[1]):(M=z[1],w=C[1]);let D=Math.floor(j)-f,F=Math.floor(B)+f,Z=Math.floor(M)-f,Q=Math.floor(w)+f;D<0&&(D=0),F>x&&(F=x),Z<0&&(Z=0),Q>d&&(Q=d);const Y=z[0]-C[0],ee=z[1]-C[1],he=Y*Y+ee*ee;for(let fe=D;fe<F;fe++)for(let re=Z;re<Q;re++){const ie=fe+.5,ze=re+.5;let ve,Se,Re=(ie-C[0])*Y+(ze-C[1])*ee;Re<0?(ve=C[0],Se=C[1]):Re>he?(ve=z[0],Se=z[1]):(Re/=he,ve=C[0]+Re*Y,Se=C[1]+Re*ee);const Ze=(ie-ve)*(ie-ve)+(ze-Se)*(ze-Se),Ke=(d-re-1)*x+fe;Ze<p[Ke]&&(p[Ke]=Ze)}}}for(let V=0;V<y;++V)p[V]=Math.sqrt(p[V]);return p}(T,V,b,p);return _.asFill&&function k(_,x,d,f,y){for(const p of _){const I=p.length;for(let V=1;V<I;++V){const b=p[V-1],T=p[V];let C,z,j,B;b[0]<T[0]?(C=b[0],z=T[0]):(C=T[0],z=b[0]),b[1]<T[1]?(j=b[1],B=T[1]):(j=T[1],B=b[1]);let M=Math.floor(C),w=Math.floor(z)+1,D=Math.floor(j),F=Math.floor(B)+1;M<f&&(M=f),w>x-f&&(w=x-f),D<f&&(D=f),F>d-f&&(F=d-f);for(let Z=D;Z<F;++Z){if(b[1]>Z==T[1]>Z)continue;const Q=Z+.5,Y=(d-Z-1)*x;for(let ee=M;ee<w;++ee)ee+.5<(T[0]-b[0])*(Q-b[1])/(T[1]-b[1])+b[0]&&(y[Y+ee]=-y[Y+ee]);for(let ee=f;ee<M;++ee)y[Y+ee]=-y[Y+ee]}}}}(T,V,b,p,C),[J(C,p),V,b]}function J(_,x){const d=2*x,f=_.length,y=new Uint8Array(4*f);for(let p=0;p<f;++p)(0,c.I)(.5-_[p]/d,y,4*p);return y}},15532:(te,X,l)=>{l.d(X,{cW:()=>v,im:()=>$,vX:()=>A});var c=l(71950),S=l(57964),W=l(85971),h=l(15954),P=l(7610),L=l(80121);function v(O,k,J,_){const x=N(O,{},{context:_,isLabelSymbol:!1});null!=x&&(k[J]=x)}function A(O,k,J,_){const x=N(O,{},{context:_,isLabelSymbol:!0});null!=x&&(k[J]=x)}function G(O){return O instanceof h.Z||O instanceof L.Z}function N(O,k,J){if(null==O)return null;const{context:_,isLabelSymbol:x}=J,d=_?.origin,f=_?.messages;if("web-scene"===d&&!G(O)){const y=(0,P.q)(O,{retainCIM:!0,hasLabelingContext:x});return null!=y.symbol?y.symbol.write(k,_):(f?.push(new S.Z("symbol:unsupported",`Symbols of type '${O.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:O,context:_,error:y.error})),null)}return("web-map"===d||"portal-item"===d&&!(0,W.A2)(_?.layer))&&G(O)?(f?.push(new S.Z("symbol:unsupported",`Symbols of type '${O.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:O,context:_})),null):O.write(k,_)}function $(O,k){return(0,c.S9)(O,null,k)}},7610:(te,X,l)=>{l.d(X,{q:()=>D});var c=l(71950),S=l(57964),W=l(66599),h=l(83944),L=(l(14007),l(55768)),v=l(13714),A=l(92227),G=l(75771),N=l(31110),$=l(87137),O=l(74224),k=l(26981),J=l(19579),_=l(91729);N.Z.fromSimpleMarkerSymbol(k.xA),A.Z.fromSimpleLineSymbol(k.CJ),$.Z.fromSimpleFillSymbol(k.z3),new G.Z({symbolLayers:new h.Z([new v.Z({material:{color:J.SQ},edges:new O.Z({size:(0,L.Wz)(1),color:new W.Z(J.X1)})})])});const p=new A.Z({symbolLayers:new h.Z([new _.Z({material:{color:new W.Z([0,0,0])},size:(0,L.Wz)(1)})])}),I=new $.Z({symbolLayers:new h.Z([new v.Z({outline:{color:new W.Z([0,0,0]),size:(0,L.Wz)(1)}})])});var b=l(80121),T=l(66637),C=l(35451),z=l(41391),j=l(89481),B=l(52248),M=l(82108);const w={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function D(F,Z=w){if(!F)return{symbol:null};const{retainId:Q=w.retainId,ignoreDrivers:Y=w.ignoreDrivers,hasLabelingContext:ee=w.hasLabelingContext,retainCIM:he=w.retainCIM,cimFallbackEnabled:fe=w.cimFallbackEnabled}=Z;let re=null;if((0,c.dU)(F)||F instanceof b.Z)re=F.clone();else if("cim"===F.type){const ie=F.data?.symbol?.type;switch(ie){case"CIMPointSymbol":re=he?F.clone():N.Z.fromCIMSymbol(F);break;case"CIMLineSymbol":fe&&(re=p.clone(),Z?.logWarning?.("Unsupported CIM line symbology converted to fallback 3D line symbology"));break;case"CIMPolygonSymbol":fe&&(re=I.clone(),Z?.logWarning?.("Unsupported CIM polygon symbology converted to fallback 3D polygon symbology"))}if(!re)return{error:new S.Z("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${ie||"unknown"}' is unsupported in 3D`,{symbol:F})}}else if(F instanceof T.Z)re=A.Z.fromSimpleLineSymbol(F);else if(F instanceof C.Z)re=N.Z.fromSimpleMarkerSymbol(F);else if(F instanceof z.Z)re=N.Z.fromPictureMarkerSymbol(F);else if(F instanceof j.Z)re=Z.geometryType&&"mesh"===Z.geometryType?G.Z.fromSimpleFillSymbol(F):$.Z.fromSimpleFillSymbol(F);else{if(!(F instanceof B.Z))return{error:new S.Z("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${F.type||F.declaredClass}' is unsupported in 3D`,{symbol:F})};re=ee?M.Z.fromTextSymbol(F):N.Z.fromTextSymbol(F)}return Q&&re&&"cim"!==re.type&&(re.id=F.id),Y&&(0,c.dU)(re)&&re.symbolLayers.forEach(ie=>ie.ignoreDrivers=!0),{symbol:re}}},96932:(te,X,l)=>{l.d(X,{b:()=>_});var c=l(57964),S=l(14007),W=l(4703),h=l(99657),P=l(35935),L=l(32196),v=l(39237),A=l(83018),G=l(17091),N=l(22784);class O{constructor(d,f,y){this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;const{buffer:p,pixelType:I,textureOnly:V}=d,b=(0,L.UK)(I);this.blockIndex=y,this.pixelType=I,this.size=f,this.textureOnly=V,V||(this.data=new b(p)),this._resetRange()}destroy(){this._texture?.dispose();for(const d in this._fbos){const f=this._fbos[d];f&&("0"===d&&f.detachColorTexture(),f.dispose()),this._fbos[d]=null}this._texture=null}get _textureDesc(){const d=new N.X;return d.wrapMode=v.e8.CLAMP_TO_EDGE,d.samplingMode=v.cw.NEAREST,d.dataType=this.pixelType,d.width=this.size,d.height=this.size,d}setData(d,f,y){const p=(0,P.jL)(d),I=this.data,V=p*this.texelSize+f;!I||V>=I.length||(I[V]=y,this.dirtyStart=Math.min(this.dirtyStart,p),this.dirtyEnd=Math.max(this.dirtyEnd,p))}getData(d,f){if(null==this.data)return null;const y=(0,P.jL)(d)*this.texelSize+f;return!this.data||y>=this.data.length?null:this.data[y]}getTexture(d){return this._texture??this._initTexture(d)}getFBO(d,f=0){if(!this._fbos[f]){const y=0===f?this.getTexture(d):this._textureDesc;this._fbos[f]=new A.X(d,y)}return this._fbos[f]}get hasDirty(){return this.dirtyEnd>=this.dirtyStart}updateTexture(d,f){try{const y=this.dirtyStart,p=this.dirtyEnd;if(!this.hasDirty)return;(0,S.Z)("esri-2d-update-debug")&&console.debug(`Version[${f}] AttributeStoreView.updateTexture`,{start:y,end:p,firstBytes:new Uint8Array(this.data.buffer.slice(0,16)),block:this}),this._resetRange();const I=this.data.buffer,V=this.getTexture(d),b=4,T=(y-y%this.size)/this.size,z=T,B=(p-p%this.size)/this.size,M=T*this.size*b,w=(this.size+B*this.size)*b-M,D=(0,L.UK)(this.pixelType),F=new D(I,M*D.BYTES_PER_ELEMENT,w),Z=this.size,Q=B-z+1;if(Q>this.size)return void W.Z.getLogger("esri.views.2d.engine.webgl.AttributeStoreView").error(new c.Z("mapview-webgl","Out-of-bounds index when updating AttributeData"));V.updateData(0,0,z,Z,Q,F)}catch{}}update(d){const{data:f,start:y,end:p}=d;if(null!=f&&null!=this.data){const I=this.data,V=y*this.texelSize;for(let b=0;b<f.length;b++)d.layout&1<<b%this.texelSize&&(I[V+b]=f[b])}this.dirtyStart=Math.min(this.dirtyStart,y),this.dirtyEnd=Math.max(this.dirtyEnd,p)}resize(d,f){const y=this.size;if(this.size=f,this.textureOnly)return void(y!==this.size&&(this._lastTexture=this._texture,this._texture=null));const p=(0,L.UK)(this.pixelType);this.destroy(),this.data=new p(d.buffer)}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}_initTexture(d){const f=new G.x(d,this._textureDesc,this.data??void 0);if(null!=this._lastTexture&&this._fbos[0]){const y=this._lastTexture.descriptor.width,p=this._lastTexture.descriptor.height,I=this._lastTexture.descriptor.dataType,V=this._lastTexture.descriptor.pixelFormat,b=this.getFBO(d),T=(0,L.Yw)(I),C=new((0,L.UK)(I))(new ArrayBuffer(y*p*T*this.texelSize)),z=d.getBoundFramebufferObject(),{x:j,y:B,width:M,height:w}=d.getViewport();d.bindFramebuffer(b),b.readPixels(0,0,y,p,V,I,C),f.updateData(0,0,0,2*y,p/2,C),d.setViewport(j,B,M,w),d.bindFramebuffer(z)}return this.destroy(),this._texture=f,this._texture}}class k{constructor(){this.size=0,this._pendingAttributeUpdates=[],this._version=0,this._epoch=0,this._locked=!1}_initialize(d){if(!d)throw new Error("InternalError: initArgs must be defined");const f=d.blockDescriptors;if(this.size=d.blockSize,(0,S.Z)("esri-2d-update-debug")&&console.debug("AttributeStoreView.initialize",{message:d}),null==this._data)this._data=f.map((y,p)=>null!=y?new O(y,this.size,p):null);else for(let y=0;y<this._data.length;y++){const p=this._data[y],I=f[y];null!=I&&(null==p?this._data[y]=new O(I,this.size,y):p.resize(I,this.size))}}destroy(){for(const d of this._data??[])d?.destroy();this._defaultTexture?.dispose(),this._defaultTexture=null,this._pendingAttributeUpdates=[]}isEmpty(){return null==this._data}getBlock(d){return null==this._data?null:this._data[d]}setLabelMinZoom(d,f){this.setData(d,0,1,f)}getLabelMinZoom(d){return this.getData(d,0,1,255)}getFilterFlags(d){return this.getData(d,0,0,0)}getVVSize(d){return this.getData(d,h.wi.VV,0,0)}getData(d,f,y,p){if(!this._data)return 0;const I=this._data[f];return null==I?0:I.getData(d,y)??p}setData(d,f,y,p){this._data[f].setData(d,y,p)}lockTextureUploads(){this._locked=!0}unlockTextureUploads(){this._locked=!1,this.update()}requestUpdate(d){this._version=d.version,this._pendingAttributeUpdates.push(d),(0,S.Z)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] AttributeStoreView.requestUpdate`,{message:d})}get currentEpoch(){return this._epoch}update(){if(this._locked)return;const d=this._pendingAttributeUpdates;this._pendingAttributeUpdates=[];for(const f of d){const{blockData:y,initArgs:p,sendUpdateEpoch:I,version:V}=f;(0,S.Z)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] Epoch[${I}] AttributeStoreView.applyUpdate`),this._version=V,this._epoch=I,null!=p&&this._initialize(p);const b=this._data;for(let T=0;T<y.length;T++){const C=y[T],z=b[T];null!=z&&null!=C&&((0,S.Z)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] CpuBlock[${T}] AttributeStoreView.update`,{block:C}),z.update(C))}}}getUniforms(d){return{filterFlags:{texture:this._getTexture(d,h.wi.FilterFlags),unit:h.NY},animation:{texture:this._getTexture(d,h.wi.Animation),unit:h.zZ},gpgpu:{texture:this._getTexture(d,h.wi.GPGPU),unit:h.cz},visualVariableData:{texture:this._getTexture(d,h.wi.VV),unit:h.bm},dataDriven0:{texture:this._getTexture(d,h.wi.DD0),unit:h.j1},dataDriven1:{texture:this._getTexture(d,h.wi.DD1),unit:h.Ly},dataDriven2:{texture:this._getTexture(d,h.wi.DD2),unit:h.ce},size:this.size}}_getTexture(d,f){const y=this._data?.[f];return y?(y.updateTexture(d,this._version),y.getTexture(d)):this._getDefaultTexture(d)}_getDefaultTexture(d){if(null==this._defaultTexture){const f=new N.X;f.wrapMode=v.e8.CLAMP_TO_EDGE,f.samplingMode=v.cw.NEAREST,f.width=1,f.height=1,this._defaultTexture=new G.x(d,f,new Uint8Array(4))}return this._defaultTexture}}var J=l(75747);class _ extends J.Z{constructor(d){super(d),this._statisticsByLevel=new Map,this.attributeView=new k}destroy(){this.children.forEach(d=>d.destroy()),this.removeAllChildren(),this.attributeView.destroy()}doRender(d){d.context.capabilities.enable("textureFloatLinear"),super.doRender(d)}createRenderParams(d){const f=super.createRenderParams(d);return f.attributeView=this.attributeView,f.instanceStore=this._instanceStore,f.statisticsByLevel=this._statisticsByLevel,f}}},75747:(te,X,l)=>{l.d(X,{Z:()=>v});var c=l(14007),S=l(43101),W=l(92311),h=l(46356),P=l(87546);const L=(A,G)=>A.key.level-G.key.level!=0?A.key.level-G.key.level:A.key.row-G.key.row!=0?A.key.row-G.key.row:A.key.col-G.key.col;class v extends W.Z{constructor(G){super(),this._tileInfoView=G}renderChildren(G){this.sortChildren(L),this.setStencilReference(G),super.renderChildren(G)}createRenderParams(G){const{state:N}=G,$=super.createRenderParams(G);return $.requiredLevel=this._tileInfoView.getClosestInfoForScale(N.scale).level,$.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(N.scale),$}prepareRenderPasses(G){const N=super.prepareRenderPasses(G);return N.push(G.registerRenderPass({name:"stencil",brushes:[h.Z],drawPhase:S.jx.DEBUG|S.jx.MAP|S.jx.HIGHLIGHT|S.jx.LABEL,target:()=>this.getStencilTarget()})),(0,c.Z)("esri-tiles-debug")&&N.push(G.registerRenderPass({name:"tileInfo",brushes:[P.Z],drawPhase:S.jx.DEBUG,target:()=>this.children})),N}getStencilTarget(){return this.children}setStencilReference(G){let N=1;for(const $ of this.children)$.stencilRef=N++}}},3803:(te,X,l)=>{l.d(X,{G:()=>S});var c=l(95163);class S{constructor(h,P,L){this._instanceId=h,this.techniqueRef=P,this._input=L}get instanceId(){return(0,c.G)(this._instanceId)}createMeshInfo(h){return{id:(0,c.G)(this._instanceId),techniqueType:this.techniqueRef.type,inputParams:h,optionalAttributes:this._input.optionalAttributes}}getInput(){return this._input}setInput(h){this._input=h}}},95163:(te,X,l)=>{function c(W){return W}function S(W){return W}l.d(X,{G:()=>c,W:()=>S})},58304:(te,X,l)=>{l.r(X),l.d(X,{default:()=>ci});var c=l(15861),S=l(50484),W=l(35458),h=l(80543),P=l(14007),L=l(4703),A=(l(65311),l(10141));let G=class extends W.Z{constructor(){super(...arguments),this.isAggregate=!0}getEffectivePopupTemplate(r=!1){if(this.popupTemplate)return this.popupTemplate;const e=this.sourceLayer?.featureReduction;return e&&"popupTemplate"in e&&e.popupEnabled?e.popupTemplate:null}getObjectId(){return this.attributes.aggregateId}};(0,S._)([(0,h.Cb)({type:Boolean})],G.prototype,"isAggregate",void 0),G=(0,S._)([(0,A.j)("esri.AggregateGraphic")],G);const N=G;l(2189);var O=l(57678),k=l(83944),J=l(480),_=l(57964),x=l(1258),d=l(51172),f=l(71763),y=l(79412),p=l(77675),I=l(73514),V=l(54786);let b=class extends I.Z{constructor(r){super(r),this._filter=null,this.duration=(0,P.Z)("mapview-transitions-duration"),this._excludedEffectView=new V.AM(r),this._includedEffectView=new V.AM(r)}get excludedEffects(){return this._excludedEffectView.effects}set featureEffect(r){this._get("featureEffect")!==r&&this._transitionTo(r)}get filter(){return this._filter||this.featureEffect?.filter||null}get hasEffects(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}get includedEffects(){return this._includedEffectView.effects}set scale(r){this._set("scale",r),this._excludedEffectView.scale=r,this._includedEffectView.scale=r}get transitioning(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}transitionStep(r,e){this._set("scale",e),this.transitioning?(this._includedEffectView.transitionStep(r,e),this._excludedEffectView.transitionStep(r,e),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=e,this._includedEffectView.scale=e)}endTransitions(){this._includedEffectView.endTransitions(),this._excludedEffectView.endTransitions(),this._filter=null}_transitionTo(r){const e=this._get("featureEffect"),t=r,s=t?.includedEffect,a=t?.excludedEffect,o=this._includedEffectView.canTransitionTo(s)&&this._excludedEffectView.canTransitionTo(a);this._includedEffectView.effect=s,this._excludedEffectView.effect=a,this._set("featureEffect",t),this._filter=t?.filter||e?.filter||null,o||this.endTransitions()}};(0,S._)([(0,h.Cb)()],b.prototype,"_filter",void 0),(0,S._)([(0,h.Cb)()],b.prototype,"_excludedEffectView",void 0),(0,S._)([(0,h.Cb)()],b.prototype,"_includedEffectView",void 0),(0,S._)([(0,h.Cb)()],b.prototype,"duration",void 0),(0,S._)([(0,h.Cb)()],b.prototype,"excludedEffects",null),(0,S._)([(0,h.Cb)()],b.prototype,"featureEffect",null),(0,S._)([(0,h.Cb)()],b.prototype,"filter",null),(0,S._)([(0,h.Cb)()],b.prototype,"hasEffects",null),(0,S._)([(0,h.Cb)()],b.prototype,"includedEffects",null),(0,S._)([(0,h.Cb)({value:0})],b.prototype,"scale",null),(0,S._)([(0,h.Cb)()],b.prototype,"transitioning",null),b=(0,S._)([(0,A.j)("esri.layers.effects.FeatureEffectView")],b);const T=b;var C=l(10842),z=l(74321),j=l(85295),B=l(85971),M=l(18276),w=l(62185),D=l(93792),F=l(43814);let Z=class extends D.Z{constructor(){super(...arguments),this.features=[]}readFeatures(r,e){const t=F.Z.fromJSON(e.spatialReference),s=[];for(let a=0;a<r.length;a++){const o=r[a],u=N.fromJSON(o),m=o.geometry?.spatialReference;null==u.geometry||m||(u.geometry.spatialReference=t);const E=o.aggregateGeometries,g=u.aggregateGeometries;if(E&&null!=g)for(const R in g){const U=g[R],K=E[R],H=K?.spatialReference;null==U||H||(U.spatialReference=t)}s.push(u)}return s}};(0,S._)([(0,h.Cb)({type:[N],json:{write:!0}})],Z.prototype,"features",void 0),(0,S._)([(0,w.r)("features")],Z.prototype,"readFeatures",null),Z=(0,S._)([(0,A.j)("esri.rest.support.AggregateFeatureSet")],Z);const Q=Z;var Y=l(91866),ee=l(5633),he=l(83124),fe=l(90110),re=l(96932),ie=l(43101),ze=l(72578),ve=l(3803),Se=l(95163);class Re{constructor(){this._instanceById=new Map}destroy(){this._instanceById.clear()}get size(){return this._instanceById.size}entries(){return this._instanceById.entries()}updateStart(){this._instanceByIdNext=new Map}updateEnd(){if(!this._instanceByIdNext)throw new Error("InternalError: Found updateEnd call without corresponding updateStart");for(const e of this._instanceById.keys())this._instanceByIdNext.has(e)||this._instanceById.delete(e);for(const[e,t]of this._instanceByIdNext.entries()){const s=this._instanceById.get(e);s?s.setInput(t.getInput()):this._instanceById.set(e,t)}this._instanceByIdNext=null}values(){return this._instanceById.values()}ensureInstance(e,t){let s;if("object"==typeof t&&"optionalAttributes"in t&&"uniforms"in t){s=`${e.type}${JSON.stringify(t.optionalAttributes)}`;const o=t.uniforms;if("object"==typeof o)for(const u in o)s+=`${u}.${null!=o[u]}`}else s=`${e.type}.${JSON.stringify(t)}`;const a=(0,ze.hP)(s);if(this._instanceByIdNext){const o=new ve.G((0,Se.W)(a),e,t);return this._instanceByIdNext.set(a,o),o}if(!this._instanceById.has(a)){const o=new ve.G((0,Se.W)(a),e,t);this._instanceById.set(a,o)}return this._instanceById.get(a)}getInstance(e){return this._instanceById.get(e)}}var Ze=l(90295),Ke=l(45425),Be=(l(6777),l(54529)),Ut=(l(87766),l(40394),l(18161)),zt=l(51424);class Bt{constructor(e,t,s){this.getStage=e,this.version=t,this._tileInfoView=s,this._pendingUpdates=new Ze.Z(1e3),this._locked=!1,this._tiles=new Map}destroy(){for(const e of this.tiles())e.destroy();this._pendingUpdates.clear(),this._tiles.clear()}tiles(){return this._tiles.values()}size(){return this._tiles.size}setTiles(e){this._tiles.clear();for(const t of e)this._tiles.set(t.key.id,t)}lockUploads(){this._locked=!0}unlockUploads(){this._locked=!1,this.flush()}enqueueUpdate(e){this._pendingUpdates.enqueue(e)}update(e){if(!this._locked)for(;this._pendingUpdates.size;){const t=this._pendingUpdates.peek();if(null==t||t.attributeEpoch>e)break;this._updateTile(t),this._pendingUpdates.dequeue()}}removeTile(e){const t=this._tiles.get(e);(0,P.Z)("esri-2d-update-debug")&&console.debug(`Tile[${e}] RenderState.removeTile`),t?.destroy(),this._tiles.delete(e)}isTileDone(e){const t=this._tiles.get(e.id);return!!t&&t.isReady}flush(){for(;this._pendingUpdates.size;){const e=this._pendingUpdates.dequeue();null!=e&&this._updateTile(e)}for(const e of this._tiles.values())e.upload()}_updateTile(e){(0,P.Z)("esri-2d-update-debug")&&console.debug(`Version[${e.version}] Tile[${e.id}] Chunk[${e.debugInfo?.chunkId??"<EnsureEnd>"}] RenderState.updateTile [${e.type}]`,e);const t=this._ensureTile(e.id);if("update"===e.type){const[o,...u]=e.modify;t.onMessage({type:"update",modify:o,remove:e.remove,end:e.end,attributeEpoch:e.attributeEpoch});for(const m of u){const E=this._tiles.get(m.tileId);E&&E.onMessage({type:"update",modify:m,remove:e.remove,end:!1,isPixelBuffer:!0,attributeEpoch:null})}return}if(null==e.append)return void t.onMessage({type:"append",clear:e.clear,debugInfo:e.debugInfo,end:e.end,attributeEpoch:e.attributeEpoch});const[s,...a]=e.append;t.onMessage({type:"append",clear:e.clear,append:s,debugInfo:e.debugInfo,end:e.end,attributeEpoch:e.attributeEpoch});for(const o of a){const u=this._tiles.get(o.tileId);u&&u.onMessage({type:"update",modify:o,remove:[],sort:!1,end:!1,isPixelBuffer:!0,attributeEpoch:null})}}_ensureTile(e){if(!this._tiles.has(e)){const t=this._createTile(e);this._copyPixelBufferedEntitiesInto(t),this._tiles.set(e,t)}return this._tiles.get(e)}_createTile(e){(0,P.Z)("esri-2d-update-debug")&&console.debug(`Version[${this.version}] Tile[${e}] RenderState.createTile`);const t=new Be.Z(e),s=this._tileInfoView.getTileBounds((0,Ke.Ue)(),t),a=this._tileInfoView.getTileResolution(t.level),o=new Ut.$(t,a,s[0],s[3],!0);if(o.stage=this.getStage(),!o.stage){const u=new _.Z("featurelayerview:webgl","Cannot create tile with empty stage");L.Z.getLogger("esri.views.2d.layers.features.RenderState").error(u)}return o}_copyPixelBufferedEntitiesInto(e){let t=7;for(let s=-1;s<=1;s++)for(let a=-1;a<=1;a++){if(0===s&&0===a)continue;const u=(0,zt.M)(e.key,a,s,this._tileInfoView.tileInfo.isWrappable).id,m=this._tiles.get(u);null!=m&&e.copyPixelBufferedEntitesFrom(m,1<<t,a,s),t--}}}var Rt=l(31043);class jt{constructor(e,t){this.id=e,this.version=t,this._resolver=(0,y.hh)(),this._done=!1}get done(){return this._done}get promise(){return this._resolver.promise}end(){this._resolver.resolve(),this._done=!0}destroy(){this._resolver.reject()}}class Nt extends re.b{constructor(e){super(e.view.featuresTilingScheme),this.updatingHandles=new fe.R,this._hitTestsRequests=[],this._store=new Re,this._visibleTiles=new Set,this._subscriptions=new Map,this._updateStatisticsRequests=[],this._lockStatisticUpdates=!1,this._layerView=e}renderChildren(e){if(this.attributeView.update(),this._renderState?.update(this.attributeView.currentEpoch),this._renderState){const t=Array.from(this._renderState.tiles()).filter(s=>s.needsUpload);t.length&&(t[Math.floor(Math.random()*t.length)].upload(),t.length>=2&&this.requestRender());for(const s of this._renderState.tiles())s.tryReady(this.attributeView.currentEpoch)&&(this._subscriptions.get(s.key.id)?.end(),this._layerView.requestUpdate(),this.hasLabels&&this._layerView.view.labelManager.requestUpdate(),this.requestRender())}for(const t of this.children)t.setTransform(e.state);switch(this.hasAnimation&&e.painter.effects.integrate.draw(e,e.attributeView),super.renderChildren(e),e.drawPhase){case ie.jx.MAP:return this._renderMapPhase(e);case ie.jx.HIGHLIGHT:return this._renderHighlightPhase(e);case ie.jx.LABEL:return this._renderLabelPhase(e)}}subscriptions(){return this._subscriptions.values()}get _instanceStore(){return this._store}get instanceStore(){return this._store}get layerView(){return this._layerView}get hasLabels(){return this._layerView.labelingCollisionInfos.length>0}get hasHighlight(){return this._layerView.hasHighlight()}get _layer(){return this._layerView.layer}_getExclusivePostprocessingInstance({drawPhase:e}){if(null==this._instanceStore)return null;let t=0,s=null;for(const a of this._instanceStore.values())a.techniqueRef.drawPhase&e&&(t++,a.techniqueRef.postProcessingEnabled&&(s=a));return t>1?null:s}_getOverrideStencilRef({drawPhase:e}){if(null==this._instanceStore)return null;let t=null;for(const s of this._instanceStore.values()){if(!(s.techniqueRef.drawPhase&e))continue;const{overrideStencilRef:a}=s.techniqueRef;if(null==t)t=a;else if(t!==a){t=null;break}}return t}get children(){return this._renderState?Array.from(this._renderState.tiles()).filter(e=>this._visibleTiles.has(e.key.id)):[]}updateAttributeView(e){this.requestRender(),this.attributeView.requestUpdate(e),this.hasLabels&&this._layerView.view.labelManager.requestUpdate()}updateSubscriptions(e){for(const{tileId:t,version:s}of e.subscribe)if(this._subscriptions.has(t))this._subscriptions.get(t).version=s;else{const a=new jt(t,s);this._subscriptions.set(t,a),this.updatingHandles.addPromise(a.promise)}for(const t of e.unsubscribe)this._subscriptions.get(t)?.destroy(),this._subscriptions.delete(t),this.removeTile(t)}isDone(e){return!!this._renderState&&this._renderState.isTileDone(e)}updateRenderState(e){var t=this;return(0,c.Z)(function*(){(0,P.Z)("esri-2d-update-debug")&&console.debug(`Version[${e}] FeatureContainer.updateRenderState`),t._renderStateNext=new Bt(()=>t._stage,e,t._tileInfoView)})()}getDisplayStatistics(e,t){const s=this._statisticsByLevel.get(e);return s?s.get(t):null}updateStatistics(e,t){if(this._lockStatisticUpdates)return void this._updateStatisticsRequests.push({level:e,statistics:t});let s=this._statisticsByLevel.get(e);s||(s=new Map,this._statisticsByLevel.set(e,s));for(const a of t)s.set(a.fieldName,{minValue:a.minValue,maxValue:a.maxValue})}editStart(){this._renderState?.lockUploads(),this.attributeView.lockTextureUploads(),this._lockStatisticUpdates=!0}editEnd(){this._renderState?.unlockUploads(),this.attributeView.unlockTextureUploads(),this._lockStatisticUpdates=!1;for(const e of this._updateStatisticsRequests)this.updateStatistics(e.level,e.statistics);this._updateStatisticsRequests=[],this.requestRender()}swapRenderState(){this._renderStateNext&&((0,P.Z)("esri-2d-update-debug")&&console.debug(`Version[${this._renderStateNext.version}] FeatureContainer.update.swapRenderState`),this._renderState?.destroy(),this._renderState=this._renderStateNext,this._renderStateNext=null),this._renderState&&this._renderState.flush(),this.requestRender()}setVisibleTiles(e){this._visibleTiles=e}onMessage(e,t){var s=this;return(0,c.Z)(function*(){(0,y.k_)(t);const a=e.inner;if(!s._subscriptions.has(a.id))return;const o=s._subscriptions.get(a.id);if(o.version!==a.subscriptionVesrion)return void((0,P.Z)("esri-2d-update-debug")&&console.debug(`Version[${a.subscriptionVesrion} != ${o.version}] Tile[${a.id}] FeatureContainer - Dropping message, outdated version]`,a));const u=s._renderStateNext??s._renderState;if(!u)throw new Error("InternalError: No renderState defined");u.version!==a.version&&console.error(`InternalError: Version mismatch. [renderState: ${u.version}, message: ${a.version}]`),u.enqueueUpdate(a),s.requestRender(),s._layerView.view.labelManager.requestUpdate(),s._layerView.requestUpdate()})()}removeTile(e){(this._renderState||this._renderStateNext)&&(this._renderState&&this._renderState.removeTile(e),this._renderStateNext&&this._renderStateNext.removeTile(e))}hitTest(e){let t=this._hitTestsRequests.find(({x:a,y:o})=>a===e.x&&o===e.y);const s=(0,y.hh)();return t?t.resolvers.push(s):(t={x:e.x,y:e.y,resolvers:[s]},this._hitTestsRequests.push(t)),this.requestRender(),s.promise}getSortKeys(e){const t=new Set(e),s=new Map;for(const a of this.children)if(a.getSortKeys(t).forEach((o,u)=>s.set(u,o)),s.size===t.size)break;return s}get hasAnimation(){return this.hasLabels}updateTransitionProperties(e,t){super.updateTransitionProperties(e,t),this._layerView.featureEffectView.transitionStep(e,t),this._layerView.featureEffectView.transitioning&&this.requestRender()}doRender(e){const{minScale:t,maxScale:s}=this._layer.effectiveScaleRange,a=e.state.scale;a<=(t||1/0)&&a>=s&&super.doRender(e)}afterRender(e){super.afterRender(e),this._hitTestsRequests.length&&this.requestRender()}setStencilReference(e){const t=this._getOverrideStencilRef(e);if(null==t)super.setStencilReference(e);else for(const s of this.children)s.stencilRef=t(s)}_renderMapPhase(e){this._layerView.featureEffectView.hasEffects?(this._renderOutsideEffect(e),this._renderInsideEffect(e)):this._renderFeatures(e,ie.Xq.All),this._hitTestsRequests.length>0&&this._renderHittest(e)}_renderHighlightPhase(e){this.hasHighlight&&(0,Rt.P9)(e,!1,t=>{this._renderFeatures(t,ie.Xq.Highlight)})}_renderLabelPhase(e){this._renderFeatures(e,ie.Xq.All)}_renderInsideEffect(e){const t=e.painter.effects.insideEffect;t.bind(e),this._renderFeatures(e,ie.Xq.InsideEffect),t.draw(e,this._layerView.featureEffectView.includedEffects),t.unbind()}_renderOutsideEffect(e){const t=e.painter.effects.outsideEffect;t.bind(e),this._renderFeatures(e,ie.Xq.OutsideEffect),t.draw(e,this._layerView.featureEffectView.excludedEffects),t.unbind()}_renderHittest(e){const{context:t}=e,s=e.painter.effects.hittest,a=t.getBoundFramebufferObject(),o=t.getViewport(),u=e.passOptions,m=e.drawPhase;s.bind(e),e.passOptions=s.createOptions(e,this._hitTestsRequests),e.drawPhase=ie.jx.HITTEST;const{distance:E,smallSymbolDistance:g}=e.passOptions,R=Math.max(E,g);for(const U of this.children)U.visible&&U.containsScreenPoint(e.state,e.passOptions.position,2*R)&&this._renderTile(U,e,ie.Xq.All);s.draw(e),s.unbind(),t.bindFramebuffer(a),t.restoreViewport(o),e.passOptions=u,e.drawPhase=m}_renderFeatures(e,t){for(const a of this.children)a.visible&&this._renderTile(a,e,t);const s=this._getExclusivePostprocessingInstance(e);s?.techniqueRef.postProcess(e,s)}_renderTile(e,t,s){const a=(0,P.Z)("featurelayer-force-marker-text-draw-order")?ie.gl.STRICT_MARKERS_AND_TEXT:ie.gl.BATCHING,o=e.getDisplayList(this._instanceStore,a);t.selection=s,o?.render(t)}}var Wt=l(36885);function qe(){return(qe=(0,c.Z)(function*(r){const e=yield(0,Wt.bA)("FeaturePipelineWorker",{client:r,strategy:"dedicated"});return new Jt(e)})).apply(this,arguments)}class Jt{constructor(e){this._connection=e,this.pipeline=this._connection.createInvokeProxy(),this.features=this._connection.createInvokeProxy("features"),this.aggregates=this._connection.createInvokeProxy("aggregates"),this.streamMessenger=this._connection.createInvokeProxy("streamMessenger")}destroy(){this._connection.destroy()}get closed(){return this._connection.closed}}var Gt=l(88278),$t=l(13649);let ye=class extends I.Z{constructor(){super(...arguments),this.events=new Gt.Z,this._updatingStrategy=!0,this._tileToEvent=new $t.Z,this._fetchStatus={outstanding:0,done:0}}get hasAllFeatures(){return this._hasAllData()&&(this._strategyInfo?.willQueryAllFeatures??!1)}get hasAllFeaturesInView(){return this._hasAllData()}get hasFullGeometries(){return this._hasAllData()&&(this._strategyInfo?.willQueryFullResolutionGeometry??!1)}onEvent(r){switch(r.type){case"subscribe":case"unsubscribe":case"loaded":case"error":this._handleTileEvent(r);break;case"updateStrategyStart":this._updatingStrategy=!0,this._fetchStatus={done:0,outstanding:0},this._strategyInfo=r.about;break;case"updateStrategyEnd":this._updatingStrategy=!1;break;case"updateFieldsStart":this._fetchStatus={done:0,outstanding:0};break;case"updateFieldsEnd":break;case"updateFieldsError":this.events.emit("error",r);break;case"fetchStart":this._fetchStatus.outstanding+=1,this.events.emit("status",this._fetchStatus);break;case"fetchEnd":this._fetchStatus.done+=1,this.events.emit("status",this._fetchStatus),r.done&&(this._fetchStatus={done:0,outstanding:0})}}_hasAllData(){return!this._updatingStrategy&&this._hasAllTileData()}_hasAllTileData(){for(const r of this._tileToEvent.values())if("loaded"!==r.peekLast()?.type)return!1;return!0}_handleTileEvent(r){switch(r.type){case"subscribe":{const e=new Ze.Z(10);e.enqueue(r),this._tileToEvent.set(r.tile,e);break}case"unsubscribe":this._tileToEvent.delete(r.tile);break;case"loaded":{const e=this._tileToEvent.get(r.tile);if(!e)return;e.enqueue(r),this._tileToEvent.set(r.tile,e);break}case"error":{const e=this._tileToEvent.get(r.tile);if(!e)return;e.enqueue(r),this._tileToEvent.set(r.tile,e),this.events.emit("error",r);break}}}};(0,S._)([(0,h.Cb)({readOnly:!0})],ye.prototype,"hasAllFeatures",null),(0,S._)([(0,h.Cb)({readOnly:!0})],ye.prototype,"hasAllFeaturesInView",null),(0,S._)([(0,h.Cb)({readOnly:!0})],ye.prototype,"hasFullGeometries",null),(0,S._)([(0,h.Cb)()],ye.prototype,"_updatingStrategy",void 0),(0,S._)([(0,h.Cb)()],ye.prototype,"_strategyInfo",void 0),(0,S._)([(0,h.Cb)()],ye.prototype,"_tileToEvent",void 0),ye=(0,S._)([(0,A.j)("esri.views.2d.layers.features.FeatureSourceEventLog")],ye);var je=l(34222),Je=l(89713);function me(r){switch(r.geometryType){case"point":return"esriGeometryPoint";case"polyline":return"esriGeometryPolyline";case"polygon":case"multipatch":return"esriGeometryPolygon";case"multipoint":return"esriGeometryMultipoint";default:return null}}var Me=l(55768),ce=l(50088),Ge=l(55117),Qt=l(44526),_e=l(50532);const Ht=Math.PI;function Vt(r,e){switch(e.transformationType){case _e.hL.Additive:return function Xt(r,e){return r+(de(e.minSize,r)||e.minDataValue)}(r,e);case _e.hL.Constant:return function Yt(r,e){const t=r.stops;let s=t?.length&&t[0].size;return null==s&&(s=r.minSize),de(s,e)}(e,r);case _e.hL.ClampedLinear:return function qt(r,e){const t=e.minDataValue,s=e.maxDataValue,a=(r-t)/(s-t),o=de(e.minSize,r),u=de(e.maxSize,r);return r<=t?o:r>=s?u:o+a*(u-o)}(r,e);case _e.hL.Proportional:return function er(r,e){const t=r/e.minDataValue,s=de(e.minSize,r),a=de(e.maxSize,r);let o=null;return o=t*s,(0,Ge.uZ)(o,s,a)}(r,e);case _e.hL.Stops:return function tr(r,e){const[t,s,a]=function ir(r,e){if(!e)return;let t=0,s=e.length-1;return e.some((a,o)=>r<a?(s=o,!0):(t=o,!1)),[t,s,(r-e[t])/(e[s]-e[t])]}(r,e.cache.ipData);if(t===s)return de(e.stops[t].size,r);{const o=de(e.stops[t].size,r);return o+(de(e.stops[s].size,r)-o)*a}}(r,e);case _e.hL.RealWorldSize:return function rr(r,e){const t=Qt.a[e.valueUnit],s=de(e.minSize,r),a=de(e.maxSize,r),{valueRepresentation:o}=e;let u=null;return u="area"===o?2*Math.sqrt(r/Ht)/t:"radius"===o||"distance"===o?2*r/t:r/t,(0,Ge.uZ)(u,s,a)}(r,e);case _e.hL.Identity:return r;case _e.hL.Unknown:return null}}function de(r,e){return"number"==typeof r?r:Vt(e,r)}function xe(r){return(r.labelsVisible&&r.labelingInfo?.every(e=>"none"!==e.deconflictionStrategy))??!1}function Oe(r,e){const t=(0,ce.g)(r,e);if(t?.labelsVisible&&t.labelingInfo?.length)return t.labelingInfo.every(s=>"none"!==s.deconflictionStrategy)}function sr(r){return e=>(0,Me.F2)(Vt(e,r))}function Ve(r){const e=null!=r&&"visualVariables"in r&&r.visualVariables;if(!e)return null;for(const t of e)if("size"===t.type)return sr(t);return null}var et=l(38955);function Ce(r,e,t,s){const o=(0,et._)(r.definitionExpression,null!=r.subtypeCode?`${r.subtypeField} = ${r.subtypeCode}`:null),u=r.customParameters??{};return s&&(u.token=s),{type:"feature",mutable:{sourceRefreshVersion:t,availableFields:e.availableFields,dataFilter:{queryScaleRanges:r.queryScaleRanges??[],definitionExpression:o,gdbVersion:r.gdbVersion,historicMoment:r.historicMoment?.getTime(),timeExtent:r.timeExtent?.toJSON(),customParameters:u}}}}var nr=l(35469),ar=l(75421),or=(l(71950),l(96043)),Ee=l(84176),pe=l(11196),lr=l(43248),ur=l(13948);function cr(r,e,t=0){if(null==e)return r[t]=0,r[t+1]=0,r[t+2]=0,void(r[t+3]=0);const{r:s,g:a,b:o,a:u}=e;r[t]=s*u/255,r[t+1]=a*u/255,r[t+2]=o*u/255,r[t+3]=u}l(10264);var $e=l(99657),oe=l(34317),ke=l(33380),se=l(28105),Qe=l(59104),Ie=l(35074),Ct=l(89481),dr=l(35451),pr=l(66637);function ge(r,e){return tt.apply(this,arguments)}function tt(){return(tt=(0,c.Z)(function*(r,e){if(!r)return[];switch(r.type){case"simple-fill":return at(r,e);case"picture-fill":return function xr(r,e){const{outline:t}=r,{uniforms:s,schemaOptions:a}=e,{store:o}=a,u=[],m=Ee.B$.createPictureFillRasterizationParam(r);if(!m)return[];const{width:E,height:g,xoffset:R,yoffset:U,xscale:K,yscale:H}=r,q={color:[255,255,255,255],sprite:m,height:g,aspectRatio:E/g,offsetX:R,offsetY:U,scaleX:K,scaleY:H,angle:0,applyRandomOffset:!1,sampleAlphaOnly:!1,scaleProportionally:!1,effects:null,scaleInfo:null};if("solid"===t?.style)return[o.ensureInstance(oe.k2.complexOutlineFill,{uniforms:{visualVariableColor:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity,visualVariableSizeScaleStops:s.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo({...q,...nt(t,!!s.visualVariableSizeOutlineScaleStops)})];const le=o.ensureInstance(oe.k2.complexFill,{uniforms:{visualVariableColor:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity},optionalAttributes:{zoomRange:!1}});return u.push(le.createMeshInfo(q)),t&&u.push(...Te(t,e,!0)),u}(r,e);case"simple-marker":return Pt(r,e);case"picture-marker":return function mr(r,e){const{uniforms:t,schemaOptions:s}=e,{store:a}=s,o=a.ensureInstance(oe.k2.marker,{uniforms:{visualVariableColor:t.visualVariableColor,visualVariableOpacity:t.visualVariableOpacity,visualVariableSizeMinMaxValue:t.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:t.visualVariableSizeScaleStops,visualVariableSizeStops:t.visualVariableSizeStops,visualVariableSizeUnitValue:t.visualVariableSizeUnitValue,visualVariableRotation:t.visualVariableRotation},optionalAttributes:{zoomRange:!1}}),u=Ee.B$.createPictureMarkerRasterizationParam(r);return u?[o.createMeshInfo({type:"picture",color:[255,255,255,255],height:r.height,width:r.width,offsetX:r.xoffset,offsetY:r.yoffset,angle:r.angle,alignment:(0,Ie.A)(t)?pe.v2.MAP:pe.v2.SCREEN,outlineColor:null,outlineSize:0,referenceSize:r.height,sprite:u,overrideOutlineColor:!1,hasSizeVV:(0,Ie.h)(t),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:(0,se.XS)(t)})]:[]}(r,e);case"simple-line":return Te(r,e,!1);case"text":return function br(r,e){const{uniforms:t,schemaOptions:s}=e,{store:a}=s;return[a.ensureInstance(oe.k2.text,{uniforms:{visualVariableColor:t.visualVariableColor,visualVariableOpacity:t.visualVariableOpacity,visualVariableRotation:t.visualVariableRotation,visualVariableSizeMinMaxValue:t.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:t.visualVariableSizeScaleStops,visualVariableSizeStops:t.visualVariableSizeStops,visualVariableSizeUnitValue:t.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!1,clipAngle:!1,referenceSymbol:!1}}).createMeshInfo({boxBackgroundColor:r.backgroundColor?.toArray(),boxBorderLineColor:r.borderLineColor?.toArray(),boxBorderLineSize:r.borderLineSize??0,color:r.color?.toArray()??[0,0,0,0],offsetX:r.xoffset,offsetY:r.yoffset,postAngle:r.angle,fontSize:r.font.size,decoration:r.font.decoration,haloColor:r.haloColor?.toArray()??[0,0,0,0],haloFontSize:r.haloSize??0,lineWidth:r.lineWidth,lineHeightRatio:r.lineHeight,horizontalAlignment:r.horizontalAlignment,verticalAlignment:r.verticalAlignment,useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",resource:{type:"text",font:r.font.toJSON(),textString:r.text,symbol:Ee.B$.createCIMTextSymbolfromTextSymbol(r)},overrides:[]},referenceSize:null,effects:null,placement:null,scaleInfo:null,transforms:null,scaleFactor:1,minPixelBuffer:(0,se.XS)(t),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null,isLineLabel:!1})]}(r,e);case"label":return function vr(r,e){const{schemaOptions:t,uniforms:s}=e,{store:a}=t,o=r.symbol,{allowOverrun:u,repeatLabel:m,repeatLabelDistance:E}=r,g={maxScale:r.maxScale??0,minScale:r.minScale??0},R=a.ensureInstance(oe.k2.label,{uniforms:{visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:s.visualVariableRotation,visualVariableSizeMinMaxValue:s.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:s.visualVariableSizeScaleStops,visualVariableSizeStops:s.visualVariableSizeStops,visualVariableSizeUnitValue:s.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!0,clipAngle:!0,referenceSymbol:!0}}),U=r.labelPlacement,[K,H]=(0,ur.qv)(U);return[R.createMeshInfo({boxBackgroundColor:o.backgroundColor?.toArray(),boxBorderLineColor:o.borderLineColor?.toArray(),boxBorderLineSize:o.borderLineSize??0,color:o.color?.toArray()??[0,0,0,0],offsetX:o.xoffset,offsetY:o.yoffset,postAngle:o.angle,fontSize:o.font.size,decoration:o.font.decoration,haloColor:o.haloColor?.toArray()??[0,0,0,0],haloFontSize:o.haloSize??0,lineWidth:o.lineWidth,lineHeightRatio:o.lineHeight,horizontalAlignment:K,verticalAlignment:H,repeatLabel:m,repeatLabelDistance:(0,Me.F2)(E),allowOverrun:u,labelPosition:r.labelPosition,scaleInfo:g,minPixelBuffer:(0,se.XS)(s),useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",resource:{type:"text",font:o.font.toJSON(),textString:o.text,symbol:Ee.B$.createCIMTextSymbolfromTextSymbol(o),primitiveName:"label-override"},useLegacyLabelEvaluationRules:null==r.labelExpressionInfo?.expression,overrides:[{type:"CIMPrimitiveOverride",valueExpressionInfo:{type:"CIMExpressionInfo",expression:r.labelExpressionInfo?.expression??r.labelExpression,returnType:"String"},primitiveName:"label-override",propertyName:"textString",defaultValue:""}]},referenceSize:null,effects:null,placement:null,transforms:null,scaleFactor:1,isLineLabel:!1})]}(r,e);case"cim":return(0,Qe.$L)(r.data,e);case"web-style":{const t=yield r.fetchCIMSymbol();return(0,Qe.$L)(t.data,e)}case"line-3d":return L.Z.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${r.type}" unsupported in MapView. Defaulting to simple-line`),Te(new pr.Z,e,!1);case"point-3d":return L.Z.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${r.type}" unsupported in MapView. Defaulting to simple-marker`),Pt(new dr.Z,e);case"polygon-3d":return L.Z.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${r.type}" unsupported in MapView. Defaulting to simple-fill`),at(new Ct.Z,e);case"mesh-3d":case"label-3d":return L.Z.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${r.type}" unsupported in MapView. Ignoring`),[];case"CIMSymbolReference":throw new Error("InternalError: CIMSymbolReference should already be resolved")}})).apply(this,arguments)}function hr(r,e){return rt.apply(this,arguments)}function rt(){return(rt=(0,c.Z)(function*(r,e){const{schemaOptions:t}=e,{store:s}=t,a=new Array($e.Pp),o=new Array($e.Pp/4);for(let g=0;g<$e.Pp;g++){const R=g<r.attributes.length?r.attributes[g].color:null;a[g]=[0,0,0,0],cr(a[g],R)}for(let g=0;g<$e.Pp/4;g++)o[g]=[0,0,0,0],o[g][0]=4*g<r.attributes.length?1:0,o[g][1]=4*g+1<r.attributes.length?1:0,o[g][2]=4*g+2<r.attributes.length?1:0,o[g][3]=4*g+3<r.attributes.length?1:0;const m=s.ensureInstance(oe.k2.dotDensity,{uniforms:{isActive:o,colors:a,dotValue:r.dotValue,dotScale:r.referenceScale,blending:r.dotBlendingEnabled,dotSize:r.dotSize,seed:r.seed},optionalAttributes:{}}).createMeshInfo({effects:null}),E=[];if(r.backgroundColor){const g=new Ct.Z({color:r.backgroundColor,outline:null}),R=yield ge(g,e);E.push(...R)}if(E.push(m),r.outline){const g=Te(r.outline,e,!0);E.push(...g)}return E})).apply(this,arguments)}function fr(r,e){return it.apply(this,arguments)}function it(){return(it=(0,c.Z)(function*(r,e){const{store:t}=e,{radius:s,minDensity:a,maxDensity:o,referenceScale:u,field:m,valueExpression:E,colorStops:g}=r,R=(0,or.uI)(g);return[t.ensureInstance(oe.k2.heatmap,{uniforms:{radius:(0,Me.F2)(s),minDensity:a,maxDensity:o,referenceScale:u,isFieldActive:!(!m&&!E),gradient:R,gradientHash:R.join(",")},optionalAttributes:{}}).createMeshInfo({effects:null})]})).apply(this,arguments)}function yr(r,e){const{store:t}=e,s=r.outline?.width||0,a=(0,se.Sc)(r),o=t.ensureInstance(oe.k2.pieChart,{uniforms:{shader:{outlineWidth:Math.round((0,Me.F2)(s)),defaultColor:(0,ke.n)(r.defaultColor),outlineColor:(0,ke.n)(r.outline?.color),othersColor:(0,ke.n)(r.othersCategory?.color),donutRatio:r.holePercentage,sectorThreshold:r.othersCategory?.threshold||0,colors:r.attributes.map(u=>(0,ke.n)(u.color)),visualVariableOpacity:a.visualVariableOpacity,visualVariableSizeMinMaxValue:a.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:a.visualVariableSizeScaleStops,visualVariableSizeStops:a.visualVariableSizeStops,visualVariableSizeUnitValue:a.visualVariableSizeUnitValue,hittestUniforms:null},numberOfFields:r.attributes.length},optionalAttributes:{}}).createMeshInfo({size:r.size,outlineWidth:s,effects:null,scaleInfo:null,minPixelBuffer:(0,se.XS)(a)});return[...r.backgroundFillSymbol?at(r.backgroundFillSymbol,{schemaOptions:e,path:"",uniforms:se.Jh}):[],o]}function Ft(r){if("path"===r.style){if(null==r.path)throw new Error("Symbol with a style of type path must define a path");return{type:"sprite-rasterization-param",overrides:[],resource:{type:"path",path:r.path,asFill:!0}}}const e=Ee.B$.fromSimpleMarker(r);if("outline"in r&&r.outline&&"none"!==r.outline.style&&"solid"!==r.outline.style){if(!e||!e.symbolLayers)throw new Error("Error handling marker! ");return{type:"sprite-rasterization-param",resource:e.symbolLayers[0],overrides:[]}}return{type:"sprite-rasterization-param",resource:(0,lr.Fp)(e),overrides:[]}}function Pt(r,e){return st.apply(this,arguments)}function st(){return(st=(0,c.Z)(function*(r,e){const{uniforms:t,schemaOptions:s}=e,{store:a}=s;if("path"===r.style||r.outline&&"solid"!==r.outline.style&&"none"!==r.outline.style){const K=Ee.B$.fromSimpleMarker(r);if(!K||!K.symbolLayers)throw new Error("Error handling marker! ");if(t.visualVariableRotation&&(K.angleAlignment="Map"),"path"!==r.style){const H=K.symbolLayers[0];if((0,Ie.h)(e.uniforms)){const q=(0,se.XS)(e.uniforms,0,1);if(q>H.size){const le=q/H.size;H.size=q;const ne=H.markerGraphics?.[0].symbol;(ne.symbolLayers&&ne.symbolLayers[0]).width*=le}}}return(0,Qe.$L)({type:"CIMSymbolReference",symbol:K},e)}const o=a.ensureInstance(oe.k2.marker,{uniforms:{visualVariableColor:t.visualVariableColor,visualVariableOpacity:t.visualVariableOpacity,visualVariableSizeMinMaxValue:t.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:t.visualVariableSizeScaleStops,visualVariableSizeStops:t.visualVariableSizeStops,visualVariableSizeUnitValue:t.visualVariableSizeUnitValue,visualVariableRotation:t.visualVariableRotation},optionalAttributes:{zoomRange:!1}}),u=Ft(r);let m=r.color?.toArray()??[0,0,0,0];"CIMVectorMarker"===u.resource.type&&(m=[255,255,255,255]);const g=r.size,U=null!=t.visualVariableColor&&("cross"===r.style||"x"===r.style);return[o.createMeshInfo({type:"simple",color:m,height:g,width:g*("triangle"===r.style?124/116:1),offsetX:r.xoffset,offsetY:r.yoffset,angle:r.angle,alignment:(0,Ie.A)(t)?pe.v2.MAP:pe.v2.SCREEN,outlineColor:r.outline?.color?.toArray()??[0,0,0,0],outlineSize:r.outline?.width??1,referenceSize:g,sprite:u,overrideOutlineColor:U,hasSizeVV:(0,Ie.h)(t),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:(0,se.XS)(t)})]})).apply(this,arguments)}function nt(r,e){const t=r.width;return{outlineColor:r.color?.toArray()||[0,0,0,1],width:t,referenceWidth:t,capType:r.cap??"round",joinType:r.join??"round",miterLimit:r.miterLimit,hasSizeVV:e}}function at(r,e){const{style:t}=r;return t&&"none"!==t&&"solid"!==t?function Sr(r,e){const{uniforms:t,schemaOptions:s}=e,{store:a}=s,o=r.color?.toArray()??[0,0,0,0],u={type:"sprite-rasterization-param",resource:{type:"fill-style",style:r.style},overrides:[]};if("solid"===r.outline?.style)return[a.ensureInstance(oe.k2.patternOutlineFill,{uniforms:{visualVariableColor:t.visualVariableColor,visualVariableOpacity:t.visualVariableOpacity,visualVariableSizeScaleStops:t.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:o,...nt(r.outline,!!t.visualVariableSizeOutlineScaleStops),sprite:u,scaleInfo:null,effects:null})];const m=[],E=a.ensureInstance(oe.k2.patternFill,{uniforms:{visualVariableColor:t.visualVariableColor,visualVariableOpacity:t.visualVariableOpacity},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:r.color?.toArray()??[0,0,0,0],sprite:u,scaleInfo:null,effects:null});return m.push(E),r.outline&&m.push(...Te(r.outline,e,!0)),m}(r,e):function _r(r,e){const{uniforms:t,schemaOptions:s}=e,{store:a}=s,o=r.color?.toArray()??[0,0,0,0];if("none"!==r.style&&"solid"===r.outline?.style)return[a.ensureInstance(oe.k2.outlineFill,{uniforms:{visualVariableColor:t.visualVariableColor,visualVariableOpacity:t.visualVariableOpacity,visualVariableSizeScaleStops:t.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:o,...nt(r.outline,!!t.visualVariableSizeOutlineScaleStops),scaleInfo:null,effects:null})];const u=[];if("none"!==r.style){const m=a.ensureInstance(oe.k2.fill,{uniforms:{visualVariableColor:t.visualVariableColor,visualVariableOpacity:t.visualVariableOpacity},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:o,scaleInfo:null,effects:null});u.push(m)}return r.outline&&u.push(...Te(r.outline,e,!0)),u}(r,e)}function Te(r,e,t){const{color:s,style:a,width:o,cap:u,join:m}=r,{schemaOptions:E}=e,{store:g}=E,R=[],U=t?{...se.Jh,visualVariableSizeScaleStops:e.uniforms.visualVariableSizeOutlineScaleStops}:e.uniforms,K={uniforms:{visualVariableColor:U.visualVariableColor,visualVariableOpacity:U.visualVariableOpacity,visualVariableSizeMinMaxValue:U.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:U.visualVariableSizeScaleStops,visualVariableSizeStops:U.visualVariableSizeStops,visualVariableSizeUnitValue:U.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!1}},H={color:s?.toArray()??[0,0,0,0],width:o,referenceWidth:o,capType:u,joinType:m,miterLimit:r.miterLimit,hasSizeVV:(0,Ie.h)(U),effects:null,scaleInfo:null};if(null==a||"solid"===a){const q=g.ensureInstance(oe.k2.line,K).createMeshInfo(H);R.push(q)}else if("none"!==a){const q=g.ensureInstance(oe.k2.texturedLine,K).createMeshInfo({...H,shouldScaleDash:!0,shouldSampleAlphaOnly:!1,isSDF:!0,sprite:{type:"sprite-rasterization-param",resource:{type:"dash",dashTemplate:(0,Ee.U1)(a,u),capStyle:(0,Ee.qp)(u)},overrides:[]}});R.push(q)}return null!=r.marker&&R.push(...function gr(r,e,t){const{uniforms:s,schemaOptions:a}=t,{store:o}=a,u=o.ensureInstance(oe.k2.marker,{uniforms:{visualVariableColor:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity,visualVariableSizeMinMaxValue:s.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:s.visualVariableSizeScaleStops,visualVariableSizeStops:s.visualVariableSizeStops,visualVariableSizeUnitValue:s.visualVariableSizeUnitValue,visualVariableRotation:s.visualVariableRotation},optionalAttributes:{zoomRange:!1}}),m=Ft(r),g=6*e.width,R=g,U=r.color?.toArray()??e.color?.toArray()??[0,0,0,0],K="cross"===r.style||"x"===r.style;let H;switch(r.placement){case"begin-end":H=pe.Tx.Both;break;case"begin":H=pe.Tx.JustBegin;break;case"end":H=pe.Tx.JustEnd;break;default:H=pe.Tx.None}const q={type:"cim-marker-placement-param",placement:{type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:H,offsetAlongLine:0},overrides:[]};return[u.createMeshInfo({type:"simple",color:U,height:R,width:g,offsetX:0,offsetY:0,angle:0,alignment:(0,Ie.A)(s)?pe.v2.MAP:pe.v2.SCREEN,outlineColor:U,outlineSize:K?e.width:0,referenceSize:R/6,sprite:m,overrideOutlineColor:K&&null!=s.visualVariableColor,hasSizeVV:(0,Ie.h)(s),placement:q,transforms:null,effects:null,scaleInfo:null,minPixelBuffer:(0,se.XS)(s)})]}(r.marker,r,e)),R}function Ne(r,e,t){return ot.apply(this,arguments)}function ot(){return ot=(0,c.Z)(function*(r,e,t){const s=e.labelsVisible&&e.labelingInfo||[],a=me(e),o=(0,ar.a)(s,a);return{type:"label",classes:yield Promise.all(o.map((u,m)=>function Er(r,e,t,s){return lt.apply(this,arguments)}(r,u,m,t)))}}),ot.apply(this,arguments)}function lt(){return(lt=(0,c.Z)(function*(r,e,t,s){const a=yield ge(e,{path:`${t}`,schemaOptions:r,uniforms:s});return{maxScale:e.maxScale,minScale:e.minScale,expression:e.labelExpressionInfo?.expression??e.labelExpression,where:e.where,meshes:a}})).apply(this,arguments)}function We(r,e){return ut.apply(this,arguments)}function ut(){return ut=(0,c.Z)(function*(r,e){if(!e)return{type:"simple",meshes:[]};switch(e.type){case"simple":return function Ir(r,e){return dt.apply(this,arguments)}(r,e);case"dot-density":return function wr(r,e){return pt.apply(this,arguments)}(r,e);case"class-breaks":return function Rr(r,e){return ht.apply(this,arguments)}(r,e);case"unique-value":return function Vr(r,e){return ft.apply(this,arguments)}(r,e);case"dictionary":return function Cr(r){const e=(0,se.Sc)(r),t=r.scaleExpression;return{type:"dictionary",fieldMap:r.fieldMap,scaleExpression:null!=t&&"1"!==t?{valueExpressionInfo:{type:"CIMExpressionInfo",expression:r.scaleExpression,returnType:"Numeric"},defaultValue:1}:void 0,visualVariableUniforms:e}}(e);case"heatmap":return function Fr(r,e){return yt.apply(this,arguments)}(r,e);case"pie-chart":return function Pr(r,e){return mt.apply(this,arguments)}(r,e)}}),ut.apply(this,arguments)}function dt(){return(dt=(0,c.Z)(function*(r,e){const t=e.getSymbols(),s=t.length?t[0]:null,a=(0,se.Sc)(e);return{type:"simple",meshes:yield ge(s,{schemaOptions:r,uniforms:a,path:"renderer.symbol"})}})).apply(this,arguments)}function pt(){return(pt=(0,c.Z)(function*(r,e){const t=(0,se.Sc)(e);return{type:"dot-density",meshes:yield hr(e,{schemaOptions:r,uniforms:t,path:"renderer.symbol"})}})).apply(this,arguments)}function ht(){return ht=(0,c.Z)(function*(r,e){const t=(0,se.Sc)(e),s=e.backgroundFillSymbol,a=e.normalizationType,o="log"===a?"esriNormalizeByLog":"percent-of-total"===a?"esriNormalizeByPercentOfTotal":"field"===a?"esriNormalizeByField":null,u=e.classBreakInfos.map(function(){var R=(0,c.Z)(function*(U){return{meshes:yield ge(U.symbol,{path:`renderer-stop-${U.minValue}-${U.maxValue}`,schemaOptions:r,uniforms:t}),min:U.minValue,max:U.maxValue}});return function(U){return R.apply(this,arguments)}}()),m=(yield Promise.all(u)).sort((R,U)=>R.min-U.min),E=yield ge(s,{schemaOptions:r,path:"renderer.backgroundFill",uniforms:{...se.Jh,visualVariableSizeOutlineScaleStops:t.visualVariableSizeOutlineScaleStops}}),g=yield ge(e.defaultSymbol,{schemaOptions:r,path:"renderer.defaultSymbol",uniforms:t});return{type:"interval",field:e.field,expression:e.valueExpression,backgroundFill:E,defaultSymbol:g,intervals:m,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,normalizationType:o,isMaxInclusive:e.isMaxInclusive}}),ht.apply(this,arguments)}function ft(){return(ft=(0,c.Z)(function*(r,e){const t=[],s=(0,se.Sc)(e),a=yield ge(e.backgroundFillSymbol,{schemaOptions:r,path:"renderer.backgroundFill",uniforms:{...se.Jh,visualVariableSizeOutlineScaleStops:s.visualVariableSizeOutlineScaleStops}}),o=yield ge(e.defaultSymbol,{schemaOptions:r,path:"renderer.defaultSymbol",uniforms:s});for(const u of e.uniqueValueInfos??[]){const m=yield ge(u.symbol,{path:`renderer-unique-value-${u.value}`,schemaOptions:r,uniforms:s});t.push({value:""+u.value,symbol:m})}return{type:"map",field:e.field,expression:e.valueExpression,field2:e.field2,field3:e.field3,fieldDelimiter:e.fieldDelimiter,backgroundFill:a,defaultSymbol:o,map:t}})).apply(this,arguments)}function yt(){return(yt=(0,c.Z)(function*(r,e){return{type:"heatmap",meshes:yield fr(e,r)}})).apply(this,arguments)}function mt(){return(mt=(0,c.Z)(function*(r,e){return{type:"pie-chart",meshes:yr(e,r)}})).apply(this,arguments)}var He=l(89170);function gt(){return(gt=(0,c.Z)(function*(r,e){const t=e.renderer,s=(0,se.Sc)(t);return{symbology:yield We(r,t),labels:yield Ne(r,e,s)}})).apply(this,arguments)}function Fe(r,e,t,s){return bt.apply(this,arguments)}function bt(){return bt=(0,c.Z)(function*(r,e,t,s){const a=t.featureReduction;if(a)switch(a.type){case"binning":return function Tr(r,e,t,s,a){return vt.apply(this,arguments)}(a,r,e,t,s);case"cluster":return function Ar(r,e,t,s,a){return St.apply(this,arguments)}(a,r,e,t,s)}const o=function Lr(r,e,t){const s=null!=e&&"unique-value"===e.type&&e.orderByClassesEnabled;if("default"!==r||s||(r=[new nr.Z({field:t,order:"descending"})]),"default"!==r&&r.length){const a=r[0],o="ascending"===a.order?"asc":"desc";return a.field?{field:a.field,order:o}:a.valueExpression?{expression:a.valueExpression,order:o}:null}return s?{byRenderer:!0,order:"asc"}:null}(t.orderBy,t.renderer,t.objectIdField),u=(0,He.$F)(t.renderer,e.filters),m=yield function Mr(r,e){return gt.apply(this,arguments)}(r,t);return{storage:u,mesh:{properties:{sortKey:o,timeZone:e.timeZone,returnMeshObjectId:!1,displayRefreshVersion:s},strategy:{type:"feature"},factory:m}}}),bt.apply(this,arguments)}function Mt(r,e){return r.fields.map(t=>({...t.toJSON(),type:Or(t,e)}))}function Or(r,e){const{onStatisticExpression:t,onStatisticField:s,statisticType:a}=r;switch(a){case"min":case"max":case"avg":case"avg_angle":case"sum":case"count":return"esriFieldTypeDouble";case"mode":{if(t){const{returnType:u}=t;return u?"string"===u?"esriFieldTypeString":"esriFieldTypeDouble":"esriFieldTypeString"}const o=e.find(u=>u.name===s);return o?o.type:"esriFieldTypeString"}}}function vt(){return(vt=(0,c.Z)(function*(r,e,t,s,a){const o=Mt(r,s.fields),u=r.renderer,m=yield We(e,u),E=(0,He.$F)(u,[null,null]),g=(0,se.Sc)(u),R=yield Ne(e,{geometryType:"polygon",labelingInfo:r.labelingInfo,labelsVisible:r.labelsVisible},g),K="geohash"===r.binType?{type:"geohash",fixBinLevel:r.fixedBinLevel??3}:{type:"grid",size:(0,Me.F2)(r.size),fixedBinLevel:r.fixedBinLevel};return{storage:E,mesh:{properties:{sortKey:null,timeZone:t.timeZone,returnMeshObjectId:!1,displayRefreshVersion:a},strategy:{type:"binning",fields:o,index:K,featureFilter:t.filters[0]},factory:{labels:R,symbology:m}}}})).apply(this,arguments)}function St(){return(St=(0,c.Z)(function*(r,e,t,s,a){const o=Mt(r,s.fields),u={type:"cluster",feature:yield We(e,r.effectiveFeatureRenderer),cluster:yield We(e,r.effectiveClusterRenderer)},m=(0,se.Sc)(r.effectiveFeatureRenderer),E={type:"cluster",feature:yield Ne(e,s,m),cluster:yield Ne(e,{geometryType:"point",labelingInfo:r.labelingInfo,labelsVisible:r.labelsVisible},m)};return{storage:(0,He.$F)(r.effectiveFeatureRenderer,[null,null]),mesh:{properties:{sortKey:null,timeZone:t.timeZone,displayRefreshVersion:a,returnMeshObjectId:!1},strategy:{type:"cluster",fields:o,featureFilter:t.filters[0],clusterRadius:(0,Me.F2)(r.clusterRadius/2)},factory:{labels:E,symbology:u}}}})).apply(this,arguments)}var Pe=l(29024);class Dr{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,s=xe(t);return[{vvEvaluators:{0:Ve(t.renderer)},deconflictionEnabled:s}]}createServiceOptions(e){var t=this;return(0,c.Z)(function*(){const s=t.layer,{capabilities:a,editingInfo:o,objectIdField:u,globalIdField:m,datesInUnknownTimezone:E,orderBy:g,parsedUrl:R}=s,U=s.fieldsIndex.toJSON(),K=me(s),H=s.timeInfo?.toJSON(),q=s.spatialReference.toJSON(),le=(0,je.d9)(R);let ne=u;if(g?.length){const be=!g[0].valueExpression&&g[0].field;be&&(ne=be)}return{type:"feature-service",source:le,isSourceHosted:(0,Je.M8)(le.path),orderByFields:ne,outSpatialReference:e.spatialReference.toJSON(),metadata:{timeReferenceUnknownClient:E,globalIdField:m,fieldsIndex:U,geometryType:K,objectIdField:u,timeInfo:H,spatialReference:q,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:a.query.maxRecordCount,supportsCompactGeometry:a.query.supportsCompactGeometry,supportsDefaultSpatialReference:a.query.supportsDefaultSpatialReference,supportsFormatPBF:a.query.supportsFormatPBF,supportsMaxRecordCountFactor:a.query.supportsMaxRecordCountFactor,supportsQuantization:a.query.supportsQuantization,lastEditDate:o?.lastEditDate?.getTime(),snapshotInfo:null}}})()}createSourceSchema(e,t){const{definitionExpression:s,customParameters:a,timeExtent:o,apiKey:u}=this.layer;return Ce({definitionExpression:s,customParameters:a,timeExtent:o},e,t,u)}createProcessorSchema(e,t,s){const{fields:a,geometryType:o,orderBy:u,objectIdField:m,renderer:E,labelingInfo:g,labelsVisible:R}=this.layer;return Fe(e,t,{featureReduction:null,fields:a.map(K=>K.toJSON()),geometryType:o,labelingInfo:g,labelsVisible:R,objectIdField:m,orderBy:u??"default",renderer:E?.clone()},s)}get hasRequiredSupport(){return(0,Pe.T)(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){const t=this.layer,{definitionExpression:s,apiKey:a,renderer:o}=t,u=this.layer.labelsVisible?this.layer.labelingInfo:null,m=JSON.stringify(t.customParameters),E=JSON.stringify(t.orderBy);return{outFields:this.layer.outFields,apiKey:a,customParameters:m,definitionExpression:s,labelingInfo:u,orderBy:E,renderer:o}}setGraphicOrigin(e){e.origin={type:"catalog",layer:this.layer}}}function _t(r,e){const t=r.extent,s=e?.clone().intersection(t),o=e?e.width*e.height:0,u=0===o?0:(null!=s?s.width*s.height:0)/o,m=(0,P.Z)("featurelayer-snapshot-point-coverage");return!isNaN(u)&&u>=m}function Ae(r,e){return null!=r.floorInfo&&(r.floorInfo.viewAllLevelIds.length>0||e.floors.length>0)}function xt(r,e,t){const s=function Ur(r,e,t){if(null==r.floorInfo||!t.floors?.length)return e;let s=t.floors;const{floorField:a,viewAllLevelIds:o}=r.floorInfo;o.length&&(s=o);const u=s.filter(E=>""!==E).map(E=>"'"+E+"'");if(u.push("''"),e?.includes(a)){let E=new RegExp("AND \\("+a+".*NULL\\)","g");e=e.replace(E,""),E=new RegExp("\\("+a+".*NULL\\)","g"),e=(e=e.replace(E,"")).replaceAll(/\s+/g," ").trim()}let m="("+a+" IN ({ids}) OR "+a+" IS NULL)";return m=m.replace("{ids}",u.join(", ")),(0,et._)(e,m)}(r,e?.where,t);return s&&(e??=new z.Z,e.where=s),e}class zr{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,s=Oe(t,e)??xe(t);return[{vvEvaluators:{0:Ve(t.renderer)},deconflictionEnabled:s}]}createServiceOptions(e){var t=this;return(0,c.Z)(function*(){const s=t.layer,{capabilities:a,editingInfo:o,objectIdField:u,typeIdField:m,globalIdField:E,datesInUnknownTimezone:g,orderBy:R,subtypeField:U,refreshInterval:K}=s,H=s.fieldsIndex.toJSON(),q=H.fields,le=me(s),ne=s.timeInfo?.toJSON(),be=s.spatialReference.toJSON(),De=s.types?.map(Ue=>Ue.toJSON()),we=(0,je.d9)(t.layer.parsedUrl);t.layer.dynamicDataSource&&(we.query={layer:JSON.stringify({source:t.layer.dynamicDataSource})});let Ye=t.layer.objectIdField;if(R?.length){const Ue=!R[0].valueExpression&&R[0].field;Ue&&(Ye=Ue)}const di=null==o?.lastEditDate&&K>0,Dt=(0,P.Z)("featurelayer-snapshot-enabled")&&"point"===s.geometryType&&a?.query.supportsPagination&&!a?.operations.supportsEditing&&!di,pi=Dt&&_t(e,s.fullExtent);return{type:"feature-service",source:we,isSourceHosted:(0,Je.M8)(we.path),orderByFields:Ye,outSpatialReference:e.spatialReference.toJSON(),metadata:{typeIdField:m??void 0,types:De,timeReferenceUnknownClient:g,subtypeField:U,globalIdField:E,fields:q,fieldsIndex:H,geometryType:le,objectIdField:u,timeInfo:ne,spatialReference:be,subtypes:t.layer.subtypes?.map(Ue=>Ue.toJSON())},queryMetadata:{maxRecordCount:a.query.maxRecordCount,supportsCompactGeometry:a.query.supportsCompactGeometry,supportsDefaultSpatialReference:a.query.supportsDefaultSpatialReference,supportsFormatPBF:a.query.supportsFormatPBF,supportsMaxRecordCountFactor:a.query.supportsMaxRecordCountFactor,supportsQuantization:a.query.supportsQuantization,lastEditDate:o?.lastEditDate?.getTime(),snapshotInfo:{supportsSnapshotMinThreshold:Dt,supportsSnapshotMaxThreshold:pi,snapshotCountThresholds:{min:(0,P.Z)("featurelayer-snapshot-point-min-threshold"),max:(0,P.Z)("featurelayer-snapshot-point-max-threshold")}}}}})()}createSourceSchema(e,t){const{definitionExpression:s,customParameters:a,gdbVersion:o,historicMoment:u,subtypeCode:m,subtypeField:E,timeExtent:g,apiKey:R}=this.layer;return Ce({definitionExpression:s,customParameters:a,gdbVersion:o,historicMoment:u,subtypeCode:m,subtypeField:E,timeExtent:g},e,t,R)}createProcessorSchema(e,t,s){const{fields:a,renderer:o,geometryType:u,labelingInfo:m,labelsVisible:E,orderBy:g,objectIdField:R}=this.layer;return Fe(e,t,{fields:a.map(K=>K.toJSON()),renderer:o?.clone(),featureReduction:(0,ce.g)(this.layer,t),geometryType:u,labelingInfo:m,labelsVisible:E,objectIdField:R,orderBy:g??"default"},s)}get hasRequiredSupport(){return(0,Pe.T)(this.layer.renderer)}get timeOptions(){return this.layer}hasFilters(e){return Ae(this.layer,e)}addFilters(e,t){return xt(this.layer,e,t)}getUpdateHashProperties(e){const t=this.layer,{definitionExpression:s,renderer:a,gdbVersion:o,apiKey:u,subtypeCode:m}=t,E=this.layer.labelsVisible?this.layer.labelingInfo:null,g=t.historicMoment?.getTime()??void 0,R=JSON.stringify(t.customParameters),U=(0,ce.g)(t,e),K=JSON.stringify(t.orderBy),H=Ae(this.layer,e)?e.floors:null;return{outFields:this.layer.outFields,apiKey:u,customParameters:R,definitionExpression:s,featureReduction:U,floors:H,gdbVersion:o,historicMoment:g,labelingInfo:E,orderBy:K,renderer:a,subtypeCode:m}}}class Ot{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,s=Oe(t,e)??xe(t);return[{vvEvaluators:{0:Ve(t.renderer)},deconflictionEnabled:s}]}createServiceOptions(e){var t=this;return(0,c.Z)(function*(){const s=t.layer,{capabilities:a,objectIdField:o}=s,u=s.fieldsIndex.toJSON(),m=me(s),E=s.timeInfo?.toJSON(),g=s.spatialReference.toJSON();return function Zr(r){if(!("openPorts"in r))throw new _.Z("source-not-supported")}(s.source),{type:"memory",source:yield s.source.openPorts(),orderByFields:o,outSpatialReference:e.spatialReference.toJSON(),metadata:{fieldsIndex:u,geometryType:m,objectIdField:o,timeInfo:E,spatialReference:g,subtypes:null,subtypeField:null,globalIdField:null,typeIdField:null,types:null,timeReferenceUnknownClient:null},queryMetadata:{maxRecordCount:a.query.maxRecordCount,supportsCompactGeometry:a.query.supportsCompactGeometry,supportsDefaultSpatialReference:a.query.supportsDefaultSpatialReference,supportsFormatPBF:a.query.supportsFormatPBF,supportsMaxRecordCountFactor:a.query.supportsMaxRecordCountFactor,supportsQuantization:a.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}})()}createSourceSchema(e,t){const{definitionExpression:s,timeExtent:a}=this.layer;return Ce({definitionExpression:s,timeExtent:a,customParameters:null},e,t,null)}createProcessorSchema(e,t,s){const{fields:a,renderer:o,geometryType:u,labelingInfo:m,labelsVisible:E,orderBy:g,objectIdField:R}=this.layer;return Fe(e,t,{fields:a.map(K=>K.toJSON()),renderer:o?.clone(),featureReduction:(0,ce.g)(this.layer,t),geometryType:u,labelingInfo:m,labelsVisible:E,objectIdField:R,orderBy:g??"default"},s)}get hasRequiredSupport(){return(0,Pe.T)(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){const t=this.layer,{definitionExpression:s,renderer:a}=t,o=this.layer.labelsVisible?this.layer.labelingInfo:null,u=(0,ce.g)(t,e);return{orderBy:JSON.stringify(t.orderBy),definitionExpression:s,renderer:a,labelingInfo:o,featureReduction:u}}}class Br{constructor(e){this.layer=e,this.timeOptions=null}getLabelingDeconflictionInfo(e){const t=this.layer,s=Oe(t,e)??xe(t);return[{vvEvaluators:{0:Ve(t.renderer)},deconflictionEnabled:s}]}createServiceOptions(e){var t=this;return(0,c.Z)(function*(){const s=t.layer,{capabilities:a,objectIdField:o}=s,u=s.fieldsIndex.toJSON(),m=me(s),E=s.spatialReference.toJSON();return{type:"memory",source:yield s.source.openPorts(),orderByFields:o,outSpatialReference:e.spatialReference.toJSON(),metadata:{fieldsIndex:u,geometryType:m,objectIdField:o,spatialReference:E,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,timeReferenceUnknownClient:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:a.query.maxRecordCount,supportsCompactGeometry:a.query.supportsCompactGeometry,supportsDefaultSpatialReference:a.query.supportsDefaultSpatialReference,supportsFormatPBF:a.query.supportsFormatPBF,supportsMaxRecordCountFactor:a.query.supportsMaxRecordCountFactor,supportsQuantization:a.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}})()}createSourceSchema(e,t){const{definitionExpression:s}=this.layer;return Ce({definitionExpression:s,customParameters:null},e,t,null)}createProcessorSchema(e,t,s){const{fields:a,renderer:o,geometryType:u,labelingInfo:m,labelsVisible:E,objectIdField:g}=this.layer;return Fe(e,t,{fields:a.map(U=>U.toJSON()),renderer:o?.clone(),featureReduction:(0,ce.g)(this.layer,t),geometryType:u,labelingInfo:m,labelsVisible:E,objectIdField:g,orderBy:"default"},s)}get hasRequiredSupport(){return(0,Pe.T)(this.layer.renderer)}getUpdateHashProperties(e){const t=this.layer,{definitionExpression:s,renderer:a}=t;return{definitionExpression:s,renderer:a,labelingInfo:this.layer.labelsVisible?this.layer.labelingInfo:null,featureReduction:(0,ce.g)(t,e)}}}class jr{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,s=Oe(t,e)??xe(t);return[{vvEvaluators:{0:Ve(t.renderer)},deconflictionEnabled:s}]}createServiceOptions(e){var t=this;return(0,c.Z)(function*(){const s=t.layer,{capabilities:a,objectIdField:o}=s,u=s.fieldsIndex.toJSON(),m=me(s),E=s.timeInfo?.toJSON(),g=s.spatialReference.toJSON(),R=s.source.getSource(),U=t.layer.objectIdField,K=(0,je.d9)(a);return K.query.maxRecordCount=R.maxRecordCount,{type:"ogc",source:R,orderByFields:U,outSpatialReference:e.spatialReference.toJSON(),metadata:{fieldsIndex:u,geometryType:m,objectIdField:o,timeInfo:E,spatialReference:g,globalIdField:null,subtypeField:null,subtypes:null,timeReferenceUnknownClient:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:K.query.maxRecordCount,supportsCompactGeometry:K.query.supportsCompactGeometry,supportsDefaultSpatialReference:K.query.supportsDefaultSpatialReference,supportsFormatPBF:K.query.supportsFormatPBF,supportsMaxRecordCountFactor:K.query.supportsMaxRecordCountFactor,supportsQuantization:K.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}})()}createSourceSchema(e,t){const{customParameters:s,timeExtent:a,apiKey:o}=this.layer;return Ce({customParameters:s,timeExtent:a},e,t,o)}createProcessorSchema(e,t,s){const{fields:a,renderer:o,geometryType:u,labelingInfo:m,labelsVisible:E,orderBy:g,objectIdField:R}=this.layer;return Fe(e,t,{fields:a.map(K=>K.toJSON()),renderer:o?.clone(),featureReduction:(0,ce.g)(this.layer,t),geometryType:u,labelingInfo:m,labelsVisible:E,objectIdField:R,orderBy:g??"default"},s)}get hasRequiredSupport(){return(0,Pe.T)(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){const t=this.layer,{renderer:s,apiKey:a}=t,o=this.layer.labelsVisible?this.layer.labelingInfo:null;return{apiKey:a,customParameters:JSON.stringify(t.customParameters),featureReduction:(0,ce.g)(t,e),labelingInfo:o,orderBy:JSON.stringify(t.orderBy),renderer:s}}}class Nr{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,s=Oe(t,e)??xe(t);return[{vvEvaluators:{0:Ve(t.renderer)},deconflictionEnabled:s}]}createServiceOptions(e){var t=this;return(0,c.Z)(function*(){const s=t.layer,{capabilities:a,objectIdField:o,globalIdField:u,orderBy:m,refreshInterval:E}=s,g=s.fieldsIndex.toJSON(),R=g.fields,U=me(s),K=s.timeInfo?.toJSON(),H=s.spatialReference.toJSON(),q=(0,je.d9)(t.layer.parsedUrl);let le=t.layer.objectIdField;if(m?.length){const we=!m[0].valueExpression&&m[0].field;we&&(le=we)}const ne=E>0,be=(0,P.Z)("featurelayer-snapshot-enabled")&&"point"===s.geometryType&&a?.query.supportsPagination&&!a?.operations.supportsEditing&&!ne,De=be&&_t(e,s.fullExtent);return{type:"feature-service",source:q,isSourceHosted:(0,Je.M8)(q.path),orderByFields:le,outSpatialReference:e.spatialReference.toJSON(),metadata:{globalIdField:u,fields:R,fieldsIndex:g,geometryType:U,objectIdField:o,timeInfo:K,spatialReference:H,timeReferenceUnknownClient:!1,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:a.query.maxRecordCount,supportsCompactGeometry:a.query.supportsCompactGeometry,supportsDefaultSpatialReference:a.query.supportsDefaultSpatialReference,supportsFormatPBF:a.query.supportsFormatPBF,supportsMaxRecordCountFactor:a.query.supportsMaxRecordCountFactor,supportsQuantization:a.query.supportsQuantization,lastEditDate:null,snapshotInfo:{supportsSnapshotMinThreshold:be,supportsSnapshotMaxThreshold:De,snapshotCountThresholds:{min:(0,P.Z)("featurelayer-snapshot-point-min-threshold"),max:(0,P.Z)("featurelayer-snapshot-point-max-threshold")}}}}})()}createSourceSchema(e,t){const{definitionExpression:s,customParameters:a,timeExtent:o}=this.layer;return Ce({definitionExpression:s,customParameters:a,timeExtent:o},e,t,null)}createProcessorSchema(e,t,s){const{fields:a,renderer:o,geometryType:u,labelingInfo:m,labelsVisible:E,orderBy:g,objectIdField:R}=this.layer;return Fe(e,t,{fields:a.map(K=>K.toJSON()),renderer:o?.clone(),featureReduction:(0,ce.g)(this.layer,t),geometryType:u,labelingInfo:m,labelsVisible:E,objectIdField:R,orderBy:g??"default"},s)}get hasRequiredSupport(){return(0,Pe.T)(this.layer.renderer)}get timeOptions(){return this.layer}hasFilters(e){return Ae(this.layer,e)}addFilters(e,t){return xt(this.layer,e,t)}getUpdateHashProperties(e){const t=this.layer,{definitionExpression:s,renderer:a,outFields:o}=t,u=this.layer.labelsVisible?this.layer.labelingInfo:null,m=JSON.stringify(t.customParameters),E=(0,ce.g)(t,e);return{outFields:o,orderBy:JSON.stringify(t.orderBy),definitionExpression:s,renderer:a,labelingInfo:u,featureReduction:E,customParameters:m,floors:Ae(this.layer,e)?e.floors:null}}}class Wr{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,s=Oe(t,e)??xe(t);return[{vvEvaluators:{0:Ve(t.renderer)},deconflictionEnabled:s}]}createServiceOptions(e){var t=this;return(0,c.Z)(function*(){const s=t.layer,{objectIdField:a}=s,o=me(s),u=s.timeInfo?.toJSON()||null,m=s.spatialReference?s.spatialReference.toJSON():null;return{type:"stream",source:t.layer.parsedUrl,outSpatialReference:e.spatialReference.toJSON(),metadata:{fieldsIndex:t.layer.fieldsIndex.toJSON(),geometryType:o,objectIdField:a,timeInfo:u,timeReferenceUnknownClient:null,spatialReference:m,subtypeField:null,subtypes:null,globalIdField:null,typeIdField:null,types:null}}})()}createSourceSchema(e,t){const{definitionExpression:s,geometryDefinition:a,customParameters:o}=this.layer;return{type:"stream",mutable:{sourceRefreshVersion:t,availableFields:e.availableFields,dataFilter:{geometryDefinition:a?.toJSON(),definitionExpression:s,customParameters:o??null,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,purgeOptions:this.layer.purgeOptions.toJSON()}}}}createProcessorSchema(e,t,s){const{fields:a,renderer:o,geometryType:u,labelingInfo:m,labelsVisible:E,objectIdField:g}=this.layer;return Fe(e,t,{fields:a.map(U=>U.toJSON()),renderer:o?.clone(),featureReduction:(0,ce.g)(this.layer,t),geometryType:u,labelingInfo:m,labelsVisible:E,objectIdField:g,orderBy:"default"},s)}get hasRequiredSupport(){return(0,Pe.T)(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){const t=this.layer,{definitionExpression:s,renderer:a}=t,o=this.layer.labelsVisible?this.layer.labelingInfo:null,u=JSON.stringify(t.customParameters);return{definitionExpression:s,renderer:a,labelingInfo:o,featureReduction:(0,ce.g)(t,e),customParameters:u,geometryDefinition:t.geometryDefinition,definitionExpressoin:t.definitionExpression}}}var Kr=l(19903);function Jr(r,e){return Et.apply(this,arguments)}function Et(){return(Et=(0,c.Z)(function*(r,{subtypeField:e,sublayers:t}){const s=yield Promise.all(t.map(({renderer:a})=>We(r,a)));return{type:"subtype",subtypeField:e,renderers:t.reduce((a,{subtypeCode:o},u)=>({...a,[o]:s[u]}),{})}})).apply(this,arguments)}function Gr(r,e){const t=(0,Kr.h)();return{type:"subtype",filters:r.filters,capabilities:{maxTextureSize:t.maxTextureSize},subtypeField:e.subtypeField,target:"feature",bindings:e.sublayers.reduce((s,{renderer:a,subtypeCode:o})=>({...s,[o]:(0,He.vZ)(a)}),{})}}function $r(r,e){return It.apply(this,arguments)}function It(){return(It=(0,c.Z)(function*(r,{subtypeField:e,sublayers:t}){const s=yield Promise.all(t.map(a=>{const o=(0,se.Sc)(a.renderer),u={...a,geometryType:a.geometryType??null};return Ne(r,u,o)}));return{type:"subtype",subtypeField:e,renderers:t.reduce((a,{subtypeCode:o},u)=>({...a,[o]:s[u]}),{})}})).apply(this,arguments)}function wt(){return(wt=(0,c.Z)(function*(r,e,t,s){return{storage:Gr(e,t),mesh:{properties:{timeZone:e.timeZone,displayRefreshVersion:s,returnMeshObjectId:!1,sortKey:null},strategy:{type:"feature"},factory:{symbology:yield Jr(r,t),labels:yield $r(r,t)}}}})).apply(this,arguments)}class Qr{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){return[{vvEvaluators:{},deconflictionEnabled:this.layer.sublayers.every(t=>xe(t))}]}createServiceOptions(e){var t=this;return(0,c.Z)(function*(){const s=t.layer,{capabilities:a,datesInUnknownTimezone:o,editingInfo:u,globalIdField:m,objectIdField:E,refreshInterval:g,subtypeField:R}=s,U=s.fieldsIndex.toJSON(),K=me(s),H=s.timeInfo?.toJSON(),q=s.spatialReference.toJSON(),le=(0,je.d9)(t.layer.parsedUrl),ne=E,be=null==u?.lastEditDate&&g>0,De=(0,P.Z)("featurelayer-snapshot-enabled")&&"point"===s.geometryType&&a?.query.supportsPagination&&!a?.operations.supportsEditing&&!be,we=De&&_t(e,s.fullExtent);return{type:"feature-service",source:le,isSourceHosted:(0,Je.M8)(le.path),orderByFields:ne,outSpatialReference:e.spatialReference.toJSON(),metadata:{timeReferenceUnknownClient:o,subtypeField:R,globalIdField:m,fieldsIndex:U,geometryType:K,objectIdField:E,timeInfo:H,spatialReference:q,subtypes:t.layer.subtypes?.map(Ye=>Ye.toJSON()),typeIdField:null,types:null},queryMetadata:{maxRecordCount:a.query.maxRecordCount,supportsCompactGeometry:a.query.supportsCompactGeometry,supportsDefaultSpatialReference:a.query.supportsDefaultSpatialReference,supportsFormatPBF:a.query.supportsFormatPBF,supportsMaxRecordCountFactor:a.query.supportsMaxRecordCountFactor,supportsQuantization:a.query.supportsQuantization,lastEditDate:u?.lastEditDate?.getTime(),snapshotInfo:{supportsSnapshotMinThreshold:De,supportsSnapshotMaxThreshold:we,snapshotCountThresholds:{min:(0,P.Z)("featurelayer-snapshot-point-min-threshold"),max:(0,P.Z)("featurelayer-snapshot-point-max-threshold")}}}}})()}createSourceSchema(e,t){const{definitionExpression:s,customParameters:a,gdbVersion:o,historicMoment:u,subtypeField:m,timeExtent:E,apiKey:g}=this.layer;return Ce({queryScaleRanges:this.layer.sublayers.items.map(U=>({subtypeCode:U.subtypeCode,minScale:U.minScale,maxScale:U.maxScale})),definitionExpression:s,customParameters:a,gdbVersion:o,historicMoment:u,subtypeField:m,timeExtent:E},e,t,g)}createProcessorSchema(e,t,s){return function kr(r,e,t,s){return wt.apply(this,arguments)}(e,t,{subtypeField:this.layer.subtypeField,sublayers:Array.from(this.layer.sublayers,o=>({featureReduction:null,geometryType:this.layer.geometryType,labelingInfo:o.labelingInfo,labelsVisible:o.labelsVisible,renderer:o.renderer,subtypeCode:o.subtypeCode,orderBy:null}))},s)}hasFilters(e){return Ae(this.layer,e)||function Hr(r,e){return r.sublayers.some(t=>!Tt(t,e))}(this.layer,e)}addFilters(e,t){e=xt(this.layer,e,t);const s=this.layer.sublayers.filter(o=>!Tt(o,t)).map(o=>o.subtypeCode);if(!s.length)return e;e??=new z.Z;const a=`NOT ${this.layer.subtypeField} IN (${s.join(",")})`;return e.where=(0,et._)(e.where,a),e}get hasRequiredSupport(){return!0}get timeOptions(){return this.layer}getUpdateHashProperties(e){const t=this.layer,{definitionExpression:s,gdbVersion:a,apiKey:o}=t,u=t.historicMoment?.getTime()??void 0,m=JSON.stringify(t.customParameters),E=Ae(this.layer,e)?e.floors:null,g=this.layer.sublayers.map(({renderer:R,labelsVisible:U,labelingInfo:K,visible:H})=>({renderer:R,labelsVisible:U,labelingInfo:K,visible:H}));return{outFields:this.layer.outFields,gdbVersion:a,definitionExpression:s,historicMoment:u,customParameters:m,apiKey:o,sublayers:g,floors:E}}setGraphicOrigin(e){const t=this.layer.fieldsIndex.get(this.layer.subtypeField),s=e.attributes[t.name],a=this.layer.sublayers.find(o=>o.subtypeCode===s);e.layer=e.sourceLayer=a}}function Tt(r,e){return r.visible&&(0===r.minScale||(0,Ge.W8)(e.scale,r.minScale)||e.scale<r.minScale)&&(0===r.maxScale||(0,Ge.W8)(e.scale,r.maxScale)||e.scale>r.maxScale)}var Xr=l(60320),ae=l(9395),Yr=l(23640);function Le(r,e){const t=new Set;for(const s of r instanceof Set?r.values():r.keys())e.has(s)||t.add(s);return t}class qr{constructor(e,t,s){const a=s?e.getTileCoverage(s,0,!0,"closest"):null,o=e.getTileCoverage(t,0,!0,"closest");if(this._tileKeys=new Map,a)for(const u of a.keys())this._tileKeys.set(u.id,u);if(o)for(const u of o.keys())this._tileKeys.set(u.id,u)}get coverageSet(){return new Set(this._tileKeys.keys())}keys(){return this._tileKeys.values()}}class ei{constructor(e){this.version=e}}class ti{constructor(e){this._subscriptions=new Map,this._visible=new Set,this._paused=new Set,this._version=0,this._config=e}destroy(){}get _coverageSet(){return this._coverage?.coverageSet??new Set}suspend(){this._suspendedOverage=this._coverage,this._coverage=null,this._updateSubscriptions()}resume(){null==this._coverage&&(this._coverage=this._suspendedOverage,this._suspendedOverage=null,this._updateSubscriptions())}update(e,t){return this._version=(this._version+1)%Number.MAX_SAFE_INTEGER,this._updateCoverage(e,t),this._updateSubscriptions(),new Set(this._visible)}_updateCoverage(e,t){this._coverage=new qr(this._config.tileInfoView,e,t)}_updateSubscriptions(){const e=this._coverageSet,t=this._updateVisibility(),s=Le(t,e),a=Le(this._subscriptions,t),o=Le(e,this._subscriptions),u=Le(a,e),m=Le(s,u),E=Le(m,this._paused);this._visible=t;for(const g of o.values())this._subscriptions.set(g,new ei(this._version));for(const g of E.values())this._paused.add(g);for(const g of u.values())this._subscriptions.delete(g),this._paused.delete(g);(o.size||u.size||E.size)&&this._sendUpdateSubscriptions(o,u,E)}_sendUpdateSubscriptions(e,t,s){const a=Array.from(e.values()).map(o=>({tileId:o,version:this._subscriptions.get(o).version}));this._config.updateSubscriptions({subscribe:a,unsubscribe:Array.from(t.values()),pause:Array.from(s.values())})}_updateVisibility(){const e=new Set,t=new Set;if(!this._coverage)return e;for(const o of this._coverage.keys())this._config.isDone(o)?e.add(o.id):this._addVisibleParent(e,t,o)||this._addVisibleChildren(e,o)||e.add(o.id);const s=new Be.Z(0,0,0,0),a=new Be.Z(0,0,0,0);for(const o of t){s.id=o;for(const u of e)a.id=u,s.containsChild(a)&&e.delete(u)}return e}_addVisibleParent(e,t,s){let a=!1;for(const o of this._visible.values())new Be.Z(o).containsChild(s)&&(e.add(o),t.add(o),a=!0);return a}_addVisibleChildren(e,t){let s=!1;for(const a of this._visible.values()){const o=new Be.Z(a);t.containsChild(o)&&(e.add(a),s=!0)}return s}}var ri=l(27173),At=l(1865),ii=l(4978),Xe=l(96696);const si=r=>{let e=class extends r{constructor(...t){super(...t),this._updatingRequiredFieldsPromise=null,this.dataUpdating=!1,this.filter=null,this.layer=null,this.requiredFields=[],this.view=null}initialize(){this.addHandles([(0,p.YP)(()=>{const t=this.layer;return[t&&"elevationInfo"in t?t.elevationInfo?.featureExpressionInfo:null,t&&"displayField"in t?t.displayField:null,t&&"timeInfo"in t&&t.timeInfo,t&&"renderer"in t&&t.renderer,t&&"labelingInfo"in t&&t.labelingInfo,t&&"floorInfo"in t&&t.floorInfo,this.filter,this.featureEffect,this.timeExtent]},()=>this._handleRequiredFieldsChange(),p.tX),(0,p.on)(()=>this.view?.floors,"change",()=>this._handleRequiredFieldsChange()),(0,p.on)(()=>{const t=this.layer;return t&&"sublayers"in t?t.sublayers:null},"change",()=>this._handleRequiredFieldsChange())])}get availableFields(){if(!this.layer)return[];const{layer:t,layer:{fieldsIndex:s},requiredFields:a}=this;return(0,j.Q0)(s,"outFields"in t&&t.outFields?[...(0,j.Lk)(s,t.outFields),...a]:a)}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(t){this._override("featureEffect",t)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(t){L.Z.getLogger(this).error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(t){throw new Error("missing implementation")}createQuery(){const t={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},s=null!=this.filter?this.filter.createQuery(t):new Y.Z(t);if("floorInfo"in this.layer&&this.layer.floorInfo){const a=(0,At.c)(this);null!=a&&(s.where=s.where?`(${s.where}) AND (${a})`:a)}return null!=this.timeExtent&&(s.timeExtent=null!=s.timeExtent?s.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),s}createAggregateQuery(){return new Y.Z({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})}queryFeatures(t,s){throw new Error("missing implementation")}queryObjectIds(t,s){throw new Error("missing implementation")}queryFeatureCount(t,s){throw new Error("missing implementation")}queryExtent(t,s){throw new Error("missing implementation")}fetchPopupFeaturesFromGraphics(t,s){var a=this;return(0,c.Z)(function*(){return a._validateFetchPopupFeatures(t,s),a._fetchPopupFeatures(t,s)})()}_loadArcadeModules(t){return t.expressionInfos?.length||Array.isArray(t.content)&&t.content.some(s=>"expression"===s.type)?(0,ii.LC)():Promise.resolve()}_handleRequiredFieldsChange(){const t=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",t),t.then(()=>{this._updatingRequiredFieldsPromise===t&&this._set("_updatingRequiredFieldsPromise",null)})}_updateRequiredFields(){var t=this;return(0,c.Z)(function*(){if(!t.layer||!t.view)return;const s="3d"===t.view.type,{layer:a,layer:{fieldsIndex:o,objectIdField:u}}=t,m="renderer"in a&&a.renderer,E="orderBy"in a&&a.orderBy,g="featureReduction"in a?a.featureReduction:null,R=new Set,U=yield Promise.allSettled([m?m.collectRequiredFields(R,o):null,(0,j.Mu)(R,a),s&&"elevationInfo"in a?(0,j.vl)(R,a):null,null!=t.filter?(0,j.Ll)(R,a,t.filter):null,s||null==t.featureEffect?null:(0,j.Ll)(R,a,t.featureEffect.filter),!s&&g?(0,j.ZV)(R,a,g):null,!s&&E?(0,j.Qj)(R,a,E):null]);if("timeInfo"in a&&a.timeInfo&&t.timeExtent&&(0,j.gd)(R,a.fieldsIndex,[a.timeInfo.startField,a.timeInfo.endField]),"floorInfo"in a&&a.floorInfo&&(0,j.gd)(R,a.fieldsIndex,[a.floorInfo.floorField]),"feature"===a.type&&s&&null!=a.infoFor3D&&(null==a.globalIdField&&L.Z.getLogger(t).error("globalIdField missing on 3DObjectFeatureLayer"),(0,j.gd)(R,a.fieldsIndex,[a.globalIdField])),"subtype-group"===a.type){(0,j.AB)(R,o,a.subtypeField);const H=a.sublayers.map(q=>Promise.all([q.renderer?.collectRequiredFields(R,o),(0,j.Mu)(R,q)]));yield Promise.allSettled(H)}if("catalog-footprint"===a.type&&a.parent){const H=a.parent;(0,j.gd)(R,o,[H.itemNameField,H.itemSourceField,H.itemTypeField,H.maxScaleField,H.minScaleField])}for(const H of U)"rejected"===H.status&&L.Z.getLogger(t).error(H.reason);(0,j.AB)(R,o,u),s&&"displayField"in a&&a.displayField&&(0,j.AB)(R,o,a.displayField);const K=Array.from(R).sort();t._set("requiredFields",K)})()}_validateFetchPopupFeatures(t,s){if(null!=s)for(const a of t){const o=a.origin&&"layer"in a.origin?a.origin.layer:a.layer;if("popupEnabled"in o&&!o.popupEnabled)throw new _.Z("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:o});if(a.isAggregate){const u="featureReduction"in o?o.featureReduction:null;if(!(u&&"popupTemplate"in u&&u.popupEnabled&&u.popupTemplate))throw new _.Z("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:o})}else if("popupTemplate"in o&&!(0,Xe.V5)(o,s))throw new _.Z("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:o})}}_popupFeatureHasRequiredFields(t,s){return(0,j.R9)(s,t)}_fetchPopupFeatures(t,s){var a=this;return(0,c.Z)(function*(){const o=new Array(t.length),u=new Map,m=yield a._createPopupQuery(t.map(E=>E.origin?.layer??E.layer),s);for(let E=0;E<t.length;E++){const g=t[E];if(g.isAggregate){o[E]=g;continue}const R=g.origin?.layer??g.layer;if(!R||!("popupEnabled"in R))continue;const U=(0,j.Lk)(a.layer.fieldsIndex,m.outFields),K=(0,Xe.V5)(R,s);if(null==K)continue;const H=yield a._loadArcadeModules(K);(0,y.k_)(s),H&&H.arcadeUtils.hasGeometryOperations(K)||!a._popupFeatureHasRequiredFields(g,U)?u.set(g.getObjectId(),{graphic:g,index:E}):o[E]=g}if("stream"===a.layer.type||0===u.size)return o.filter(Boolean);m.objectIds=Array.from(u.keys());try{const E=yield a.layer.queryFeatures(m,s);for(const g of E.features){const{graphic:{geometry:R,origin:U},index:K}=u.get(g.getObjectId());g.geometry||=R,g.origin=U,o[K]=g}}catch{}return o.filter(Boolean)})()}_createPopupQuery(t,s){var a=this;return(0,c.Z)(function*(){const o=a.layer.createQuery(),u=new Set;let m=!1;const E=t??[a.layer];for(const g of E){if(!("popupEnabled"in g))continue;const R=(0,Xe.V5)(g,s);if(null==R)continue;const U=yield a._loadArcadeModules(R);(0,y.k_)(s);const K=U&&U.arcadeUtils.hasGeometryOperations(R);m=!("point"!==a.layer.geometryType&&!K);const H=yield(0,Xe.e7)(a.layer,R);(0,y.k_)(s);for(const q of H)u.add(q)}if(o.returnGeometry=m,o.returnZ=m,o.returnM=m,o.outFields=Array.from(u),o.outSpatialReference=a.view.spatialReference,"floorInfo"in a.layer&&a.layer.floorInfo){const g=(0,At.c)(a);null!=g&&(o.where=o.where?`(${o.where}) AND (${g})`:g)}return o})()}canResume(){return!(!super.canResume()||null!=this.timeExtent&&this.timeExtent.isEmpty)}getTest(){}get test(){}};return(0,S._)([(0,h.Cb)()],e.prototype,"_updatingRequiredFieldsPromise",void 0),(0,S._)([(0,h.Cb)({readOnly:!0})],e.prototype,"availableFields",null),(0,S._)([(0,h.Cb)({readOnly:!0})],e.prototype,"dataUpdating",void 0),(0,S._)([(0,h.Cb)({type:ri.Z})],e.prototype,"featureEffect",null),(0,S._)([(0,h.Cb)({type:z.Z})],e.prototype,"filter",void 0),(0,S._)([(0,h.Cb)()],e.prototype,"layer",void 0),(0,S._)([(0,h.Cb)({type:Number})],e.prototype,"maximumNumberOfFeatures",null),(0,S._)([(0,h.Cb)({readOnly:!0,type:Boolean})],e.prototype,"maximumNumberOfFeaturesExceeded",null),(0,S._)([(0,h.Cb)({readOnly:!0})],e.prototype,"requiredFields",void 0),(0,S._)([(0,h.Cb)()],e.prototype,"suspended",void 0),(0,S._)([(0,h.Cb)()],e.prototype,"view",void 0),e=(0,S._)([(0,A.j)("esri.views.layers.FeatureLayerView")],e),e};var ni=l(50145),ai=l(32126),oi=l(26894);const Lt=4294967294;let ue=class extends(si((0,ai.Z)((0,he.y)(ni.Z)))){constructor(){super(...arguments),this._commandsQueue=new Xr.Z({process:r=>{switch(r.type){case"edit-by-feature":case"edit-by-id":return this._doEdit(r);case"update":return this._doUpdate();case"highlight":return this._updateHighlights()}}}),this._visibilityOverrides=new Set,this._highlightCounter=new Yr.i,this._lastAvailableFields=[],this._lastTargetState=null,this.eventLog=new ye,this._sourceRefreshVersion=1,this._displayRefreshVersion=1,this._pipelineUpdating=!1,this._fields=null,this.featureEffectView=new T}destroy(){this._workerProxy?.destroy(),this._workerAttached.reject((0,y.zE)()),this._commandsQueue.destroy()}initialize(){this._workerAttached=(0,y.hh)(),(0,y.R8)(this._workerAttached.promise),this.addResolvingPromise(this._initProxy()),this.featureEffectView.featureEffect=this.featureEffect,this.featureEffectView.endTransitions()}_initProxy(){var r=this;return(0,c.Z)(function*(){const e=r.layer;if("isTable"in e&&e.isTable)throw new _.Z("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:e});if("mesh"===e.geometryType)throw new _.Z("featurelayerview:geometry-type-not-supported",`Geometry type of ${e.geometryType} is not supported`,{layer:e});if(("feature"===e.type||"subtype-group"===e.type)&&!1===(0,B.S1)(e)?.operations.supportsQuery)throw new _.Z("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:e});r._workerProxy&&r._workerProxy.destroy();const t=r._createClientOptions();r._workerProxy=yield function Kt(r){return qe.apply(this,arguments)}(t)})()}_attachProxy(){var r=this;return(0,c.Z)(function*(){const e={service:yield r.layerAdapter.createServiceOptions(r.view),tileInfoJSON:r.view.featuresTilingScheme.tileInfo.toJSON()};let t=[];Array.isArray(e.service.source)&&(t=e.service.source);try{yield r._workerProxy.pipeline.onAttach(e,{transferList:t}),r._workerAttached.resolve()}catch(s){r._workerAttached.reject((0,y.zE)()),(0,y.H9)(s)}})()}_detachProxy(){var r=this;return(0,c.Z)(function*(){return r._workerProxy.pipeline.onDetach()})()}getWorker(){var r=this;return(0,c.Z)(function*(){return yield r._workerAttached.promise,r._workerProxy})()}get hasAllFeatures(){return this.layer.visible&&this.eventLog.hasAllFeatures}get hasAllFeaturesInView(){return this.layer.visible&&this.eventLog.hasAllFeaturesInView}get hasFullGeometries(){return this.layer.visible&&this.eventLog.hasFullGeometries}get labelingCollisionInfos(){const r=this.layerAdapter.getLabelingDeconflictionInfo(this.view),e=this.layer.geometryType,t=!this.suspended;return r.map(({vvEvaluators:s,deconflictionEnabled:a})=>({container:this.featureContainer,vvEvaluators:s,deconflictionEnabled:a,geometryType:e,visible:t}))}get layerAdapter(){switch(this.layer.type){case"feature":return"memory"===this.layer.source.type?new Ot(this.layer):new zr(this.layer);case"geojson":case"csv":case"wfs":return new Ot(this.layer);case"subtype-group":return new Qr(this.layer);case"ogc-feature":return new jr(this.layer);case"stream":return new Wr(this.layer);case"oriented-imagery":return new Nr(this.layer);case"knowledge-graph-sublayer":return new Br(this.layer);case"catalog-footprint":return new Dr(this.layer);default:(0,J.Bg)(this.layer)}return null}get timeExtent(){return(0,M.h)(this.layerAdapter.timeOptions,this.view?.timeExtent,this._get("timeExtent"))}getDisplayStatistics(r,e){return this.featureContainer?.getDisplayStatistics(r,e)}queryHeatmapStatistics(r){var e=this;return(0,c.Z)(function*(){return(yield e.getWorker()).pipeline.queryHeatmapStatistics(r)})()}highlight(r,e="highlight"){let t;r instanceof W.Z?t=[r.getObjectId()]:"number"==typeof r||"string"==typeof r?t=[r]:k.Z.isCollection(r)&&r.length>0?t=r.map(a=>a?.getObjectId()).toArray():Array.isArray(r)&&r.length>0&&(t="number"==typeof r[0]||"string"==typeof r[0]?r:r.map(a=>a?.getObjectId()));const s=t?.filter(O.pC);return s?.length?(this._addHighlights(s,e),(0,x.kB)(()=>this._removeHighlights(s,e))):(0,x.kB)()}getHighlightIds(){return Array.from(this._highlightCounter.ids())}hasHighlight(){return!this._highlightCounter.empty}hitTest(r,e){var t=this;return(0,c.Z)(function*(){const s=yield t.featureContainer.hitTest(e);if(0===s.length)return null;const a=yield t.getWorker(),{features:o,aggregates:u}=yield a.pipeline.getDisplayFeatures(s),m=t.featureContainer.getSortKeys(s),E=({displayId:g},{displayId:R})=>m.has(g)&&m.has(R)?m.get(g)-m.get(R):g-R;return o.sort(E).reverse(),u.sort(E).reverse(),[...u.map(g=>t._createGraphicHit(r,N.fromJSON(g))),...o.map(g=>t._createGraphicHit(r,W.Z.fromJSON(g)))]})()}queryStatistics(){var r=this;return(0,c.Z)(function*(){const e=yield r.getWorker();return(0,ae.Y)(e.pipeline.queryStatistics(),{featureCount:0,ringCount:0,vertexCount:0})})()}querySummaryStatistics(r,e,t){var s=this;return(0,c.Z)(function*(){const a=yield s.getWorker(),o={...e,scale:s.view.scale},u=a.features.executeQueryForSummaryStatistics(s._cleanUpQuery(r),o,t);return(0,ae.Y)(u,{})})()}queryAggregateSummaryStatistics(r,e,t){var s=this;return(0,c.Z)(function*(){const a={...e,scale:s.view.scale},o=(yield s.getWorker()).aggregates.executeQueryForSummaryStatistics(s._cleanUpAggregateQuery(r),a,t);return(0,ae.Y)(o,{})})()}queryUniqueValues(r,e,t){var s=this;return(0,c.Z)(function*(){const a=yield s.getWorker(),o={...e,scale:s.view.scale},u=a.features.executeQueryForUniqueValues(s._cleanUpQuery(r),o,t);return(0,ae.Y)(u,{uniqueValueInfos:[]})})()}queryAggregateUniqueValues(r,e,t){var s=this;return(0,c.Z)(function*(){const a=yield s.getWorker(),o={...e,scale:s.view.scale},u=a.aggregates.executeQueryForUniqueValues(s._cleanUpAggregateQuery(r),o,t);return(0,ae.Y)(u,{uniqueValueInfos:[]})})()}queryClassBreaks(r,e,t){var s=this;return(0,c.Z)(function*(){const a=yield s.getWorker(),o={...e,scale:s.view.scale},u=a.features.executeQueryForClassBreaks(s._cleanUpQuery(r),o,t);return(0,ae.Y)(u,{classBreakInfos:[]})})()}queryAggregateClassBreaks(r,e,t){var s=this;return(0,c.Z)(function*(){const a=yield s.getWorker(),o={...e,scale:s.view.scale},u=a.aggregates.executeQueryForClassBreaks(s._cleanUpAggregateQuery(r),o,t);return(0,ae.Y)(u,{classBreakInfos:[]})})()}queryHistogram(r,e,t){var s=this;return(0,c.Z)(function*(){const a=yield s.getWorker(),o={...e,scale:s.view.scale},u=a.features.executeQueryForHistogram(s._cleanUpQuery(r),o,t);return(0,ae.Y)(u,{bins:[],maxValue:null,minValue:null,normalizationTotal:null})})()}queryAggregateHistogram(r,e,t){var s=this;return(0,c.Z)(function*(){const a=yield s.getWorker(),o={...e,scale:s.view.scale},u=a.aggregates.executeQueryForHistogram(s._cleanUpAggregateQuery(r),o,t);return(0,ae.Y)(u,{bins:[],maxValue:null,minValue:null,normalizationTotal:null})})()}queryFeatures(r,e){return this.queryFeaturesJSON(r,e).then(t=>{const s=D.Z.fromJSON(t);return s.features.forEach(a=>this._setLayersForFeature(a)),s})}queryVisibleFeatures(r,e){var t=this;return(0,c.Z)(function*(){const s=(yield t.getWorker()).pipeline.queryVisibleFeatures(t._cleanUpQuery(r),e),a=yield(0,ae.Y)(s,{features:[]}),o=D.Z.fromJSON(a);return o.features.forEach(u=>t._setLayersForFeature(u)),o})()}queryAggregates(r,e){var t=this;return(0,c.Z)(function*(){const s=(yield t.getWorker()).aggregates.executeQuery(t._cleanUpAggregateQuery(r),e),a=yield(0,ae.Y)(s,{features:[]}),o=Q.fromJSON(a);return o.features.forEach(u=>t._setLayersForFeature(u)),o})()}queryAggregateIds(r,e){var t=this;return(0,c.Z)(function*(){const s=(yield t.getWorker()).aggregates.executeQueryForIds(t._cleanUpAggregateQuery(r),e);return(0,ae.Y)(s,[])})()}queryAggregateCount(r,e){var t=this;return(0,c.Z)(function*(){const s=(yield t.getWorker()).aggregates.executeQueryForCount(t._cleanUpAggregateQuery(r),e);return(0,ae.Y)(s,0)})()}queryAggregateJSON(r,e){var t=this;return(0,c.Z)(function*(){const s=(yield t.getWorker()).aggregates.executeQuery(t._cleanUpAggregateQuery(r),e);return(0,ae.Y)(s,{features:[]})})()}queryFeaturesJSON(r,e){var t=this;return(0,c.Z)(function*(){const s=(yield t.getWorker()).features.executeQuery(t._cleanUpQuery(r),e);return(0,ae.Y)(s,{features:[]})})()}queryObjectIds(r,e){var t=this;return(0,c.Z)(function*(){const s=(yield t.getWorker()).features.executeQueryForIds(t._cleanUpQuery(r),e);return(0,ae.Y)(s,[])})()}queryFeatureCount(r,e){var t=this;return(0,c.Z)(function*(){const s=(yield t.getWorker()).features.executeQueryForCount(t._cleanUpQuery(r),e);return(0,ae.Y)(s,0)})()}queryExtent(r,e){var t=this;return(0,c.Z)(function*(){const s=(yield t.getWorker()).features.executeQueryForExtent(t._cleanUpQuery(r),e),a=yield(0,ae.Y)(s,{count:0,extent:null});return{count:a.count,extent:oi.Z.fromJSON(a.extent)}})()}getSampleFeatures(r){var e=this;return(0,c.Z)(function*(){return(yield e.getWorker()).pipeline.getSampleFeatures(r)})()}setVisibility(r,e){e?this._visibilityOverrides.delete(r):this._visibilityOverrides.add(r),this._update()}update(r){if(!this._subscriptionManager)return;this.view.animation&&!this._lastTargetState&&(this._lastTargetState=r.state.clone()),!this.view.animation&&this._lastTargetState&&(this._lastTargetState=null);const e=this._subscriptionManager.update(r.targetState,this._lastTargetState);this.featureContainer.setVisibleTiles(e)}attach(){(0,P.Z)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.attach"),(0,y.R8)(this._updatingHandles.addPromise(this._workerAttached.promise)),(0,y.R8)(this._attachProxy()),this.featureContainer=new Nt(this),this.container.addChild(this.featureContainer),this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`),this._subscriptionManager=new ti({tileInfoView:this.view.featuresTilingScheme,updateSubscriptions:r=>{this.featureContainer.updateSubscriptions(r),(0,y.R8)(this._updatingHandles.addPromise(this.getWorker().then(e=>e.pipeline.updateSubscriptions(r))))},isDone:r=>this.featureContainer.isDone(r)}),this.requestUpdate(),this.addAttachHandles([(0,p.YP)(()=>JSON.stringify({displayRefreshVersion:this._displayRefreshVersion,timeExtent:this.timeExtent,clips:this.clips,filter:this.filter,featureEffect:this.featureEffect,sourceRefreshVersion:this._sourceRefreshVersion,timeZone:this.view.timeZone,effect:this.featureEffect,...this.layerAdapter.getUpdateHashProperties(this.view)}),()=>this._update(),p.nn),(0,p.YP)(()=>this.updateSuspended,r=>{r||(this._subscriptionManager.resume(),this.view.labelManager.requestUpdate())})]),"stream"!==this.layer.type&&"catalog-footprint"!==this.layer.type&&this.addAttachHandles(this.layer.on("edits",r=>this._edit(r)))}detach(){(0,P.Z)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.detach"),this._detachProxy(),this._fields=null,this.featureContainer.destroy(),this.featureContainer=null,this._commandsQueue.clear(),this.container.removeAllChildren(),this._subscriptionManager=(0,d.SC)(this._subscriptionManager),this._workerProxy.pipeline.onDetach(),this._workerAttached=(0,y.hh)(),(0,y.R8)(this._workerAttached.promise),this._lastAvailableFields=[],this._lastSchema=null}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}isUpdating(){const r="renderer"in this.layer&&null!=this.layer.renderer,e=this._commandsQueue.updateTracking.updating,t=null!=this._updatingRequiredFieldsPromise,s=this.featureContainer.updatingHandles.updating,a=this.updateRequested||r&&(e||t)||s||this._pipelineUpdating||this.dataUpdating;if((0,P.Z)("esri-2d-log-updating")){console.log(`Updating FLV2D (${this.layer.id}): ${a}\n  -> updateRequested ${this.updateRequested}\n  -> hasRenderer ${r}\n  -> updatingRequiredFields ${t}\n  -> hasPendingCommand ${e}\n  -> dataUpdating ${this.dataUpdating}\n  -> processing ${this._pipelineUpdating}\n  -> updatingContainer ${s}\n`);for(const o of this.featureContainer.subscriptions())console.log(`    -> Tile[${o.id}] Done: ${o.done}`)}return a}_createClientOptions(){const r=this;return{get container(){return r.featureContainer},setUpdating:e=>{this._set("_pipelineUpdating",e.pipeline),this._set("dataUpdating",e.data)},emitEvent:e=>{this.emit(e.name,e.event)},get eventLog(){return r.eventLog},fetch:e=>Promise.all(e.map(t=>r.view.stage.painter.textureManager.rasterizeItem(t))),fetchDictionary:e=>Promise.all(e.map(t=>this._fetchDictionaryRequest(t)))}}_fetchDictionaryRequest(r){var e=this;return(0,c.Z)(function*(){try{if("subtype-group"===e.layer.type)throw new Error("InternalError: SubtypeGroupLayer does not support dictionary renderer");const t=e.layer.renderer;if(!t||"dictionary"!==t.type)throw new Error("InternalError: Expected layer to have a DictionaryRenderer");const s=e._lastSchema.processor.mesh.factory.symbology;if("dictionary"!==s.type)throw new Error("InternalError: Expected schema to be of type 'dictionary'");const a={cimAnalyzer:e.view.stage.cimAnalyzer,cimResourceManager:e.view.stage.painter.textureManager.resourceManager,store:e.featureContainer.instanceStore,scaleExpression:s.scaleExpression};e._fields||(e._fields=e.layer.fields.map(m=>m.toJSON()));const o=s.visualVariableUniforms,u=yield t.getSymbolAsync(r.feature,{fields:e._fields});return u&&u.data?{type:"dictionary-response",meshes:yield(0,Qe.$L)(u.data,{uniforms:o,path:"renderer",schemaOptions:a})}:{type:"dictionary-response",meshes:[]}}catch{return{type:"dictionary-response",meshes:[]}}})()}_cleanUpQuery(r){const e=Y.Z.from(r)||this.createQuery();return e.outSpatialReference||(e.outSpatialReference=this.view.spatialReference),e.toJSON()}_cleanUpAggregateQuery(r){const e=Y.Z.from(r)||this.createAggregateQuery();e.outSpatialReference||(e.outSpatialReference=this.view.spatialReference);const t=e.objectIds??[];for(const s of e.aggregateIds??[])t.push(s);return e.objectIds=t,e.aggregateIds=[],e.toJSON()}_update(){var r=this;return(0,c.Z)(function*(){return r._commandsQueue.push({type:"update"})})()}_edit(r){var e=this;return(0,c.Z)(function*(){if(e.updateSuspended)return void e._subscriptionManager.suspend();const t=e._getEffectiveEdit(r);return t?e._commandsQueue.push(t).catch(y.H9):void 0})()}doRefresh(r){var e=this;return(0,c.Z)(function*(){e.attached&&(e.updateSuspended&&r||(r?e.incrementSourceRefreshVersion():e.incrementDisplayRefreshVersion()))})()}incrementSourceRefreshVersion(){this._sourceRefreshVersion=(this._sourceRefreshVersion+1)%Lt+1}incrementDisplayRefreshVersion(){this._displayRefreshVersion=(this._displayRefreshVersion+1)%Lt+1}_getEffectiveEdit(r){const e="globalIdField"in this.layer&&this.layer.globalIdField,t=r.deletedFeatures.some(m=>-1===m.objectId||!m.objectId),s=e&&this.availableFields.includes(e);if(t&&!s)return L.Z.getLogger(this).error(new _.Z("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${e} to be included the layer's outFields for updates to be reflected on the map`)),null;const a=this.layer,o=r.historicMoment?.getTime()??null,u="layerId"in a&&r.editedFeatures?.find(m=>m.layerId===a.layerId);if(u&&this._canEditByFeature(u)){const g=(0,Rt.oq)(this.layer.geometryType),{adds:R,deletes:U,updates:K}=u.editedFeatures,H=this.layer.objectIdField,q=R.map(ne=>(0,C.XA)(ne,g,!1,!1)),le=K.map(ne=>(0,C.XA)(ne.current,g,!1,!1));return{type:"edit-by-feature",added:q,removed:U.map(ne=>"attributes"in ne?{globalId:e?ne.attributes[e]:null,objectId:H?ne.attributes[H]:null}:ne),updated:le,historicMoment:o}}return{type:"edit-by-id",added:r.addedFeatures,updated:r.updatedFeatures,removed:r.deletedFeatures,historicMoment:o}}_canEditByFeature(r){const{adds:e,updates:t}=r.editedFeatures;return e.every(s=>this.view.spatialReference.equals(s.geometry?.spatialReference))&&t.every(s=>this.view.spatialReference.equals(s.current.geometry?.spatialReference))}_doUpdate(){var r=this;return(0,c.Z)(function*(){"featureReduction"in r.layer&&r.layer.featureReduction&&r.layer.featureReduction!==r._lastFeatureReduction&&(r.layer.featureReduction=r.layer.featureReduction?.clone(),r._lastFeatureReduction=r.layer.featureReduction);try{if(yield r._updateRequiredFields(),r.destroyed||!r.layerAdapter?.hasRequiredSupport||!r._subscriptionManager)return;const e=r.featureContainer.instanceStore;r.featureContainer.attributeView.lockTextureUploads(),e.updateStart();const t=r.featureEffect,s={store:e,cimAnalyzer:r.view.stage.cimAnalyzer,cimResourceManager:r.view.stage.painter.textureManager.resourceManager,scaleExpression:void 0},a=r._createViewSchemaConfig(),o={source:r.layerAdapter.createSourceSchema(a,r._sourceRefreshVersion),processor:yield r.layerAdapter.createProcessorSchema(s,a,r._displayRefreshVersion)},u=(0,f.R)(r._lastSchema?.source.mutable,o.source.mutable)||(0,f.R)(r._lastSchema?.processor,o.processor);if(!u)return r.featureContainer.requestRender(),r.featureContainer.attributeView.unlockTextureUploads(),e.updateEnd(),void(r.featureEffectView.featureEffect=t);r._lastSchema=o,r._fields=null;const m=Math.round(performance.now());(0,P.Z)("esri-2d-update-debug")&&console.debug(`Id[${r.layer.uid}] Version[${m}] FeatureLayerView2D._doUpdate`,{changes:u}),yield(yield r.getWorker()).pipeline.updateSchema(o,m),e.updateEnd(),r.featureEffectView.featureEffect=t,r.featureEffectView.endTransitions(),r.featureContainer.attributeView.unlockTextureUploads(),r.featureContainer.swapRenderState(),r.featureContainer.requestRender(),(0,P.Z)("esri-2d-update-debug")&&console.debug(`Version[${m}] FeatureLayerView2D.updateEnd`),r.requestUpdate()}catch(e){(0,P.Z)("esri-2d-update-debug")&&console.error("Encountered an error during update",e)}})()}_doEdit(r){var e=this;return(0,c.Z)(function*(){const t=yield e.getWorker();try{e.featureContainer.editStart(),yield t.pipeline.onEdits(r),e.featureContainer.editEnd()}catch(s){(0,y.D_)(s)}})()}get hasFilter(){const r=this.layerAdapter.hasFilters?.(this.view)??!1;return null!=this.filter||null!=this.timeExtent||this._visibilityOverrides.size>0||r}_getEffectiveAvailableFields(r){const e=function li(r,e){const t=new Set;return r&&r.forEach(s=>t.add(s)),e&&e.forEach(s=>t.add(s)),t.has("*")?["*"]:Array.from(t)}(this._lastAvailableFields,r);return this._lastAvailableFields=e,(0,j.TK)(this.layer.fieldsIndex,e)}_createViewSchemaConfig(){const r=[ui(this.view,this.layerAdapter,this.timeExtent,this._visibilityOverrides,this.filter),this.featureEffect?.filter?.toJSON()??null];return{availableFields:this._getEffectiveAvailableFields(this.availableFields),filters:r,scale:this.view.scale,timeZone:this.view.timeZone}}_addHighlights(r,e){this._highlightCounter.addReason(r,e),this._commandsQueue.push({type:"highlight"})}_removeHighlights(r,e){this._highlightCounter.deleteReason(r,e),this._commandsQueue.push({type:"highlight"})}_updateHighlights(){var r=this;return(0,c.Z)(function*(){const e=[];for(const a of r._highlightCounter.ids()){const o=r._highlightCounter.getHighlightReason(a),u=(0,ee.ck)(o);e.push({objectId:a,highlightFlags:u})}const t=yield r.getWorker();if(r.destroyed)return;const s=t.pipeline.updateHighlight({highlights:e}).catch(a=>{(0,y.D_)(a)||L.Z.getLogger(r).error(a)});r._updatingHandles.addPromise(s)})()}_setLayersForFeature(r){r.layer=r.sourceLayer=this.layer,this.layerAdapter.setGraphicOrigin&&this.layerAdapter.setGraphicOrigin(r)}_createGraphicHit(r,e){return this._setLayersForFeature(e),null!=e.geometry&&(e.geometry.spatialReference=this.view.spatialReference),{type:"graphic",graphic:e,layer:this.layer,mapPoint:r}}};function ui(r,e,t,s,a){a&&(a=a.clone());const o=null!=a?a.timeExtent:null,u=null!=t&&null!=o?t.intersection(o):t||o;u&&(a??=new z.Z,a.timeExtent=u),a=e.addFilters?.(a,r)??a;let m=a?.toJSON()??null;return s.size&&(m??=(new z.Z).toJSON(),m.hiddenIds=Array.from(s)),m}(0,S._)([(0,h.Cb)()],ue.prototype,"_commandsQueue",void 0),(0,S._)([(0,h.Cb)()],ue.prototype,"_sourceRefreshVersion",void 0),(0,S._)([(0,h.Cb)()],ue.prototype,"_displayRefreshVersion",void 0),(0,S._)([(0,h.Cb)({readOnly:!0})],ue.prototype,"_pipelineUpdating",void 0),(0,S._)([(0,h.Cb)({readOnly:!0})],ue.prototype,"hasAllFeatures",null),(0,S._)([(0,h.Cb)({readOnly:!0})],ue.prototype,"hasAllFeaturesInView",null),(0,S._)([(0,h.Cb)({readOnly:!0})],ue.prototype,"hasFullGeometries",null),(0,S._)([(0,h.Cb)()],ue.prototype,"featureEffectView",void 0),(0,S._)([(0,h.Cb)()],ue.prototype,"labelingCollisionInfos",null),(0,S._)([(0,h.Cb)()],ue.prototype,"layerAdapter",null),(0,S._)([(0,h.Cb)({readOnly:!0})],ue.prototype,"timeExtent",null),(0,S._)([(0,h.Cb)()],ue.prototype,"updating",void 0),ue=(0,S._)([(0,A.j)("esri.views.2d.layers.FeatureLayerView2D")],ue);const ci=ue},50088:(te,X,l)=>{function c(S,W){const h=S.featureReduction;return h&&"selection"!==h.type&&(!("maxScale"in h)||!h.maxScale||h.maxScale<W.scale)?h:null}l.d(X,{g:()=>c})},51424:(te,X,l)=>{function c(S,W,h,P){const L=S.clone(),v=1<<L.level,A=L.col+W,G=L.row+h;return P&&A<0?(L.col=A+v,L.world-=1):A>=v?(L.col=A-v,L.world+=1):L.col=A,L.row=G,L}l.d(X,{M:()=>c})},23640:(te,X,l)=>{l.d(X,{i:()=>S});var c=l(5633);class S{constructor(){this._idToCounters=new Map}get empty(){return 0===this._idToCounters.size}addReason(h,P){for(const L of h){let v=this._idToCounters.get(L);v||(v=new Map,this._idToCounters.set(L,v)),v.set(P,(v.get(P)||0)+1)}}deleteReason(h,P){for(const L of h){const v=this._idToCounters.get(L);if(!v)continue;let A=v.get(P);if(null==A)return;A--,A>0?v.set(P,A):v.delete(P),0===v.size&&this._idToCounters.delete(L)}}getHighlightReason(h){const P=this._idToCounters.get(h);if(!P)return null;let L=null;for(const v of c.Oo)P.get(v)&&(L=v);return L||null}ids(){return this._idToCounters.keys()}}},9395:(te,X,l)=>{l.d(X,{Y:()=>S});var c=l(15861);function S(h,P){return W.apply(this,arguments)}function W(){return(W=(0,c.Z)(function*(h,P){try{return yield h}catch(L){if("no-queryEngine"!==L.name)throw L;return P}})).apply(this,arguments)}},96696:(te,X,l)=>{l.d(X,{V5:()=>P,e7:()=>W});var c=l(15861),S=l(85295);function W(v){return h.apply(this,arguments)}function h(){return(h=(0,c.Z)(function*(v,A=v.popupTemplate){if(null==A)return[];const G=yield A.getRequiredFields(v.fieldsIndex),{lastEditInfoEnabled:N}=A,{objectIdField:$,typeIdField:O,globalIdField:k,relationships:J}=v;if(G.includes("*"))return["*"];const _=N?(0,S.CH)(v):[],x=(0,S.Q0)(v.fieldsIndex,[...G,..._]);return O&&x.push(O),x&&$&&v.fieldsIndex?.has($)&&!x.includes($)&&x.push($),x&&k&&v.fieldsIndex?.has(k)&&!x.includes(k)&&x.push(k),J&&J.forEach(d=>{const{keyField:f}=d;x&&f&&v.fieldsIndex?.has(f)&&!x.includes(f)&&x.push(f)}),x})).apply(this,arguments)}function P(v,A){return v.popupTemplate?v.popupTemplate:null!=A&&A.defaultPopupTemplateEnabled&&null!=v.defaultPopupTemplate?v.defaultPopupTemplate:null}}}]);