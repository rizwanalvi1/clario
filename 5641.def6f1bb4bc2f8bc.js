"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[5641,318],{85641:(Z,D,e)=>{e.r(D),e.d(D,{default:()=>m});var u=e(15861),l=e(50484),b=e(5603),L=e(30352),j=e(4703),A=e(3233),O=e(79412),v=e(77675),y=e(80543),I=(e(14007),e(65311),e(49301)),U=e(62185),C=e(10141),B=e(7547),_=e(60301),c=e(95060),E=e(19855),M=e(80099),T=e(70509),S=e(29717),R=e(79936),K=e(27835),W=e(41528),H=e(95140),g=e(16031),a=e(66262),r=e(84735),i=e(46018),o=e(5538);let d=class extends((0,E.h7)((0,S.M)((0,M.q)((0,T.I)((0,g.Q)((0,H.K)((0,A.R)(c.Z)))))))){constructor(t){var s;super(t),s=this,this.allLayers=new b.Z({getCollections:()=>[this.layers],getChildrenFunction:n=>"layers"in n?n.layers:null}),this.allTables=(0,W.a)(this),this.fullExtent=void 0,this.operationalLayerType="GroupLayer",this.spatialReference=void 0,this.type="group",this._debouncedSaveOperations=(0,O.Ds)(function(){var n=(0,u.Z)(function*(P,h,x){const{save:V,saveAs:G}=yield Promise.all([e.e(8592),e.e(8696)]).then(e.bind(e,90254));switch(P){case r.x.SAVE:return V(s,h);case r.x.SAVE_AS:return G(s,x,h)}});return function(P,h,x){return n.apply(this,arguments)}}())}initialize(){this._enforceVisibility(this.visibilityMode,this.visible),this.addHandles([(0,v.YP)(()=>{let t=this.parent;for(;t&&"parent"in t&&t.parent;)t=t.parent;return t&&a.x in t},t=>{const s="prevent-adding-tables";this.removeHandles(s),t&&(this.tables.removeAll(),this.addHandles((0,v.on)(()=>this.tables,"before-add",n=>{n.preventDefault(),j.Z.getLogger(this).errorOnce("tables","tables in group layers in a webscene are not supported. Please move the tables from the group layer to the webscene if you want to persist them.")}),s))},v.tX),(0,v.YP)(()=>this.visible,this._onVisibilityChange.bind(this),v.Z_)])}destroy(){this.allLayers.destroy(),this.allTables.destroy()}get sourceIsPortalItem(){return this.portalItem&&this.originIdOf("portalItem")===_.s3.USER}_writeLayers(t,s,n,P){const h=[];if(!t)return h;t.forEach(x=>{const V=(0,o.Nw)(x,P.webmap?P.webmap.getLayerJSONFromResourceInfo(x):null,P);V?.layerType&&h.push(V)}),s.layers=h}set portalItem(t){this._set("portalItem",t)}readPortalItem(t,s,n){const{itemId:P,layerType:h}=s;if("GroupLayer"===h&&P)return new K.default({id:P,portal:n?.portal})}writePortalItem(t,s){t?.id&&(s.itemId=t.id)}set visibilityMode(t){const s=this._get("visibilityMode")!==t;this._set("visibilityMode",t),s&&this._enforceVisibility(t,this.visible)}beforeSave(){var t=this;return(0,u.Z)(function*(){return(0,i.P)(t)})()}load(t){const s=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Group Layer","Scene Service"],layerModuleTypeMap:R.T},t).catch(n=>{if((0,O.r9)(n),this.sourceIsPortalItem)throw n});return this.addResolvingPromise(s),Promise.resolve(this)}loadAll(){var t=this;return(0,u.Z)(function*(){return(0,L.G)(t,s=>{s(t.layers,t.tables)})})()}save(t){var s=this;return(0,u.Z)(function*(){return s._debouncedSaveOperations(r.x.SAVE,t)})()}saveAs(t,s){var n=this;return(0,u.Z)(function*(){return n._debouncedSaveOperations(r.x.SAVE_AS,s,t)})()}layerAdded(t){t.visible&&"exclusive"===this.visibilityMode?this._turnOffOtherLayers(t):"inherited"===this.visibilityMode&&(t.visible=this.visible),this.hasHandles(t.uid)?console.error(`Layer read to Grouplayer: uid=${t.uid}`):this.addHandles((0,v.YP)(()=>t.visible,s=>this._onChildVisibilityChange(t,s),v.Z_),t.uid)}layerRemoved(t){this.removeHandles(t.uid),this._enforceVisibility(this.visibilityMode,this.visible)}_turnOffOtherLayers(t){this.layers.forEach(s=>{s!==t&&(s.visible=!1)})}_enforceVisibility(t,s){if(!(0,I.vw)(this).initialized)return;const n=this.layers;let P=n.find(h=>h.visible);switch(t){case"exclusive":n.length&&!P&&(P=n.at(0),P.visible=!0),this._turnOffOtherLayers(P);break;case"inherited":n.forEach(h=>{h.visible=s})}}_onVisibilityChange(t){"inherited"===this.visibilityMode&&this.layers.forEach(s=>{s.visible=t})}_onChildVisibilityChange(t,s){switch(this.visibilityMode){case"exclusive":s?this._turnOffOtherLayers(t):this._isAnyLayerVisible()||(t.visible=!0);break;case"inherited":t.visible=this.visible}}_isAnyLayerVisible(){return this.layers.some(t=>t.visible)}};(0,l._)([(0,y.Cb)({readOnly:!0,dependsOn:[]})],d.prototype,"allLayers",void 0),(0,l._)([(0,y.Cb)({readOnly:!0})],d.prototype,"allTables",void 0),(0,l._)([(0,y.Cb)({json:{read:!0,write:!0}})],d.prototype,"blendMode",void 0),(0,l._)([(0,y.Cb)()],d.prototype,"fullExtent",void 0),(0,l._)([(0,y.Cb)({readOnly:!0})],d.prototype,"sourceIsPortalItem",null),(0,l._)([(0,y.Cb)({json:{read:!1,write:{ignoreOrigin:!0}}})],d.prototype,"layers",void 0),(0,l._)([(0,B.c)("layers")],d.prototype,"_writeLayers",null),(0,l._)([(0,y.Cb)({type:["GroupLayer"]})],d.prototype,"operationalLayerType",void 0),(0,l._)([(0,y.Cb)({json:{origins:{"web-map":{read:!1,write:{overridePolicy(t,s,n){return{enabled:"Group Layer"===t?.type&&n?.initiator!==this}}}},"web-scene":{read:!1,write:!1}}}})],d.prototype,"portalItem",null),(0,l._)([(0,U.r)("web-map","portalItem",["itemId"])],d.prototype,"readPortalItem",null),(0,l._)([(0,B.c)("web-map","portalItem",{itemId:{type:String}})],d.prototype,"writePortalItem",null),(0,l._)([(0,y.Cb)()],d.prototype,"spatialReference",void 0),(0,l._)([(0,y.Cb)({json:{read:!1},readOnly:!0,value:"group"})],d.prototype,"type",void 0),(0,l._)([(0,y.Cb)({type:["independent","inherited","exclusive"],value:"independent",json:{write:!0,origins:{"web-map":{type:["independent","exclusive"],write:(t,s,n)=>{"inherited"!==t&&(s[n]=t)}}}}})],d.prototype,"visibilityMode",null),d=(0,l._)([(0,C.j)("esri.layers.GroupLayer")],d);const m=d},70509:(Z,D,e)=>{e.d(D,{I:()=>K});var u=e(15861),l=e(50484),b=e(11931),L=e(26152),j=e(66476),A=e(37636),O=e(57964),v=e(4703),y=e(51172),p=e(79412),f=e(6785),I=e(80543),B=(e(14007),e(65311),e(62185)),_=e(10141),c=e(7547),E=e(85971),M=e(61018),T=e(27835),S=e(57437),R=e(50318);const K=H=>{let g=class extends H{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,y.SC)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(a){a!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",a))}readPortalItem(a,r,i){if(r.itemId)return new T.default({id:r.itemId,portal:i?.portal})}writePortalItem(a,r){a?.id&&(r.itemId=a.id)}loadFromPortal(a,r){var i=this;return(0,u.Z)(function*(){if(i.portalItem?.id)try{const{load:o}=yield Promise.all([e.e(2772),e.e(8592),e.e(6964)]).then(e.bind(e,36964));return(0,p.k_)(r),yield o({instance:i,supportedTypes:a.supportedTypes,validateItem:a.validateItem,supportsData:a.supportsData,layerModuleTypeMap:a.layerModuleTypeMap},r)}catch(o){throw(0,p.D_)(o)||v.Z.getLogger(i).warn(`Failed to load layer (${i.title}, ${i.id}) portal item (${i.portalItem.id})\n  ${o}`),o}})()}finishLoadEditablePortalLayer(a){var r=this;return(0,u.Z)(function*(){r._set("userHasEditingPrivileges",yield r._fetchUserHasEditingPrivileges(a).catch(i=>((0,p.r9)(i),!0)))})()}setUserPrivileges(a,r){var i=this;return(0,u.Z)(function*(){if(!b.default.userPrivilegesApplied)return i.finishLoadEditablePortalLayer(r);if(i.url)try{const{features:{edit:o,fullEdit:d},content:{updateItem:m}}=yield i._fetchUserPrivileges(a,r);i._set("userHasEditingPrivileges",o),i._set("userHasFullEditingPrivileges",d),i._set("userHasUpdateItemPrivileges",m)}catch(o){(0,p.r9)(o)}})()}_fetchUserPrivileges(a,r){var i=this;return(0,u.Z)(function*(){let o=i.portalItem;if(!a||!o||!o.loaded||o.sourceUrl)return i._fetchFallbackUserPrivileges(r);const d=a===o.id;if(d&&o.portal.user)return(0,R.Ss)(o);let m,t;if(d)m=o.portal.url;else try{m=yield(0,E.oP)(i.url,r)}catch(h){(0,p.r9)(h)}if(!m||!(0,f.Zo)(m,o.portal.url))return i._fetchFallbackUserPrivileges(r);try{const h=null!=r?r.signal:null;t=yield L.id?.getCredential(`${m}/sharing`,{prompt:!1,signal:h})}catch(h){(0,p.r9)(h)}if(!t)return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}};try{if(d?yield o.reload():(o=new T.default({id:a,portal:{url:m}}),yield o.load(r)),o.portal.user)return(0,R.Ss)(o)}catch(h){(0,p.r9)(h)}return{features:{edit:!0,fullEdit:!1},content:{updateItem:!1}}})()}_fetchFallbackUserPrivileges(a){var r=this;return(0,u.Z)(function*(){let i=!0;try{i=yield r._fetchUserHasEditingPrivileges(a)}catch(o){(0,p.r9)(o)}return{features:{edit:i,fullEdit:!1},content:{updateItem:!1}}})()}_fetchUserHasEditingPrivileges(a){var r=this;return(0,u.Z)(function*(){const i=r.url?L.id?.findCredential(r.url):null;if(!i)return!0;const o=W.credential===i?W.user:yield r._fetchEditingUser(a);return W.credential=i,W.user=o,null==o?.privileges||o.privileges.includes("features:user:edit")})()}_fetchEditingUser(a){var r=this;return(0,u.Z)(function*(){const i=r.portalItem?.portal?.user;if(i)return i;const o=L.id?.findServerInfo(r.url??"");if(!o?.owningSystemUrl)return null;const d=`${o.owningSystemUrl}/sharing/rest`,m=M.Z.getDefault();if(m&&m.loaded&&(0,f.Fv)(m.restUrl)===(0,f.Fv)(d))return m.user;const t=`${d}/community/self`,s=null!=a?a.signal:null,n=yield(0,A.q6)((0,j.Z)(t,{authMode:"no-prompt",query:{f:"json"},signal:s}));return n.ok?S.Z.fromJSON(n.value.data):null})()}read(a,r){r&&(r.layer=this),super.read(a,r)}write(a,r){const i=r?.portal,o=this.portalItem?.id&&(this.portalItem.portal||M.Z.getDefault());return i&&o&&!(0,f.tm)(o.restUrl,i.restUrl)?(r.messages&&r.messages.push(new O.Z("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(a,{...r,layer:this})}};return(0,l._)([(0,I.Cb)({type:T.default})],g.prototype,"portalItem",null),(0,l._)([(0,B.r)("web-document","portalItem",["itemId"])],g.prototype,"readPortalItem",null),(0,l._)([(0,c.c)("web-document","portalItem",{itemId:{type:String}})],g.prototype,"writePortalItem",null),(0,l._)([(0,I.Cb)({clonable:!1})],g.prototype,"resourceReferences",void 0),(0,l._)([(0,I.Cb)({type:Boolean,readOnly:!0})],g.prototype,"userHasEditingPrivileges",void 0),(0,l._)([(0,I.Cb)({type:Boolean,readOnly:!0})],g.prototype,"userHasFullEditingPrivileges",void 0),(0,l._)([(0,I.Cb)({type:Boolean,readOnly:!0})],g.prototype,"userHasUpdateItemPrivileges",void 0),g=(0,l._)([(0,_.j)("esri.layers.mixins.PortalLayer")],g),g},W={credential:null,user:null}},50318:(Z,D,e)=>{e.d(D,{$o:()=>I,Fj:()=>y,IW:()=>f,Ss:()=>B,_$:()=>v,ck:()=>p,hz:()=>C,qj:()=>O});var u=e(15861),l=e(83821),b=e(43814),L=e(48230);function A(){return(A=(0,u.Z)(function*(_){const c=_.spatialReference;if(c.isWGS84)return _.clone();if(c.isWebMercator)return(0,L.Sx)(_);const E=b.Z.WGS84;return yield(0,l.initializeProjection)(c,E),(0,l.project)(_,E)})).apply(this,arguments)}function O(_,c){if(!v(_,c)){const E=_.typeKeywords;E?E.push(c):_.typeKeywords=[c]}}function v(_,c){return!!_.typeKeywords?.includes(c)}function y(_){return v(_,C.HOSTED_SERVICE)}function p(_,c){const E=_.typeKeywords;if(E){const M=E.indexOf(c);M>-1&&E.splice(M,1)}}function f(_,c,E){E?O(_,c):p(_,c)}function I(_){return U.apply(this,arguments)}function U(){return U=(0,u.Z)(function*(_){const c=_.clone().normalize();let E;if(c.length>1)for(const M of c)E?M.width>E.width&&(E=M):E=M;else E=c[0];return function j(_){return A.apply(this,arguments)}(E)}),U.apply(this,arguments)}const C={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function B(_){const{portal:c,isOrgItem:E,itemControl:M}=_,T=c.user?.privileges;let S=!T||T.includes("features:user:edit"),R=!!E&&!!T?.includes("features:user:fullEdit");const K="update"===M||"admin"===M;return K?R=S=!0:R&&(S=!0),{features:{edit:S,fullEdit:R},content:{updateItem:K}}}},66262:(Z,D,e)=>{e.d(D,{x:()=>u});const u=Symbol("WebScene")},84735:(Z,D,e)=>{var u,l;e.d(D,{x:()=>u}),(l=u||(u={}))[l.SAVE=0]="SAVE",l[l.SAVE_AS=1]="SAVE_AS"},46018:(Z,D,e)=>{e.d(D,{P:()=>b,z:()=>A});var u=e(15861),l=e(57964);function b(O){return L.apply(this,arguments)}function L(){return(L=(0,u.Z)(function*(O){const v=[];for(const y of O.allLayers)if("beforeSave"in y&&"function"==typeof y.beforeSave){const p=y.beforeSave();p&&v.push(p)}yield Promise.allSettled(v)})).apply(this,arguments)}const j=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function A(O,v,y){let p=(O.messages??[]).filter(({type:f})=>"error"===f).map(({name:f,message:I,details:U})=>new l.Z(f,I,U));if(O.blockedRelativeUrls&&(p=p.concat(O.blockedRelativeUrls.map(f=>new l.Z("url:unsupported",`Relative url '${f}' is not supported`)))),y){const{ignoreUnsupported:f,supplementalUnsupportedErrors:I=[],requiredPropertyChecksDisabled:U}=y;f&&(p=p.filter(({name:C})=>!(j.has(C)||I.includes(C)))),U&&(p=p.filter(C=>"web-document-write:property-required"!==C.name))}if(p.length>0)throw new l.Z(v.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:p})}}}]);