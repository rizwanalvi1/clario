"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[7192],{40408:(X,D,u)=>{u.d(D,{dp:()=>U,o2:()=>h,yZ:()=>F});var E=u(55117),y=u(49602);const j=96;function F(g,S){const Z=S||g.extent,c=g.width,$=(0,y.c9)(Z?.spatialReference);return Z&&c?Z.width/c*$*y.hd*j:0}function U(g,S){return g/((0,y.c9)(S)*y.hd*j)}function h(g,S,Z){return function m(g,S){return 0===S||(0,E.W8)(g,S)||g<S}(g,S)&&function M(g,S){return 0===S||(0,E.W8)(g,S)||g>S}(g,Z)}},1865:(X,D,u)=>{function E(F){const U=F.layer;return"floorInfo"in U&&U.floorInfo?.floorField&&"floors"in F.view?j(F.view.floors,U.floorInfo.floorField):null}function y(F,U){return"floorInfo"in U&&U.floorInfo?.floorField?j(F,U.floorInfo.floorField):null}function j(F,U){if(!F?.length)return null;const C=F.filter(b=>""!==b).map(b=>`'${b}'`);return C.push("''"),`${U} IN (${C.join(",")}) OR ${U} IS NULL`}u.d(D,{c:()=>E,f:()=>y})},45859:(X,D,u)=>{u.d(D,{FN:()=>j,QV:()=>y,ac:()=>U});var E=u(60301);function y(C,b,O){return b.flatten(({sublayers:m})=>m).length!==C.length||!!C.some(m=>m.originIdOf("minScale")>O||m.originIdOf("maxScale")>O||m.originIdOf("renderer")>O||m.originIdOf("labelingInfo")>O||m.originIdOf("opacity")>O||m.originIdOf("labelsVisible")>O||m.originIdOf("source")>O)||!F(C,b)}function j(C,b,O){return!!C.some(h=>{const m=h.source,M=!m||"map-layer"===m.type&&m.mapLayerId===h.id&&(null==m.gdbVersion||m.gdbVersion===O);return h.commitProperty("renderer"),h.commitProperty("labelingInfo"),h.commitProperty("opacity"),h.commitProperty("labelsVisible"),!M||h.originIdOf("renderer")>E.s3.SERVICE||h.originIdOf("labelingInfo")>E.s3.SERVICE||h.originIdOf("opacity")>E.s3.SERVICE||h.originIdOf("labelsVisible")>E.s3.SERVICE})||!F(C,b)}function F(C,b){if(!C?.length||null==b)return!0;const O=b.slice().reverse().flatten(({sublayers:M})=>M&&M.toArray().reverse()).map(M=>M.id).toArray();if(C.length>O.length)return!1;let h=0;const m=O.length;for(const{id:M}of C){for(;h<m&&O[h]!==M;)h++;if(h>=m)return!1}return!0}function U(C){return!!C&&C.some(b=>null!=b.minScale||null!=b.layerDefinition?.minScale)}},64269:(X,D,u)=>{u.d(D,{VF:()=>H,Uf:()=>Le});var E=u(15861),y=u(50484),j=u(35458),F=u(73514),U=u(57678),C=u(83944),b=u(57964),O=u(1258),h=u(14007),m=u(8611),M=u(79412),g=u(77675),S=u(38955),Z=u(49602),c=u(80543),W=(u(4703),u(10141)),z=u(26894),se=u(40408),me=u(85295),k=u(1865);function q(i,r){return r?"xoffset"in r&&r.xoffset?Math.max(i,Math.abs(r.xoffset)):"yoffset"in r&&r.yoffset?Math.max(i,Math.abs(r.yoffset||0)):i:i}function le(i,r){return"number"==typeof i?i:i?.stops?.length?function ge(i){let r=0,o=0;for(let s=0;s<i.length;s++){const l=i[s].size;"number"==typeof l&&(r+=l,o++)}return r/o}(i.stops):r}function ae(i){const r=i?.renderer,o=i?.pointerType,s="touch"===o?9:6;if(!r)return s;const l="visualVariables"in r?function ve(i,r){if(!r)return i;const o=r.filter(f=>"size"===f.type).map(f=>{const{maxSize:R,minSize:p}=f;return(le(R,i)+le(p,i))/2});let s=0;const l=o.length;if(0===l)return i;for(let f=0;f<l;f++)s+=o[f];const a=Math.floor(s/l);return Math.max(a,i)}(s,r.visualVariables):s;if("simple"===r.type)return q(l,r.symbol);if("unique-value"===r.type){let a=l;return r.uniqueValueInfos?.forEach(f=>{a=q(a,f.symbol)}),a}if("class-breaks"===r.type){let a=l;return r.classBreakInfos.forEach(f=>{a=q(a,f.symbol)}),a}return l}var be=u(66476),xe=u(93566),_=u(15462),ue=u(40637),Ie=u(33721),Ee=u(45859);var ee,we=u(2189),Ce=u(34411),pe=u(89317),Me=u(1535),ye=(u(65311),u(7547)),Pe=u(43814);let x=ee=class extends pe.wq{static from(i){return(0,Me.TJ)(ee,i)}constructor(i){super(i),this.dpi=96,this.floors=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=null,this.height=400,this.historicMoment=null,this.layerIds=null,this.layerOption="top",this.mapExtent=null,this.maxAllowableOffset=null,this.returnFieldName=!0,this.returnGeometry=!1,this.returnM=!1,this.returnUnformattedValues=!0,this.returnZ=!1,this.spatialReference=null,this.sublayers=null,this.timeExtent=null,this.tolerance=null,this.width=400}writeHistoricMoment(i,r){r.historicMoment=i&&i.getTime()}};(0,y._)([(0,c.Cb)({type:Number,json:{write:!0}})],x.prototype,"dpi",void 0),(0,y._)([(0,c.Cb)()],x.prototype,"floors",void 0),(0,y._)([(0,c.Cb)({type:String,json:{write:!0}})],x.prototype,"gdbVersion",void 0),(0,y._)([(0,c.Cb)({types:we.qM,json:{read:ue.im,write:!0}})],x.prototype,"geometry",void 0),(0,y._)([(0,c.Cb)({type:Number,json:{write:!0}})],x.prototype,"geometryPrecision",void 0),(0,y._)([(0,c.Cb)({type:Number,json:{write:!0}})],x.prototype,"height",void 0),(0,y._)([(0,c.Cb)({type:Date})],x.prototype,"historicMoment",void 0),(0,y._)([(0,ye.c)("historicMoment")],x.prototype,"writeHistoricMoment",null),(0,y._)([(0,c.Cb)({type:[Number],json:{write:!0}})],x.prototype,"layerIds",void 0),(0,y._)([(0,c.Cb)({type:["top","visible","all","popup"],json:{write:!0}})],x.prototype,"layerOption",void 0),(0,y._)([(0,c.Cb)({type:z.Z,json:{write:!0}})],x.prototype,"mapExtent",void 0),(0,y._)([(0,c.Cb)({type:Number,json:{write:!0}})],x.prototype,"maxAllowableOffset",void 0),(0,y._)([(0,c.Cb)({type:Boolean,json:{write:!0}})],x.prototype,"returnFieldName",void 0),(0,y._)([(0,c.Cb)({type:Boolean,json:{write:!0}})],x.prototype,"returnGeometry",void 0),(0,y._)([(0,c.Cb)({type:Boolean,json:{write:!0}})],x.prototype,"returnM",void 0),(0,y._)([(0,c.Cb)({type:Boolean,json:{write:!0}})],x.prototype,"returnUnformattedValues",void 0),(0,y._)([(0,c.Cb)({type:Boolean,json:{write:!0}})],x.prototype,"returnZ",void 0),(0,y._)([(0,c.Cb)({type:Pe.Z,json:{write:!0}})],x.prototype,"spatialReference",void 0),(0,y._)([(0,c.Cb)()],x.prototype,"sublayers",void 0),(0,y._)([(0,c.Cb)({type:Ce.Z,json:{write:!0}})],x.prototype,"timeExtent",void 0),(0,y._)([(0,c.Cb)({type:Number,json:{write:!0}})],x.prototype,"tolerance",void 0),(0,y._)([(0,c.Cb)({type:Number,json:{write:!0}})],x.prototype,"width",void 0),x=ee=(0,y._)([(0,W.j)("esri.rest.support.IdentifyParameters")],x);const fe=x;var Ue=u(62185),Fe=u(31709);let B=class extends pe.wq{constructor(i){super(i),this.displayFieldName=null,this.feature=null,this.layerId=null,this.layerName=null}readFeature(i,r){return j.Z.fromJSON({attributes:{...r.attributes},geometry:{...r.geometry}})}writeFeature(i,r){if(!i)return;const{attributes:o,geometry:s}=i;o&&(r.attributes={...o}),null!=s&&(r.geometry=s.toJSON(),r.geometryType=Fe.P.toJSON(s.type))}};(0,y._)([(0,c.Cb)({type:String,json:{write:!0}})],B.prototype,"displayFieldName",void 0),(0,y._)([(0,c.Cb)({type:j.Z})],B.prototype,"feature",void 0),(0,y._)([(0,Ue.r)("feature",["attributes","geometry"])],B.prototype,"readFeature",null),(0,y._)([(0,ye.c)("feature")],B.prototype,"writeFeature",null),(0,y._)([(0,c.Cb)({type:Number,json:{write:!0}})],B.prototype,"layerId",void 0),(0,y._)([(0,c.Cb)({type:String,json:{write:!0}})],B.prototype,"layerName",void 0),B=(0,y._)([(0,W.j)("esri.rest.support.IdentifyResult")],B);const je=B;function te(){return(te=(0,E.Z)(function*(i,r,o){const s=(r=function Ze(i){return fe.from(i)}(r)).geometry?[r.geometry]:[],l=(0,_.en)(i);return l.path+="/identify",(0,xe.aX)(s).then(a=>{const f=function Oe(i,r){const{dpi:o,gdbVersion:s,geometry:l,geometryPrecision:a,height:f,historicMoment:R,layerOption:p,mapExtent:P,maxAllowableOffset:d,returnFieldName:I,returnGeometry:v,returnUnformattedValues:V,returnZ:w,spatialReference:G,timeExtent:N,tolerance:T,width:A}=i.toJSON(),{dynamicLayers:Q,layerDefs:J,layerIds:Y}=function Se(i){const{mapExtent:r,floors:o,width:s,sublayers:l,layerIds:a,layerOption:f,gdbVersion:R}=i,p=l?.find(w=>null!=w.layer)?.layer?.serviceSublayers,P="popup"===f,d={},I=(0,se.yZ)({extent:r,width:s,spatialReference:r?.spatialReference}),v=[],V=w=>{if(w.visible&&(0===I||(0===w.minScale||I<=w.minScale)&&(0===w.maxScale||I>=w.maxScale)))if(w.sublayers)w.sublayers.forEach(V);else{if(!1===a?.includes(w.id)||P&&(!w.popupTemplate||!w.popupEnabled))return;v.unshift(w)}};if(l?.forEach(V),l&&!v.length)d.layerIds=[];else{const w=(0,Ee.FN)(v,p,R),G=v.map(N=>{const T=(0,k.f)(o,N);return N.toExportImageJSON(T)});if(w)d.dynamicLayers=JSON.stringify(G);else{if(l){let T=v.map(({id:A})=>A);a&&(T=T.filter(A=>a.includes(A))),d.layerIds=T}else a?.length&&(d.layerIds=a);const N=function Re(i,r){const o=!!i?.length,s=r.filter(l=>null!=l.definitionExpression||o&&null!=l.floorInfo);return s.length?s.map(l=>{const a=(0,k.f)(i,l),f=(0,S._)(a,l.definitionExpression);return{id:l.id,definitionExpression:f??void 0}}):null}(o,v);if(null!=N&&N.length){const T={};for(const A of N)A.definitionExpression&&(T[A.id]=A.definitionExpression);Object.keys(T).length&&(d.layerDefs=JSON.stringify(T))}}}return d}(i),oe=null!=r?.geometry?r.geometry:null,L={historicMoment:R,geometryPrecision:a,maxAllowableOffset:d,returnFieldName:I,returnGeometry:v,returnUnformattedValues:V,returnZ:w,tolerance:T},K=oe?.toJSON()||l;L.imageDisplay=`${A},${f},${o}`,s&&(L.gdbVersion=s),K&&(delete K.spatialReference,L.geometry=JSON.stringify(K),L.geometryType=(0,ue.Ji)(K));const he=G??K?.spatialReference??P?.spatialReference;if(he&&(L.sr=(0,Ie.B9)(he)),L.time=N?[N.start,N.end].join(","):null,P){const{xmin:Je,ymin:$e,xmax:ze,ymax:Qe}=P;L.mapExtent=`${Je},${$e},${ze},${Qe}`}return J&&(L.layerDefs=J),Q&&!J&&(L.dynamicLayers=Q),L.layers="popup"===p?"visible":p,Y&&!Q&&(L.layers+=`:${Y.join(",")}`),L}(r,{geometry:a?.[0]}),R=(0,_.cv)({...l.query,f:"json",...f}),p=(0,_.lA)(R,o);return(0,be.Z)(l.path,p).then(Te).then(P=>function Ne(i,r){if(!r?.length)return i;const o=new Map;r.forEach(function s(l){o.set(l.id,l),l.sublayers&&l.sublayers.forEach(s)});for(const l of i.results)l.feature.sourceLayer=o.get(l.layerId);return i}(P,r.sublayers))})})).apply(this,arguments)}function Te(i){const r=i.data;return r.results=r.results||[],r.exceededTransferLimit=!!r.exceededTransferLimit,r.results=r.results.map(o=>je.fromJSON(o)),r}var Ae=u(4978),ce=u(35451),de=u(96696);let re=null;function Le(i,r){return"tile"===r.type||"map-image"===r.type}let H=class extends F.Z{constructor(i){var r;super(i),r=this,this._featuresResolutions=new WeakMap,this.highlightGraphics=null,this.highlightGraphicUpdated=null,this.updateHighlightedFeatures=(0,M.Ds)(function(){var o=(0,E.Z)(function*(s){r.destroyed||r.updatingHandles.addPromise(r._updateHighlightedFeaturesGeometries(s).catch(()=>{}))});return function(s){return o.apply(this,arguments)}}())}initialize(){const i=r=>{this.updatingHandles.addPromise(this._updateHighlightedFeaturesSymbols(r).catch(()=>{})),this.updateHighlightedFeatures(this._highlightGeometriesResolution)};this.addHandles([(0,g.on)(()=>this.highlightGraphics,"change",r=>i(r.added),{onListenerAdd:r=>i(r)})])}fetchPopupFeaturesAtLocation(i,r){var o=this;return(0,E.Z)(function*(){const{layerView:{layer:s,view:{scale:l}}}=o;if(!i)throw new b.Z("fetchPopupFeatures:invalid-area","Nothing to fetch without area",{layer:s});const a=function Ge(i,r,o){const s=[];if(!i)return s;const l=a=>{if(a.visible&&(0===a.minScale||r<=a.minScale)&&(0===a.maxScale||r>=a.maxScale))if(a.sublayers)a.sublayers.forEach(l);else if(a.popupEnabled){const p=(0,de.V5)(a,{...o,defaultPopupTemplateEnabled:!1});null!=p&&s.unshift({sublayer:a,popupTemplate:p})}};return i.map(l),s}(s.sublayers,l,r);if(!a.length)return[];const f=yield function Be(i,r){return ne.apply(this,arguments)}(s,a);if(!((s.capabilities?.operations?.supportsIdentify??1)&&s.version>=10.5||f))throw new b.Z("fetchPopupFeatures:not-supported","query operation is disabled for this service",{layer:s});return f?o._fetchPopupFeaturesUsingQueries(i,a,r):o._fetchPopupFeaturesUsingIdentify(i,a,r)})()}clearHighlights(){this.highlightGraphics?.removeAll()}highlight(i){const r=this.highlightGraphics;if(!r)return(0,O.kB)();let o=null;if(i instanceof j.Z?o=[i]:C.Z.isCollection(i)&&i.length>0?o=i.toArray():Array.isArray(i)&&i.length>0&&(o=i),o=o?.filter(U.pC),!o?.length)return(0,O.kB)();for(const s of o){const l=s.sourceLayer;null!=l&&"geometryType"in l&&"point"===l.geometryType&&(s.visible=!1)}return r.addMany(o),(0,O.kB)(()=>r.removeMany(o??[]))}_updateHighlightedFeaturesSymbols(i){var r=this;return(0,E.Z)(function*(){const{layerView:{view:o},highlightGraphics:s,highlightGraphicUpdated:l}=r;if(s&&l)for(const a of i){const f=a.sourceLayer&&"renderer"in a.sourceLayer&&a.sourceLayer.renderer;a.sourceLayer&&"geometryType"in a.sourceLayer&&"point"===a.sourceLayer.geometryType&&f&&"getSymbolAsync"in f&&f.getSymbolAsync(a).then(function(){var R=(0,E.Z)(function*(p){p||=new ce.Z;let P=null;const d="visualVariables"in f?f.visualVariables?.find(I=>"size"===I.type):void 0;d&&(re||(re=(yield u.e(7157).then(u.bind(u,37157))).getSize),P=re(d,a,{view:o.type,scale:o.scale,shape:"simple-marker"===p.type?p.style:null})),P||="width"in p&&"height"in p&&null!=p.width&&null!=p.height?Math.max(p.width,p.height):"size"in p?p.size:16,s.includes(a)&&(a.symbol=new ce.Z({style:"square",size:P,xoffset:"xoffset"in p?p.xoffset:0,yoffset:"yoffset"in p?p.yoffset:0}),l(a,"symbol"),a.visible=!0)});return function(p){return R.apply(this,arguments)}}())}})()}_updateHighlightedFeaturesGeometries(i){var r=this;return(0,E.Z)(function*(){const{layerView:{layer:o,view:s},highlightGraphics:l,highlightGraphicUpdated:a}=r;if(r._highlightGeometriesResolution=i,!a||!l?.length||!o.capabilities.operations.supportsQuery)return;const f=r._getTargetResolution(i),R=new Map;for(const d of l)(!r._featuresResolutions.has(d)||r._featuresResolutions.get(d)>f)&&(0,m.s1)(R,d.sourceLayer,()=>new Map).set(d.getObjectId(),d);const p=Array.from(R,([d,I])=>{const v=d.createQuery();return v.objectIds=[...I.keys()],v.outFields=[d.objectIdField],v.returnGeometry=!0,v.maxAllowableOffset=f,v.outSpatialReference=s.spatialReference,d.queryFeatures(v)}),P=yield Promise.all(p);if(!r.destroyed)for(const{features:d}of P)for(const I of d){const V=R.get(I.sourceLayer).get(I.getObjectId());V&&l.includes(V)&&(V.geometry=I.geometry,a(V,"geometry"),r._featuresResolutions.set(V,f))}})()}_getTargetResolution(i){const r=i*(0,Z.c9)(this.layerView.view.spatialReference),o=r/16;return o<=10?0:i/r*o}_fetchPopupFeaturesUsingIdentify(i,r,o){var s=this;return(0,E.Z)(function*(){const l=yield s._createIdentifyParameters(i,r,o);if(null==l)return[];const{results:a}=yield function Ve(i,r,o){return te.apply(this,arguments)}(s.layerView.layer.parsedUrl,l,o);return a.map(f=>f.feature)})()}_createIdentifyParameters(i,r,o){var s=this;return(0,E.Z)(function*(){const{floors:l,layer:a,timeExtent:f,view:{spatialReference:R,scale:p}}=s.layerView;if(!r.length)return null;yield Promise.all(r.map(({sublayer:w})=>w.load(o).catch(()=>{})));const P=Math.min((0,h.Z)("mapservice-popup-identify-max-tolerance"),a.allSublayers.reduce((w,G)=>G.renderer?ae({renderer:G.renderer,pointerType:o?.pointerType}):w,2)),d=s.createFetchPopupFeaturesQueryGeometry(i,P),I=(0,se.dp)(p,R),v=Math.round(d.width/I),V=new z.Z({xmin:d.center.x-I*v,ymin:d.center.y-I*v,xmax:d.center.x+I*v,ymax:d.center.y+I*v,spatialReference:d.spatialReference});return new fe({floors:l,gdbVersion:"gdbVersion"in a?a.gdbVersion:void 0,geometry:i,height:v,layerOption:"popup",mapExtent:V,returnGeometry:!0,spatialReference:R,sublayers:a.sublayers,timeExtent:f,tolerance:P,width:v})})()}_fetchPopupFeaturesUsingQueries(i,r,o){var s=this;return(0,E.Z)(function*(){const{layerView:{floors:l,timeExtent:a}}=s,f=r.map(function(){var R=(0,E.Z)(function*({sublayer:p,popupTemplate:P}){if(yield p.load(o).catch(()=>{}),p.capabilities&&!p.capabilities.operations.supportsQuery)return[];const d=p.createQuery(),I=ae({renderer:p.renderer,pointerType:o?.pointerType}),v=s.createFetchPopupFeaturesQueryGeometry(i,I),V=new Set,[w]=yield Promise.all([(0,de.e7)(p,P),p.renderer?.collectRequiredFields(V,p.fieldsIndex)]);(0,M.k_)(o),(0,me.gd)(V,p.fieldsIndex,w);const G=Array.from(V).sort();d.geometry=v,d.outFields=G,d.timeExtent=a;const N=(0,k.f)(l,p);d.where=(0,S._)(d.where,N);const T=s._getTargetResolution(v.width/I),A=yield function De(i){return i.expressionInfos?.length||Array.isArray(i.content)&&i.content.some(r=>"expression"===r.type)?(0,Ae.LC)():Promise.resolve()}(P);(0,M.k_)(o);const Q="point"===p.geometryType||A&&A.arcadeUtils.hasGeometryOperations(P);Q||(d.maxAllowableOffset=T);let{features:J}=yield p.queryFeatures(d,o);const Y=Q?0:T;J=yield function He(i,r,o){return ie.apply(this,arguments)}(p,J,o);for(const oe of J)s._featuresResolutions.set(oe,Y);return J});return function(p){return R.apply(this,arguments)}}());return(yield Promise.allSettled(f)).reduce((R,p)=>"fulfilled"===p.status?[...R,...p.value]:R,[]).filter(U.pC)})()}};function ne(){return(ne=(0,E.Z)(function*(i,r){if(i.capabilities?.operations?.supportsQuery)return!0;try{return yield Promise.any(r.map(({sublayer:o})=>o.load().then(()=>o.capabilities.operations.supportsQuery)))}catch{return!1}})).apply(this,arguments)}function ie(){return(ie=(0,E.Z)(function*(i,r,o){const s=i.renderer;return s&&"defaultSymbol"in s&&!s.defaultSymbol&&(r=s.valueExpression?yield Promise.all(r.map(l=>s.getSymbolAsync(l,o).then(a=>a?l:null))).then(l=>l.filter(a=>null!=a)):r.filter(l=>null!=s.getSymbol(l))),r})).apply(this,arguments)}(0,y._)([(0,c.Cb)({constructOnly:!0})],H.prototype,"createFetchPopupFeaturesQueryGeometry",void 0),(0,y._)([(0,c.Cb)({constructOnly:!0})],H.prototype,"layerView",void 0),(0,y._)([(0,c.Cb)({constructOnly:!0})],H.prototype,"highlightGraphics",void 0),(0,y._)([(0,c.Cb)({constructOnly:!0})],H.prototype,"highlightGraphicUpdated",void 0),(0,y._)([(0,c.Cb)({constructOnly:!0})],H.prototype,"updatingHandles",void 0),H=(0,y._)([(0,W.j)("esri.views.layers.support.MapServiceLayerViewHelper")],H)},9171:(X,D,u)=>{u.d(D,{K:()=>F}),u(2189);var y=u(49602),j=u(26894);function F(b,O,h,m=new j.Z){let M=0;if("2d"===h.type)M=O*(h.resolution??0);else if("3d"===h.type){const W=h.overlayPixelSizeInMapUnits(b),z=h.basemapSpatialReference;M=null==z||z.equals(h.spatialReference)?O*W:(0,y.c9)(z)/(0,y.c9)(h.spatialReference)}const g=b.x-M,S=b.y-M,Z=b.x+M,c=b.y+M,{spatialReference:$}=h;return m.xmin=Math.min(g,Z),m.ymin=Math.min(S,c),m.xmax=Math.max(g,Z),m.ymax=Math.max(S,c),m.spatialReference=$,m}new j.Z}}]);