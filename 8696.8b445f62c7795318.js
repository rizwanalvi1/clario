"use strict";(self.webpackChunkclario_frontend=self.webpackChunkclario_frontend||[]).push([[8696,5251],{60084:(L,y,r)=>{r.d(y,{D:()=>h});var u=r(26496);function h(g){g?.writtenProperties&&g.writtenProperties.forEach(({target:i,propName:p,newOrigin:c})=>{(0,u.l)(i)&&c&&i.originOf(p)!==c&&i.updateOrigin(p,c)})}},26496:(L,y,r)=>{function u(h){return h&&"getAtOrigin"in h&&"originOf"in h}r.d(y,{l:()=>u})},90254:(L,y,r)=>{r.r(y),r.d(y,{save:()=>d,saveAs:()=>D});var u=r(15861),h=r(85155),g=r(453),i=r(50318),p=r(89055);const c="Group Layer",E="group-layer-save",M="group-layer-save-as",O=i.hz.GROUP_LAYER_MAP;function U(e){return{isValid:"group"===e.type,errorMessage:"Layer.type should be 'group'"}}function A(e){return{isValid:(0,i._$)(e,O),errorMessage:`Layer.portalItem.typeKeywords should have '${O}'`}}function x(e,t){return{...(0,g.Y)(e,"web-map",!0),initiator:t}}function R(e){const t=e.layerJSON;return Promise.resolve(t&&Object.keys(t).length?t:null)}function a(e,t){return o.apply(this,arguments)}function o(){return(o=(0,u.Z)(function*(e,t){t.title||=e.title,(0,i.ck)(t,i.hz.METADATA),(0,i.qj)(t,O)})).apply(this,arguments)}function d(e,t){return _.apply(this,arguments)}function _(){return _=(0,u.Z)(function*(e,t){return(0,h.a1)({layer:e,itemType:c,validateLayer:U,validateItem:A,createJSONContext:n=>x(n,e),createItemData:R,errorNamePrefix:E,saveResources:(n=(0,u.Z)(function*(l,m){return e.sourceIsPortalItem||(yield l.removeAllResources().catch(()=>{})),(0,p.H)(e.resourceReferences,m)}),function(m,s){return n.apply(this,arguments)})},t);var n}),_.apply(this,arguments)}function D(e,t,n){return v.apply(this,arguments)}function v(){return(v=(0,u.Z)(function*(e,t,n){return(0,h.po)({layer:e,itemType:c,validateLayer:U,createJSONContext:l=>x(l,e),createItemData:R,errorNamePrefix:M,newItem:t,setItemProperties:a,saveResources:(l,m)=>(0,p.H)(e.resourceReferences,m)},n)})).apply(this,arguments)}},453:(L,y,r)=>{r.d(y,{Y:()=>i,h:()=>g});var u=r(6785),h=r(61018);function g(c,E){return{...p(c,E),readResourcePaths:[]}}function i(c,E,M){const O=(0,u.mN)(c.itemUrl);return{...p(c,E),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:O?{rootPath:O.path,writtenUrls:[]}:null,resources:M?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function p(c,E){return{origin:E,url:(0,u.mN)(c.itemUrl),portal:c.portal||h.Z.getDefault(),portalItem:c}}},5251:(L,y,r)=>{r.r(y),r.d(y,{addOrUpdateResources:()=>E,contentToBlob:()=>d,fetchResources:()=>p,getSiblingOfSameType:()=>D,getSiblingOfSameTypeI:()=>v,removeAllResources:()=>A,removeResource:()=>O,splitPrefixFileNameAndExtension:()=>a});var u=r(15861),h=r(66476),g=r(57964),i=r(6785);function p(e){return c.apply(this,arguments)}function c(){return(c=(0,u.Z)(function*(e,t={},n){yield e.load(n);const l=(0,i.v_)(e.itemUrl,"resources"),{start:m=1,num:s=10,sortOrder:f="asc",sortField:j="resource"}=t,I={query:{start:m,num:s,sortOrder:f,sortField:j,token:e.apiKey},signal:n?.signal},P=yield e.portal.request(l,I);return{total:P.total,nextStart:P.nextStart,resources:P.resources.map(({created:C,size:T,resource:K})=>({created:new Date(C),size:T,resource:e.resourceFromPath(K)}))}})).apply(this,arguments)}function E(e,t,n,l){return M.apply(this,arguments)}function M(){return(M=(0,u.Z)(function*(e,t,n,l){const m=new Map;for(const{resource:f,content:j,compress:I,access:P}of t){if(!f.hasPath())throw new g.Z(`portal-item-resource-${n}:invalid-path`,"Resource does not have a valid path");const[C,T]=R(f.path),K=`${C}/${I??""}/${P??""}`;m.has(K)||m.set(K,{prefix:C,compress:I,access:P,files:[]}),m.get(K).files.push({fileName:T,content:j})}yield e.load(l);const s=(0,i.v_)(e.userItemUrl,"add"===n?"addResources":"updateResources");for(const{prefix:f,compress:j,access:I,files:P}of m.values())for(let T=0;T<P.length;T+=25){const K=P.slice(T,T+25),B=new FormData;f&&"."!==f&&B.append("resourcesPrefix",f),j&&B.append("compress","true"),I&&B.append("access",I);let b=0;for(const{fileName:w,content:W}of K)B.append("file"+ ++b,W,w);B.append("f","json"),yield e.portal.request(s,{method:"post",body:B,signal:l?.signal})}})).apply(this,arguments)}function O(e,t,n){return U.apply(this,arguments)}function U(){return(U=(0,u.Z)(function*(e,t,n){if(!t.hasPath())throw new g.Z("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield e.load(n);const l=(0,i.v_)(e.userItemUrl,"removeResources");yield e.portal.request(l,{method:"post",query:{resource:t.path},signal:n?.signal}),t.portalItem=null})).apply(this,arguments)}function A(e,t){return x.apply(this,arguments)}function x(){return(x=(0,u.Z)(function*(e,t){yield e.load(t);const n=(0,i.v_)(e.userItemUrl,"removeResources");return e.portal.request(n,{method:"post",query:{deleteAll:!0},signal:t?.signal})})).apply(this,arguments)}function R(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function a(e){const[t,n]=function o(e){const t=(0,i.Ml)(e);return null==t?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}(e),[l,m]=R(t);return[l,m,n]}function d(e){return _.apply(this,arguments)}function _(){return(_=(0,u.Z)(function*(e){return"blob"===e.type?e.blob:"json"===e.type?new Blob([e.jsonString],{type:"application/json"}):(yield(0,h.Z)(e.url,{responseType:"blob"})).data})).apply(this,arguments)}function D(e,t){if(!e.hasPath())return null;const[n,,l]=a(e.path);return e.portalItem.resourceFromPath((0,i.v_)(n,t+l))}function v(e,t){if(!e.hasPath())return null;const[n,,l]=a(e.path);return e.portalItem.resourceFromPath((0,i.v_)(n,t+l))}},89055:(L,y,r)=>{r.d(y,{H:()=>c,b:()=>M});var u=r(15861),h=r(57964),g=r(79412),i=r(19986),p=r(5251);function c(a,o,d){return E.apply(this,arguments)}function E(){return(E=(0,u.Z)(function*(a,o,d){const _=yield U(a,o,d);yield x(_,o,d)})).apply(this,arguments)}function M(a,o,d,_,D){return O.apply(this,arguments)}function O(){return(O=(0,u.Z)(function*(a,o,d,_,D){const v=yield U(d,_,D);yield a.update({data:o}),yield x(v,_,D)})).apply(this,arguments)}function U(a,o,d){return A.apply(this,arguments)}function A(){return(A=(0,u.Z)(function*(a,o,d){if(!o?.resources)return;const _=o.portalItem===a.portalItem?new Set(a.paths):new Set;a.paths.length=0,a.portalItem=o.portalItem;const D=new Set(o.resources.toKeep.map(s=>s.resource.path)),v=new Set,e=[];D.forEach(s=>{_.delete(s),a.paths.push(s)});const t=[],n=[],l=[];for(const s of o.resources.toUpdate)if(_.delete(s.resource.path),D.has(s.resource.path)||v.has(s.resource.path)){const{resource:f,content:j,finish:I}=s,P=(0,p.getSiblingOfSameTypeI)(f,(0,i.DO)());a.paths.push(P.path),t.push({resource:P,content:yield(0,p.contentToBlob)(j),compress:s.compress}),I&&l.push(()=>I(P))}else{a.paths.push(s.resource.path),n.push({resource:s.resource,content:yield(0,p.contentToBlob)(s.content),compress:s.compress});const f=s.finish;f&&l.push(()=>f(s.resource)),v.add(s.resource.path)}for(const s of o.resources.toAdd)if(a.paths.push(s.resource.path),_.has(s.resource.path))_.delete(s.resource.path);else{t.push({resource:s.resource,content:yield(0,p.contentToBlob)(s.content),compress:s.compress});const f=s.finish;f&&l.push(()=>f(s.resource))}if(t.length||n.length){const{addOrUpdateResources:s}=yield Promise.resolve().then(r.bind(r,5251));yield s(o.portalItem,t,"add",d),yield s(o.portalItem,n,"update",d)}if(l.forEach(s=>s()),0===e.length)return _;const m=yield(0,g.UO)(e);if((0,g.k_)(d),m.length>0)throw new h.Z("save:resources","Failed to save one or more resources",{errors:m});return _})).apply(this,arguments)}function x(a,o,d){return R.apply(this,arguments)}function R(){return(R=(0,u.Z)(function*(a,o,d){if(!a||!o.portalItem)return;const _=[];for(const D of a){const v=o.portalItem.resourceFromPath(D);_.push(v.portalItem.removeResource(v,d))}yield(0,g.as)(_)})).apply(this,arguments)}},88911:(L,y,r)=>{r.d(y,{w:()=>i});var u=r(11931),h=r(57964),g=r(40907);function i(p){if(u.default.apiKey&&(0,g.r)(p.portal.url))throw new h.Z("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${p.portal.url} when using an api key`)}}}]);